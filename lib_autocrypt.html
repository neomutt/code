<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NeoMutt: Autocrypt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><a href="https://neomutt.org"><img alt="Logo" src="neomutt-64.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <a style="color: black; text-decoration: none;" href="https://neomutt.org">
   <div id="projectname">NeoMutt
   &#160;<span id="projectnumber">2025-09-05-43-g177ed6</span>
   </div>
   <div id="projectbrief">Teaching an old dog new tricks</div>
   </a>
   <a href="https://github.com/neomutt/neomutt" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000000; color:#fff; position: fixed; top: 0; border: 0; right: 0; z-index: 9999;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </td>
   <td><a style="text-decoration: none; position: absolute; right: 0; top: 25px; margin-right: 100px; color: #66d866; font-size: 400%;" href="http://www.doxygen.org/index.html">DOXYGEN</a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('lib_autocrypt.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Autocrypt</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>End-to-end encryption</p>
<p>This is an implementation of Autocrypt Level 1.1. <a href="https://autocrypt.org/">https://autocrypt.org/</a></p>
<h2><a class="anchor" id="autotoc_md12"></a>
Still Todo</h2>
<ul>
<li>Setup message creation</li>
<li>Setup message import These can both be added to the account menu, and perhaps the first-run too.</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Developer Notes</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
<code>header-&gt;security | SEC_AUTOCRYPT</code></h3>
<p>During message composition, SEC_AUTOCRYPT is mutually exclusive from SEC_ENCRYPT and SEC_SIGN. The former means that autocrypt will sign and encrypt the email upon send, the latter means the normal keyring will do so.</p>
<p>We keep these separate so that autocrypt can detect the normal keyring has been turned on (manually, or by oppenc or something) and disable itself.</p>
<p>Outside message composition the flags are not exclusive. We can't tell a message is an autocrypt message until we try to decrypt it. Once we do so, the flag is added to the existing flags. The only relevance for decrypted messages is when replying, in which case we want to force using autocrypt in the reply.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
<code>header-&gt;security | SEC_AUTOCRYPT_OVERRIDE</code></h3>
<p>I was loathe to use another bit for this, but unlike SEC_OPPENCRYPT, SEC_AUTOCRYPT means the message <em>will</em> be encrypted, not that the option is on.</p>
<p>We need a way to distinguish between the user manually enabling autocrypt and the recommendation engine doing so. If this is not set, the engine can turn SEC_AUTOCRYPT back off when the recipients change. But if the user manually set it, we don't want to do that.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
<code>mutt_autocrypt_init()</code></h3>
<p>All public functions (in autocrypt.h) should call this function to make sure everything is set up. Nothing prevents the user from manually flipping the option at runtime, but in that case the directory and such may not even exist.</p>
<p>Right now, I only allow "first run" initialization during startup. Not all calls are interactive, and we don't want to prompt the user while opening a mailbox, for instance.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
Database schema version</h3>
<p>There is a "schema" table in the database, which records database version. Any changes to the database should bump the schema version by adding a call in <a class="el" href="autocrypt_2private_8h.html#a6bf8cc8f42e2dce5232ea607b5706b32" title="Update the version number of the Autocrypt database schema.">mutt_autocrypt_schema_update()</a>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">File   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="autocrypt_8c.html" title="Autocrypt end-to-end encryption.">autocrypt/autocrypt.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_autocrypt.html">Autocrypt shared code</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="autocrypt__data_8c.html" title="Private Autocrypt Data.">autocrypt/autocrypt_data.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_autocrypt_data.html">Private Autocrypt Data</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="autocrypt_2config_8c.html" title="Config used by libautocrypt.">autocrypt/config.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_config.html">Autocrypt Config</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="autocrypt_2db_8c.html" title="Autocrypt database handling.">autocrypt/db.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_db.html">Autocrypt database handling</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="dlg__autocrypt_8c.html" title="Autocrypt account menu.">autocrypt/dlg_autocrypt.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_dlg_autocrypt.html">Autocrypt account dialog</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="autocrypt_2expando_8c.html" title="Autocrypt Expando definitions.">autocrypt/expando.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_expando.html">Autocrypt Expando definitions</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="autocrypt_2functions_8c.html" title="Autocrypt functions.">autocrypt/functions.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_functions.html">Autocrypt functions</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="gpgme_8c.html" title="Autocrypt GPGME handler.">autocrypt/gpgme.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_gpgme.html">Autocrypt GPGME handler</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="schema_8c.html" title="Autocrypt database schema.">autocrypt/schema.c</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="autocrypt_schema.html">Autocrypt database schema</a>   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
