<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NeoMutt: ncrypt/smime.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><a href="https://neomutt.org"><img alt="Logo" src="neomutt-64.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <a style="color: black; text-decoration: none;" href="https://neomutt.org">
   <div id="projectname">NeoMutt
   &#160;<span id="projectnumber">2025-09-05-84-g3cce42</span>
   </div>
   <div id="projectbrief">Teaching an old dog new tricks</div>
   </a>
   <a href="https://github.com/neomutt/neomutt" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000000; color:#fff; position: fixed; top: 0; border: 0; right: 0; z-index: 9999;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </td>
   <td><a style="text-decoration: none; position: absolute; right: 0; top: 25px; margin-right: 100px; color: #66d866; font-size: 400%;" href="http://www.doxygen.org/index.html">DOXYGEN</a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('smime_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">smime.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>SMIME helper routines.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;config.h&quot;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="ncrypt_2private_8h_source.html">private.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt_2lib_8h_source.html">mutt/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="address_2lib_8h_source.html">address/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_2lib_8h_source.html">config/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="email_2lib_8h_source.html">email/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="core_2lib_8h_source.html">core/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="alias_2lib_8h_source.html">alias/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="gui_2lib_8h_source.html">gui/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt_8h_source.html">mutt.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ncrypt_2lib_8h_source.html">lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="editor_2lib_8h_source.html">editor/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="expando_2lib_8h_source.html">expando/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="history_2lib_8h_source.html">history/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="question_2lib_8h_source.html">question/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="send_2lib_8h_source.html">send/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="copy_8h_source.html">copy.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="crypt_8h_source.html">crypt.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cryptglue_8h_source.html">cryptglue.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="expando__smime_8h_source.html">expando_smime.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handler_8h_source.html">handler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt__logging_8h_source.html">mutt_logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="smime_8h_source.html">smime.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for smime.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c__incl.svg" width="2423" height="274"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="smime_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6f582853bd091e5fda82a82dc049a38d" id="r_a6f582853bd091e5fda82a82dc049a38d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6f582853bd091e5fda82a82dc049a38d">smime_init</a> (void)</td></tr>
<tr class="memdesc:a6f582853bd091e5fda82a82dc049a38d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise smime globals.  <br /></td></tr>
<tr class="separator:a6f582853bd091e5fda82a82dc049a38d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d3eec74fc4e57062dd82ab74beea573" id="r_a7d3eec74fc4e57062dd82ab74beea573"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7d3eec74fc4e57062dd82ab74beea573">smime_cleanup</a> (void)</td></tr>
<tr class="memdesc:a7d3eec74fc4e57062dd82ab74beea573"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up smime globals.  <br /></td></tr>
<tr class="separator:a7d3eec74fc4e57062dd82ab74beea573"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8fc02f34e610b2f4d7cc6823fb41f3f" id="r_ae8fc02f34e610b2f4d7cc6823fb41f3f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a> (struct <a class="el" href="structSmimeKey.html">SmimeKey</a> **keylist)</td></tr>
<tr class="memdesc:ae8fc02f34e610b2f4d7cc6823fb41f3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a list of SMIME keys.  <br /></td></tr>
<tr class="separator:ae8fc02f34e610b2f4d7cc6823fb41f3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c4c3863f1ccb2a083d402a91c9f026d" id="r_a4c4c3863f1ccb2a083d402a91c9f026d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a> (struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *key)</td></tr>
<tr class="memdesc:a4c4c3863f1ccb2a083d402a91c9f026d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy an SMIME key.  <br /></td></tr>
<tr class="separator:a4c4c3863f1ccb2a083d402a91c9f026d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb364b3c8158f09603b981b70bbee2eb" id="r_gadb364b3c8158f09603b981b70bbee2eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__void__passphrase.html#gadb364b3c8158f09603b981b70bbee2eb">smime_class_void_passphrase</a> (void)</td></tr>
<tr class="memdesc:gadb364b3c8158f09603b981b70bbee2eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forget the cached passphrase - Implements <a class="el" href="structCryptModuleSpecs.html#ac08ed67f7b29c7b6cba6d4999cebf739">CryptModuleSpecs::void_passphrase()</a> -.  <br /></td></tr>
<tr class="separator:gadb364b3c8158f09603b981b70bbee2eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaa50dd72a9aae26aa62d0510121d41f9" id="r_gaaa50dd72a9aae26aa62d0510121d41f9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__valid__passphrase.html#gaaa50dd72a9aae26aa62d0510121d41f9">smime_class_valid_passphrase</a> (void)</td></tr>
<tr class="memdesc:gaaa50dd72a9aae26aa62d0510121d41f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensure we have a valid passphrase - Implements <a class="el" href="structCryptModuleSpecs.html#a8e4fee6a5203c68d854e1d328559889a">CryptModuleSpecs::valid_passphrase()</a> -.  <br /></td></tr>
<tr class="separator:gaaa50dd72a9aae26aa62d0510121d41f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af21a85aeb2bba21e9805e7c827d65d44" id="r_af21a85aeb2bba21e9805e7c827d65d44"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af21a85aeb2bba21e9805e7c827d65d44">smime_command</a> (struct <a class="el" href="structBuffer.html">Buffer</a> *buf, struct <a class="el" href="structSmimeCommandContext.html">SmimeCommandContext</a> *cctx, const struct <a class="el" href="structExpando.html">Expando</a> *exp)</td></tr>
<tr class="memdesc:af21a85aeb2bba21e9805e7c827d65d44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format an SMIME command string.  <br /></td></tr>
<tr class="separator:af21a85aeb2bba21e9805e7c827d65d44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1ab503f8f55cd15916f08d31b3c94ab" id="r_ad1ab503f8f55cd15916f08d31b3c94ab"><td class="memItemLeft" align="right" valign="top">static pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a> (FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname, const char *sig_fname, const char *cryptalg, const char *digestalg, const char *key, const char *certificates, const char *intermediates, const struct <a class="el" href="structExpando.html">Expando</a> *exp)</td></tr>
<tr class="memdesc:ad1ab503f8f55cd15916f08d31b3c94ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run an SMIME command.  <br /></td></tr>
<tr class="separator:ad1ab503f8f55cd15916f08d31b3c94ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87e30ca8724474468609c9defc0f99bf" id="r_a87e30ca8724474468609c9defc0f99bf"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a87e30ca8724474468609c9defc0f99bf">smime_parse_key</a> (char *buf)</td></tr>
<tr class="memdesc:a87e30ca8724474468609c9defc0f99bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an SMIME key block.  <br /></td></tr>
<tr class="separator:a87e30ca8724474468609c9defc0f99bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d0f081748b9e72a7355c87730919647" id="r_a9d0f081748b9e72a7355c87730919647"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9d0f081748b9e72a7355c87730919647">smime_get_candidates</a> (const char *<a class="el" href="menu_2functions_8c.html#ab29e0b2dbd98a3fcd6204ae4dfcfd4cb">search</a>, bool only_public_key)</td></tr>
<tr class="memdesc:a9d0f081748b9e72a7355c87730919647"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find keys matching a string.  <br /></td></tr>
<tr class="separator:a9d0f081748b9e72a7355c87730919647"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e079323e146c10a6e08e27ddc596edf" id="r_a2e079323e146c10a6e08e27ddc596edf"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2e079323e146c10a6e08e27ddc596edf">smime_get_key_by_hash</a> (const char *hash, bool only_public_key)</td></tr>
<tr class="memdesc:a2e079323e146c10a6e08e27ddc596edf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find a key by its hash.  <br /></td></tr>
<tr class="separator:a2e079323e146c10a6e08e27ddc596edf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfb16196155bcfafa112b95298b79c5c" id="r_acfb16196155bcfafa112b95298b79c5c"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acfb16196155bcfafa112b95298b79c5c">smime_get_key_by_addr</a> (const char *mailbox, <a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506">KeyFlags</a> abilities, bool only_public_key, bool oppenc_mode)</td></tr>
<tr class="memdesc:acfb16196155bcfafa112b95298b79c5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find an SIME key by address.  <br /></td></tr>
<tr class="separator:acfb16196155bcfafa112b95298b79c5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c38fdc15799909098d0721429c7d5b8" id="r_a6c38fdc15799909098d0721429c7d5b8"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6c38fdc15799909098d0721429c7d5b8">smime_get_key_by_str</a> (const char *str, <a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506">KeyFlags</a> abilities, bool only_public_key)</td></tr>
<tr class="memdesc:a6c38fdc15799909098d0721429c7d5b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find an SMIME key by string.  <br /></td></tr>
<tr class="separator:a6c38fdc15799909098d0721429c7d5b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affcdbedd1b787e5d656107e922a30c20" id="r_affcdbedd1b787e5d656107e922a30c20"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#affcdbedd1b787e5d656107e922a30c20">smime_ask_for_key</a> (const char *prompt, <a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506">KeyFlags</a> abilities, bool only_public_key)</td></tr>
<tr class="memdesc:affcdbedd1b787e5d656107e922a30c20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ask the user to select a key.  <br /></td></tr>
<tr class="separator:affcdbedd1b787e5d656107e922a30c20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4477a016ba21f15dd55a65c753c47b01" id="r_a4477a016ba21f15dd55a65c753c47b01"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4477a016ba21f15dd55a65c753c47b01">getkeys</a> (const char *mailbox)</td></tr>
<tr class="memdesc:a4477a016ba21f15dd55a65c753c47b01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the keys for a mailbox.  <br /></td></tr>
<tr class="separator:a4477a016ba21f15dd55a65c753c47b01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac0708b7bcdbde024790ae10b6a2abeda" id="r_gac0708b7bcdbde024790ae10b6a2abeda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__smime__getkeys.html#gac0708b7bcdbde024790ae10b6a2abeda">smime_class_getkeys</a> (struct <a class="el" href="structEnvelope.html">Envelope</a> *env)</td></tr>
<tr class="memdesc:gac0708b7bcdbde024790ae10b6a2abeda"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the S/MIME keys required to encrypt this email - Implements <a class="el" href="structCryptModuleSpecs.html#a555d3da530f7c25207fcbae9efa8ab03">CryptModuleSpecs::smime_getkeys()</a> -.  <br /></td></tr>
<tr class="separator:gac0708b7bcdbde024790ae10b6a2abeda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7921d6c191d45637b5bddd61ac32a666" id="r_ga7921d6c191d45637b5bddd61ac32a666"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__find__keys.html#ga7921d6c191d45637b5bddd61ac32a666">smime_class_find_keys</a> (const struct AddressList *al, bool oppenc_mode)</td></tr>
<tr class="memdesc:ga7921d6c191d45637b5bddd61ac32a666"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the keyids of the recipients of a message - Implements <a class="el" href="structCryptModuleSpecs.html#af0b575dd8d3a347cfccd49fe8c2a09b6">CryptModuleSpecs::find_keys()</a> -.  <br /></td></tr>
<tr class="separator:ga7921d6c191d45637b5bddd61ac32a666"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac22eada01fd9622f13deb3f43459d412" id="r_ac22eada01fd9622f13deb3f43459d412"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac22eada01fd9622f13deb3f43459d412">smime_handle_cert_email</a> (const char *certificate, const char *mailbox, bool copy, char ***buffer, int *num)</td></tr>
<tr class="memdesc:ac22eada01fd9622f13deb3f43459d412"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process an email containing certificates.  <br /></td></tr>
<tr class="separator:ac22eada01fd9622f13deb3f43459d412"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab03fce542ee9a7967437403be572d34e" id="r_ab03fce542ee9a7967437403be572d34e"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab03fce542ee9a7967437403be572d34e">smime_extract_certificate</a> (const char *infile)</td></tr>
<tr class="memdesc:ab03fce542ee9a7967437403be572d34e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract an SMIME certificate from a file.  <br /></td></tr>
<tr class="separator:ab03fce542ee9a7967437403be572d34e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8239a280f5be0afe28e328c5917e8d5a" id="r_a8239a280f5be0afe28e328c5917e8d5a"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8239a280f5be0afe28e328c5917e8d5a">smime_extract_signer_certificate</a> (const char *infile)</td></tr>
<tr class="memdesc:a8239a280f5be0afe28e328c5917e8d5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract the signer's certificate.  <br /></td></tr>
<tr class="separator:a8239a280f5be0afe28e328c5917e8d5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga523926006764a23ce6227f7b96f34a6f" id="r_ga523926006764a23ce6227f7b96f34a6f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__smime__invoke__import.html#ga523926006764a23ce6227f7b96f34a6f">smime_class_invoke_import</a> (const char *infile, const char *mailbox)</td></tr>
<tr class="memdesc:ga523926006764a23ce6227f7b96f34a6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a certificate and update index file (externally) - Implements <a class="el" href="structCryptModuleSpecs.html#ad5b7c9666d4927379aaffcd74bf24bb9">CryptModuleSpecs::smime_invoke_import()</a> -.  <br /></td></tr>
<tr class="separator:ga523926006764a23ce6227f7b96f34a6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafb3382e2e21537418ade714435f50f7e" id="r_gafb3382e2e21537418ade714435f50f7e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__smime__verify__sender.html#gafb3382e2e21537418ade714435f50f7e">smime_class_verify_sender</a> (struct <a class="el" href="structEmail.html">Email</a> *e, struct <a class="el" href="structMessage.html">Message</a> *msg)</td></tr>
<tr class="memdesc:gafb3382e2e21537418ade714435f50f7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the sender match the certificate?  <br /></td></tr>
<tr class="separator:gafb3382e2e21537418ade714435f50f7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adffec9377e19186fd331cf38f2226bb9" id="r_adffec9377e19186fd331cf38f2226bb9"><td class="memItemLeft" align="right" valign="top">static pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adffec9377e19186fd331cf38f2226bb9">smime_invoke_encrypt</a> (FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname, const char *uids)</td></tr>
<tr class="memdesc:adffec9377e19186fd331cf38f2226bb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use SMIME to encrypt a file.  <br /></td></tr>
<tr class="separator:adffec9377e19186fd331cf38f2226bb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a302ddcf352fd3fc5d5928a7543781b46" id="r_a302ddcf352fd3fc5d5928a7543781b46"><td class="memItemLeft" align="right" valign="top">static pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a302ddcf352fd3fc5d5928a7543781b46">smime_invoke_sign</a> (FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname)</td></tr>
<tr class="memdesc:a302ddcf352fd3fc5d5928a7543781b46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use SMIME to sign a file.  <br /></td></tr>
<tr class="separator:a302ddcf352fd3fc5d5928a7543781b46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga36daf9001cadaf09a8684d135b44fc6c" id="r_ga36daf9001cadaf09a8684d135b44fc6c"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structBody.html">Body</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__smime__build__smime__entity.html#ga36daf9001cadaf09a8684d135b44fc6c">smime_class_build_smime_entity</a> (struct <a class="el" href="structBody.html">Body</a> *b, char *certlist)</td></tr>
<tr class="memdesc:ga36daf9001cadaf09a8684d135b44fc6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encrypt the email body to all recipients - Implements <a class="el" href="structCryptModuleSpecs.html#abedeb5fcb17d39428eef332bee81e24a">CryptModuleSpecs::smime_build_smime_entity()</a> -.  <br /></td></tr>
<tr class="separator:ga36daf9001cadaf09a8684d135b44fc6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9c2aea99bc63bcb58dab303c4ae3909" id="r_ae9c2aea99bc63bcb58dab303c4ae3909"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae9c2aea99bc63bcb58dab303c4ae3909">openssl_md_to_smime_micalg</a> (const char *md)</td></tr>
<tr class="memdesc:ae9c2aea99bc63bcb58dab303c4ae3909"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change the algorithm names.  <br /></td></tr>
<tr class="separator:ae9c2aea99bc63bcb58dab303c4ae3909"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8b92663dcfebcf295d41d9837985801a" id="r_ga8b92663dcfebcf295d41d9837985801a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structBody.html">Body</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__sign__message.html#ga8b92663dcfebcf295d41d9837985801a">smime_class_sign_message</a> (struct <a class="el" href="structBody.html">Body</a> *b, const struct AddressList *from)</td></tr>
<tr class="memdesc:ga8b92663dcfebcf295d41d9837985801a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cryptographically sign the <a class="el" href="structBody.html" title="The body of an email.">Body</a> of a message - Implements <a class="el" href="structCryptModuleSpecs.html#a2b299059989dd0e333b86782f2138ab3">CryptModuleSpecs::sign_message()</a> -.  <br /></td></tr>
<tr class="separator:ga8b92663dcfebcf295d41d9837985801a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78f4b26aa7184098db006fdc8eb96ae4" id="r_a78f4b26aa7184098db006fdc8eb96ae4"><td class="memItemLeft" align="right" valign="top">static pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a78f4b26aa7184098db006fdc8eb96ae4">smime_invoke_verify</a> (FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname, const char *sig_fname, int opaque)</td></tr>
<tr class="memdesc:a78f4b26aa7184098db006fdc8eb96ae4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use SMIME to verify a file.  <br /></td></tr>
<tr class="separator:a78f4b26aa7184098db006fdc8eb96ae4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8eb0f60e2b6099bf5cacf6d39d821e1f" id="r_a8eb0f60e2b6099bf5cacf6d39d821e1f"><td class="memItemLeft" align="right" valign="top">static pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8eb0f60e2b6099bf5cacf6d39d821e1f">smime_invoke_decrypt</a> (FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname)</td></tr>
<tr class="memdesc:a8eb0f60e2b6099bf5cacf6d39d821e1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use SMIME to decrypt a file.  <br /></td></tr>
<tr class="separator:a8eb0f60e2b6099bf5cacf6d39d821e1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3ab0fc69c683d591e2ecf6a4e79b2f37" id="r_ga3ab0fc69c683d591e2ecf6a4e79b2f37"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__verify__one.html#ga3ab0fc69c683d591e2ecf6a4e79b2f37">smime_class_verify_one</a> (struct <a class="el" href="structBody.html">Body</a> *b, struct <a class="el" href="structState.html">State</a> *state, const char *tempfile)</td></tr>
<tr class="memdesc:ga3ab0fc69c683d591e2ecf6a4e79b2f37"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check a signed MIME part against a signature - Implements <a class="el" href="structCryptModuleSpecs.html#abe8b95602735ac15f4f3a8d6ab1dc45b">CryptModuleSpecs::verify_one()</a> -.  <br /></td></tr>
<tr class="separator:ga3ab0fc69c683d591e2ecf6a4e79b2f37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83eb7260d3b15365720064e2db623b34" id="r_a83eb7260d3b15365720064e2db623b34"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structBody.html">Body</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a83eb7260d3b15365720064e2db623b34">smime_handle_entity</a> (struct <a class="el" href="structBody.html">Body</a> *b, struct <a class="el" href="structState.html">State</a> *state, FILE *fp_out_file)</td></tr>
<tr class="memdesc:a83eb7260d3b15365720064e2db623b34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle type application/pkcs7-mime.  <br /></td></tr>
<tr class="separator:a83eb7260d3b15365720064e2db623b34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9885e7131d9a5d4053b196bbe146af40" id="r_ga9885e7131d9a5d4053b196bbe146af40"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__decrypt__mime.html#ga9885e7131d9a5d4053b196bbe146af40">smime_class_decrypt_mime</a> (FILE *fp_in, FILE **fp_out, struct <a class="el" href="structBody.html">Body</a> *b, struct <a class="el" href="structBody.html">Body</a> **b_dec)</td></tr>
<tr class="memdesc:ga9885e7131d9a5d4053b196bbe146af40"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decrypt an encrypted MIME part - Implements <a class="el" href="structCryptModuleSpecs.html#a18cf5903d388ba3cc91431e5076271ee">CryptModuleSpecs::decrypt_mime()</a> -.  <br /></td></tr>
<tr class="separator:ga9885e7131d9a5d4053b196bbe146af40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga77eef2288f13097abdd210ac1ed1e4d1" id="r_ga77eef2288f13097abdd210ac1ed1e4d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__application__handler.html#ga77eef2288f13097abdd210ac1ed1e4d1">smime_class_application_handler</a> (struct <a class="el" href="structBody.html">Body</a> *b, struct <a class="el" href="structState.html">State</a> *state)</td></tr>
<tr class="memdesc:ga77eef2288f13097abdd210ac1ed1e4d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manage the MIME type "application/pgp" or "application/smime" - Implements <a class="el" href="structCryptModuleSpecs.html#a9d7b47fb748a7cdb4975f2dde8179a98">CryptModuleSpecs::application_handler()</a> -.  <br /></td></tr>
<tr class="separator:ga77eef2288f13097abdd210ac1ed1e4d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga95da8ee8b6073935efb814164ff9ee78" id="r_ga95da8ee8b6073935efb814164ff9ee78"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ncrypt_2lib_8h.html#a2073a168ca3a64c3c30d13fa4917a05d">SecurityFlags</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__crypto__send__menu.html#ga95da8ee8b6073935efb814164ff9ee78">smime_class_send_menu</a> (struct <a class="el" href="structEmail.html">Email</a> *e)</td></tr>
<tr class="memdesc:ga95da8ee8b6073935efb814164ff9ee78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ask the user whether to sign and/or encrypt the email - Implements <a class="el" href="structCryptModuleSpecs.html#aa5176c9adfe75f78d99e4c2bd7e6671c">CryptModuleSpecs::send_menu()</a> -.  <br /></td></tr>
<tr class="separator:ga95da8ee8b6073935efb814164ff9ee78"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a34dd93b9b68b65428e25c44739a51349" id="r_a34dd93b9b68b65428e25c44739a51349"><td class="memItemLeft" align="right" valign="top">static char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a34dd93b9b68b65428e25c44739a51349">SmimePass</a> [256]</td></tr>
<tr class="memdesc:a34dd93b9b68b65428e25c44739a51349"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cached Smime Passphrase.  <br /></td></tr>
<tr class="separator:a34dd93b9b68b65428e25c44739a51349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4009b05bed4b2cee11d0e78bc8d67ba7" id="r_a4009b05bed4b2cee11d0e78bc8d67ba7"><td class="memItemLeft" align="right" valign="top">static time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4009b05bed4b2cee11d0e78bc8d67ba7">SmimeExpTime</a> = 0</td></tr>
<tr class="memdesc:a4009b05bed4b2cee11d0e78bc8d67ba7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unix time when <a class="el" href="#a34dd93b9b68b65428e25c44739a51349" title="Cached Smime Passphrase.">SmimePass</a> expires.  <br /></td></tr>
<tr class="separator:a4009b05bed4b2cee11d0e78bc8d67ba7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6e38e9a28b61f5b2a7040931e58afaa" id="r_aa6e38e9a28b61f5b2a7040931e58afaa"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structBuffer.html">Buffer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a> = { 0 }</td></tr>
<tr class="memdesc:aa6e38e9a28b61f5b2a7040931e58afaa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Smime key to use.  <br /></td></tr>
<tr class="separator:aa6e38e9a28b61f5b2a7040931e58afaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad37cb485abe0aeafae99190ea323d3c4" id="r_ad37cb485abe0aeafae99190ea323d3c4"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structBuffer.html">Buffer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad37cb485abe0aeafae99190ea323d3c4">SmimeCertToUse</a> = { 0 }</td></tr>
<tr class="memdesc:ad37cb485abe0aeafae99190ea323d3c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Smime certificate to use.  <br /></td></tr>
<tr class="separator:ad37cb485abe0aeafae99190ea323d3c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19c9a640138167646b8df02dcd2a7234" id="r_a19c9a640138167646b8df02dcd2a7234"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structBuffer.html">Buffer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a19c9a640138167646b8df02dcd2a7234">SmimeIntermediateToUse</a> = { 0 }</td></tr>
<tr class="memdesc:a19c9a640138167646b8df02dcd2a7234"><td class="mdescLeft">&#160;</td><td class="mdescRight">Smime intermediate certificate to use.  <br /></td></tr>
<tr class="separator:a19c9a640138167646b8df02dcd2a7234"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>SMIME helper routines. </p>
<dl class="section author"><dt>Authors</dt><dd><ul>
<li>Richard Russon</li>
<li>Pietro Cerutti</li>
<li>Lars Haalck</li>
<li>Anna Figueiredo Gomes</li>
<li>Alejandro Colomar</li>
<li>Tóth János</li>
</ul>
</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 2 of the License, or (at your option) any later version.</dd></dl>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>

<p class="definition">Definition in file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a6f582853bd091e5fda82a82dc049a38d" name="a6f582853bd091e5fda82a82dc049a38d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f582853bd091e5fda82a82dc049a38d">&#9670;&#160;</a></span>smime_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void smime_init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise smime globals. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00081">81</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   82</span>{</div>
<div class="line"><span class="lineno">   83</span>  <a class="code hl_function" href="buffer_8c.html#ae144a736bd5f9de289bdc8f27fecf96a">buf_alloc</a>(&amp;<a class="code hl_variable" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a>, 256);</div>
<div class="line"><span class="lineno">   84</span>  <a class="code hl_function" href="buffer_8c.html#ae144a736bd5f9de289bdc8f27fecf96a">buf_alloc</a>(&amp;<a class="code hl_variable" href="#ad37cb485abe0aeafae99190ea323d3c4">SmimeCertToUse</a>, 256);</div>
<div class="line"><span class="lineno">   85</span>  <a class="code hl_function" href="buffer_8c.html#ae144a736bd5f9de289bdc8f27fecf96a">buf_alloc</a>(&amp;<a class="code hl_variable" href="#a19c9a640138167646b8df02dcd2a7234">SmimeIntermediateToUse</a>, 256);</div>
<div class="line"><span class="lineno">   86</span>}</div>
<div class="ttc" id="abuffer_8c_html_ae144a736bd5f9de289bdc8f27fecf96a"><div class="ttname"><a href="buffer_8c.html#ae144a736bd5f9de289bdc8f27fecf96a">buf_alloc</a></div><div class="ttdeci">void buf_alloc(struct Buffer *buf, size_t new_size)</div><div class="ttdoc">Make sure a buffer can store at least new_size bytes.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00337">buffer.c:337</a></div></div>
<div class="ttc" id="asmime_8c_html_a19c9a640138167646b8df02dcd2a7234"><div class="ttname"><a href="#a19c9a640138167646b8df02dcd2a7234">SmimeIntermediateToUse</a></div><div class="ttdeci">static struct Buffer SmimeIntermediateToUse</div><div class="ttdoc">Smime intermediate certificate to use.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00076">smime.c:76</a></div></div>
<div class="ttc" id="asmime_8c_html_aa6e38e9a28b61f5b2a7040931e58afaa"><div class="ttname"><a href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a></div><div class="ttdeci">static struct Buffer SmimeKeyToUse</div><div class="ttdoc">Smime key to use.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00072">smime.c:72</a></div></div>
<div class="ttc" id="asmime_8c_html_ad37cb485abe0aeafae99190ea323d3c4"><div class="ttname"><a href="#ad37cb485abe0aeafae99190ea323d3c4">SmimeCertToUse</a></div><div class="ttdeci">static struct Buffer SmimeCertToUse</div><div class="ttdoc">Smime certificate to use.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00074">smime.c:74</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a6f582853bd091e5fda82a82dc049a38d_cgraph.svg" width="222" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-2" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a6f582853bd091e5fda82a82dc049a38d_icgraph.svg" width="268" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7d3eec74fc4e57062dd82ab74beea573" name="a7d3eec74fc4e57062dd82ab74beea573"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d3eec74fc4e57062dd82ab74beea573">&#9670;&#160;</a></span>smime_cleanup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void smime_cleanup </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up smime globals. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00091">91</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   92</span>{</div>
<div class="line"><span class="lineno">   93</span>  <a class="code hl_function" href="buffer_8c.html#a3847c69d3b333d1674043d7f5b7b112f">buf_dealloc</a>(&amp;<a class="code hl_variable" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a>);</div>
<div class="line"><span class="lineno">   94</span>  <a class="code hl_function" href="buffer_8c.html#a3847c69d3b333d1674043d7f5b7b112f">buf_dealloc</a>(&amp;<a class="code hl_variable" href="#ad37cb485abe0aeafae99190ea323d3c4">SmimeCertToUse</a>);</div>
<div class="line"><span class="lineno">   95</span>  <a class="code hl_function" href="buffer_8c.html#a3847c69d3b333d1674043d7f5b7b112f">buf_dealloc</a>(&amp;<a class="code hl_variable" href="#a19c9a640138167646b8df02dcd2a7234">SmimeIntermediateToUse</a>);</div>
<div class="line"><span class="lineno">   96</span>}</div>
<div class="ttc" id="abuffer_8c_html_a3847c69d3b333d1674043d7f5b7b112f"><div class="ttname"><a href="buffer_8c.html#a3847c69d3b333d1674043d7f5b7b112f">buf_dealloc</a></div><div class="ttdeci">void buf_dealloc(struct Buffer *buf)</div><div class="ttdoc">Release the memory allocated by a buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00377">buffer.c:377</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a7d3eec74fc4e57062dd82ab74beea573_cgraph.svg" width="267" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-4" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a7d3eec74fc4e57062dd82ab74beea573_icgraph.svg" width="326" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae8fc02f34e610b2f4d7cc6823fb41f3f" name="ae8fc02f34e610b2f4d7cc6823fb41f3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">&#9670;&#160;</a></span>smime_key_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void smime_key_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structSmimeKey.html">SmimeKey</a> **</td>          <td class="paramname"><span class="paramname"><em>keylist</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Free a list of SMIME keys. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">keylist</td><td>List of keys to free </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00102">102</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  103</span>{</div>
<div class="line"><span class="lineno">  104</span>  <span class="keywordflow">if</span> (!keylist)</div>
<div class="line"><span class="lineno">  105</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *key = NULL;</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>  <span class="keywordflow">while</span> (*keylist)</div>
<div class="line"><span class="lineno">  110</span>  {</div>
<div class="line"><span class="lineno">  111</span>    key = *keylist;</div>
<div class="line"><span class="lineno">  112</span>    *keylist = (*keylist)-&gt;<a class="code hl_variable" href="structSmimeKey.html#a5123a1f750cbd3057df958bb785459b2">next</a>;</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a9f73117582d0292e71e7867b7909326c">email</a>);</div>
<div class="line"><span class="lineno">  115</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a>);</div>
<div class="line"><span class="lineno">  116</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;key-&gt;<a class="code hl_variable" href="structSmimeKey.html#ab9df91118c710284278ceaeb98769f7c">label</a>);</div>
<div class="line"><span class="lineno">  117</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a6921c2922bea84854b90eab1b7e90f1e">issuer</a>);</div>
<div class="line"><span class="lineno">  118</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;key);</div>
<div class="line"><span class="lineno">  119</span>  }</div>
<div class="line"><span class="lineno">  120</span>}</div>
<div class="ttc" id="amemory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition</b> <a href="memory_8h_source.html#l00062">memory.h:62</a></div></div>
<div class="ttc" id="astructSmimeKey_html"><div class="ttname"><a href="structSmimeKey.html">SmimeKey</a></div><div class="ttdoc">An SIME key.</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00042">smime.h:43</a></div></div>
<div class="ttc" id="astructSmimeKey_html_a34c24c91867b2600f20b6d892ef156bb"><div class="ttname"><a href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">SmimeKey::hash</a></div><div class="ttdeci">char * hash</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00045">smime.h:45</a></div></div>
<div class="ttc" id="astructSmimeKey_html_a5123a1f750cbd3057df958bb785459b2"><div class="ttname"><a href="structSmimeKey.html#a5123a1f750cbd3057df958bb785459b2">SmimeKey::next</a></div><div class="ttdeci">struct SmimeKey * next</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00050">smime.h:50</a></div></div>
<div class="ttc" id="astructSmimeKey_html_a6921c2922bea84854b90eab1b7e90f1e"><div class="ttname"><a href="structSmimeKey.html#a6921c2922bea84854b90eab1b7e90f1e">SmimeKey::issuer</a></div><div class="ttdeci">char * issuer</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00047">smime.h:47</a></div></div>
<div class="ttc" id="astructSmimeKey_html_a9f73117582d0292e71e7867b7909326c"><div class="ttname"><a href="structSmimeKey.html#a9f73117582d0292e71e7867b7909326c">SmimeKey::email</a></div><div class="ttdeci">char * email</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00044">smime.h:44</a></div></div>
<div class="ttc" id="astructSmimeKey_html_ab9df91118c710284278ceaeb98769f7c"><div class="ttname"><a href="structSmimeKey.html#ab9df91118c710284278ceaeb98769f7c">SmimeKey::label</a></div><div class="ttdeci">char * label</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00046">smime.h:46</a></div></div>
</div><!-- fragment --><div id="dynsection-5" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ae8fc02f34e610b2f4d7cc6823fb41f3f_icgraph.svg" width="591" height="396"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4c4c3863f1ccb2a083d402a91c9f026d" name="a4c4c3863f1ccb2a083d402a91c9f026d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c4c3863f1ccb2a083d402a91c9f026d">&#9670;&#160;</a></span>smime_copy_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> * smime_copy_key </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structSmimeKey.html">SmimeKey</a> *</td>          <td class="paramname"><span class="paramname"><em>key</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copy an SMIME key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>Key to copy </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Newly allocated SMIME key </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00127">127</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  128</span>{</div>
<div class="line"><span class="lineno">  129</span>  <span class="keywordflow">if</span> (!key)</div>
<div class="line"><span class="lineno">  130</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *copy = NULL;</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>  copy = <a class="code hl_define" href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a>(1, <span class="keyword">struct</span> <a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a>);</div>
<div class="line"><span class="lineno">  135</span>  copy-&gt;<a class="code hl_variable" href="structSmimeKey.html#a9f73117582d0292e71e7867b7909326c">email</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a9f73117582d0292e71e7867b7909326c">email</a>);</div>
<div class="line"><span class="lineno">  136</span>  copy-&gt;<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a>);</div>
<div class="line"><span class="lineno">  137</span>  copy-&gt;<a class="code hl_variable" href="structSmimeKey.html#ab9df91118c710284278ceaeb98769f7c">label</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(key-&gt;<a class="code hl_variable" href="structSmimeKey.html#ab9df91118c710284278ceaeb98769f7c">label</a>);</div>
<div class="line"><span class="lineno">  138</span>  copy-&gt;<a class="code hl_variable" href="structSmimeKey.html#a6921c2922bea84854b90eab1b7e90f1e">issuer</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a6921c2922bea84854b90eab1b7e90f1e">issuer</a>);</div>
<div class="line"><span class="lineno">  139</span>  copy-&gt;<a class="code hl_variable" href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">trust</a> = key-&gt;<a class="code hl_variable" href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">trust</a>;</div>
<div class="line"><span class="lineno">  140</span>  copy-&gt;<a class="code hl_variable" href="structSmimeKey.html#a04a10c0ce76603a444b05e0110f92f88">flags</a> = key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a04a10c0ce76603a444b05e0110f92f88">flags</a>;</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>  <span class="keywordflow">return</span> copy;</div>
<div class="line"><span class="lineno">  143</span>}</div>
<div class="ttc" id="amemory_8h_html_a9aaf8f21a29735767a069ff1aee9d7d9"><div class="ttname"><a href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a></div><div class="ttdeci">#define MUTT_MEM_CALLOC(n, type)</div><div class="ttdef"><b>Definition</b> <a href="memory_8h_source.html#l00047">memory.h:47</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a3fe33d90e4814281cd57de048119c950"><div class="ttname"><a href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a></div><div class="ttdeci">char * mutt_str_dup(const char *str)</div><div class="ttdoc">Copy a string, safely.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00255">string.c:255</a></div></div>
<div class="ttc" id="astructSmimeKey_html_a04a10c0ce76603a444b05e0110f92f88"><div class="ttname"><a href="structSmimeKey.html#a04a10c0ce76603a444b05e0110f92f88">SmimeKey::flags</a></div><div class="ttdeci">KeyFlags flags</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00049">smime.h:49</a></div></div>
<div class="ttc" id="astructSmimeKey_html_abc36d7072ad69579e39e26326eed39e0"><div class="ttname"><a href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">SmimeKey::trust</a></div><div class="ttdeci">char trust</div><div class="ttdoc">i=Invalid r=revoked e=expired u=unverified v=verified t=trusted</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00048">smime.h:48</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a4c4c3863f1ccb2a083d402a91c9f026d_cgraph.svg" width="288" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-7" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a4c4c3863f1ccb2a083d402a91c9f026d_icgraph.svg" width="356" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af21a85aeb2bba21e9805e7c827d65d44" name="af21a85aeb2bba21e9805e7c827d65d44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af21a85aeb2bba21e9805e7c827d65d44">&#9670;&#160;</a></span>smime_command()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void smime_command </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structBuffer.html">Buffer</a> *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structSmimeCommandContext.html">SmimeCommandContext</a> *</td>          <td class="paramname"><span class="paramname"><em>cctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structExpando.html">Expando</a> *</td>          <td class="paramname"><span class="paramname"><em>exp</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Format an SMIME command string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer.">Buffer</a> for the result </td></tr>
    <tr><td class="paramname">cctx</td><td>Data to pass to the formatter </td></tr>
    <tr><td class="paramname">exp</td><td><a class="el" href="structExpando.html" title="Parsed Expando trees.">Expando</a> to use </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00194">194</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  196</span>{</div>
<div class="line"><span class="lineno">  197</span>  <a class="code hl_function" href="expando_2expando_8c.html#ab4abd85472e0638449c5a98159b0f9be">expando_render</a>(exp, <a class="code hl_variable" href="expando__smime_8c.html#ab3b5356f1777d3822f9f51dc5c566f21">SmimeCommandRenderCallbacks</a>, cctx, <a class="code hl_define" href="render_8h.html#a5167e8b2777abe5e02be90e0d2a816de">MUTT_FORMAT_NO_FLAGS</a>,</div>
<div class="line"><span class="lineno">  198</span>                 buf-&gt;<a class="code hl_variable" href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">dsize</a>, buf);</div>
<div class="line"><span class="lineno">  199</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(buf));</div>
<div class="line"><span class="lineno">  200</span>}</div>
<div class="ttc" id="abuffer_8h_html_a728ebc5a947b77c8d56db44ce553a7ab"><div class="ttname"><a href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a></div><div class="ttdeci">static const char * buf_string(const struct Buffer *buf)</div><div class="ttdoc">Convert a buffer to a const char * &quot;string&quot;.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00096">buffer.h:96</a></div></div>
<div class="ttc" id="aexpando_2expando_8c_html_ab4abd85472e0638449c5a98159b0f9be"><div class="ttname"><a href="expando_2expando_8c.html#ab4abd85472e0638449c5a98159b0f9be">expando_render</a></div><div class="ttdeci">int expando_render(const struct Expando *exp, const struct ExpandoRenderCallback *erc, void *data, MuttFormatFlags flags, int max_cols, struct Buffer *buf)</div><div class="ttdoc">Render an Expando + data into a string.</div><div class="ttdef"><b>Definition</b> <a href="expando_2expando_8c_source.html#l00118">expando.c:118</a></div></div>
<div class="ttc" id="aexpando__smime_8c_html_ab3b5356f1777d3822f9f51dc5c566f21"><div class="ttname"><a href="expando__smime_8c.html#ab3b5356f1777d3822f9f51dc5c566f21">SmimeCommandRenderCallbacks</a></div><div class="ttdeci">const struct ExpandoRenderCallback SmimeCommandRenderCallbacks[]</div><div class="ttdoc">Callbacks for Smime Command Expandos.</div><div class="ttdef"><b>Definition</b> <a href="expando__smime_8c_source.html#l00162">expando_smime.c:162</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00090">logging2.h:90</a></div></div>
<div class="ttc" id="alogging2_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdeci">@ LL_DEBUG2</div><div class="ttdoc">Log at debug level 2.</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00045">logging2.h:45</a></div></div>
<div class="ttc" id="arender_8h_html_a5167e8b2777abe5e02be90e0d2a816de"><div class="ttname"><a href="render_8h.html#a5167e8b2777abe5e02be90e0d2a816de">MUTT_FORMAT_NO_FLAGS</a></div><div class="ttdeci">#define MUTT_FORMAT_NO_FLAGS</div><div class="ttdoc">No flags are set.</div><div class="ttdef"><b>Definition</b> <a href="render_8h_source.html#l00033">render.h:33</a></div></div>
<div class="ttc" id="astructBuffer_html_a1d9ee60bcf94de702b15ec2b5d811995"><div class="ttname"><a href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">Buffer::dsize</a></div><div class="ttdeci">size_t dsize</div><div class="ttdoc">Length of data.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00039">buffer.h:39</a></div></div>
</div><!-- fragment --><div id="dynsection-8" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_af21a85aeb2bba21e9805e7c827d65d44_cgraph.svg" width="312" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-9" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_af21a85aeb2bba21e9805e7c827d65d44_icgraph.svg" width="298" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad1ab503f8f55cd15916f08d31b3c94ab" name="ad1ab503f8f55cd15916f08d31b3c94ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1ab503f8f55cd15916f08d31b3c94ab">&#9670;&#160;</a></span>smime_invoke()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pid_t smime_invoke </td>
          <td>(</td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_out</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_err</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_infd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_outfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_errfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>sig_fname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>cryptalg</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>digestalg</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>key</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>certificates</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>intermediates</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structExpando.html">Expando</a> *</td>          <td class="paramname"><span class="paramname"><em>exp</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Run an SMIME command. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_in</td><td>stdin for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_out</td><td>stdout for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_err</td><td>stderr for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_infd</td><td>stdin for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_outfd</td><td>stdout for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_errfd</td><td>stderr for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>Filename to pass to the command </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sig_fname</td><td>Signature filename to pass to the command </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cryptalg</td><td>Encryption algorithm </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">digestalg</td><td>Hashing algorithm </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>SMIME key </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">certificates</td><td>Public certificates </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">intermediates</td><td>Intermediate certificates </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exp</td><td><a class="el" href="structExpando.html" title="Parsed Expando trees.">Expando</a> format string </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">num</td><td>PID of the created process </td></tr>
    <tr><td class="paramname">-1</td><td>Error creating pipes or forking</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><code>fp_smime_in</code> has priority over <code>fp_smime_infd</code>. Likewise <code>fp_smime_out</code> and <code>fp_smime_err</code>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00224">224</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  229</span>{</div>
<div class="line"><span class="lineno">  230</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeCommandContext.html">SmimeCommandContext</a> cctx = { 0 };</div>
<div class="line"><span class="lineno">  231</span> </div>
<div class="line"><span class="lineno">  232</span>  <span class="keywordflow">if</span> (!exp)</div>
<div class="line"><span class="lineno">  233</span>    <span class="keywordflow">return</span> (pid_t) -1;</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span>  cctx.<a class="code hl_variable" href="structSmimeCommandContext.html#ac09e42923cceb83c265f5bd163a92c8c">fname</a> = <a class="code hl_variable" href="structSmimeCommandContext.html#ac09e42923cceb83c265f5bd163a92c8c">fname</a>;</div>
<div class="line"><span class="lineno">  236</span>  cctx.<a class="code hl_variable" href="structSmimeCommandContext.html#a188afd96c520aa3b0b6caf6988ceab2b">sig_fname</a> = <a class="code hl_variable" href="structSmimeCommandContext.html#a188afd96c520aa3b0b6caf6988ceab2b">sig_fname</a>;</div>
<div class="line"><span class="lineno">  237</span>  cctx.<a class="code hl_variable" href="structSmimeCommandContext.html#a7c5e080eefc6e98377db7ba11f5ffbba">key</a> = <a class="code hl_variable" href="structSmimeCommandContext.html#a7c5e080eefc6e98377db7ba11f5ffbba">key</a>;</div>
<div class="line"><span class="lineno">  238</span>  cctx.<a class="code hl_variable" href="structSmimeCommandContext.html#a63b73e1d2b6bf1aa106c22ce970cda97">cryptalg</a> = <a class="code hl_variable" href="structSmimeCommandContext.html#a63b73e1d2b6bf1aa106c22ce970cda97">cryptalg</a>;</div>
<div class="line"><span class="lineno">  239</span>  cctx.<a class="code hl_variable" href="structSmimeCommandContext.html#a3dee10ce395177b61300c96086c22ea4">digestalg</a> = <a class="code hl_variable" href="structSmimeCommandContext.html#a3dee10ce395177b61300c96086c22ea4">digestalg</a>;</div>
<div class="line"><span class="lineno">  240</span>  cctx.<a class="code hl_variable" href="structSmimeCommandContext.html#afe0c9c15aecd2aad514743a45c52d6d8">certificates</a> = <a class="code hl_variable" href="structSmimeCommandContext.html#afe0c9c15aecd2aad514743a45c52d6d8">certificates</a>;</div>
<div class="line"><span class="lineno">  241</span>  cctx.<a class="code hl_variable" href="structSmimeCommandContext.html#a2bfac5bbad182bcb933d0dffcb1f9d43">intermediates</a> = <a class="code hl_variable" href="structSmimeCommandContext.html#a2bfac5bbad182bcb933d0dffcb1f9d43">intermediates</a>;</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *cmd = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  244</span>  <a class="code hl_function" href="#af21a85aeb2bba21e9805e7c827d65d44">smime_command</a>(cmd, &amp;cctx, exp);</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>  pid_t pid = <a class="code hl_function" href="mutt_2filter_8c.html#a8b8175018aa96307b2cf569d719ca6dc">filter_create_fd</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(cmd), fp_smime_in, fp_smime_out,</div>
<div class="line"><span class="lineno">  247</span>                               fp_smime_err, fp_smime_infd, fp_smime_outfd,</div>
<div class="line"><span class="lineno">  248</span>                               fp_smime_errfd, <a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#a5410041863c473ba1f27b415c0a40482">env</a>);</div>
<div class="line"><span class="lineno">  249</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;cmd);</div>
<div class="line"><span class="lineno">  250</span>  <span class="keywordflow">return</span> pid;</div>
<div class="line"><span class="lineno">  251</span>}</div>
<div class="ttc" id="amutt_2filter_8c_html_a8b8175018aa96307b2cf569d719ca6dc"><div class="ttname"><a href="mutt_2filter_8c.html#a8b8175018aa96307b2cf569d719ca6dc">filter_create_fd</a></div><div class="ttdeci">pid_t filter_create_fd(const char *cmd, FILE **fp_in, FILE **fp_out, FILE **fp_err, int fdin, int fdout, int fderr, char **envlist)</div><div class="ttdoc">Run a command on a pipe (optionally connect stdin/stdout)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2filter_8c_source.html#l00062">filter.c:62</a></div></div>
<div class="ttc" id="apool_8c_html_a41cba27c25d33cb6822789a2856093f2"><div class="ttname"><a href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a></div><div class="ttdeci">struct Buffer * buf_pool_get(void)</div><div class="ttdoc">Get a Buffer from the pool.</div><div class="ttdef"><b>Definition</b> <a href="pool_8c_source.html#l00082">pool.c:82</a></div></div>
<div class="ttc" id="apool_8c_html_a4cc6068279461cb8628219586dfa35a1"><div class="ttname"><a href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a></div><div class="ttdeci">void buf_pool_release(struct Buffer **ptr)</div><div class="ttdoc">Return a Buffer to the pool.</div><div class="ttdef"><b>Definition</b> <a href="pool_8c_source.html#l00096">pool.c:96</a></div></div>
<div class="ttc" id="asmime_8c_html_af21a85aeb2bba21e9805e7c827d65d44"><div class="ttname"><a href="#af21a85aeb2bba21e9805e7c827d65d44">smime_command</a></div><div class="ttdeci">static void smime_command(struct Buffer *buf, struct SmimeCommandContext *cctx, const struct Expando *exp)</div><div class="ttdoc">Format an SMIME command string.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00194">smime.c:194</a></div></div>
<div class="ttc" id="astructBuffer_html"><div class="ttname"><a href="structBuffer.html">Buffer</a></div><div class="ttdoc">String manipulation buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00035">buffer.h:36</a></div></div>
<div class="ttc" id="astructNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00041">neomutt.h:42</a></div></div>
<div class="ttc" id="astructNeoMutt_html_a5410041863c473ba1f27b415c0a40482"><div class="ttname"><a href="structNeoMutt.html#a5410041863c473ba1f27b415c0a40482">NeoMutt::env</a></div><div class="ttdeci">char ** env</div><div class="ttdoc">Private copy of the environment variables.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00054">neomutt.h:54</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html"><div class="ttname"><a href="structSmimeCommandContext.html">SmimeCommandContext</a></div><div class="ttdoc">Data for a SIME command.</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00057">smime.h:58</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html_a188afd96c520aa3b0b6caf6988ceab2b"><div class="ttname"><a href="structSmimeCommandContext.html#a188afd96c520aa3b0b6caf6988ceab2b">SmimeCommandContext::sig_fname</a></div><div class="ttdeci">const char * sig_fname</div><div class="ttdoc">s</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00063">smime.h:63</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html_a2bfac5bbad182bcb933d0dffcb1f9d43"><div class="ttname"><a href="structSmimeCommandContext.html#a2bfac5bbad182bcb933d0dffcb1f9d43">SmimeCommandContext::intermediates</a></div><div class="ttdeci">const char * intermediates</div><div class="ttdoc">i</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00065">smime.h:65</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html_a3dee10ce395177b61300c96086c22ea4"><div class="ttname"><a href="structSmimeCommandContext.html#a3dee10ce395177b61300c96086c22ea4">SmimeCommandContext::digestalg</a></div><div class="ttdeci">const char * digestalg</div><div class="ttdoc">d</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00061">smime.h:61</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html_a63b73e1d2b6bf1aa106c22ce970cda97"><div class="ttname"><a href="structSmimeCommandContext.html#a63b73e1d2b6bf1aa106c22ce970cda97">SmimeCommandContext::cryptalg</a></div><div class="ttdeci">const char * cryptalg</div><div class="ttdoc">a</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00060">smime.h:60</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html_a7c5e080eefc6e98377db7ba11f5ffbba"><div class="ttname"><a href="structSmimeCommandContext.html#a7c5e080eefc6e98377db7ba11f5ffbba">SmimeCommandContext::key</a></div><div class="ttdeci">const char * key</div><div class="ttdoc">k</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00059">smime.h:59</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html_ac09e42923cceb83c265f5bd163a92c8c"><div class="ttname"><a href="structSmimeCommandContext.html#ac09e42923cceb83c265f5bd163a92c8c">SmimeCommandContext::fname</a></div><div class="ttdeci">const char * fname</div><div class="ttdoc">f</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00062">smime.h:62</a></div></div>
<div class="ttc" id="astructSmimeCommandContext_html_afe0c9c15aecd2aad514743a45c52d6d8"><div class="ttname"><a href="structSmimeCommandContext.html#afe0c9c15aecd2aad514743a45c52d6d8">SmimeCommandContext::certificates</a></div><div class="ttdeci">const char * certificates</div><div class="ttdoc">c</div><div class="ttdef"><b>Definition</b> <a href="smime_8h_source.html#l00064">smime.h:64</a></div></div>
</div><!-- fragment --><div id="dynsection-10" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ad1ab503f8f55cd15916f08d31b3c94ab_cgraph.svg" width="430" height="251"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-11" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ad1ab503f8f55cd15916f08d31b3c94ab_icgraph.svg" width="540" height="420"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a87e30ca8724474468609c9defc0f99bf" name="a87e30ca8724474468609c9defc0f99bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87e30ca8724474468609c9defc0f99bf">&#9670;&#160;</a></span>smime_parse_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> * smime_parse_key </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an SMIME key block. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>String to parse </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>SMIME key </td></tr>
    <tr><td class="paramname">NULL</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00259">259</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  260</span>{</div>
<div class="line"><span class="lineno">  261</span>  <span class="keywordtype">char</span> *pend = NULL, *p = NULL;</div>
<div class="line"><span class="lineno">  262</span>  <span class="keywordtype">int</span> field = 0;</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *key = <a class="code hl_define" href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a>(1, <span class="keyword">struct</span> <a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a>);</div>
<div class="line"><span class="lineno">  265</span> </div>
<div class="line"><span class="lineno">  266</span>  <span class="keywordflow">for</span> (p = buf; p; p = pend)</div>
<div class="line"><span class="lineno">  267</span>  {</div>
<div class="line"><span class="lineno">  268</span>    <span class="comment">/* Some users manually maintain their .index file, and use a tab</span></div>
<div class="line"><span class="lineno">  269</span><span class="comment">     * as a delimiter, which the old parsing code (using fscanf)</span></div>
<div class="line"><span class="lineno">  270</span><span class="comment">     * happened to allow.  smime_keys uses a space, so search for both.  */</span></div>
<div class="line"><span class="lineno">  271</span>    <span class="keywordflow">if</span> ((pend = strchr(p, <span class="charliteral">&#39; &#39;</span>)) || (pend = strchr(p, <span class="charliteral">&#39;\t&#39;</span>)) || (pend = strchr(p, <span class="charliteral">&#39;\n&#39;</span>)))</div>
<div class="line"><span class="lineno">  272</span>      *pend++ = 0;</div>
<div class="line"><span class="lineno">  273</span> </div>
<div class="line"><span class="lineno">  274</span>    <span class="comment">/* For backward compatibility, don&#39;t count consecutive delimiters</span></div>
<div class="line"><span class="lineno">  275</span><span class="comment">     * as an empty field.  */</span></div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><span class="lineno">  277</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>    field++;</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">switch</span> (field)</div>
<div class="line"><span class="lineno">  282</span>    {</div>
<div class="line"><span class="lineno">  283</span>      <span class="keywordflow">case</span> 1: <span class="comment">/* mailbox */</span></div>
<div class="line"><span class="lineno">  284</span>        key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a9f73117582d0292e71e7867b7909326c">email</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(p);</div>
<div class="line"><span class="lineno">  285</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  286</span>      <span class="keywordflow">case</span> 2: <span class="comment">/* hash */</span></div>
<div class="line"><span class="lineno">  287</span>        key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(p);</div>
<div class="line"><span class="lineno">  288</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  289</span>      <span class="keywordflow">case</span> 3: <span class="comment">/* label */</span></div>
<div class="line"><span class="lineno">  290</span>        key-&gt;<a class="code hl_variable" href="structSmimeKey.html#ab9df91118c710284278ceaeb98769f7c">label</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(p);</div>
<div class="line"><span class="lineno">  291</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  292</span>      <span class="keywordflow">case</span> 4: <span class="comment">/* issuer */</span></div>
<div class="line"><span class="lineno">  293</span>        key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a6921c2922bea84854b90eab1b7e90f1e">issuer</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(p);</div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  295</span>      <span class="keywordflow">case</span> 5: <span class="comment">/* trust */</span></div>
<div class="line"><span class="lineno">  296</span>        key-&gt;<a class="code hl_variable" href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">trust</a> = *p;</div>
<div class="line"><span class="lineno">  297</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  298</span>      <span class="keywordflow">case</span> 6: <span class="comment">/* purpose */</span></div>
<div class="line"><span class="lineno">  299</span>        <span class="keywordflow">while</span> (*p)</div>
<div class="line"><span class="lineno">  300</span>        {</div>
<div class="line"><span class="lineno">  301</span>          <span class="keywordflow">switch</span> (*p++)</div>
<div class="line"><span class="lineno">  302</span>          {</div>
<div class="line"><span class="lineno">  303</span>            <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div>
<div class="line"><span class="lineno">  304</span>              key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a04a10c0ce76603a444b05e0110f92f88">flags</a> |= <a class="code hl_define" href="ncrypt_2lib_8h.html#a7254adf21a76d4ceea08bd931df4310f">KEYFLAG_CANENCRYPT</a>;</div>
<div class="line"><span class="lineno">  305</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>            <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line"><span class="lineno">  308</span>              key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a04a10c0ce76603a444b05e0110f92f88">flags</a> |= <a class="code hl_define" href="ncrypt_2lib_8h.html#aee8e2da44282ca27f6a786cef781334f">KEYFLAG_CANSIGN</a>;</div>
<div class="line"><span class="lineno">  309</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  310</span>          }</div>
<div class="line"><span class="lineno">  311</span>        }</div>
<div class="line"><span class="lineno">  312</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  313</span>    }</div>
<div class="line"><span class="lineno">  314</span>  }</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>  <span class="comment">/* Old index files could be missing issuer, trust, and purpose,</span></div>
<div class="line"><span class="lineno">  317</span><span class="comment">   * but anything less than that is an error. */</span></div>
<div class="line"><span class="lineno">  318</span>  <span class="keywordflow">if</span> (field &lt; 3)</div>
<div class="line"><span class="lineno">  319</span>  {</div>
<div class="line"><span class="lineno">  320</span>    <a class="code hl_function" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a>(&amp;key);</div>
<div class="line"><span class="lineno">  321</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  322</span>  }</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>  <span class="keywordflow">if</span> (field &lt; 4)</div>
<div class="line"><span class="lineno">  325</span>    key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a6921c2922bea84854b90eab1b7e90f1e">issuer</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(<span class="stringliteral">&quot;?&quot;</span>);</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>  <span class="keywordflow">if</span> (field &lt; 5)</div>
<div class="line"><span class="lineno">  328</span>    key-&gt;<a class="code hl_variable" href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">trust</a> = <span class="charliteral">&#39;t&#39;</span>;</div>
<div class="line"><span class="lineno">  329</span> </div>
<div class="line"><span class="lineno">  330</span>  <span class="keywordflow">if</span> (field &lt; 6)</div>
<div class="line"><span class="lineno">  331</span>    key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a04a10c0ce76603a444b05e0110f92f88">flags</a> = (<a class="code hl_define" href="ncrypt_2lib_8h.html#a7254adf21a76d4ceea08bd931df4310f">KEYFLAG_CANENCRYPT</a> | <a class="code hl_define" href="ncrypt_2lib_8h.html#aee8e2da44282ca27f6a786cef781334f">KEYFLAG_CANSIGN</a>);</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>  <span class="keywordflow">return</span> key;</div>
<div class="line"><span class="lineno">  334</span>}</div>
<div class="ttc" id="ancrypt_2lib_8h_html_a7254adf21a76d4ceea08bd931df4310f"><div class="ttname"><a href="ncrypt_2lib_8h.html#a7254adf21a76d4ceea08bd931df4310f">KEYFLAG_CANENCRYPT</a></div><div class="ttdeci">#define KEYFLAG_CANENCRYPT</div><div class="ttdoc">Key is suitable for encryption.</div><div class="ttdef"><b>Definition</b> <a href="ncrypt_2lib_8h_source.html#l00134">lib.h:134</a></div></div>
<div class="ttc" id="ancrypt_2lib_8h_html_aee8e2da44282ca27f6a786cef781334f"><div class="ttname"><a href="ncrypt_2lib_8h.html#aee8e2da44282ca27f6a786cef781334f">KEYFLAG_CANSIGN</a></div><div class="ttdeci">#define KEYFLAG_CANSIGN</div><div class="ttdoc">Key is suitable for signing.</div><div class="ttdef"><b>Definition</b> <a href="ncrypt_2lib_8h_source.html#l00133">lib.h:133</a></div></div>
<div class="ttc" id="asmime_8c_html_ae8fc02f34e610b2f4d7cc6823fb41f3f"><div class="ttname"><a href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a></div><div class="ttdeci">static void smime_key_free(struct SmimeKey **keylist)</div><div class="ttdoc">Free a list of SMIME keys.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00102">smime.c:102</a></div></div>
</div><!-- fragment --><div id="dynsection-12" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a87e30ca8724474468609c9defc0f99bf_cgraph.svg" width="311" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-13" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a87e30ca8724474468609c9defc0f99bf_icgraph.svg" width="351" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9d0f081748b9e72a7355c87730919647" name="a9d0f081748b9e72a7355c87730919647"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d0f081748b9e72a7355c87730919647">&#9670;&#160;</a></span>smime_get_candidates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> * smime_get_candidates </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>search</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>only_public_key</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find keys matching a string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">search</td><td>String to match </td></tr>
    <tr><td class="paramname">only_public_key</td><td>If true, only get the public keys </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Matching key </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00342">342</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  343</span>{</div>
<div class="line"><span class="lineno">  344</span>  <span class="keywordtype">char</span> buf[1024] = { 0 };</div>
<div class="line"><span class="lineno">  345</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *key = NULL, *results = NULL;</div>
<div class="line"><span class="lineno">  346</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> **results_end = &amp;results;</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *index_file = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  349</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_smime_certificates = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_certificates&quot;</span>);</div>
<div class="line"><span class="lineno">  350</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_smime_keys = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_keys&quot;</span>);</div>
<div class="line"><span class="lineno">  351</span>  <a class="code hl_function" href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a>(index_file, <span class="stringliteral">&quot;%s/.index&quot;</span>,</div>
<div class="line"><span class="lineno">  352</span>             only_public_key ? <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(c_smime_certificates) : <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(c_smime_keys));</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>  FILE *fp = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(index_file), <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">  355</span>  <span class="keywordflow">if</span> (!fp)</div>
<div class="line"><span class="lineno">  356</span>  {</div>
<div class="line"><span class="lineno">  357</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(index_file));</div>
<div class="line"><span class="lineno">  358</span>    <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;index_file);</div>
<div class="line"><span class="lineno">  359</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  360</span>  }</div>
<div class="line"><span class="lineno">  361</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;index_file);</div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span>  <span class="keywordflow">while</span> (fgets(buf, <span class="keyword">sizeof</span>(buf), fp))</div>
<div class="line"><span class="lineno">  364</span>  {</div>
<div class="line"><span class="lineno">  365</span>    <span class="keywordflow">if</span> (((*<a class="code hl_function" href="menu_2functions_8c.html#ab29e0b2dbd98a3fcd6204ae4dfcfd4cb">search</a> == <span class="charliteral">&#39;\0&#39;</span>)) || <a class="code hl_function" href="mutt_2string_8c.html#a98e1b08634aeded6d93f91dbc7ceb38d">mutt_istr_find</a>(buf, <a class="code hl_function" href="menu_2functions_8c.html#ab29e0b2dbd98a3fcd6204ae4dfcfd4cb">search</a>))</div>
<div class="line"><span class="lineno">  366</span>    {</div>
<div class="line"><span class="lineno">  367</span>      key = <a class="code hl_function" href="#a87e30ca8724474468609c9defc0f99bf">smime_parse_key</a>(buf);</div>
<div class="line"><span class="lineno">  368</span>      <span class="keywordflow">if</span> (key)</div>
<div class="line"><span class="lineno">  369</span>      {</div>
<div class="line"><span class="lineno">  370</span>        *results_end = key;</div>
<div class="line"><span class="lineno">  371</span>        results_end = &amp;key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a5123a1f750cbd3057df958bb785459b2">next</a>;</div>
<div class="line"><span class="lineno">  372</span>      }</div>
<div class="line"><span class="lineno">  373</span>    }</div>
<div class="line"><span class="lineno">  374</span>  }</div>
<div class="line"><span class="lineno">  375</span> </div>
<div class="line"><span class="lineno">  376</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  377</span> </div>
<div class="line"><span class="lineno">  378</span>  <span class="keywordflow">return</span> results;</div>
<div class="line"><span class="lineno">  379</span>}</div>
<div class="ttc" id="abuffer_8c_html_a02123807d31181ac701b566226e93b33"><div class="ttname"><a href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a></div><div class="ttdeci">int buf_printf(struct Buffer *buf, const char *fmt,...)</div><div class="ttdoc">Format a string overwriting a Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00161">buffer.c:161</a></div></div>
<div class="ttc" id="aconfig_2helpers_8c_html_a9f184e61342916799259930333f4205f"><div class="ttname"><a href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00168">helpers.c:168</a></div></div>
<div class="ttc" id="afile_8h_html_a9b519e795f098be88b93cd72c49a35ec"><div class="ttname"><a href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a></div><div class="ttdeci">#define mutt_file_fclose(FP)</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00139">file.h:139</a></div></div>
<div class="ttc" id="afile_8h_html_a9fa358d76519cb6bc8ffca5850976d46"><div class="ttname"><a href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a></div><div class="ttdeci">#define mutt_file_fopen(PATH, MODE)</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00138">file.h:138</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gafaa521ab22db877ccf1b87e679e1b43e"><div class="ttname"><a href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a></div><div class="ttdeci">#define mutt_perror(...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00094">logging2.h:94</a></div></div>
<div class="ttc" id="amenu_2functions_8c_html_ab29e0b2dbd98a3fcd6204ae4dfcfd4cb"><div class="ttname"><a href="menu_2functions_8c.html#ab29e0b2dbd98a3fcd6204ae4dfcfd4cb">search</a></div><div class="ttdeci">static int search(struct Menu *menu, int op)</div><div class="ttdoc">Search a menu.</div><div class="ttdef"><b>Definition</b> <a href="menu_2functions_8c_source.html#l00059">functions.c:59</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a98e1b08634aeded6d93f91dbc7ceb38d"><div class="ttname"><a href="mutt_2string_8c.html#a98e1b08634aeded6d93f91dbc7ceb38d">mutt_istr_find</a></div><div class="ttdeci">const char * mutt_istr_find(const char *haystack, const char *needle)</div><div class="ttdoc">Find first occurrence of string (ignoring case)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00523">string.c:523</a></div></div>
<div class="ttc" id="asmime_8c_html_a87e30ca8724474468609c9defc0f99bf"><div class="ttname"><a href="#a87e30ca8724474468609c9defc0f99bf">smime_parse_key</a></div><div class="ttdeci">static struct SmimeKey * smime_parse_key(char *buf)</div><div class="ttdoc">Parse an SMIME key block.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00259">smime.c:259</a></div></div>
<div class="ttc" id="astring2_8h_html_a7e0481bed27661ea2679f256b24e0283"><div class="ttname"><a href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a></div><div class="ttdeci">#define NONULL(x)</div><div class="ttdef"><b>Definition</b> <a href="string2_8h_source.html#l00043">string2.h:43</a></div></div>
<div class="ttc" id="astructNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00046">neomutt.h:46</a></div></div>
</div><!-- fragment --><div id="dynsection-14" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a9d0f081748b9e72a7355c87730919647_cgraph.svg" width="526" height="403"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-15" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a9d0f081748b9e72a7355c87730919647_icgraph.svg" width="392" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a2e079323e146c10a6e08e27ddc596edf" name="a2e079323e146c10a6e08e27ddc596edf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e079323e146c10a6e08e27ddc596edf">&#9670;&#160;</a></span>smime_get_key_by_hash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> * smime_get_key_by_hash </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>hash</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>only_public_key</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find a key by its hash. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hash</td><td>Hash to find </td></tr>
    <tr><td class="paramname">only_public_key</td><td>If true, only get the public keys </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Matching key</td></tr>
  </table>
  </dd>
</dl>
<p>Returns the first matching key record, without prompting or checking of abilities or trust. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00390">390</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  391</span>{</div>
<div class="line"><span class="lineno">  392</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *match = NULL;</div>
<div class="line"><span class="lineno">  393</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *results = <a class="code hl_function" href="#a9d0f081748b9e72a7355c87730919647">smime_get_candidates</a>(<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a>, only_public_key);</div>
<div class="line"><span class="lineno">  394</span>  <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *result = results; result; result = result-&gt;<a class="code hl_variable" href="structSmimeKey.html#a5123a1f750cbd3057df958bb785459b2">next</a>)</div>
<div class="line"><span class="lineno">  395</span>  {</div>
<div class="line"><span class="lineno">  396</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="mutt_2string_8c.html#a29db81d6f5a7dd216cbea75ecf8a5885">mutt_istr_equal</a>(<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a>, result-&gt;hash))</div>
<div class="line"><span class="lineno">  397</span>    {</div>
<div class="line"><span class="lineno">  398</span>      match = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(result);</div>
<div class="line"><span class="lineno">  399</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  400</span>    }</div>
<div class="line"><span class="lineno">  401</span>  }</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span>  <a class="code hl_function" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a>(&amp;results);</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>  <span class="keywordflow">return</span> match;</div>
<div class="line"><span class="lineno">  406</span>}</div>
<div class="ttc" id="amutt_2string_8c_html_a29db81d6f5a7dd216cbea75ecf8a5885"><div class="ttname"><a href="mutt_2string_8c.html#a29db81d6f5a7dd216cbea75ecf8a5885">mutt_istr_equal</a></div><div class="ttdeci">bool mutt_istr_equal(const char *a, const char *b)</div><div class="ttdoc">Compare two strings, ignoring case.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00672">string.c:672</a></div></div>
<div class="ttc" id="asmime_8c_html_a4c4c3863f1ccb2a083d402a91c9f026d"><div class="ttname"><a href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a></div><div class="ttdeci">static struct SmimeKey * smime_copy_key(struct SmimeKey *key)</div><div class="ttdoc">Copy an SMIME key.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00127">smime.c:127</a></div></div>
<div class="ttc" id="asmime_8c_html_a9d0f081748b9e72a7355c87730919647"><div class="ttname"><a href="#a9d0f081748b9e72a7355c87730919647">smime_get_candidates</a></div><div class="ttdeci">static struct SmimeKey * smime_get_candidates(const char *search, bool only_public_key)</div><div class="ttdoc">Find keys matching a string.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00342">smime.c:342</a></div></div>
</div><!-- fragment --><div id="dynsection-16" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a2e079323e146c10a6e08e27ddc596edf_cgraph.svg" width="392" height="200"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-17" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a2e079323e146c10a6e08e27ddc596edf_icgraph.svg" width="420" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="acfb16196155bcfafa112b95298b79c5c" name="acfb16196155bcfafa112b95298b79c5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfb16196155bcfafa112b95298b79c5c">&#9670;&#160;</a></span>smime_get_key_by_addr()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> * smime_get_key_by_addr </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>mailbox</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506">KeyFlags</a></td>          <td class="paramname"><span class="paramname"><em>abilities</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>only_public_key</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>oppenc_mode</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find an SIME key by address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mailbox</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> address to match </td></tr>
    <tr><td class="paramname">abilities</td><td>Abilities to match, see <a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506" title="Flags describing PGP/SMIME keys, e.g. KEYFLAG_CANSIGN.">KeyFlags</a> </td></tr>
    <tr><td class="paramname">only_public_key</td><td>If true, only get the public keys </td></tr>
    <tr><td class="paramname">oppenc_mode</td><td>If true, use opportunistic encryption </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Matching key </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00416">416</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  418</span>{</div>
<div class="line"><span class="lineno">  419</span>  <span class="keywordflow">if</span> (!mailbox)</div>
<div class="line"><span class="lineno">  420</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *results = NULL, *result = NULL;</div>
<div class="line"><span class="lineno">  423</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *matches = NULL;</div>
<div class="line"><span class="lineno">  424</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> **matches_end = &amp;matches;</div>
<div class="line"><span class="lineno">  425</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *match = NULL;</div>
<div class="line"><span class="lineno">  426</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *trusted_match = NULL;</div>
<div class="line"><span class="lineno">  427</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *valid_match = NULL;</div>
<div class="line"><span class="lineno">  428</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *return_key = NULL;</div>
<div class="line"><span class="lineno">  429</span>  <span class="keywordtype">bool</span> multi_trusted_matches = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>  results = <a class="code hl_function" href="#a9d0f081748b9e72a7355c87730919647">smime_get_candidates</a>(mailbox, only_public_key);</div>
<div class="line"><span class="lineno">  432</span>  <span class="keywordflow">for</span> (result = results; result; result = result-&gt;next)</div>
<div class="line"><span class="lineno">  433</span>  {</div>
<div class="line"><span class="lineno">  434</span>    <span class="keywordflow">if</span> (abilities &amp;&amp; !(result-&gt;flags &amp; abilities))</div>
<div class="line"><span class="lineno">  435</span>    {</div>
<div class="line"><span class="lineno">  436</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  437</span>    }</div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="mutt_2string_8c.html#a29db81d6f5a7dd216cbea75ecf8a5885">mutt_istr_equal</a>(mailbox, result-&gt;email))</div>
<div class="line"><span class="lineno">  440</span>    {</div>
<div class="line"><span class="lineno">  441</span>      match = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(result);</div>
<div class="line"><span class="lineno">  442</span>      *matches_end = match;</div>
<div class="line"><span class="lineno">  443</span>      matches_end = &amp;match-&gt;<a class="code hl_variable" href="structSmimeKey.html#a5123a1f750cbd3057df958bb785459b2">next</a>;</div>
<div class="line"><span class="lineno">  444</span> </div>
<div class="line"><span class="lineno">  445</span>      <span class="keywordflow">if</span> (match-&gt;<a class="code hl_variable" href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">trust</a> == <span class="charliteral">&#39;t&#39;</span>)</div>
<div class="line"><span class="lineno">  446</span>      {</div>
<div class="line"><span class="lineno">  447</span>        <span class="keywordflow">if</span> (trusted_match &amp;&amp; !<a class="code hl_function" href="mutt_2string_8c.html#a29db81d6f5a7dd216cbea75ecf8a5885">mutt_istr_equal</a>(match-&gt;<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a>, trusted_match-&gt;<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a>))</div>
<div class="line"><span class="lineno">  448</span>        {</div>
<div class="line"><span class="lineno">  449</span>          multi_trusted_matches = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  450</span>        }</div>
<div class="line"><span class="lineno">  451</span>        trusted_match = match;</div>
<div class="line"><span class="lineno">  452</span>      }</div>
<div class="line"><span class="lineno">  453</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((match-&gt;<a class="code hl_variable" href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">trust</a> == <span class="charliteral">&#39;u&#39;</span>) || (match-&gt;<a class="code hl_variable" href="structSmimeKey.html#abc36d7072ad69579e39e26326eed39e0">trust</a> == <span class="charliteral">&#39;v&#39;</span>))</div>
<div class="line"><span class="lineno">  454</span>      {</div>
<div class="line"><span class="lineno">  455</span>        valid_match = match;</div>
<div class="line"><span class="lineno">  456</span>      }</div>
<div class="line"><span class="lineno">  457</span>    }</div>
<div class="line"><span class="lineno">  458</span>  }</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>  <a class="code hl_function" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a>(&amp;results);</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>  <span class="keywordflow">if</span> (matches)</div>
<div class="line"><span class="lineno">  463</span>  {</div>
<div class="line"><span class="lineno">  464</span>    <span class="keywordflow">if</span> (oppenc_mode || !isatty(STDIN_FILENO))</div>
<div class="line"><span class="lineno">  465</span>    {</div>
<div class="line"><span class="lineno">  466</span>      <span class="keyword">const</span> <span class="keywordtype">bool</span> c_crypt_opportunistic_encrypt_strong_keys =</div>
<div class="line"><span class="lineno">  467</span>          <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;crypt_opportunistic_encrypt_strong_keys&quot;</span>);</div>
<div class="line"><span class="lineno">  468</span>      <span class="keywordflow">if</span> (trusted_match)</div>
<div class="line"><span class="lineno">  469</span>        return_key = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(trusted_match);</div>
<div class="line"><span class="lineno">  470</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (valid_match &amp;&amp; !c_crypt_opportunistic_encrypt_strong_keys)</div>
<div class="line"><span class="lineno">  471</span>        return_key = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(valid_match);</div>
<div class="line"><span class="lineno">  472</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  473</span>        return_key = NULL;</div>
<div class="line"><span class="lineno">  474</span>    }</div>
<div class="line"><span class="lineno">  475</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (trusted_match &amp;&amp; !multi_trusted_matches)</div>
<div class="line"><span class="lineno">  476</span>    {</div>
<div class="line"><span class="lineno">  477</span>      return_key = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(trusted_match);</div>
<div class="line"><span class="lineno">  478</span>    }</div>
<div class="line"><span class="lineno">  479</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  480</span>    {</div>
<div class="line"><span class="lineno">  481</span>      return_key = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(<a class="code hl_function" href="group__gui__dlg.html#gaf7f866a50b02f14c12ad47a0b20ce0fc">dlg_smime</a>(matches, mailbox));</div>
<div class="line"><span class="lineno">  482</span>    }</div>
<div class="line"><span class="lineno">  483</span> </div>
<div class="line"><span class="lineno">  484</span>    <a class="code hl_function" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a>(&amp;matches);</div>
<div class="line"><span class="lineno">  485</span>  }</div>
<div class="line"><span class="lineno">  486</span> </div>
<div class="line"><span class="lineno">  487</span>  <span class="keywordflow">return</span> return_key;</div>
<div class="line"><span class="lineno">  488</span>}</div>
<div class="ttc" id="aconfig_2helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00047">helpers.c:47</a></div></div>
<div class="ttc" id="agroup__gui__dlg_html_gaf7f866a50b02f14c12ad47a0b20ce0fc"><div class="ttname"><a href="group__gui__dlg.html#gaf7f866a50b02f14c12ad47a0b20ce0fc">dlg_smime</a></div><div class="ttdeci">struct SmimeKey * dlg_smime(struct SmimeKey *keys, const char *query)</div><div class="ttdoc">Get the user to select a key -.</div><div class="ttdef"><b>Definition</b> <a href="dlg__smime_8c_source.html#l00194">dlg_smime.c:194</a></div></div>
</div><!-- fragment --><div id="dynsection-18" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_acfb16196155bcfafa112b95298b79c5c_cgraph.svg" width="392" height="307"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-19" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_acfb16196155bcfafa112b95298b79c5c_icgraph.svg" width="391" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6c38fdc15799909098d0721429c7d5b8" name="a6c38fdc15799909098d0721429c7d5b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c38fdc15799909098d0721429c7d5b8">&#9670;&#160;</a></span>smime_get_key_by_str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> * smime_get_key_by_str </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>str</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506">KeyFlags</a></td>          <td class="paramname"><span class="paramname"><em>abilities</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>only_public_key</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find an SMIME key by string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">str</td><td>String to match </td></tr>
    <tr><td class="paramname">abilities</td><td>Abilities to match, see <a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506" title="Flags describing PGP/SMIME keys, e.g. KEYFLAG_CANSIGN.">KeyFlags</a> </td></tr>
    <tr><td class="paramname">only_public_key</td><td>If true, only get the public keys </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Matching key </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00497">497</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  498</span>{</div>
<div class="line"><span class="lineno">  499</span>  <span class="keywordflow">if</span> (!str)</div>
<div class="line"><span class="lineno">  500</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *results = NULL, *result = NULL;</div>
<div class="line"><span class="lineno">  503</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *matches = NULL;</div>
<div class="line"><span class="lineno">  504</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> **matches_end = &amp;matches;</div>
<div class="line"><span class="lineno">  505</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *match = NULL;</div>
<div class="line"><span class="lineno">  506</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *return_key = NULL;</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>  results = <a class="code hl_function" href="#a9d0f081748b9e72a7355c87730919647">smime_get_candidates</a>(str, only_public_key);</div>
<div class="line"><span class="lineno">  509</span>  <span class="keywordflow">for</span> (result = results; result; result = result-&gt;next)</div>
<div class="line"><span class="lineno">  510</span>  {</div>
<div class="line"><span class="lineno">  511</span>    <span class="keywordflow">if</span> (abilities &amp;&amp; !(result-&gt;flags &amp; abilities))</div>
<div class="line"><span class="lineno">  512</span>    {</div>
<div class="line"><span class="lineno">  513</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  514</span>    }</div>
<div class="line"><span class="lineno">  515</span> </div>
<div class="line"><span class="lineno">  516</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="mutt_2string_8c.html#a29db81d6f5a7dd216cbea75ecf8a5885">mutt_istr_equal</a>(str, result-&gt;hash) ||</div>
<div class="line"><span class="lineno">  517</span>        <a class="code hl_function" href="mutt_2string_8c.html#a98e1b08634aeded6d93f91dbc7ceb38d">mutt_istr_find</a>(result-&gt;email, str) || <a class="code hl_function" href="mutt_2string_8c.html#a98e1b08634aeded6d93f91dbc7ceb38d">mutt_istr_find</a>(result-&gt;label, str))</div>
<div class="line"><span class="lineno">  518</span>    {</div>
<div class="line"><span class="lineno">  519</span>      match = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(result);</div>
<div class="line"><span class="lineno">  520</span>      *matches_end = match;</div>
<div class="line"><span class="lineno">  521</span>      matches_end = &amp;match-&gt;<a class="code hl_variable" href="structSmimeKey.html#a5123a1f750cbd3057df958bb785459b2">next</a>;</div>
<div class="line"><span class="lineno">  522</span>    }</div>
<div class="line"><span class="lineno">  523</span>  }</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>  <a class="code hl_function" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a>(&amp;results);</div>
<div class="line"><span class="lineno">  526</span> </div>
<div class="line"><span class="lineno">  527</span>  <span class="keywordflow">if</span> (matches)</div>
<div class="line"><span class="lineno">  528</span>  {</div>
<div class="line"><span class="lineno">  529</span>    return_key = <a class="code hl_function" href="#a4c4c3863f1ccb2a083d402a91c9f026d">smime_copy_key</a>(<a class="code hl_function" href="group__gui__dlg.html#gaf7f866a50b02f14c12ad47a0b20ce0fc">dlg_smime</a>(matches, str));</div>
<div class="line"><span class="lineno">  530</span>    <a class="code hl_function" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a>(&amp;matches);</div>
<div class="line"><span class="lineno">  531</span>  }</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>  <span class="keywordflow">return</span> return_key;</div>
<div class="line"><span class="lineno">  534</span>}</div>
</div><!-- fragment --><div id="dynsection-20" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a6c38fdc15799909098d0721429c7d5b8_cgraph.svg" width="536" height="304"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-21" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a6c38fdc15799909098d0721429c7d5b8_icgraph.svg" width="360" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="affcdbedd1b787e5d656107e922a30c20" name="affcdbedd1b787e5d656107e922a30c20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affcdbedd1b787e5d656107e922a30c20">&#9670;&#160;</a></span>smime_ask_for_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structSmimeKey.html">SmimeKey</a> * smime_ask_for_key </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>prompt</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506">KeyFlags</a></td>          <td class="paramname"><span class="paramname"><em>abilities</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>only_public_key</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Ask the user to select a key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">prompt</td><td>Prompt to show the user </td></tr>
    <tr><td class="paramname">abilities</td><td>Abilities to match, see <a class="el" href="ncrypt_2lib_8h.html#a530487c28aacc2c2d50f12eefb8c5506" title="Flags describing PGP/SMIME keys, e.g. KEYFLAG_CANSIGN.">KeyFlags</a> </td></tr>
    <tr><td class="paramname">only_public_key</td><td>If true, only get the public keys </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Selected SMIME key </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00543">543</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  544</span>{</div>
<div class="line"><span class="lineno">  545</span>  <span class="keywordflow">if</span> (!prompt)</div>
<div class="line"><span class="lineno">  546</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *key = NULL;</div>
<div class="line"><span class="lineno">  549</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *resp = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  550</span> </div>
<div class="line"><span class="lineno">  551</span>  <a class="code hl_function" href="mutt__logging_8c.html#af068b3f524a31fad293b2fb61dfc4534">mutt_clear_error</a>();</div>
<div class="line"><span class="lineno">  552</span> </div>
<div class="line"><span class="lineno">  553</span>  <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><span class="lineno">  554</span>  {</div>
<div class="line"><span class="lineno">  555</span>    <a class="code hl_function" href="buffer_8c.html#a3b1f80652b37dc26046f9acdd85a0b05">buf_reset</a>(resp);</div>
<div class="line"><span class="lineno">  556</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__gui__mw.html#gabcbd2498b412e9f8e9d953cafc01989c">mw_get_field</a>(prompt, resp, <a class="code hl_define" href="mutt_8h.html#ab0d3fda521b45dec654ff46bac59c8c2">MUTT_COMP_NO_FLAGS</a>, <a class="code hl_enumvalue" href="history_2lib_8h.html#acb0a49d94e5b4fe512c30e2c12621234aee9379d265cad600929abe5cc271019a">HC_OTHER</a>, NULL, NULL) != 0)</div>
<div class="line"><span class="lineno">  557</span>    {</div>
<div class="line"><span class="lineno">  558</span>      <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">  559</span>    }</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>    key = <a class="code hl_function" href="#a6c38fdc15799909098d0721429c7d5b8">smime_get_key_by_str</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(resp), abilities, only_public_key);</div>
<div class="line"><span class="lineno">  562</span>    <span class="keywordflow">if</span> (key)</div>
<div class="line"><span class="lineno">  563</span>      <span class="keywordflow">goto</span> done;</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;No matching keys found for \&quot;%s\&quot;&quot;</span>), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(resp));</div>
<div class="line"><span class="lineno">  566</span>  }</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>done:</div>
<div class="line"><span class="lineno">  569</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;resp);</div>
<div class="line"><span class="lineno">  570</span>  <span class="keywordflow">return</span> key;</div>
<div class="line"><span class="lineno">  571</span>}</div>
<div class="ttc" id="abuffer_8c_html_a3b1f80652b37dc26046f9acdd85a0b05"><div class="ttname"><a href="buffer_8c.html#a3b1f80652b37dc26046f9acdd85a0b05">buf_reset</a></div><div class="ttdeci">void buf_reset(struct Buffer *buf)</div><div class="ttdoc">Reset an existing Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00076">buffer.c:76</a></div></div>
<div class="ttc" id="agroup__gui__mw_html_gabcbd2498b412e9f8e9d953cafc01989c"><div class="ttname"><a href="group__gui__mw.html#gabcbd2498b412e9f8e9d953cafc01989c">mw_get_field</a></div><div class="ttdeci">int mw_get_field(const char *prompt, struct Buffer *buf, CompletionFlags complete, enum HistoryClass hclass, const struct CompleteOps *comp_api, void *cdata)</div><div class="ttdoc">Ask the user for a string -.</div><div class="ttdef"><b>Definition</b> <a href="editor_2window_8c_source.html#l00272">window.c:272</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00093">logging2.h:93</a></div></div>
<div class="ttc" id="ahistory_2lib_8h_html_acb0a49d94e5b4fe512c30e2c12621234aee9379d265cad600929abe5cc271019a"><div class="ttname"><a href="history_2lib_8h.html#acb0a49d94e5b4fe512c30e2c12621234aee9379d265cad600929abe5cc271019a">HC_OTHER</a></div><div class="ttdeci">@ HC_OTHER</div><div class="ttdoc">Miscellaneous strings.</div><div class="ttdef"><b>Definition</b> <a href="history_2lib_8h_source.html#l00059">lib.h:59</a></div></div>
<div class="ttc" id="amutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="amutt_8h_html_ab0d3fda521b45dec654ff46bac59c8c2"><div class="ttname"><a href="mutt_8h.html#ab0d3fda521b45dec654ff46bac59c8c2">MUTT_COMP_NO_FLAGS</a></div><div class="ttdeci">#define MUTT_COMP_NO_FLAGS</div><div class="ttdoc">No flags are set.</div><div class="ttdef"><b>Definition</b> <a href="mutt_8h_source.html#l00056">mutt.h:56</a></div></div>
<div class="ttc" id="amutt__logging_8c_html_af068b3f524a31fad293b2fb61dfc4534"><div class="ttname"><a href="mutt__logging_8c.html#af068b3f524a31fad293b2fb61dfc4534">mutt_clear_error</a></div><div class="ttdeci">void mutt_clear_error(void)</div><div class="ttdoc">Clear the message line (bottom line of screen)</div><div class="ttdef"><b>Definition</b> <a href="mutt__logging_8c_source.html#l00074">mutt_logging.c:74</a></div></div>
<div class="ttc" id="asmime_8c_html_a6c38fdc15799909098d0721429c7d5b8"><div class="ttname"><a href="#a6c38fdc15799909098d0721429c7d5b8">smime_get_key_by_str</a></div><div class="ttdeci">static struct SmimeKey * smime_get_key_by_str(const char *str, KeyFlags abilities, bool only_public_key)</div><div class="ttdoc">Find an SMIME key by string.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00497">smime.c:497</a></div></div>
</div><!-- fragment --><div id="dynsection-22" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_affcdbedd1b787e5d656107e922a30c20_cgraph.svg" width="492" height="355"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-23" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_affcdbedd1b787e5d656107e922a30c20_icgraph.svg" width="374" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4477a016ba21f15dd55a65c753c47b01" name="a4477a016ba21f15dd55a65c753c47b01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4477a016ba21f15dd55a65c753c47b01">&#9670;&#160;</a></span>getkeys()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void getkeys </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>mailbox</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the keys for a mailbox. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mailbox</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> address</td></tr>
  </table>
  </dd>
</dl>
<p>This sets the '*ToUse' variables for an upcoming decryption, where the required key is different from <code>$smime_default_key</code>. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00580">580</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  581</span>{</div>
<div class="line"><span class="lineno">  582</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *k = NULL;</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structSmimeKey.html">SmimeKey</a> *key = <a class="code hl_function" href="#acfb16196155bcfafa112b95298b79c5c">smime_get_key_by_addr</a>(mailbox, <a class="code hl_define" href="ncrypt_2lib_8h.html#a7254adf21a76d4ceea08bd931df4310f">KEYFLAG_CANENCRYPT</a>, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>  <span class="keywordflow">if</span> (!key)</div>
<div class="line"><span class="lineno">  587</span>  {</div>
<div class="line"><span class="lineno">  588</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *prompt = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  589</span>    <a class="code hl_function" href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a>(prompt, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Enter keyID for %s: &quot;</span>), mailbox);</div>
<div class="line"><span class="lineno">  590</span>    key = <a class="code hl_function" href="#affcdbedd1b787e5d656107e922a30c20">smime_ask_for_key</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(prompt), <a class="code hl_define" href="ncrypt_2lib_8h.html#a7254adf21a76d4ceea08bd931df4310f">KEYFLAG_CANENCRYPT</a>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  591</span>    <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;prompt);</div>
<div class="line"><span class="lineno">  592</span>  }</div>
<div class="line"><span class="lineno">  593</span> </div>
<div class="line"><span class="lineno">  594</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_smime_keys = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_keys&quot;</span>);</div>
<div class="line"><span class="lineno">  595</span>  <span class="keywordtype">size_t</span> smime_keys_len = <a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(c_smime_keys);</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_smime_default_key = <a class="code hl_function" href="config_2helpers_8c.html#a6b1589ee93ff51ef31f1d9324e138078">cs_subset_string</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_default_key&quot;</span>);</div>
<div class="line"><span class="lineno">  598</span>  k = key ? key-&gt;<a class="code hl_variable" href="structSmimeKey.html#a34c24c91867b2600f20b6d892ef156bb">hash</a> : <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(c_smime_default_key);</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>  <span class="comment">/* if the key is different from last time */</span></div>
<div class="line"><span class="lineno">  601</span>  <span class="keywordflow">if</span> ((<a class="code hl_function" href="buffer_8c.html#a2914dc2d9a9d77e4c9970b4249be9370">buf_len</a>(&amp;<a class="code hl_variable" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a>) &lt;= smime_keys_len) ||</div>
<div class="line"><span class="lineno">  602</span>      !<a class="code hl_function" href="mutt_2string_8c.html#a29db81d6f5a7dd216cbea75ecf8a5885">mutt_istr_equal</a>(k, <a class="code hl_variable" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a>.data + smime_keys_len + 1))</div>
<div class="line"><span class="lineno">  603</span>  {</div>
<div class="line"><span class="lineno">  604</span>    <a class="code hl_function" href="group__crypto__void__passphrase.html#gadb364b3c8158f09603b981b70bbee2eb">smime_class_void_passphrase</a>();</div>
<div class="line"><span class="lineno">  605</span>    <a class="code hl_function" href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a>(&amp;<a class="code hl_variable" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a>, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(c_smime_keys), k);</div>
<div class="line"><span class="lineno">  606</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_smime_certificates = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_certificates&quot;</span>);</div>
<div class="line"><span class="lineno">  607</span>    <a class="code hl_function" href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a>(&amp;<a class="code hl_variable" href="#ad37cb485abe0aeafae99190ea323d3c4">SmimeCertToUse</a>, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(c_smime_certificates), k);</div>
<div class="line"><span class="lineno">  608</span>  }</div>
<div class="line"><span class="lineno">  609</span> </div>
<div class="line"><span class="lineno">  610</span>  <a class="code hl_function" href="#ae8fc02f34e610b2f4d7cc6823fb41f3f">smime_key_free</a>(&amp;key);</div>
<div class="line"><span class="lineno">  611</span>}</div>
<div class="ttc" id="abuffer_8c_html_a2914dc2d9a9d77e4c9970b4249be9370"><div class="ttname"><a href="buffer_8c.html#a2914dc2d9a9d77e4c9970b4249be9370">buf_len</a></div><div class="ttdeci">size_t buf_len(const struct Buffer *buf)</div><div class="ttdoc">Calculate the length of a Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00491">buffer.c:491</a></div></div>
<div class="ttc" id="aconfig_2helpers_8c_html_a6b1589ee93ff51ef31f1d9324e138078"><div class="ttname"><a href="config_2helpers_8c.html#a6b1589ee93ff51ef31f1d9324e138078">cs_subset_string</a></div><div class="ttdeci">const char * cs_subset_string(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a string config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00291">helpers.c:291</a></div></div>
<div class="ttc" id="agroup__crypto__void__passphrase_html_gadb364b3c8158f09603b981b70bbee2eb"><div class="ttname"><a href="group__crypto__void__passphrase.html#gadb364b3c8158f09603b981b70bbee2eb">smime_class_void_passphrase</a></div><div class="ttdeci">void smime_class_void_passphrase(void)</div><div class="ttdoc">Forget the cached passphrase - Implements CryptModuleSpecs::void_passphrase() -.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00148">smime.c:148</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_acca6786b903b22a5924219f9db96e10d"><div class="ttname"><a href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a></div><div class="ttdeci">size_t mutt_str_len(const char *a)</div><div class="ttdoc">Calculate the length of a string, safely.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00498">string.c:498</a></div></div>
<div class="ttc" id="asmime_8c_html_acfb16196155bcfafa112b95298b79c5c"><div class="ttname"><a href="#acfb16196155bcfafa112b95298b79c5c">smime_get_key_by_addr</a></div><div class="ttdeci">static struct SmimeKey * smime_get_key_by_addr(const char *mailbox, KeyFlags abilities, bool only_public_key, bool oppenc_mode)</div><div class="ttdoc">Find an SIME key by address.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00416">smime.c:416</a></div></div>
<div class="ttc" id="asmime_8c_html_affcdbedd1b787e5d656107e922a30c20"><div class="ttname"><a href="#affcdbedd1b787e5d656107e922a30c20">smime_ask_for_key</a></div><div class="ttdeci">static struct SmimeKey * smime_ask_for_key(const char *prompt, KeyFlags abilities, bool only_public_key)</div><div class="ttdoc">Ask the user to select a key.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00543">smime.c:543</a></div></div>
</div><!-- fragment --><div id="dynsection-24" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a4477a016ba21f15dd55a65c753c47b01_cgraph.svg" width="506" height="667"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-25" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a4477a016ba21f15dd55a65c753c47b01_icgraph.svg" width="279" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac22eada01fd9622f13deb3f43459d412" name="ac22eada01fd9622f13deb3f43459d412"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac22eada01fd9622f13deb3f43459d412">&#9670;&#160;</a></span>smime_handle_cert_email()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int smime_handle_cert_email </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>certificate</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>mailbox</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>copy</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char ***</td>          <td class="paramname"><span class="paramname"><em>buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>num</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process an email containing certificates. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">certificate</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> with certificates </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mailbox</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> address </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">copy</td><td>If true, save the certificates to buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buffer</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer.">Buffer</a> allocated to hold certificates </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num</td><td>Number of certificates in buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
    <tr><td class="paramname">-2</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00704">704</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  706</span>{</div>
<div class="line"><span class="lineno">  707</span>  <span class="keywordtype">char</span> email[256] = { 0 };</div>
<div class="line"><span class="lineno">  708</span>  <span class="keywordtype">int</span> rc = -1, count = 0;</div>
<div class="line"><span class="lineno">  709</span>  pid_t pid;</div>
<div class="line"><span class="lineno">  710</span> </div>
<div class="line"><span class="lineno">  711</span>  FILE *fp_err = <a class="code hl_define" href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a>();</div>
<div class="line"><span class="lineno">  712</span>  <span class="keywordflow">if</span> (!fp_err)</div>
<div class="line"><span class="lineno">  713</span>  {</div>
<div class="line"><span class="lineno">  714</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno">  715</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  716</span>  }</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>  FILE *fp_out = <a class="code hl_define" href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a>();</div>
<div class="line"><span class="lineno">  719</span>  <span class="keywordflow">if</span> (!fp_out)</div>
<div class="line"><span class="lineno">  720</span>  {</div>
<div class="line"><span class="lineno">  721</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_err);</div>
<div class="line"><span class="lineno">  722</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno">  723</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  724</span>  }</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_get_cert_email_command =</div>
<div class="line"><span class="lineno">  727</span>      <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_get_cert_email_command&quot;</span>);</div>
<div class="line"><span class="lineno">  728</span>  pid = <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(NULL, NULL, NULL, -1, fileno(fp_out), fileno(fp_err), certificate,</div>
<div class="line"><span class="lineno">  729</span>                     NULL, NULL, NULL, NULL, NULL, NULL, c_smime_get_cert_email_command);</div>
<div class="line"><span class="lineno">  730</span>  <span class="keywordflow">if</span> (pid == -1)</div>
<div class="line"><span class="lineno">  731</span>  {</div>
<div class="line"><span class="lineno">  732</span>    <a class="code hl_define" href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Error: unable to create OpenSSL subprocess&quot;</span>));</div>
<div class="line"><span class="lineno">  733</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_err);</div>
<div class="line"><span class="lineno">  734</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno">  735</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  736</span>  }</div>
<div class="line"><span class="lineno">  737</span> </div>
<div class="line"><span class="lineno">  738</span>  <a class="code hl_function" href="mutt_2filter_8c.html#a22c6912b837b1114c3276c990e73dca3">filter_wait</a>(pid);</div>
<div class="line"><span class="lineno">  739</span> </div>
<div class="line"><span class="lineno">  740</span>  fflush(fp_out);</div>
<div class="line"><span class="lineno">  741</span>  rewind(fp_out);</div>
<div class="line"><span class="lineno">  742</span>  fflush(fp_err);</div>
<div class="line"><span class="lineno">  743</span>  rewind(fp_err);</div>
<div class="line"><span class="lineno">  744</span> </div>
<div class="line"><span class="lineno">  745</span>  <span class="keywordflow">while</span> ((fgets(email, <span class="keyword">sizeof</span>(email), fp_out)))</div>
<div class="line"><span class="lineno">  746</span>  {</div>
<div class="line"><span class="lineno">  747</span>    <span class="keywordtype">size_t</span> len = <a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(email);</div>
<div class="line"><span class="lineno">  748</span>    <span class="keywordflow">if</span> (len &amp;&amp; (email[len - 1] == <span class="charliteral">&#39;\n&#39;</span>))</div>
<div class="line"><span class="lineno">  749</span>      email[len - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  750</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="mutt_2string_8c.html#aebd2a8a3f8a30062c31fa1474d87cc41">mutt_istr_startswith</a>(email, mailbox))</div>
<div class="line"><span class="lineno">  751</span>      rc = 1;</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>    rc = (rc &lt; 0) ? 0 : rc;</div>
<div class="line"><span class="lineno">  754</span>    count++;</div>
<div class="line"><span class="lineno">  755</span>  }</div>
<div class="line"><span class="lineno">  756</span> </div>
<div class="line"><span class="lineno">  757</span>  <span class="keywordflow">if</span> (rc == -1)</div>
<div class="line"><span class="lineno">  758</span>  {</div>
<div class="line"><span class="lineno">  759</span>    <a class="code hl_function" href="curs__lib_8c.html#acd14d074d8b9e6cb21e851dd573cdec2">mutt_endwin</a>();</div>
<div class="line"><span class="lineno">  760</span>    <a class="code hl_function" href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a>(fp_err, stdout);</div>
<div class="line"><span class="lineno">  761</span>    <a class="code hl_function" href="curs__lib_8c.html#ab6a61cdfcf8c2c73ee59381c79c79774">mutt_any_key_to_continue</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Error: unable to create OpenSSL subprocess&quot;</span>));</div>
<div class="line"><span class="lineno">  762</span>    rc = 1;</div>
<div class="line"><span class="lineno">  763</span>  }</div>
<div class="line"><span class="lineno">  764</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  765</span>  {</div>
<div class="line"><span class="lineno">  766</span>    rc = 1;</div>
<div class="line"><span class="lineno">  767</span>  }</div>
<div class="line"><span class="lineno">  768</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  769</span>  {</div>
<div class="line"><span class="lineno">  770</span>    rc = 0;</div>
<div class="line"><span class="lineno">  771</span>  }</div>
<div class="line"><span class="lineno">  772</span> </div>
<div class="line"><span class="lineno">  773</span>  <span class="keywordflow">if</span> (copy &amp;&amp; buffer &amp;&amp; num)</div>
<div class="line"><span class="lineno">  774</span>  {</div>
<div class="line"><span class="lineno">  775</span>    (*num) = count;</div>
<div class="line"><span class="lineno">  776</span>    *buffer = <a class="code hl_define" href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a>(count, <span class="keywordtype">char</span> *);</div>
<div class="line"><span class="lineno">  777</span>    count = 0;</div>
<div class="line"><span class="lineno">  778</span> </div>
<div class="line"><span class="lineno">  779</span>    rewind(fp_out);</div>
<div class="line"><span class="lineno">  780</span>    <span class="keywordflow">while</span> ((fgets(email, <span class="keyword">sizeof</span>(email), fp_out)))</div>
<div class="line"><span class="lineno">  781</span>    {</div>
<div class="line"><span class="lineno">  782</span>      <span class="keywordtype">size_t</span> len = <a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(email);</div>
<div class="line"><span class="lineno">  783</span>      <span class="keywordflow">if</span> (len &amp;&amp; (email[len - 1] == <span class="charliteral">&#39;\n&#39;</span>))</div>
<div class="line"><span class="lineno">  784</span>        email[len - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  785</span>      (*buffer)[count] = <a class="code hl_define" href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a>(<a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(email) + 1, <span class="keywordtype">char</span>);</div>
<div class="line"><span class="lineno">  786</span>      strncpy((*buffer)[count], email, <a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(email));</div>
<div class="line"><span class="lineno">  787</span>      count++;</div>
<div class="line"><span class="lineno">  788</span>    }</div>
<div class="line"><span class="lineno">  789</span>  }</div>
<div class="line"><span class="lineno">  790</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (copy)</div>
<div class="line"><span class="lineno">  791</span>  {</div>
<div class="line"><span class="lineno">  792</span>    rc = 2;</div>
<div class="line"><span class="lineno">  793</span>  }</div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno">  796</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_err);</div>
<div class="line"><span class="lineno">  797</span> </div>
<div class="line"><span class="lineno">  798</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  799</span>}</div>
<div class="ttc" id="aconfig_2helpers_8h_html_afadba3dd7a0ec53c70d047005b2efcef"><div class="ttname"><a href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a></div><div class="ttdeci">const struct Expando * cs_subset_expando(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get an Expando config item by name.</div><div class="ttdef"><b>Definition</b> <a href="expando_2config__type_8c_source.html#l00360">config_type.c:360</a></div></div>
<div class="ttc" id="acurs__lib_8c_html_ab6a61cdfcf8c2c73ee59381c79c79774"><div class="ttname"><a href="curs__lib_8c.html#ab6a61cdfcf8c2c73ee59381c79c79774">mutt_any_key_to_continue</a></div><div class="ttdeci">int mutt_any_key_to_continue(const char *s)</div><div class="ttdoc">Prompt the user to &#39;press any key&#39; and wait.</div><div class="ttdef"><b>Definition</b> <a href="curs__lib_8c_source.html#l00174">curs_lib.c:174</a></div></div>
<div class="ttc" id="acurs__lib_8c_html_acd14d074d8b9e6cb21e851dd573cdec2"><div class="ttname"><a href="curs__lib_8c.html#acd14d074d8b9e6cb21e851dd573cdec2">mutt_endwin</a></div><div class="ttdeci">void mutt_endwin(void)</div><div class="ttdoc">Shutdown curses.</div><div class="ttdef"><b>Definition</b> <a href="curs__lib_8c_source.html#l00152">curs_lib.c:152</a></div></div>
<div class="ttc" id="afile_8c_html_a0a6ff09a685fb6fa1120a582a5a6ef4a"><div class="ttname"><a href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a></div><div class="ttdeci">int mutt_file_copy_stream(FILE *fp_in, FILE *fp_out)</div><div class="ttdoc">Copy the contents of one file into another.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00225">file.c:225</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gae108f891125caafa9250cf0959c40c04"><div class="ttname"><a href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a></div><div class="ttdeci">#define mutt_message(...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00092">logging2.h:92</a></div></div>
<div class="ttc" id="amutt_2filter_8c_html_a22c6912b837b1114c3276c990e73dca3"><div class="ttname"><a href="mutt_2filter_8c.html#a22c6912b837b1114c3276c990e73dca3">filter_wait</a></div><div class="ttdeci">int filter_wait(pid_t pid)</div><div class="ttdoc">Wait for the exit of a process and return its status.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2filter_8c_source.html#l00220">filter.c:220</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_aebd2a8a3f8a30062c31fa1474d87cc41"><div class="ttname"><a href="mutt_2string_8c.html#aebd2a8a3f8a30062c31fa1474d87cc41">mutt_istr_startswith</a></div><div class="ttdeci">size_t mutt_istr_startswith(const char *str, const char *prefix)</div><div class="ttdoc">Check whether a string starts with a prefix, ignoring case.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00244">string.c:244</a></div></div>
<div class="ttc" id="asmime_8c_html_ad1ab503f8f55cd15916f08d31b3c94ab"><div class="ttname"><a href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a></div><div class="ttdeci">static pid_t smime_invoke(FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname, const char *sig_fname, const char *cryptalg, const char *digestalg, const char *key, const char *certificates, const char *intermediates, const struct Expando *exp)</div><div class="ttdoc">Run an SMIME command.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00224">smime.c:224</a></div></div>
<div class="ttc" id="astructExpando_html"><div class="ttname"><a href="structExpando.html">Expando</a></div><div class="ttdoc">Parsed Expando trees.</div><div class="ttdef"><b>Definition</b> <a href="expando_2expando_8h_source.html#l00040">expando.h:41</a></div></div>
<div class="ttc" id="atmp_8h_html_a4ad1bdd71a5077a9e7dfc4890e1089f6"><div class="ttname"><a href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a></div><div class="ttdeci">#define mutt_file_mkstemp()</div><div class="ttdef"><b>Definition</b> <a href="tmp_8h_source.html#l00036">tmp.h:36</a></div></div>
</div><!-- fragment --><div id="dynsection-26" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ac22eada01fd9622f13deb3f43459d412_cgraph.svg" width="424" height="414"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-27" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ac22eada01fd9622f13deb3f43459d412_icgraph.svg" width="378" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab03fce542ee9a7967437403be572d34e" name="ab03fce542ee9a7967437403be572d34e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab03fce542ee9a7967437403be572d34e">&#9670;&#160;</a></span>smime_extract_certificate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * smime_extract_certificate </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>infile</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Extract an SMIME certificate from a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">infile</td><td>File to read </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Filename of temporary file containing certificate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00806">806</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  807</span>{</div>
<div class="line"><span class="lineno">  808</span>  FILE *fp_err = NULL;</div>
<div class="line"><span class="lineno">  809</span>  FILE *fp_out = NULL;</div>
<div class="line"><span class="lineno">  810</span>  FILE *fp_cert = NULL;</div>
<div class="line"><span class="lineno">  811</span>  <span class="keywordtype">char</span> *rc = NULL;</div>
<div class="line"><span class="lineno">  812</span>  pid_t pid;</div>
<div class="line"><span class="lineno">  813</span>  <span class="keywordtype">int</span> empty;</div>
<div class="line"><span class="lineno">  814</span> </div>
<div class="line"><span class="lineno">  815</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *pk7out = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  816</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *certfile = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>  fp_err = <a class="code hl_define" href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a>();</div>
<div class="line"><span class="lineno">  819</span>  <span class="keywordflow">if</span> (!fp_err)</div>
<div class="line"><span class="lineno">  820</span>  {</div>
<div class="line"><span class="lineno">  821</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno">  822</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  823</span>  }</div>
<div class="line"><span class="lineno">  824</span> </div>
<div class="line"><span class="lineno">  825</span>  <a class="code hl_define" href="tmp_8h.html#a271a7828888985955df49205d7846a45">buf_mktemp</a>(pk7out);</div>
<div class="line"><span class="lineno">  826</span>  fp_out = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out), <span class="stringliteral">&quot;w+&quot;</span>);</div>
<div class="line"><span class="lineno">  827</span>  <span class="keywordflow">if</span> (!fp_out)</div>
<div class="line"><span class="lineno">  828</span>  {</div>
<div class="line"><span class="lineno">  829</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out));</div>
<div class="line"><span class="lineno">  830</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  831</span>  }</div>
<div class="line"><span class="lineno">  832</span> </div>
<div class="line"><span class="lineno">  833</span>  <span class="comment">/* Step 1: Convert the signature to a PKCS#7 structure, as we can&#39;t</span></div>
<div class="line"><span class="lineno">  834</span><span class="comment">   * extract the full set of certificates directly. */</span></div>
<div class="line"><span class="lineno">  835</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_pk7out_command = <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_pk7out_command&quot;</span>);</div>
<div class="line"><span class="lineno">  836</span>  pid = <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(NULL, NULL, NULL, -1, fileno(fp_out), fileno(fp_err), infile,</div>
<div class="line"><span class="lineno">  837</span>                     NULL, NULL, NULL, NULL, NULL, NULL, c_smime_pk7out_command);</div>
<div class="line"><span class="lineno">  838</span>  <span class="keywordflow">if</span> (pid == -1)</div>
<div class="line"><span class="lineno">  839</span>  {</div>
<div class="line"><span class="lineno">  840</span>    <a class="code hl_function" href="curs__lib_8c.html#ab6a61cdfcf8c2c73ee59381c79c79774">mutt_any_key_to_continue</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Error: unable to create OpenSSL subprocess&quot;</span>));</div>
<div class="line"><span class="lineno">  841</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  842</span>  }</div>
<div class="line"><span class="lineno">  843</span> </div>
<div class="line"><span class="lineno">  844</span>  <a class="code hl_function" href="mutt_2filter_8c.html#a22c6912b837b1114c3276c990e73dca3">filter_wait</a>(pid);</div>
<div class="line"><span class="lineno">  845</span> </div>
<div class="line"><span class="lineno">  846</span>  fflush(fp_out);</div>
<div class="line"><span class="lineno">  847</span>  rewind(fp_out);</div>
<div class="line"><span class="lineno">  848</span>  fflush(fp_err);</div>
<div class="line"><span class="lineno">  849</span>  rewind(fp_err);</div>
<div class="line"><span class="lineno">  850</span>  empty = (fgetc(fp_out) == EOF);</div>
<div class="line"><span class="lineno">  851</span>  <span class="keywordflow">if</span> (empty)</div>
<div class="line"><span class="lineno">  852</span>  {</div>
<div class="line"><span class="lineno">  853</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out));</div>
<div class="line"><span class="lineno">  854</span>    <a class="code hl_function" href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a>(fp_err, stdout);</div>
<div class="line"><span class="lineno">  855</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  856</span>  }</div>
<div class="line"><span class="lineno">  857</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno">  858</span> </div>
<div class="line"><span class="lineno">  859</span>  <a class="code hl_define" href="tmp_8h.html#a271a7828888985955df49205d7846a45">buf_mktemp</a>(certfile);</div>
<div class="line"><span class="lineno">  860</span>  fp_cert = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(certfile), <span class="stringliteral">&quot;w+&quot;</span>);</div>
<div class="line"><span class="lineno">  861</span>  <span class="keywordflow">if</span> (!fp_cert)</div>
<div class="line"><span class="lineno">  862</span>  {</div>
<div class="line"><span class="lineno">  863</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(certfile));</div>
<div class="line"><span class="lineno">  864</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out));</div>
<div class="line"><span class="lineno">  865</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  866</span>  }</div>
<div class="line"><span class="lineno">  867</span> </div>
<div class="line"><span class="lineno">  868</span>  <span class="comment">// Step 2: Extract the certificates from a PKCS#7 structure.</span></div>
<div class="line"><span class="lineno">  869</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_get_cert_command = <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_get_cert_command&quot;</span>);</div>
<div class="line"><span class="lineno">  870</span>  pid = <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(NULL, NULL, NULL, -1, fileno(fp_cert), fileno(fp_err),</div>
<div class="line"><span class="lineno">  871</span>                     <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out), NULL, NULL, NULL, NULL, NULL, NULL,</div>
<div class="line"><span class="lineno">  872</span>                     c_smime_get_cert_command);</div>
<div class="line"><span class="lineno">  873</span>  <span class="keywordflow">if</span> (pid == -1)</div>
<div class="line"><span class="lineno">  874</span>  {</div>
<div class="line"><span class="lineno">  875</span>    <a class="code hl_function" href="curs__lib_8c.html#ab6a61cdfcf8c2c73ee59381c79c79774">mutt_any_key_to_continue</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Error: unable to create OpenSSL subprocess&quot;</span>));</div>
<div class="line"><span class="lineno">  876</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out));</div>
<div class="line"><span class="lineno">  877</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  878</span>  }</div>
<div class="line"><span class="lineno">  879</span> </div>
<div class="line"><span class="lineno">  880</span>  <a class="code hl_function" href="mutt_2filter_8c.html#a22c6912b837b1114c3276c990e73dca3">filter_wait</a>(pid);</div>
<div class="line"><span class="lineno">  881</span> </div>
<div class="line"><span class="lineno">  882</span>  <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out));</div>
<div class="line"><span class="lineno">  883</span> </div>
<div class="line"><span class="lineno">  884</span>  fflush(fp_cert);</div>
<div class="line"><span class="lineno">  885</span>  rewind(fp_cert);</div>
<div class="line"><span class="lineno">  886</span>  fflush(fp_err);</div>
<div class="line"><span class="lineno">  887</span>  rewind(fp_err);</div>
<div class="line"><span class="lineno">  888</span>  empty = (fgetc(fp_cert) == EOF);</div>
<div class="line"><span class="lineno">  889</span>  <span class="keywordflow">if</span> (empty)</div>
<div class="line"><span class="lineno">  890</span>  {</div>
<div class="line"><span class="lineno">  891</span>    <a class="code hl_function" href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a>(fp_err, stdout);</div>
<div class="line"><span class="lineno">  892</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  893</span>  }</div>
<div class="line"><span class="lineno">  894</span> </div>
<div class="line"><span class="lineno">  895</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_cert);</div>
<div class="line"><span class="lineno">  896</span> </div>
<div class="line"><span class="lineno">  897</span>  rc = <a class="code hl_function" href="buffer_8c.html#ad76477cc0c660bc50162393e997233eb">buf_strdup</a>(certfile);</div>
<div class="line"><span class="lineno">  898</span> </div>
<div class="line"><span class="lineno">  899</span>cleanup:</div>
<div class="line"><span class="lineno">  900</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_err);</div>
<div class="line"><span class="lineno">  901</span>  <span class="keywordflow">if</span> (fp_out)</div>
<div class="line"><span class="lineno">  902</span>  {</div>
<div class="line"><span class="lineno">  903</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno">  904</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(pk7out));</div>
<div class="line"><span class="lineno">  905</span>  }</div>
<div class="line"><span class="lineno">  906</span>  <span class="keywordflow">if</span> (fp_cert)</div>
<div class="line"><span class="lineno">  907</span>  {</div>
<div class="line"><span class="lineno">  908</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_cert);</div>
<div class="line"><span class="lineno">  909</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(certfile));</div>
<div class="line"><span class="lineno">  910</span>  }</div>
<div class="line"><span class="lineno">  911</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;pk7out);</div>
<div class="line"><span class="lineno">  912</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;certfile);</div>
<div class="line"><span class="lineno">  913</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  914</span>}</div>
<div class="ttc" id="abuffer_8c_html_ad76477cc0c660bc50162393e997233eb"><div class="ttname"><a href="buffer_8c.html#ad76477cc0c660bc50162393e997233eb">buf_strdup</a></div><div class="ttdeci">char * buf_strdup(const struct Buffer *buf)</div><div class="ttdoc">Copy a Buffer&#39;s string.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00571">buffer.c:571</a></div></div>
<div class="ttc" id="afile_8c_html_ae57463c2854c006a3c67b78736e9056e"><div class="ttname"><a href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a></div><div class="ttdeci">void mutt_file_unlink(const char *s)</div><div class="ttdoc">Delete a file, carefully.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00159">file.c:159</a></div></div>
<div class="ttc" id="atmp_8h_html_a271a7828888985955df49205d7846a45"><div class="ttname"><a href="tmp_8h.html#a271a7828888985955df49205d7846a45">buf_mktemp</a></div><div class="ttdeci">#define buf_mktemp(buf)</div><div class="ttdef"><b>Definition</b> <a href="tmp_8h_source.html#l00033">tmp.h:33</a></div></div>
</div><!-- fragment --><div id="dynsection-28" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ab03fce542ee9a7967437403be572d34e_cgraph.svg" width="598" height="511"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-29" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ab03fce542ee9a7967437403be572d34e_icgraph.svg" width="380" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8239a280f5be0afe28e328c5917e8d5a" name="a8239a280f5be0afe28e328c5917e8d5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8239a280f5be0afe28e328c5917e8d5a">&#9670;&#160;</a></span>smime_extract_signer_certificate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * smime_extract_signer_certificate </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>infile</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Extract the signer's certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">infile</td><td>File to read </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Name of temporary file containing certificate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00921">921</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  922</span>{</div>
<div class="line"><span class="lineno">  923</span>  <span class="keywordtype">char</span> *cert = NULL;</div>
<div class="line"><span class="lineno">  924</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *certfile = NULL;</div>
<div class="line"><span class="lineno">  925</span>  pid_t pid;</div>
<div class="line"><span class="lineno">  926</span>  <span class="keywordtype">int</span> empty;</div>
<div class="line"><span class="lineno">  927</span> </div>
<div class="line"><span class="lineno">  928</span>  FILE *fp_err = <a class="code hl_define" href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a>();</div>
<div class="line"><span class="lineno">  929</span>  <span class="keywordflow">if</span> (!fp_err)</div>
<div class="line"><span class="lineno">  930</span>  {</div>
<div class="line"><span class="lineno">  931</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno">  932</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  933</span>  }</div>
<div class="line"><span class="lineno">  934</span> </div>
<div class="line"><span class="lineno">  935</span>  certfile = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  936</span>  <a class="code hl_define" href="tmp_8h.html#a271a7828888985955df49205d7846a45">buf_mktemp</a>(certfile);</div>
<div class="line"><span class="lineno">  937</span>  FILE *fp_out = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(certfile), <span class="stringliteral">&quot;w+&quot;</span>);</div>
<div class="line"><span class="lineno">  938</span>  <span class="keywordflow">if</span> (!fp_out)</div>
<div class="line"><span class="lineno">  939</span>  {</div>
<div class="line"><span class="lineno">  940</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_err);</div>
<div class="line"><span class="lineno">  941</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(certfile));</div>
<div class="line"><span class="lineno">  942</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  943</span>  }</div>
<div class="line"><span class="lineno">  944</span> </div>
<div class="line"><span class="lineno">  945</span>  <span class="comment">/* Extract signer&#39;s certificate</span></div>
<div class="line"><span class="lineno">  946</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  947</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_get_signer_cert_command =</div>
<div class="line"><span class="lineno">  948</span>      <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_get_signer_cert_command&quot;</span>);</div>
<div class="line"><span class="lineno">  949</span>  pid = <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(NULL, NULL, NULL, -1, -1, fileno(fp_err), infile, NULL, NULL, NULL,</div>
<div class="line"><span class="lineno">  950</span>                     NULL, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(certfile), NULL, c_smime_get_signer_cert_command);</div>
<div class="line"><span class="lineno">  951</span>  <span class="keywordflow">if</span> (pid == -1)</div>
<div class="line"><span class="lineno">  952</span>  {</div>
<div class="line"><span class="lineno">  953</span>    <a class="code hl_function" href="curs__lib_8c.html#ab6a61cdfcf8c2c73ee59381c79c79774">mutt_any_key_to_continue</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Error: unable to create OpenSSL subprocess&quot;</span>));</div>
<div class="line"><span class="lineno">  954</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  955</span>  }</div>
<div class="line"><span class="lineno">  956</span> </div>
<div class="line"><span class="lineno">  957</span>  <a class="code hl_function" href="mutt_2filter_8c.html#a22c6912b837b1114c3276c990e73dca3">filter_wait</a>(pid);</div>
<div class="line"><span class="lineno">  958</span> </div>
<div class="line"><span class="lineno">  959</span>  fflush(fp_out);</div>
<div class="line"><span class="lineno">  960</span>  rewind(fp_out);</div>
<div class="line"><span class="lineno">  961</span>  fflush(fp_err);</div>
<div class="line"><span class="lineno">  962</span>  rewind(fp_err);</div>
<div class="line"><span class="lineno">  963</span>  empty = (fgetc(fp_out) == EOF);</div>
<div class="line"><span class="lineno">  964</span>  <span class="keywordflow">if</span> (empty)</div>
<div class="line"><span class="lineno">  965</span>  {</div>
<div class="line"><span class="lineno">  966</span>    <a class="code hl_function" href="curs__lib_8c.html#acd14d074d8b9e6cb21e851dd573cdec2">mutt_endwin</a>();</div>
<div class="line"><span class="lineno">  967</span>    <a class="code hl_function" href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a>(fp_err, stdout);</div>
<div class="line"><span class="lineno">  968</span>    <a class="code hl_function" href="curs__lib_8c.html#ab6a61cdfcf8c2c73ee59381c79c79774">mutt_any_key_to_continue</a>(NULL);</div>
<div class="line"><span class="lineno">  969</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  970</span>  }</div>
<div class="line"><span class="lineno">  971</span> </div>
<div class="line"><span class="lineno">  972</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno">  973</span>  cert = <a class="code hl_function" href="buffer_8c.html#ad76477cc0c660bc50162393e997233eb">buf_strdup</a>(certfile);</div>
<div class="line"><span class="lineno">  974</span> </div>
<div class="line"><span class="lineno">  975</span>cleanup:</div>
<div class="line"><span class="lineno">  976</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_err);</div>
<div class="line"><span class="lineno">  977</span>  <span class="keywordflow">if</span> (fp_out)</div>
<div class="line"><span class="lineno">  978</span>  {</div>
<div class="line"><span class="lineno">  979</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno">  980</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(certfile));</div>
<div class="line"><span class="lineno">  981</span>  }</div>
<div class="line"><span class="lineno">  982</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;certfile);</div>
<div class="line"><span class="lineno">  983</span>  <span class="keywordflow">return</span> cert;</div>
<div class="line"><span class="lineno">  984</span>}</div>
</div><!-- fragment --><div id="dynsection-30" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a8239a280f5be0afe28e328c5917e8d5a_cgraph.svg" width="574" height="563"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-31" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a8239a280f5be0afe28e328c5917e8d5a_icgraph.svg" width="352" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="adffec9377e19186fd331cf38f2226bb9" name="adffec9377e19186fd331cf38f2226bb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adffec9377e19186fd331cf38f2226bb9">&#9670;&#160;</a></span>smime_invoke_encrypt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pid_t smime_invoke_encrypt </td>
          <td>(</td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_out</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_err</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_infd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_outfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_errfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>uids</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Use SMIME to encrypt a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_in</td><td>stdin for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_out</td><td>stdout for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_err</td><td>stderr for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_infd</td><td>stdin for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_outfd</td><td>stdout for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_errfd</td><td>stderr for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>Filename to pass to the command </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uids</td><td>List of IDs/fingerprints, space separated </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">num</td><td>PID of the created process </td></tr>
    <tr><td class="paramname">-1</td><td>Error creating pipes or forking</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><code>fp_smime_in</code> has priority over <code>fp_smime_infd</code>. Likewise <code>fp_smime_out</code> and <code>fp_smime_err</code>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l01149">1149</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1153</span>{</div>
<div class="line"><span class="lineno"> 1154</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_smime_encrypt_with = <a class="code hl_function" href="config_2helpers_8c.html#a6b1589ee93ff51ef31f1d9324e138078">cs_subset_string</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_encrypt_with&quot;</span>);</div>
<div class="line"><span class="lineno"> 1155</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_encrypt_command = <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_encrypt_command&quot;</span>);</div>
<div class="line"><span class="lineno"> 1156</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(fp_smime_in, fp_smime_out, fp_smime_err, fp_smime_infd,</div>
<div class="line"><span class="lineno"> 1157</span>                      fp_smime_outfd, fp_smime_errfd, fname, NULL, c_smime_encrypt_with,</div>
<div class="line"><span class="lineno"> 1158</span>                      NULL, NULL, uids, NULL, c_smime_encrypt_command);</div>
<div class="line"><span class="lineno"> 1159</span>}</div>
</div><!-- fragment --><div id="dynsection-32" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-32-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-32-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-32-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_adffec9377e19186fd331cf38f2226bb9_cgraph.svg" width="362" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-33" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-33-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-33-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-33-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_adffec9377e19186fd331cf38f2226bb9_icgraph.svg" width="402" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a302ddcf352fd3fc5d5928a7543781b46" name="a302ddcf352fd3fc5d5928a7543781b46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a302ddcf352fd3fc5d5928a7543781b46">&#9670;&#160;</a></span>smime_invoke_sign()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pid_t smime_invoke_sign </td>
          <td>(</td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_out</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_err</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_infd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_outfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_errfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Use SMIME to sign a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_in</td><td>stdin for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_out</td><td>stdout for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_err</td><td>stderr for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_infd</td><td>stdin for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_outfd</td><td>stdout for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_errfd</td><td>stderr for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>Filename to pass to the command </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">num</td><td>PID of the created process </td></tr>
    <tr><td class="paramname">-1</td><td>Error creating pipes or forking</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><code>fp_smime_in</code> has priority over <code>fp_smime_infd</code>. Likewise <code>fp_smime_out</code> and <code>fp_smime_err</code>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l01176">1176</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1179</span>{</div>
<div class="line"><span class="lineno"> 1180</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_smime_sign_digest_alg = <a class="code hl_function" href="config_2helpers_8c.html#a6b1589ee93ff51ef31f1d9324e138078">cs_subset_string</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_sign_digest_alg&quot;</span>);</div>
<div class="line"><span class="lineno"> 1181</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_sign_command = <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_sign_command&quot;</span>);</div>
<div class="line"><span class="lineno"> 1182</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(fp_smime_in, fp_smime_out, fp_smime_err, fp_smime_infd, fp_smime_outfd,</div>
<div class="line"><span class="lineno"> 1183</span>                      fp_smime_errfd, fname, NULL, NULL, c_smime_sign_digest_alg,</div>
<div class="line"><span class="lineno"> 1184</span>                      <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(&amp;<a class="code hl_variable" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a>), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(&amp;<a class="code hl_variable" href="#ad37cb485abe0aeafae99190ea323d3c4">SmimeCertToUse</a>),</div>
<div class="line"><span class="lineno"> 1185</span>                      <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(&amp;<a class="code hl_variable" href="#a19c9a640138167646b8df02dcd2a7234">SmimeIntermediateToUse</a>), c_smime_sign_command);</div>
<div class="line"><span class="lineno"> 1186</span>}</div>
</div><!-- fragment --><div id="dynsection-34" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-34-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-34-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-34-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a302ddcf352fd3fc5d5928a7543781b46_cgraph.svg" width="471" height="171"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-35" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-35-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-35-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-35-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a302ddcf352fd3fc5d5928a7543781b46_icgraph.svg" width="388" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae9c2aea99bc63bcb58dab303c4ae3909" name="ae9c2aea99bc63bcb58dab303c4ae3909"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9c2aea99bc63bcb58dab303c4ae3909">&#9670;&#160;</a></span>openssl_md_to_smime_micalg()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * openssl_md_to_smime_micalg </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>md</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Change the algorithm names. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">md</td><td>OpenSSL message digest name </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>SMIME <a class="el" href="structMessage.html" title="A local copy of an email.">Message</a> Integrity Check algorithm</td></tr>
  </table>
  </dd>
</dl>
<p>The openssl -md doesn't want hyphens: md5, sha1, sha224, sha256, sha384, sha512 However, the micalg does: md5, sha-1, sha-224, sha-256, sha-384, sha-512</p>
<dl class="section note"><dt>Note</dt><dd>The caller should free the returned string </dd></dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l01335">1335</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1336</span>{</div>
<div class="line"><span class="lineno"> 1337</span>  <span class="keywordflow">if</span> (!md)</div>
<div class="line"><span class="lineno"> 1338</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1339</span> </div>
<div class="line"><span class="lineno"> 1340</span>  <span class="keywordtype">char</span> *micalg = NULL;</div>
<div class="line"><span class="lineno"> 1341</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="mutt_2string_8c.html#aebd2a8a3f8a30062c31fa1474d87cc41">mutt_istr_startswith</a>(md, <span class="stringliteral">&quot;sha&quot;</span>))</div>
<div class="line"><span class="lineno"> 1342</span>  {</div>
<div class="line"><span class="lineno"> 1343</span>    <a class="code hl_function" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;micalg, <span class="stringliteral">&quot;sha-%s&quot;</span>, md + 3);</div>
<div class="line"><span class="lineno"> 1344</span>  }</div>
<div class="line"><span class="lineno"> 1345</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1346</span>  {</div>
<div class="line"><span class="lineno"> 1347</span>    micalg = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(md);</div>
<div class="line"><span class="lineno"> 1348</span>  }</div>
<div class="line"><span class="lineno"> 1349</span> </div>
<div class="line"><span class="lineno"> 1350</span>  <span class="keywordflow">return</span> micalg;</div>
<div class="line"><span class="lineno"> 1351</span>}</div>
<div class="ttc" id="amutt_2string_8c_html_a4388c16988fac9a7596dee4d4af89595"><div class="ttname"><a href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a></div><div class="ttdeci">int mutt_str_asprintf(char **strp, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00803">string.c:803</a></div></div>
</div><!-- fragment --><div id="dynsection-36" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-36-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-36-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-36-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ae9c2aea99bc63bcb58dab303c4ae3909_cgraph.svg" width="364" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-37" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-37-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-37-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-37-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_ae9c2aea99bc63bcb58dab303c4ae3909_icgraph.svg" width="408" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a78f4b26aa7184098db006fdc8eb96ae4" name="a78f4b26aa7184098db006fdc8eb96ae4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78f4b26aa7184098db006fdc8eb96ae4">&#9670;&#160;</a></span>smime_invoke_verify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pid_t smime_invoke_verify </td>
          <td>(</td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_out</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_err</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_infd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_outfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_errfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>sig_fname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>opaque</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Use SMIME to verify a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_in</td><td>stdin for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_out</td><td>stdout for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_err</td><td>stderr for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_infd</td><td>stdin for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_outfd</td><td>stdout for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_errfd</td><td>stderr for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>Filename to pass to the command </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sig_fname</td><td>Signature filename to pass to the command </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">opaque</td><td>If true, use <code>$smime_verify_opaque_command</code> else <code>$smime_verify_command</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">num</td><td>PID of the created process </td></tr>
    <tr><td class="paramname">-1</td><td>Error creating pipes or forking</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><code>fp_smime_in</code> has priority over <code>fp_smime_infd</code>. Likewise <code>fp_smime_out</code> and <code>fp_smime_err</code>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l01526">1526</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1530</span>{</div>
<div class="line"><span class="lineno"> 1531</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_verify_opaque_command =</div>
<div class="line"><span class="lineno"> 1532</span>      <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_verify_opaque_command&quot;</span>);</div>
<div class="line"><span class="lineno"> 1533</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_verify_command = <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_verify_command&quot;</span>);</div>
<div class="line"><span class="lineno"> 1534</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(fp_smime_in, fp_smime_out, fp_smime_err, fp_smime_infd, fp_smime_outfd,</div>
<div class="line"><span class="lineno"> 1535</span>                      fp_smime_errfd, fname, sig_fname, NULL, NULL, NULL, NULL, NULL,</div>
<div class="line"><span class="lineno"> 1536</span>                      (opaque ? c_smime_verify_opaque_command : c_smime_verify_command));</div>
<div class="line"><span class="lineno"> 1537</span>}</div>
</div><!-- fragment --><div id="dynsection-38" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-38-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-38-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-38-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a78f4b26aa7184098db006fdc8eb96ae4_cgraph.svg" width="350" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-39" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-39-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-39-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-39-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a78f4b26aa7184098db006fdc8eb96ae4_icgraph.svg" width="379" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8eb0f60e2b6099bf5cacf6d39d821e1f" name="a8eb0f60e2b6099bf5cacf6d39d821e1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8eb0f60e2b6099bf5cacf6d39d821e1f">&#9670;&#160;</a></span>smime_invoke_decrypt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pid_t smime_invoke_decrypt </td>
          <td>(</td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_out</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE **</td>          <td class="paramname"><span class="paramname"><em>fp_smime_err</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_infd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_outfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fp_smime_errfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Use SMIME to decrypt a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_in</td><td>stdin for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_out</td><td>stdout for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fp_smime_err</td><td>stderr for the command, or NULL (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_infd</td><td>stdin for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_outfd</td><td>stdout for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_smime_errfd</td><td>stderr for the command, or -1 (OPTIONAL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>Filename to pass to the command </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">num</td><td>PID of the created process </td></tr>
    <tr><td class="paramname">-1</td><td>Error creating pipes or forking</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><code>fp_smime_in</code> has priority over <code>fp_smime_infd</code>. Likewise <code>fp_smime_out</code> and <code>fp_smime_err</code>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l01554">1554</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1557</span>{</div>
<div class="line"><span class="lineno"> 1558</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structExpando.html">Expando</a> *c_smime_decrypt_command = <a class="code hl_function" href="config_2helpers_8h.html#afadba3dd7a0ec53c70d047005b2efcef">cs_subset_expando</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;smime_decrypt_command&quot;</span>);</div>
<div class="line"><span class="lineno"> 1559</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="#ad1ab503f8f55cd15916f08d31b3c94ab">smime_invoke</a>(fp_smime_in, fp_smime_out, fp_smime_err, fp_smime_infd,</div>
<div class="line"><span class="lineno"> 1560</span>                      fp_smime_outfd, fp_smime_errfd, fname, NULL, NULL, NULL,</div>
<div class="line"><span class="lineno"> 1561</span>                      <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(&amp;<a class="code hl_variable" href="#aa6e38e9a28b61f5b2a7040931e58afaa">SmimeKeyToUse</a>), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(&amp;<a class="code hl_variable" href="#ad37cb485abe0aeafae99190ea323d3c4">SmimeCertToUse</a>),</div>
<div class="line"><span class="lineno"> 1562</span>                      NULL, c_smime_decrypt_command);</div>
<div class="line"><span class="lineno"> 1563</span>}</div>
</div><!-- fragment --><div id="dynsection-40" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-40-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-40-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-40-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a8eb0f60e2b6099bf5cacf6d39d821e1f_cgraph.svg" width="494" height="116"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-41" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-41-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-41-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-41-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a8eb0f60e2b6099bf5cacf6d39d821e1f_icgraph.svg" width="375" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a83eb7260d3b15365720064e2db623b34" name="a83eb7260d3b15365720064e2db623b34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83eb7260d3b15365720064e2db623b34">&#9670;&#160;</a></span>smime_handle_entity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structBody.html">Body</a> * smime_handle_entity </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structBody.html">Body</a> *</td>          <td class="paramname"><span class="paramname"><em>b</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structState.html">State</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *</td>          <td class="paramname"><span class="paramname"><em>fp_out_file</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handle type application/pkcs7-mime. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b</td><td><a class="el" href="structBody.html" title="The body of an email.">Body</a> to handle </td></tr>
    <tr><td class="paramname">state</td><td><a class="el" href="structState.html" title="Keep track when processing files.">State</a> to use </td></tr>
    <tr><td class="paramname">fp_out_file</td><td>File for the result </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td><a class="el" href="structBody.html" title="The body of an email.">Body</a> for parsed MIME part</td></tr>
  </table>
  </dd>
</dl>
<p>This can either be a signed or an encrypted message. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l01682">1682</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1683</span>{</div>
<div class="line"><span class="lineno"> 1684</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *tmpfname = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno"> 1685</span>  FILE *fp_smime_out = NULL, *fp_smime_in = NULL, *fp_smime_err = NULL;</div>
<div class="line"><span class="lineno"> 1686</span>  FILE *fp_tmp = NULL, *fp_out = NULL;</div>
<div class="line"><span class="lineno"> 1687</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBody.html">Body</a> *p = NULL;</div>
<div class="line"><span class="lineno"> 1688</span>  pid_t pid = -1;</div>
<div class="line"><span class="lineno"> 1689</span>  <a class="code hl_typedef" href="ncrypt_2lib_8h.html#a2073a168ca3a64c3c30d13fa4917a05d">SecurityFlags</a> <a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> = <a class="code hl_function" href="crypt_8c.html#a4073ce5b5fcec6e245dbfa9369016b8e">mutt_is_application_smime</a>(b);</div>
<div class="line"><span class="lineno"> 1690</span> </div>
<div class="line"><span class="lineno"> 1691</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#a798dfac1e8839ca89375b4ec62b3eff2">APPLICATION_SMIME</a>))</div>
<div class="line"><span class="lineno"> 1692</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 1693</span> </div>
<div class="line"><span class="lineno"> 1694</span>  <span class="comment">/* Because of the mutt_body_handler() we avoid the buffer pool. */</span></div>
<div class="line"><span class="lineno"> 1695</span>  fp_smime_out = <a class="code hl_define" href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a>();</div>
<div class="line"><span class="lineno"> 1696</span>  <span class="keywordflow">if</span> (!fp_smime_out)</div>
<div class="line"><span class="lineno"> 1697</span>  {</div>
<div class="line"><span class="lineno"> 1698</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno"> 1699</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1700</span>  }</div>
<div class="line"><span class="lineno"> 1701</span> </div>
<div class="line"><span class="lineno"> 1702</span>  fp_smime_err = <a class="code hl_define" href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a>();</div>
<div class="line"><span class="lineno"> 1703</span>  <span class="keywordflow">if</span> (!fp_smime_err)</div>
<div class="line"><span class="lineno"> 1704</span>  {</div>
<div class="line"><span class="lineno"> 1705</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno"> 1706</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1707</span>  }</div>
<div class="line"><span class="lineno"> 1708</span> </div>
<div class="line"><span class="lineno"> 1709</span>  <a class="code hl_define" href="tmp_8h.html#a271a7828888985955df49205d7846a45">buf_mktemp</a>(tmpfname);</div>
<div class="line"><span class="lineno"> 1710</span>  fp_tmp = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname), <span class="stringliteral">&quot;w+&quot;</span>);</div>
<div class="line"><span class="lineno"> 1711</span>  <span class="keywordflow">if</span> (!fp_tmp)</div>
<div class="line"><span class="lineno"> 1712</span>  {</div>
<div class="line"><span class="lineno"> 1713</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname));</div>
<div class="line"><span class="lineno"> 1714</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1715</span>  }</div>
<div class="line"><span class="lineno"> 1716</span> </div>
<div class="line"><span class="lineno"> 1717</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="file_8c.html#a6b60cb2044041374689e6e6641c5cc05">mutt_file_seek</a>(state-&gt;<a class="code hl_variable" href="structState.html#a9cf7e1f0c5c12399def5ca38b13054ae">fp_in</a>, b-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a>, SEEK_SET))</div>
<div class="line"><span class="lineno"> 1718</span>  {</div>
<div class="line"><span class="lineno"> 1719</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1720</span>  }</div>
<div class="line"><span class="lineno"> 1721</span> </div>
<div class="line"><span class="lineno"> 1722</span>  <a class="code hl_function" href="file_8c.html#a2bafa45ca3c8ce7d96303377d860e2db">mutt_file_copy_bytes</a>(state-&gt;<a class="code hl_variable" href="structState.html#a9cf7e1f0c5c12399def5ca38b13054ae">fp_in</a>, fp_tmp, b-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a>);</div>
<div class="line"><span class="lineno"> 1723</span> </div>
<div class="line"><span class="lineno"> 1724</span>  fflush(fp_tmp);</div>
<div class="line"><span class="lineno"> 1725</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_tmp);</div>
<div class="line"><span class="lineno"> 1726</span> </div>
<div class="line"><span class="lineno"> 1727</span>  <span class="keywordflow">if</span> ((<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#aacaa4abd4c0696e260b7a0f1d466360a">SEC_ENCRYPT</a>) &amp;&amp;</div>
<div class="line"><span class="lineno"> 1728</span>      ((pid = <a class="code hl_function" href="#a8eb0f60e2b6099bf5cacf6d39d821e1f">smime_invoke_decrypt</a>(&amp;fp_smime_in, NULL, NULL, -1, fileno(fp_smime_out),</div>
<div class="line"><span class="lineno"> 1729</span>                                   fileno(fp_smime_err), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname))) == -1))</div>
<div class="line"><span class="lineno"> 1730</span>  {</div>
<div class="line"><span class="lineno"> 1731</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname));</div>
<div class="line"><span class="lineno"> 1732</span>    <span class="keywordflow">if</span> (state-&gt;<a class="code hl_variable" href="structState.html#a5d855f7d518fde2ac4e8e409cbb24ad3">flags</a> &amp; <a class="code hl_define" href="mutt_2state_8h.html#a2a4ce653367a744f47960bc30b42f3a7">STATE_DISPLAY</a>)</div>
<div class="line"><span class="lineno"> 1733</span>    {</div>
<div class="line"><span class="lineno"> 1734</span>      <a class="code hl_function" href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a>(state, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[-- Error: unable to create OpenSSL subprocess --]\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1735</span>    }</div>
<div class="line"><span class="lineno"> 1736</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1737</span>  }</div>
<div class="line"><span class="lineno"> 1738</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#a6522a5e7af7f8624b8a3bbc94d8efb1e">SEC_SIGNOPAQUE</a>) &amp;&amp;</div>
<div class="line"><span class="lineno"> 1739</span>           ((pid = <a class="code hl_function" href="#a78f4b26aa7184098db006fdc8eb96ae4">smime_invoke_verify</a>(&amp;fp_smime_in, NULL, NULL, -1,</div>
<div class="line"><span class="lineno"> 1740</span>                                       fileno(fp_smime_out), fileno(fp_smime_err), NULL,</div>
<div class="line"><span class="lineno"> 1741</span>                                       <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname), <a class="code hl_define" href="ncrypt_2lib_8h.html#a6522a5e7af7f8624b8a3bbc94d8efb1e">SEC_SIGNOPAQUE</a>)) == -1))</div>
<div class="line"><span class="lineno"> 1742</span>  {</div>
<div class="line"><span class="lineno"> 1743</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname));</div>
<div class="line"><span class="lineno"> 1744</span>    <span class="keywordflow">if</span> (state-&gt;<a class="code hl_variable" href="structState.html#a5d855f7d518fde2ac4e8e409cbb24ad3">flags</a> &amp; <a class="code hl_define" href="mutt_2state_8h.html#a2a4ce653367a744f47960bc30b42f3a7">STATE_DISPLAY</a>)</div>
<div class="line"><span class="lineno"> 1745</span>    {</div>
<div class="line"><span class="lineno"> 1746</span>      <a class="code hl_function" href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a>(state, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[-- Error: unable to create OpenSSL subprocess --]\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1747</span>    }</div>
<div class="line"><span class="lineno"> 1748</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1749</span>  }</div>
<div class="line"><span class="lineno"> 1750</span> </div>
<div class="line"><span class="lineno"> 1751</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#aacaa4abd4c0696e260b7a0f1d466360a">SEC_ENCRYPT</a>)</div>
<div class="line"><span class="lineno"> 1752</span>  {</div>
<div class="line"><span class="lineno"> 1753</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__crypto__valid__passphrase.html#gaaa50dd72a9aae26aa62d0510121d41f9">smime_class_valid_passphrase</a>())</div>
<div class="line"><span class="lineno"> 1754</span>      <a class="code hl_function" href="group__crypto__void__passphrase.html#gadb364b3c8158f09603b981b70bbee2eb">smime_class_void_passphrase</a>();</div>
<div class="line"><span class="lineno"> 1755</span>    fputs(<a class="code hl_variable" href="#a34dd93b9b68b65428e25c44739a51349">SmimePass</a>, fp_smime_in);</div>
<div class="line"><span class="lineno"> 1756</span>    fputc(<span class="charliteral">&#39;\n&#39;</span>, fp_smime_in);</div>
<div class="line"><span class="lineno"> 1757</span>  }</div>
<div class="line"><span class="lineno"> 1758</span> </div>
<div class="line"><span class="lineno"> 1759</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_smime_in);</div>
<div class="line"><span class="lineno"> 1760</span> </div>
<div class="line"><span class="lineno"> 1761</span>  <a class="code hl_function" href="mutt_2filter_8c.html#a22c6912b837b1114c3276c990e73dca3">filter_wait</a>(pid);</div>
<div class="line"><span class="lineno"> 1762</span>  <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname));</div>
<div class="line"><span class="lineno"> 1763</span> </div>
<div class="line"><span class="lineno"> 1764</span>  <span class="keywordflow">if</span> (state-&gt;<a class="code hl_variable" href="structState.html#a5d855f7d518fde2ac4e8e409cbb24ad3">flags</a> &amp; <a class="code hl_define" href="mutt_2state_8h.html#a2a4ce653367a744f47960bc30b42f3a7">STATE_DISPLAY</a>)</div>
<div class="line"><span class="lineno"> 1765</span>  {</div>
<div class="line"><span class="lineno"> 1766</span>    fflush(fp_smime_err);</div>
<div class="line"><span class="lineno"> 1767</span>    rewind(fp_smime_err);</div>
<div class="line"><span class="lineno"> 1768</span> </div>
<div class="line"><span class="lineno"> 1769</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> c = fgetc(fp_smime_err);</div>
<div class="line"><span class="lineno"> 1770</span>    <span class="keywordflow">if</span> (c != EOF)</div>
<div class="line"><span class="lineno"> 1771</span>    {</div>
<div class="line"><span class="lineno"> 1772</span>      ungetc(c, fp_smime_err);</div>
<div class="line"><span class="lineno"> 1773</span> </div>
<div class="line"><span class="lineno"> 1774</span>      <a class="code hl_function" href="crypt_8c.html#ac85f3f9345f53423bce29d478a6d7aaa">crypt_current_time</a>(state, <span class="stringliteral">&quot;OpenSSL&quot;</span>);</div>
<div class="line"><span class="lineno"> 1775</span>      <a class="code hl_function" href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a>(fp_smime_err, state-&gt;<a class="code hl_variable" href="structState.html#a88fc722d3012ebf69d3a061cbf6bc296">fp_out</a>);</div>
<div class="line"><span class="lineno"> 1776</span>      <a class="code hl_function" href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a>(state, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[-- End of OpenSSL output --]\n\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1777</span>    }</div>
<div class="line"><span class="lineno"> 1778</span> </div>
<div class="line"><span class="lineno"> 1779</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#aacaa4abd4c0696e260b7a0f1d466360a">SEC_ENCRYPT</a>)</div>
<div class="line"><span class="lineno"> 1780</span>    {</div>
<div class="line"><span class="lineno"> 1781</span>      <a class="code hl_function" href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a>(state, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[-- The following data is S/MIME encrypted --]\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1782</span>    }</div>
<div class="line"><span class="lineno"> 1783</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1784</span>    {</div>
<div class="line"><span class="lineno"> 1785</span>      <a class="code hl_function" href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a>(state, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[-- The following data is S/MIME signed --]\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1786</span>    }</div>
<div class="line"><span class="lineno"> 1787</span>  }</div>
<div class="line"><span class="lineno"> 1788</span> </div>
<div class="line"><span class="lineno"> 1789</span>  fflush(fp_smime_out);</div>
<div class="line"><span class="lineno"> 1790</span>  rewind(fp_smime_out);</div>
<div class="line"><span class="lineno"> 1791</span> </div>
<div class="line"><span class="lineno"> 1792</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#aacaa4abd4c0696e260b7a0f1d466360a">SEC_ENCRYPT</a>)</div>
<div class="line"><span class="lineno"> 1793</span>  {</div>
<div class="line"><span class="lineno"> 1794</span>    <span class="comment">/* void the passphrase, even if that wasn&#39;t the problem */</span></div>
<div class="line"><span class="lineno"> 1795</span>    <span class="keywordflow">if</span> (fgetc(fp_smime_out) == EOF)</div>
<div class="line"><span class="lineno"> 1796</span>    {</div>
<div class="line"><span class="lineno"> 1797</span>      <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Decryption failed&quot;</span>));</div>
<div class="line"><span class="lineno"> 1798</span>      <a class="code hl_function" href="group__crypto__void__passphrase.html#gadb364b3c8158f09603b981b70bbee2eb">smime_class_void_passphrase</a>();</div>
<div class="line"><span class="lineno"> 1799</span>    }</div>
<div class="line"><span class="lineno"> 1800</span>    rewind(fp_smime_out);</div>
<div class="line"><span class="lineno"> 1801</span>  }</div>
<div class="line"><span class="lineno"> 1802</span> </div>
<div class="line"><span class="lineno"> 1803</span>  <span class="keywordflow">if</span> (fp_out_file)</div>
<div class="line"><span class="lineno"> 1804</span>  {</div>
<div class="line"><span class="lineno"> 1805</span>    fp_out = fp_out_file;</div>
<div class="line"><span class="lineno"> 1806</span>  }</div>
<div class="line"><span class="lineno"> 1807</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1808</span>  {</div>
<div class="line"><span class="lineno"> 1809</span>    fp_out = <a class="code hl_define" href="tmp_8h.html#a4ad1bdd71a5077a9e7dfc4890e1089f6">mutt_file_mkstemp</a>();</div>
<div class="line"><span class="lineno"> 1810</span>    <span class="keywordflow">if</span> (!fp_out)</div>
<div class="line"><span class="lineno"> 1811</span>    {</div>
<div class="line"><span class="lineno"> 1812</span>      <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno"> 1813</span>      <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1814</span>    }</div>
<div class="line"><span class="lineno"> 1815</span>  }</div>
<div class="line"><span class="lineno"> 1816</span>  <span class="keywordtype">char</span> buf[8192] = { 0 };</div>
<div class="line"><span class="lineno"> 1817</span>  <span class="keywordflow">while</span> (fgets(buf, <span class="keyword">sizeof</span>(buf) - 1, fp_smime_out))</div>
<div class="line"><span class="lineno"> 1818</span>  {</div>
<div class="line"><span class="lineno"> 1819</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> len = <a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(buf);</div>
<div class="line"><span class="lineno"> 1820</span>    <span class="keywordflow">if</span> ((len &gt; 1) &amp;&amp; (buf[len - 2] == <span class="charliteral">&#39;\r&#39;</span>))</div>
<div class="line"><span class="lineno"> 1821</span>    {</div>
<div class="line"><span class="lineno"> 1822</span>      buf[len - 2] = <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><span class="lineno"> 1823</span>      buf[len - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1824</span>    }</div>
<div class="line"><span class="lineno"> 1825</span>    fputs(buf, fp_out);</div>
<div class="line"><span class="lineno"> 1826</span>  }</div>
<div class="line"><span class="lineno"> 1827</span>  fflush(fp_out);</div>
<div class="line"><span class="lineno"> 1828</span>  rewind(fp_out);</div>
<div class="line"><span class="lineno"> 1829</span> </div>
<div class="line"><span class="lineno"> 1830</span>  <span class="keyword">const</span> <span class="keywordtype">long</span> size = <a class="code hl_function" href="file_8c.html#a4cffa4f503de3736198956ebed431f7e">mutt_file_get_size_fp</a>(fp_out);</div>
<div class="line"><span class="lineno"> 1831</span>  <span class="keywordflow">if</span> (size == 0)</div>
<div class="line"><span class="lineno"> 1832</span>  {</div>
<div class="line"><span class="lineno"> 1833</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno"> 1834</span>  }</div>
<div class="line"><span class="lineno"> 1835</span>  p = <a class="code hl_function" href="email_2parse_8c.html#a2cfe061d82e6381b14e355c0937ecfc1">mutt_read_mime_header</a>(fp_out, 0);</div>
<div class="line"><span class="lineno"> 1836</span>  <span class="keywordflow">if</span> (p)</div>
<div class="line"><span class="lineno"> 1837</span>  {</div>
<div class="line"><span class="lineno"> 1838</span>    p-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a> = size - p-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a>;</div>
<div class="line"><span class="lineno"> 1839</span> </div>
<div class="line"><span class="lineno"> 1840</span>    <a class="code hl_function" href="email_2parse_8c.html#a0b38ac4f44b3414d0e18d26324861369">mutt_parse_part</a>(fp_out, p);</div>
<div class="line"><span class="lineno"> 1841</span> </div>
<div class="line"><span class="lineno"> 1842</span>    <span class="keywordflow">if</span> (state-&gt;<a class="code hl_variable" href="structState.html#a5d855f7d518fde2ac4e8e409cbb24ad3">flags</a> &amp; <a class="code hl_define" href="mutt_2state_8h.html#a2a4ce653367a744f47960bc30b42f3a7">STATE_DISPLAY</a>)</div>
<div class="line"><span class="lineno"> 1843</span>      <a class="code hl_function" href="group__handler__api.html#ga7ccf06ce10b9aed658fcc6c7a40c64b8">mutt_protected_headers_handler</a>(p, state);</div>
<div class="line"><span class="lineno"> 1844</span> </div>
<div class="line"><span class="lineno"> 1845</span>    <span class="comment">/* Store any protected headers in the parent so they can be</span></div>
<div class="line"><span class="lineno"> 1846</span><span class="comment">     * accessed for index updates after the handler recursion is done.</span></div>
<div class="line"><span class="lineno"> 1847</span><span class="comment">     * This is done before the handler to prevent a nested encrypted</span></div>
<div class="line"><span class="lineno"> 1848</span><span class="comment">     * handler from freeing the headers. */</span></div>
<div class="line"><span class="lineno"> 1849</span>    <a class="code hl_function" href="envelope_8c.html#a244dacf9b1001c9ce1dbd473e001381f">mutt_env_free</a>(&amp;b-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a>);</div>
<div class="line"><span class="lineno"> 1850</span>    b-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a> = p-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a>;</div>
<div class="line"><span class="lineno"> 1851</span>    p-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a> = NULL;</div>
<div class="line"><span class="lineno"> 1852</span> </div>
<div class="line"><span class="lineno"> 1853</span>    <span class="keywordflow">if</span> (state-&gt;<a class="code hl_variable" href="structState.html#a88fc722d3012ebf69d3a061cbf6bc296">fp_out</a>)</div>
<div class="line"><span class="lineno"> 1854</span>    {</div>
<div class="line"><span class="lineno"> 1855</span>      rewind(fp_out);</div>
<div class="line"><span class="lineno"> 1856</span>      FILE *fp_tmp_buffer = state-&gt;<a class="code hl_variable" href="structState.html#a9cf7e1f0c5c12399def5ca38b13054ae">fp_in</a>;</div>
<div class="line"><span class="lineno"> 1857</span>      state-&gt;<a class="code hl_variable" href="structState.html#a9cf7e1f0c5c12399def5ca38b13054ae">fp_in</a> = fp_out;</div>
<div class="line"><span class="lineno"> 1858</span>      <a class="code hl_function" href="handler_8c.html#a3e520d3004995a6c0cf0696edfd209fb">mutt_body_handler</a>(p, state);</div>
<div class="line"><span class="lineno"> 1859</span>      state-&gt;<a class="code hl_variable" href="structState.html#a9cf7e1f0c5c12399def5ca38b13054ae">fp_in</a> = fp_tmp_buffer;</div>
<div class="line"><span class="lineno"> 1860</span>    }</div>
<div class="line"><span class="lineno"> 1861</span> </div>
<div class="line"><span class="lineno"> 1862</span>    <span class="comment">/* Embedded multipart signed protected headers override the</span></div>
<div class="line"><span class="lineno"> 1863</span><span class="comment">     * encrypted headers.  We need to do this after the handler so</span></div>
<div class="line"><span class="lineno"> 1864</span><span class="comment">     * they can be printed in the pager. */</span></div>
<div class="line"><span class="lineno"> 1865</span>    <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#a67114d960e61fc36c467f4bf08d37335">SMIME_SIGN</a>) &amp;&amp; <a class="code hl_function" href="crypt_8c.html#a345fb1ff241b3fc778632947c2b08d37">mutt_is_multipart_signed</a>(p) &amp;&amp; p-&gt;<a class="code hl_variable" href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">parts</a> &amp;&amp;</div>
<div class="line"><span class="lineno"> 1866</span>        p-&gt;<a class="code hl_variable" href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">parts</a>-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a>)</div>
<div class="line"><span class="lineno"> 1867</span>    {</div>
<div class="line"><span class="lineno"> 1868</span>      <a class="code hl_function" href="envelope_8c.html#a244dacf9b1001c9ce1dbd473e001381f">mutt_env_free</a>(&amp;b-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a>);</div>
<div class="line"><span class="lineno"> 1869</span>      b-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a> = p-&gt;<a class="code hl_variable" href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">parts</a>-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a>;</div>
<div class="line"><span class="lineno"> 1870</span>      p-&gt;<a class="code hl_variable" href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">parts</a>-&gt;<a class="code hl_variable" href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">mime_headers</a> = NULL;</div>
<div class="line"><span class="lineno"> 1871</span>    }</div>
<div class="line"><span class="lineno"> 1872</span>  }</div>
<div class="line"><span class="lineno"> 1873</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_smime_out);</div>
<div class="line"><span class="lineno"> 1874</span> </div>
<div class="line"><span class="lineno"> 1875</span>  <span class="keywordflow">if</span> (!fp_out_file)</div>
<div class="line"><span class="lineno"> 1876</span>  {</div>
<div class="line"><span class="lineno"> 1877</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno"> 1878</span>    <a class="code hl_function" href="file_8c.html#ae57463c2854c006a3c67b78736e9056e">mutt_file_unlink</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tmpfname));</div>
<div class="line"><span class="lineno"> 1879</span>  }</div>
<div class="line"><span class="lineno"> 1880</span>  fp_out = NULL;</div>
<div class="line"><span class="lineno"> 1881</span> </div>
<div class="line"><span class="lineno"> 1882</span>  <span class="keywordflow">if</span> (state-&gt;<a class="code hl_variable" href="structState.html#a5d855f7d518fde2ac4e8e409cbb24ad3">flags</a> &amp; <a class="code hl_define" href="mutt_2state_8h.html#a2a4ce653367a744f47960bc30b42f3a7">STATE_DISPLAY</a>)</div>
<div class="line"><span class="lineno"> 1883</span>  {</div>
<div class="line"><span class="lineno"> 1884</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#aacaa4abd4c0696e260b7a0f1d466360a">SEC_ENCRYPT</a>)</div>
<div class="line"><span class="lineno"> 1885</span>      <a class="code hl_function" href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a>(state, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[-- End of S/MIME encrypted data --]\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1886</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1887</span>      <a class="code hl_function" href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a>(state, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[-- End of S/MIME signed data --]\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1888</span>  }</div>
<div class="line"><span class="lineno"> 1889</span> </div>
<div class="line"><span class="lineno"> 1890</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="structBody.html#af77d79aadb278bef8f2829c268f2486f">type</a> &amp; <a class="code hl_define" href="ncrypt_2lib_8h.html#a6522a5e7af7f8624b8a3bbc94d8efb1e">SEC_SIGNOPAQUE</a>)</div>
<div class="line"><span class="lineno"> 1891</span>  {</div>
<div class="line"><span class="lineno"> 1892</span>    <span class="keywordtype">char</span> *line = NULL;</div>
<div class="line"><span class="lineno"> 1893</span>    <span class="keywordtype">size_t</span> linelen;</div>
<div class="line"><span class="lineno"> 1894</span> </div>
<div class="line"><span class="lineno"> 1895</span>    rewind(fp_smime_err);</div>
<div class="line"><span class="lineno"> 1896</span> </div>
<div class="line"><span class="lineno"> 1897</span>    line = <a class="code hl_function" href="file_8c.html#a1ad76f956147154f16128b7761dadd58">mutt_file_read_line</a>(line, &amp;linelen, fp_smime_err, NULL, <a class="code hl_define" href="file_8h.html#abb6d0dccab49bda4ed23948c7f5d0eaa">MUTT_RL_NO_FLAGS</a>);</div>
<div class="line"><span class="lineno"> 1898</span>    <span class="keywordflow">if</span> (linelen &amp;&amp; <a class="code hl_function" href="mutt_2string_8c.html#a29db81d6f5a7dd216cbea75ecf8a5885">mutt_istr_equal</a>(line, <span class="stringliteral">&quot;verification successful&quot;</span>))</div>
<div class="line"><span class="lineno"> 1899</span>      b-&gt;<a class="code hl_variable" href="structBody.html#ae4b2706a5c4601ae1497a96e047d8f5e">goodsig</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1900</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;line);</div>
<div class="line"><span class="lineno"> 1901</span>  }</div>
<div class="line"><span class="lineno"> 1902</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p)</div>
<div class="line"><span class="lineno"> 1903</span>  {</div>
<div class="line"><span class="lineno"> 1904</span>    b-&gt;<a class="code hl_variable" href="structBody.html#ae4b2706a5c4601ae1497a96e047d8f5e">goodsig</a> = p-&gt;<a class="code hl_variable" href="structBody.html#ae4b2706a5c4601ae1497a96e047d8f5e">goodsig</a>;</div>
<div class="line"><span class="lineno"> 1905</span>    b-&gt;<a class="code hl_variable" href="structBody.html#a4de063a5f09cb7376f9fde6bb0fe48bc">badsig</a> = p-&gt;<a class="code hl_variable" href="structBody.html#a4de063a5f09cb7376f9fde6bb0fe48bc">badsig</a>;</div>
<div class="line"><span class="lineno"> 1906</span>  }</div>
<div class="line"><span class="lineno"> 1907</span> </div>
<div class="line"><span class="lineno"> 1908</span>cleanup:</div>
<div class="line"><span class="lineno"> 1909</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_smime_out);</div>
<div class="line"><span class="lineno"> 1910</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_smime_err);</div>
<div class="line"><span class="lineno"> 1911</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_tmp);</div>
<div class="line"><span class="lineno"> 1912</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp_out);</div>
<div class="line"><span class="lineno"> 1913</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;tmpfname);</div>
<div class="line"><span class="lineno"> 1914</span>  <span class="keywordflow">return</span> p;</div>
<div class="line"><span class="lineno"> 1915</span>}</div>
<div class="ttc" id="acrypt_8c_html_a345fb1ff241b3fc778632947c2b08d37"><div class="ttname"><a href="crypt_8c.html#a345fb1ff241b3fc778632947c2b08d37">mutt_is_multipart_signed</a></div><div class="ttdeci">SecurityFlags mutt_is_multipart_signed(struct Body *b)</div><div class="ttdoc">Is a message signed?</div><div class="ttdef"><b>Definition</b> <a href="crypt_8c_source.html#l00408">crypt.c:408</a></div></div>
<div class="ttc" id="acrypt_8c_html_a4073ce5b5fcec6e245dbfa9369016b8e"><div class="ttname"><a href="crypt_8c.html#a4073ce5b5fcec6e245dbfa9369016b8e">mutt_is_application_smime</a></div><div class="ttdeci">SecurityFlags mutt_is_application_smime(struct Body *b)</div><div class="ttdoc">Does the message use S/MIME?</div><div class="ttdef"><b>Definition</b> <a href="crypt_8c_source.html#l00609">crypt.c:609</a></div></div>
<div class="ttc" id="acrypt_8c_html_ac85f3f9345f53423bce29d478a6d7aaa"><div class="ttname"><a href="crypt_8c.html#ac85f3f9345f53423bce29d478a6d7aaa">crypt_current_time</a></div><div class="ttdeci">void crypt_current_time(struct State *state, const char *app_name)</div><div class="ttdoc">Print the current time.</div><div class="ttdef"><b>Definition</b> <a href="crypt_8c_source.html#l00064">crypt.c:64</a></div></div>
<div class="ttc" id="aemail_2parse_8c_html_a0b38ac4f44b3414d0e18d26324861369"><div class="ttname"><a href="email_2parse_8c.html#a0b38ac4f44b3414d0e18d26324861369">mutt_parse_part</a></div><div class="ttdeci">void mutt_parse_part(FILE *fp, struct Body *b)</div><div class="ttdoc">Parse a MIME part.</div><div class="ttdef"><b>Definition</b> <a href="email_2parse_8c_source.html#l01821">parse.c:1821</a></div></div>
<div class="ttc" id="aemail_2parse_8c_html_a2cfe061d82e6381b14e355c0937ecfc1"><div class="ttname"><a href="email_2parse_8c.html#a2cfe061d82e6381b14e355c0937ecfc1">mutt_read_mime_header</a></div><div class="ttdeci">struct Body * mutt_read_mime_header(FILE *fp, bool digest)</div><div class="ttdoc">Parse a MIME header.</div><div class="ttdef"><b>Definition</b> <a href="email_2parse_8c_source.html#l01361">parse.c:1361</a></div></div>
<div class="ttc" id="aenvelope_8c_html_a244dacf9b1001c9ce1dbd473e001381f"><div class="ttname"><a href="envelope_8c.html#a244dacf9b1001c9ce1dbd473e001381f">mutt_env_free</a></div><div class="ttdeci">void mutt_env_free(struct Envelope **ptr)</div><div class="ttdoc">Free an Envelope.</div><div class="ttdef"><b>Definition</b> <a href="envelope_8c_source.html#l00125">envelope.c:125</a></div></div>
<div class="ttc" id="afile_8c_html_a1ad76f956147154f16128b7761dadd58"><div class="ttname"><a href="file_8c.html#a1ad76f956147154f16128b7761dadd58">mutt_file_read_line</a></div><div class="ttdeci">char * mutt_file_read_line(char *line, size_t *size, FILE *fp, int *line_num, ReadLineFlags flags)</div><div class="ttdoc">Read a line from a file.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00685">file.c:685</a></div></div>
<div class="ttc" id="afile_8c_html_a2bafa45ca3c8ce7d96303377d860e2db"><div class="ttname"><a href="file_8c.html#a2bafa45ca3c8ce7d96303377d860e2db">mutt_file_copy_bytes</a></div><div class="ttdeci">int mutt_file_copy_bytes(FILE *fp_in, FILE *fp_out, size_t size)</div><div class="ttdoc">Copy some content from one file to another.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00195">file.c:195</a></div></div>
<div class="ttc" id="afile_8c_html_a4cffa4f503de3736198956ebed431f7e"><div class="ttname"><a href="file_8c.html#a4cffa4f503de3736198956ebed431f7e">mutt_file_get_size_fp</a></div><div class="ttdeci">long mutt_file_get_size_fp(FILE *fp)</div><div class="ttdoc">Get the size of a file.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l01430">file.c:1430</a></div></div>
<div class="ttc" id="afile_8c_html_a6b60cb2044041374689e6e6641c5cc05"><div class="ttname"><a href="file_8c.html#a6b60cb2044041374689e6e6641c5cc05">mutt_file_seek</a></div><div class="ttdeci">bool mutt_file_seek(FILE *fp, LOFF_T offset, int whence)</div><div class="ttdoc">Wrapper for fseeko with error handling.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00655">file.c:655</a></div></div>
<div class="ttc" id="afile_8h_html_abb6d0dccab49bda4ed23948c7f5d0eaa"><div class="ttname"><a href="file_8h.html#abb6d0dccab49bda4ed23948c7f5d0eaa">MUTT_RL_NO_FLAGS</a></div><div class="ttdeci">#define MUTT_RL_NO_FLAGS</div><div class="ttdoc">No flags are set.</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00040">file.h:40</a></div></div>
<div class="ttc" id="agroup__crypto__valid__passphrase_html_gaaa50dd72a9aae26aa62d0510121d41f9"><div class="ttname"><a href="group__crypto__valid__passphrase.html#gaaa50dd72a9aae26aa62d0510121d41f9">smime_class_valid_passphrase</a></div><div class="ttdeci">bool smime_class_valid_passphrase(void)</div><div class="ttdoc">Ensure we have a valid passphrase - Implements CryptModuleSpecs::valid_passphrase() -.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00157">smime.c:157</a></div></div>
<div class="ttc" id="agroup__handler__api_html_ga7ccf06ce10b9aed658fcc6c7a40c64b8"><div class="ttname"><a href="group__handler__api.html#ga7ccf06ce10b9aed658fcc6c7a40c64b8">mutt_protected_headers_handler</a></div><div class="ttdeci">int mutt_protected_headers_handler(struct Body *b_email, struct State *state)</div><div class="ttdoc">Handler for protected headers - Implements handler_t -.</div><div class="ttdef"><b>Definition</b> <a href="crypt_8c_source.html#l01117">crypt.c:1117</a></div></div>
<div class="ttc" id="ahandler_8c_html_a3e520d3004995a6c0cf0696edfd209fb"><div class="ttname"><a href="handler_8c.html#a3e520d3004995a6c0cf0696edfd209fb">mutt_body_handler</a></div><div class="ttdeci">int mutt_body_handler(struct Body *b, struct State *state)</div><div class="ttdoc">Handler for the Body of an email.</div><div class="ttdef"><b>Definition</b> <a href="handler_8c_source.html#l01632">handler.c:1632</a></div></div>
<div class="ttc" id="amutt_2state_8c_html_a0d52430e63f8cffdd0e6a78182ad4385"><div class="ttname"><a href="mutt_2state_8c.html#a0d52430e63f8cffdd0e6a78182ad4385">state_attach_puts</a></div><div class="ttdeci">void state_attach_puts(struct State *state, const char *t)</div><div class="ttdoc">Write a string to the state.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2state_8c_source.html#l00104">state.c:104</a></div></div>
<div class="ttc" id="amutt_2state_8h_html_a2a4ce653367a744f47960bc30b42f3a7"><div class="ttname"><a href="mutt_2state_8h.html#a2a4ce653367a744f47960bc30b42f3a7">STATE_DISPLAY</a></div><div class="ttdeci">#define STATE_DISPLAY</div><div class="ttdoc">Output is displayed to the user.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2state_8h_source.html#l00033">state.h:33</a></div></div>
<div class="ttc" id="ancrypt_2lib_8h_html_a2073a168ca3a64c3c30d13fa4917a05d"><div class="ttname"><a href="ncrypt_2lib_8h.html#a2073a168ca3a64c3c30d13fa4917a05d">SecurityFlags</a></div><div class="ttdeci">uint16_t SecurityFlags</div><div class="ttdoc">Flags, e.g. SEC_ENCRYPT.</div><div class="ttdef"><b>Definition</b> <a href="ncrypt_2lib_8h_source.html#l00082">lib.h:82</a></div></div>
<div class="ttc" id="ancrypt_2lib_8h_html_a6522a5e7af7f8624b8a3bbc94d8efb1e"><div class="ttname"><a href="ncrypt_2lib_8h.html#a6522a5e7af7f8624b8a3bbc94d8efb1e">SEC_SIGNOPAQUE</a></div><div class="ttdeci">#define SEC_SIGNOPAQUE</div><div class="ttdoc">Email has an opaque signature (encrypted)</div><div class="ttdef"><b>Definition</b> <a href="ncrypt_2lib_8h_source.html#l00089">lib.h:89</a></div></div>
<div class="ttc" id="ancrypt_2lib_8h_html_a67114d960e61fc36c467f4bf08d37335"><div class="ttname"><a href="ncrypt_2lib_8h.html#a67114d960e61fc36c467f4bf08d37335">SMIME_SIGN</a></div><div class="ttdeci">#define SMIME_SIGN</div><div class="ttdef"><b>Definition</b> <a href="ncrypt_2lib_8h_source.html#l00109">lib.h:109</a></div></div>
<div class="ttc" id="ancrypt_2lib_8h_html_a798dfac1e8839ca89375b4ec62b3eff2"><div class="ttname"><a href="ncrypt_2lib_8h.html#a798dfac1e8839ca89375b4ec62b3eff2">APPLICATION_SMIME</a></div><div class="ttdeci">#define APPLICATION_SMIME</div><div class="ttdoc">Use SMIME to encrypt/sign.</div><div class="ttdef"><b>Definition</b> <a href="ncrypt_2lib_8h_source.html#l00097">lib.h:97</a></div></div>
<div class="ttc" id="ancrypt_2lib_8h_html_aacaa4abd4c0696e260b7a0f1d466360a"><div class="ttname"><a href="ncrypt_2lib_8h.html#aacaa4abd4c0696e260b7a0f1d466360a">SEC_ENCRYPT</a></div><div class="ttdeci">#define SEC_ENCRYPT</div><div class="ttdoc">Email is encrypted.</div><div class="ttdef"><b>Definition</b> <a href="ncrypt_2lib_8h_source.html#l00084">lib.h:84</a></div></div>
<div class="ttc" id="asmime_8c_html_a34dd93b9b68b65428e25c44739a51349"><div class="ttname"><a href="#a34dd93b9b68b65428e25c44739a51349">SmimePass</a></div><div class="ttdeci">static char SmimePass[256]</div><div class="ttdoc">Cached Smime Passphrase.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l00067">smime.c:67</a></div></div>
<div class="ttc" id="asmime_8c_html_a78f4b26aa7184098db006fdc8eb96ae4"><div class="ttname"><a href="#a78f4b26aa7184098db006fdc8eb96ae4">smime_invoke_verify</a></div><div class="ttdeci">static pid_t smime_invoke_verify(FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname, const char *sig_fname, int opaque)</div><div class="ttdoc">Use SMIME to verify a file.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l01526">smime.c:1526</a></div></div>
<div class="ttc" id="asmime_8c_html_a8eb0f60e2b6099bf5cacf6d39d821e1f"><div class="ttname"><a href="#a8eb0f60e2b6099bf5cacf6d39d821e1f">smime_invoke_decrypt</a></div><div class="ttdeci">static pid_t smime_invoke_decrypt(FILE **fp_smime_in, FILE **fp_smime_out, FILE **fp_smime_err, int fp_smime_infd, int fp_smime_outfd, int fp_smime_errfd, const char *fname)</div><div class="ttdoc">Use SMIME to decrypt a file.</div><div class="ttdef"><b>Definition</b> <a href="smime_8c_source.html#l01554">smime.c:1554</a></div></div>
<div class="ttc" id="astructBody_html"><div class="ttname"><a href="structBody.html">Body</a></div><div class="ttdoc">The body of an email.</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00035">body.h:36</a></div></div>
<div class="ttc" id="astructBody_html_a0b87b7bdb6faef44d9aac4854975f805"><div class="ttname"><a href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">Body::parts</a></div><div class="ttdeci">struct Body * parts</div><div class="ttdoc">parts of a multipart or message/rfc822</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00073">body.h:73</a></div></div>
<div class="ttc" id="astructBody_html_a1969dfeb0a155ccb16153fe777a103b0"><div class="ttname"><a href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">Body::offset</a></div><div class="ttdeci">LOFF_T offset</div><div class="ttdoc">offset where the actual data begins</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00052">body.h:52</a></div></div>
<div class="ttc" id="astructBody_html_a4de063a5f09cb7376f9fde6bb0fe48bc"><div class="ttname"><a href="structBody.html#a4de063a5f09cb7376f9fde6bb0fe48bc">Body::badsig</a></div><div class="ttdeci">bool badsig</div><div class="ttdoc">Bad cryptographic signature (needed to check encrypted s/mime-signatures)</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00043">body.h:43</a></div></div>
<div class="ttc" id="astructBody_html_a62f6c9b4245ed3b6b9296adb45aa4010"><div class="ttname"><a href="structBody.html#a62f6c9b4245ed3b6b9296adb45aa4010">Body::mime_headers</a></div><div class="ttdeci">struct Envelope * mime_headers</div><div class="ttdoc">Memory hole protected headers.</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00076">body.h:76</a></div></div>
<div class="ttc" id="astructBody_html_a6f92d7ec8568ca04ae07931c56dd0790"><div class="ttname"><a href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">Body::length</a></div><div class="ttdeci">LOFF_T length</div><div class="ttdoc">length (in bytes) of attachment</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00053">body.h:53</a></div></div>
<div class="ttc" id="astructBody_html_ae4b2706a5c4601ae1497a96e047d8f5e"><div class="ttname"><a href="structBody.html#ae4b2706a5c4601ae1497a96e047d8f5e">Body::goodsig</a></div><div class="ttdeci">bool goodsig</div><div class="ttdoc">Good cryptographic signature.</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00045">body.h:45</a></div></div>
<div class="ttc" id="astructBody_html_af77d79aadb278bef8f2829c268f2486f"><div class="ttname"><a href="structBody.html#af77d79aadb278bef8f2829c268f2486f">Body::type</a></div><div class="ttdeci">unsigned int type</div><div class="ttdoc">content-type primary type, ContentType</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00040">body.h:40</a></div></div>
<div class="ttc" id="astructState_html_a5d855f7d518fde2ac4e8e409cbb24ad3"><div class="ttname"><a href="structState.html#a5d855f7d518fde2ac4e8e409cbb24ad3">State::flags</a></div><div class="ttdeci">StateFlags flags</div><div class="ttdoc">Flags, e.g. STATE_DISPLAY.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2state_8h_source.html#l00052">state.h:52</a></div></div>
<div class="ttc" id="astructState_html_a88fc722d3012ebf69d3a061cbf6bc296"><div class="ttname"><a href="structState.html#a88fc722d3012ebf69d3a061cbf6bc296">State::fp_out</a></div><div class="ttdeci">FILE * fp_out</div><div class="ttdoc">File to write to.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2state_8h_source.html#l00050">state.h:50</a></div></div>
<div class="ttc" id="astructState_html_a9cf7e1f0c5c12399def5ca38b13054ae"><div class="ttname"><a href="structState.html#a9cf7e1f0c5c12399def5ca38b13054ae">State::fp_in</a></div><div class="ttdeci">FILE * fp_in</div><div class="ttdoc">File to read from.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2state_8h_source.html#l00049">state.h:49</a></div></div>
</div><!-- fragment --><div id="dynsection-42" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-42-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-42-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-42-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a83eb7260d3b15365720064e2db623b34_cgraph.svg" width="834" height="1318"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-43" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-43-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-43-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-43-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="smime_8c_a83eb7260d3b15365720064e2db623b34_icgraph.svg" width="403" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a34dd93b9b68b65428e25c44739a51349" name="a34dd93b9b68b65428e25c44739a51349"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34dd93b9b68b65428e25c44739a51349">&#9670;&#160;</a></span>SmimePass</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char SmimePass[256]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cached Smime Passphrase. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00067">67</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>

</div>
</div>
<a id="a4009b05bed4b2cee11d0e78bc8d67ba7" name="a4009b05bed4b2cee11d0e78bc8d67ba7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4009b05bed4b2cee11d0e78bc8d67ba7">&#9670;&#160;</a></span>SmimeExpTime</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">time_t SmimeExpTime = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unix time when <a class="el" href="#a34dd93b9b68b65428e25c44739a51349" title="Cached Smime Passphrase.">SmimePass</a> expires. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00069">69</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>

</div>
</div>
<a id="aa6e38e9a28b61f5b2a7040931e58afaa" name="aa6e38e9a28b61f5b2a7040931e58afaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6e38e9a28b61f5b2a7040931e58afaa">&#9670;&#160;</a></span>SmimeKeyToUse</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structBuffer.html">Buffer</a> SmimeKeyToUse = { 0 }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Smime key to use. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00072">72</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   72</span>{ 0 };</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad37cb485abe0aeafae99190ea323d3c4" name="ad37cb485abe0aeafae99190ea323d3c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad37cb485abe0aeafae99190ea323d3c4">&#9670;&#160;</a></span>SmimeCertToUse</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structBuffer.html">Buffer</a> SmimeCertToUse = { 0 }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Smime certificate to use. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00074">74</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   74</span>{ 0 };</div>
</div><!-- fragment -->
</div>
</div>
<a id="a19c9a640138167646b8df02dcd2a7234" name="a19c9a640138167646b8df02dcd2a7234"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19c9a640138167646b8df02dcd2a7234">&#9670;&#160;</a></span>SmimeIntermediateToUse</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structBuffer.html">Buffer</a> SmimeIntermediateToUse = { 0 }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Smime intermediate certificate to use. </p>

<p class="definition">Definition at line <a class="el" href="smime_8c_source.html#l00076">76</a> of file <a class="el" href="smime_8c_source.html">smime.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   76</span>{ 0 };</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
