<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NeoMutt: mbox_sync()</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><a href="https://neomutt.org"><img alt="Logo" src="neomutt-64.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <a style="color: black; text-decoration: none;" href="https://neomutt.org">
   <div id="projectname">NeoMutt
   &#160;<span id="projectnumber">2025-09-05-40-g6a7c50</span>
   </div>
   <div id="projectbrief">Teaching an old dog new tricks</div>
   </a>
   <a href="https://github.com/neomutt/neomutt" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000000; color:#fff; position: fixed; top: 0; border: 0; right: 0; z-index: 9999;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </td>
   <td><a style="text-decoration: none; position: absolute; right: 0; top: 25px; margin-right: 100px; color: #66d866; font-size: 400%;" href="http://www.doxygen.org/index.html">DOXYGEN</a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__mx__mbox__sync.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">mbox_sync()<div class="ingroups"><a class="el" href="group__mx__api.html">Mailbox API</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a>.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for mbox_sync():</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync.svg" width="252" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gadeb7755ceb989e6dc91e9afa2ff9e84e"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#gadeb7755ceb989e6dc91e9afa2ff9e84e">comp_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:gadeb7755ceb989e6dc91e9afa2ff9e84e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:gadeb7755ceb989e6dc91e9afa2ff9e84e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga51ba9115523ffa080d8f71211a821c39"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#ga51ba9115523ffa080d8f71211a821c39">maildir_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ga51ba9115523ffa080d8f71211a821c39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:ga51ba9115523ffa080d8f71211a821c39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga47a65cbf57a70eb1db4e5aed167ec3d7"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#ga47a65cbf57a70eb1db4e5aed167ec3d7">mbox_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ga47a65cbf57a70eb1db4e5aed167ec3d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:ga47a65cbf57a70eb1db4e5aed167ec3d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a28d46645d6c462bb1b43c2210b3672"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#ga0a28d46645d6c462bb1b43c2210b3672">mh_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ga0a28d46645d6c462bb1b43c2210b3672"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:ga0a28d46645d6c462bb1b43c2210b3672"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga64573e1bd7aca7ae22829562a82ae730"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#ga64573e1bd7aca7ae22829562a82ae730">nntp_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ga64573e1bd7aca7ae22829562a82ae730"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:ga64573e1bd7aca7ae22829562a82ae730"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf34af0a876b8063034f021754bf66886"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#gaf34af0a876b8063034f021754bf66886">nm_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:gaf34af0a876b8063034f021754bf66886"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:gaf34af0a876b8063034f021754bf66886"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf4f176edf88cdbf7c4ded57e9838f008"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#gaf4f176edf88cdbf7c4ded57e9838f008">pop_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:gaf4f176edf88cdbf7c4ded57e9838f008"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:gaf4f176edf88cdbf7c4ded57e9838f008"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> to sync </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">enum</td><td><a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432" title="Return values from mbox_check(), mbox_check_stats(), mbox_sync(), and mbox_close()">MxStatus</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section pre"><dt>Precondition</dt><dd>m is not NULL </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a id="gadeb7755ceb989e6dc91e9afa2ff9e84e" name="gadeb7755ceb989e6dc91e9afa2ff9e84e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadeb7755ceb989e6dc91e9afa2ff9e84e">&#9670;&#160;</a></span>comp_mbox_sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> comp_mbox_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -. </p>
<p>Changes in <a class="el" href="structNeoMutt.html" title="Container for Accounts, Notifications.">NeoMutt</a> only affect the tmp file. Calling <a class="el" href="group__mx__mbox__sync.html#gadeb7755ceb989e6dc91e9afa2ff9e84e" title="Save changes to the Mailbox - Implements MxOps::mbox_sync() -.">comp_mbox_sync()</a> will commit them to the compressed file. </p>

<p class="definition">Definition at line <a class="el" href="compmbox_2compress_8c_source.html#l00584">584</a> of file <a class="el" href="compmbox_2compress_8c_source.html">compress.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  585</span>{</div>
<div class="line"><span class="lineno">  586</span>  <span class="keywordflow">if</span> (!m-&gt;<a class="code hl_variable" href="structMailbox.html#adfd56243ea7dd8797f3d75f33f1d607a">compress_info</a>)</div>
<div class="line"><span class="lineno">  587</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structCompressInfo.html">CompressInfo</a> *ci = m-&gt;<a class="code hl_variable" href="structMailbox.html#adfd56243ea7dd8797f3d75f33f1d607a">compress_info</a>;</div>
<div class="line"><span class="lineno">  590</span> </div>
<div class="line"><span class="lineno">  591</span>  <span class="keywordflow">if</span> (!ci-&gt;<a class="code hl_variable" href="structCompressInfo.html#aef70fbe59eca22ca5326424873ffeaae">cmd_close</a>)</div>
<div class="line"><span class="lineno">  592</span>  {</div>
<div class="line"><span class="lineno">  593</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Can&#39;t sync a compressed file without a close-hook&quot;</span>));</div>
<div class="line"><span class="lineno">  594</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  595</span>  }</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span>  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structMxOps.html">MxOps</a> *ops = ci-&gt;<a class="code hl_variable" href="structCompressInfo.html#a9f6c41db8d4f70ebb317146dfa5e0472">child_ops</a>;</div>
<div class="line"><span class="lineno">  598</span>  <span class="keywordflow">if</span> (!ops)</div>
<div class="line"><span class="lineno">  599</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  600</span> </div>
<div class="line"><span class="lineno">  601</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="compmbox_2compress_8c.html#a8c82fa05ac9a30a1cd0e5c5b472ae066">lock_realpath</a>(m, <span class="keyword">true</span>))</div>
<div class="line"><span class="lineno">  602</span>  {</div>
<div class="line"><span class="lineno">  603</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Unable to lock mailbox&quot;</span>));</div>
<div class="line"><span class="lineno">  604</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  605</span>  }</div>
<div class="line"><span class="lineno">  606</span> </div>
<div class="line"><span class="lineno">  607</span>  <span class="keyword">enum</span> <a class="code hl_enumeration" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> check = <a class="code hl_function" href="group__mx__mbox__check.html#gabf3eceb782a3061fe668121697cc2e22">comp_mbox_check</a>(m);</div>
<div class="line"><span class="lineno">  608</span>  <span class="keywordflow">if</span> (check != <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>)</div>
<div class="line"><span class="lineno">  609</span>    <span class="keywordflow">goto</span> sync_cleanup;</div>
<div class="line"><span class="lineno">  610</span> </div>
<div class="line"><span class="lineno">  611</span>  check = ops-&gt;<a class="code hl_variable" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">mbox_sync</a>(m);</div>
<div class="line"><span class="lineno">  612</span>  <span class="keywordflow">if</span> (check != <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>)</div>
<div class="line"><span class="lineno">  613</span>    <span class="keywordflow">goto</span> sync_cleanup;</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="compmbox_2compress_8c.html#ac72bc28dc8d4e5d6e73aeb6607acfcc6">execute_command</a>(m, ci-&gt;<a class="code hl_variable" href="structCompressInfo.html#aef70fbe59eca22ca5326424873ffeaae">cmd_close</a>, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Compressing %s&quot;</span>)))</div>
<div class="line"><span class="lineno">  616</span>  {</div>
<div class="line"><span class="lineno">  617</span>    check = <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  618</span>    <span class="keywordflow">goto</span> sync_cleanup;</div>
<div class="line"><span class="lineno">  619</span>  }</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>  check = <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>;</div>
<div class="line"><span class="lineno">  622</span> </div>
<div class="line"><span class="lineno">  623</span>sync_cleanup:</div>
<div class="line"><span class="lineno">  624</span>  <a class="code hl_function" href="compmbox_2compress_8c.html#a877acb05482802a48bc56da5e24c8c54">store_size</a>(m);</div>
<div class="line"><span class="lineno">  625</span>  <a class="code hl_function" href="compmbox_2compress_8c.html#aa35e239a0ed2772ae5824c317276f83a">unlock_realpath</a>(m);</div>
<div class="line"><span class="lineno">  626</span>  <span class="keywordflow">return</span> check;</div>
<div class="line"><span class="lineno">  627</span>}</div>
<div class="ttc" id="acompmbox_2compress_8c_html_a877acb05482802a48bc56da5e24c8c54"><div class="ttname"><a href="compmbox_2compress_8c.html#a877acb05482802a48bc56da5e24c8c54">store_size</a></div><div class="ttdeci">static void store_size(const struct Mailbox *m)</div><div class="ttdoc">Save the size of the compressed file.</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2compress_8c_source.html#l00196">compress.c:196</a></div></div>
<div class="ttc" id="acompmbox_2compress_8c_html_a8c82fa05ac9a30a1cd0e5c5b472ae066"><div class="ttname"><a href="compmbox_2compress_8c.html#a8c82fa05ac9a30a1cd0e5c5b472ae066">lock_realpath</a></div><div class="ttdeci">static bool lock_realpath(struct Mailbox *m, bool excl)</div><div class="ttdoc">Try to lock the Mailbox.realpath.</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2compress_8c_source.html#l00106">compress.c:106</a></div></div>
<div class="ttc" id="acompmbox_2compress_8c_html_aa35e239a0ed2772ae5824c317276f83a"><div class="ttname"><a href="compmbox_2compress_8c.html#aa35e239a0ed2772ae5824c317276f83a">unlock_realpath</a></div><div class="ttdeci">static void unlock_realpath(struct Mailbox *m)</div><div class="ttdoc">Unlock the mailbox-&gt;realpath.</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2compress_8c_source.html#l00147">compress.c:147</a></div></div>
<div class="ttc" id="acompmbox_2compress_8c_html_ac72bc28dc8d4e5d6e73aeb6607acfcc6"><div class="ttname"><a href="compmbox_2compress_8c.html#ac72bc28dc8d4e5d6e73aeb6607acfcc6">execute_command</a></div><div class="ttdeci">static bool execute_command(struct Mailbox *m, const struct Expando *exp, const char *progress)</div><div class="ttdoc">Run a system command.</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2compress_8c_source.html#l00289">compress.c:289</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging2_8h_source.html#l00093">logging2.h:93</a></div></div>
<div class="ttc" id="agroup__mx__mbox__check_html_gabf3eceb782a3061fe668121697cc2e22"><div class="ttname"><a href="group__mx__mbox__check.html#gabf3eceb782a3061fe668121697cc2e22">comp_mbox_check</a></div><div class="ttdeci">static enum MxStatus comp_mbox_check(struct Mailbox *m)</div><div class="ttdoc">Check for new mail - Implements MxOps::mbox_check() -.</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2compress_8c_source.html#l00548">compress.c:548</a></div></div>
<div class="ttc" id="amutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a></div><div class="ttdeci">MxStatus</div><div class="ttdoc">Return values from mbox_check(), mbox_check_stats(), mbox_sync(), and mbox_close()</div><div class="ttdef"><b>Definition:</b> <a href="mxapi_8h_source.html#l00059">mxapi.h:60</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a></div><div class="ttdeci">@ MX_STATUS_ERROR</div><div class="ttdoc">An error occurred.</div><div class="ttdef"><b>Definition:</b> <a href="mxapi_8h_source.html#l00061">mxapi.h:61</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a></div><div class="ttdeci">@ MX_STATUS_OK</div><div class="ttdoc">No changes.</div><div class="ttdef"><b>Definition:</b> <a href="mxapi_8h_source.html#l00062">mxapi.h:62</a></div></div>
<div class="ttc" id="astructCompressInfo_html"><div class="ttname"><a href="structCompressInfo.html">CompressInfo</a></div><div class="ttdoc">Private data for compress.</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2lib_8h_source.html#l00059">lib.h:60</a></div></div>
<div class="ttc" id="astructCompressInfo_html_a9f6c41db8d4f70ebb317146dfa5e0472"><div class="ttname"><a href="structCompressInfo.html#a9f6c41db8d4f70ebb317146dfa5e0472">CompressInfo::child_ops</a></div><div class="ttdeci">const struct MxOps * child_ops</div><div class="ttdoc">callbacks of de-compressed file</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2lib_8h_source.html#l00065">lib.h:65</a></div></div>
<div class="ttc" id="astructCompressInfo_html_aef70fbe59eca22ca5326424873ffeaae"><div class="ttname"><a href="structCompressInfo.html#aef70fbe59eca22ca5326424873ffeaae">CompressInfo::cmd_close</a></div><div class="ttdeci">struct Expando * cmd_close</div><div class="ttdoc">close-hook command</div><div class="ttdef"><b>Definition:</b> <a href="compmbox_2lib_8h_source.html#l00062">lib.h:62</a></div></div>
<div class="ttc" id="astructMailbox_html_adfd56243ea7dd8797f3d75f33f1d607a"><div class="ttname"><a href="structMailbox.html#adfd56243ea7dd8797f3d75f33f1d607a">Mailbox::compress_info</a></div><div class="ttdeci">void * compress_info</div><div class="ttdoc">Compressed mbox module private data.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00121">mailbox.h:121</a></div></div>
<div class="ttc" id="astructMxOps_html"><div class="ttname"><a href="structMxOps.html">MxOps</a></div><div class="ttdef"><b>Definition:</b> <a href="mxapi_8h_source.html#l00087">mxapi.h:88</a></div></div>
<div class="ttc" id="astructMxOps_html_aebbfeec5651637ec053cc47b95c124af"><div class="ttname"><a href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync</a></div><div class="ttdeci">enum MxStatus(* mbox_sync)(struct Mailbox *m)</div><div class="ttdef"><b>Definition:</b> <a href="mxapi_8h_source.html#l00147">mxapi.h:184</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync_gadeb7755ceb989e6dc91e9afa2ff9e84e_cgraph.svg" width="515" height="218"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ga51ba9115523ffa080d8f71211a821c39" name="ga51ba9115523ffa080d8f71211a821c39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga51ba9115523ffa080d8f71211a821c39">&#9670;&#160;</a></span>maildir_mbox_sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> maildir_mbox_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">enum</td><td><a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432" title="Return values from mbox_check(), mbox_check_stats(), mbox_sync(), and mbox_close()">MxStatus</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The flag retvals come from a call to a backend sync function </dd></dl>

<p class="definition">Definition at line <a class="el" href="maildir_2mailbox_8c_source.html#l00842">842</a> of file <a class="el" href="maildir_2mailbox_8c_source.html">mailbox.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  843</span>{</div>
<div class="line"><span class="lineno">  844</span>  <span class="keyword">enum</span> <a class="code hl_enumeration" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> check = <a class="code hl_function" href="maildir_2mailbox_8c.html#a0a574fe0e1b5e2b5fb122b1cf4335824">maildir_check</a>(m);</div>
<div class="line"><span class="lineno">  845</span>  <span class="keywordflow">if</span> (check == <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>)</div>
<div class="line"><span class="lineno">  846</span>    <span class="keywordflow">return</span> check;</div>
<div class="line"><span class="lineno">  847</span> </div>
<div class="line"><span class="lineno">  848</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structHeaderCache.html">HeaderCache</a> *hc = <a class="code hl_function" href="maildir_2hcache_8c.html#a55f606d07015638dfc6e43bef6202270">maildir_hcache_open</a>(m);</div>
<div class="line"><span class="lineno">  849</span> </div>
<div class="line"><span class="lineno">  850</span>  <span class="keyword">struct </span>Progress *progress = NULL;</div>
<div class="line"><span class="lineno">  851</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno">  852</span>  {</div>
<div class="line"><span class="lineno">  853</span>    progress = <a class="code hl_function" href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a>(<a class="code hl_enumvalue" href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75ae89b45d8e4dad79ccfd4fc6df66c6bfe">MUTT_PROGRESS_WRITE</a>, m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>);</div>
<div class="line"><span class="lineno">  854</span>    <a class="code hl_function" href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a>(progress, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Writing %s...&quot;</span>), <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  855</span>  }</div>
<div class="line"><span class="lineno">  856</span> </div>
<div class="line"><span class="lineno">  857</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno">  858</span>  {</div>
<div class="line"><span class="lineno">  859</span>    <a class="code hl_function" href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a>(progress, i, -1);</div>
<div class="line"><span class="lineno">  860</span> </div>
<div class="line"><span class="lineno">  861</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i];</div>
<div class="line"><span class="lineno">  862</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="maildir_2message_8c.html#aaab54af8091d9fc9b1d034295e5d2331">maildir_sync_mailbox_message</a>(m, e, hc))</div>
<div class="line"><span class="lineno">  863</span>    {</div>
<div class="line"><span class="lineno">  864</span>      <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno">  865</span>      <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno">  866</span>    }</div>
<div class="line"><span class="lineno">  867</span>  }</div>
<div class="line"><span class="lineno">  868</span>  <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno">  869</span>  <a class="code hl_function" href="maildir_2hcache_8c.html#a61490c082944273676e7439df8ce1511">maildir_hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno">  870</span> </div>
<div class="line"><span class="lineno">  871</span>  <span class="comment">/* XXX race condition? */</span></div>
<div class="line"><span class="lineno">  872</span> </div>
<div class="line"><span class="lineno">  873</span>  <a class="code hl_function" href="maildir_2mailbox_8c.html#a5c65f6a672a0bb2b822e2d2fbcc662df">maildir_update_mtime</a>(m);</div>
<div class="line"><span class="lineno">  874</span> </div>
<div class="line"><span class="lineno">  875</span>  <span class="comment">/* adjust indices */</span></div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#ab5863d8f516c6db52e2fadb531bf8557">msg_deleted</a>)</div>
<div class="line"><span class="lineno">  878</span>  {</div>
<div class="line"><span class="lineno">  879</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> c_maildir_trash = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;maildir_trash&quot;</span>);</div>
<div class="line"><span class="lineno">  880</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, j = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno">  881</span>    {</div>
<div class="line"><span class="lineno">  882</span>      <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i];</div>
<div class="line"><span class="lineno">  883</span>      <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno">  884</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  885</span> </div>
<div class="line"><span class="lineno">  886</span>      <span class="keywordflow">if</span> (!e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a> || c_maildir_trash)</div>
<div class="line"><span class="lineno">  887</span>        e-&gt;<a class="code hl_variable" href="structEmail.html#ace0e20a11dbdc84ca9ea63497c05b603">index</a> = j++;</div>
<div class="line"><span class="lineno">  888</span>    }</div>
<div class="line"><span class="lineno">  889</span>  }</div>
<div class="line"><span class="lineno">  890</span> </div>
<div class="line"><span class="lineno">  891</span>  <span class="keywordflow">return</span> check;</div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>err:</div>
<div class="line"><span class="lineno">  894</span>  <a class="code hl_function" href="maildir_2hcache_8c.html#a61490c082944273676e7439df8ce1511">maildir_hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno">  895</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  896</span>}</div>
<div class="ttc" id="aconfig_2helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name.</div><div class="ttdef"><b>Definition:</b> <a href="config_2helpers_8c_source.html#l00047">helpers.c:47</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_a7e9739eb3e94344633f7051c2fb9453e"><div class="ttname"><a href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a></div><div class="ttdeci">static const char * mailbox_path(const struct Mailbox *m)</div><div class="ttdoc">Get the Mailbox's path string.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00223">mailbox.h:223</a></div></div>
<div class="ttc" id="amaildir_2hcache_8c_html_a55f606d07015638dfc6e43bef6202270"><div class="ttname"><a href="maildir_2hcache_8c.html#a55f606d07015638dfc6e43bef6202270">maildir_hcache_open</a></div><div class="ttdeci">struct HeaderCache * maildir_hcache_open(struct Mailbox *m)</div><div class="ttdoc">Open the Header Cache.</div><div class="ttdef"><b>Definition:</b> <a href="maildir_2hcache_8c_source.html#l00096">hcache.c:96</a></div></div>
<div class="ttc" id="amaildir_2hcache_8c_html_a61490c082944273676e7439df8ce1511"><div class="ttname"><a href="maildir_2hcache_8c.html#a61490c082944273676e7439df8ce1511">maildir_hcache_close</a></div><div class="ttdeci">void maildir_hcache_close(struct HeaderCache **ptr)</div><div class="ttdoc">Close the Header Cache.</div><div class="ttdef"><b>Definition:</b> <a href="maildir_2hcache_8c_source.html#l00069">hcache.c:69</a></div></div>
<div class="ttc" id="amaildir_2mailbox_8c_html_a0a574fe0e1b5e2b5fb122b1cf4335824"><div class="ttname"><a href="maildir_2mailbox_8c.html#a0a574fe0e1b5e2b5fb122b1cf4335824">maildir_check</a></div><div class="ttdeci">static enum MxStatus maildir_check(struct Mailbox *m)</div><div class="ttdoc">Check for new mail.</div><div class="ttdef"><b>Definition:</b> <a href="maildir_2mailbox_8c_source.html#l00543">mailbox.c:543</a></div></div>
<div class="ttc" id="amaildir_2mailbox_8c_html_a5c65f6a672a0bb2b822e2d2fbcc662df"><div class="ttname"><a href="maildir_2mailbox_8c.html#a5c65f6a672a0bb2b822e2d2fbcc662df">maildir_update_mtime</a></div><div class="ttdeci">void maildir_update_mtime(struct Mailbox *m)</div><div class="ttdoc">Update our record of the Maildir modification time.</div><div class="ttdef"><b>Definition:</b> <a href="maildir_2mailbox_8c_source.html#l00720">mailbox.c:720</a></div></div>
<div class="ttc" id="amaildir_2message_8c_html_aaab54af8091d9fc9b1d034295e5d2331"><div class="ttname"><a href="maildir_2message_8c.html#aaab54af8091d9fc9b1d034295e5d2331">maildir_sync_mailbox_message</a></div><div class="ttdeci">bool maildir_sync_mailbox_message(struct Mailbox *m, struct Email *e, struct HeaderCache *hc)</div><div class="ttdoc">Save changes to the mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="maildir_2message_8c_source.html#l00311">message.c:311</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_a0a558d538b8742adf8b1251f2848ba75ae89b45d8e4dad79ccfd4fc6df66c6bfe"><div class="ttname"><a href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75ae89b45d8e4dad79ccfd4fc6df66c6bfe">MUTT_PROGRESS_WRITE</a></div><div class="ttdeci">@ MUTT_PROGRESS_WRITE</div><div class="ttdoc">Progress tracks elements, according to $write_inc</div><div class="ttdef"><b>Definition:</b> <a href="progress_2lib_8h_source.html#l00084">lib.h:84</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_a551a8d9e844532e2851d6bee121c09b3"><div class="ttname"><a href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a></div><div class="ttdeci">struct Progress * progress_new(enum ProgressType type, size_t size)</div><div class="ttdoc">Create a new Progress Bar.</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00139">progress.c:139</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_ab4c7a63427cdcaae2b1147ff6f010af4"><div class="ttname"><a href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a></div><div class="ttdeci">void progress_free(struct Progress **ptr)</div><div class="ttdoc">Free a Progress Bar.</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00110">progress.c:110</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_abd7142bf1b3c664cf1c3edca7c9b41d8"><div class="ttname"><a href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a></div><div class="ttdeci">void progress_set_message(struct Progress *progress, const char *fmt,...) __attribute__((__format__(__printf__</div></div>
<div class="ttc" id="aprogress_2lib_8h_html_ae0ca330f9059a039a4ece5cb1b00155b"><div class="ttname"><a href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a></div><div class="ttdeci">bool progress_update(struct Progress *progress, size_t pos, int percent)</div><div class="ttdoc">Update the state of the progress bar.</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00080">progress.c:80</a></div></div>
<div class="ttc" id="astructEmail_html"><div class="ttname"><a href="structEmail.html">Email</a></div><div class="ttdoc">The envelope/body of an email.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00038">email.h:39</a></div></div>
<div class="ttc" id="astructEmail_html_ac5db33e3d6d9723d8e496078d5769567"><div class="ttname"><a href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">Email::deleted</a></div><div class="ttdeci">bool deleted</div><div class="ttdoc">Email is deleted.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00078">email.h:78</a></div></div>
<div class="ttc" id="astructEmail_html_ace0e20a11dbdc84ca9ea63497c05b603"><div class="ttname"><a href="structEmail.html#ace0e20a11dbdc84ca9ea63497c05b603">Email::index</a></div><div class="ttdeci">int index</div><div class="ttdoc">The absolute (unsorted) message number.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00110">email.h:110</a></div></div>
<div class="ttc" id="astructHeaderCache_html"><div class="ttname"><a href="structHeaderCache.html">HeaderCache</a></div><div class="ttdoc">Header Cache.</div><div class="ttdef"><b>Definition:</b> <a href="hcache_2lib_8h_source.html#l00085">lib.h:86</a></div></div>
<div class="ttc" id="astructMailbox_html_a3d7ee4badbaec0d67db9e29d5ba716ee"><div class="ttname"><a href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">Mailbox::msg_count</a></div><div class="ttdeci">int msg_count</div><div class="ttdoc">Total number of messages.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00088">mailbox.h:88</a></div></div>
<div class="ttc" id="astructMailbox_html_a73ca79846dce43a175892c5d88e932ca"><div class="ttname"><a href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">Mailbox::emails</a></div><div class="ttdeci">struct Email ** emails</div><div class="ttdoc">Array of Emails.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00096">mailbox.h:96</a></div></div>
<div class="ttc" id="astructMailbox_html_ab5863d8f516c6db52e2fadb531bf8557"><div class="ttname"><a href="structMailbox.html#ab5863d8f516c6db52e2fadb531bf8557">Mailbox::msg_deleted</a></div><div class="ttdeci">int msg_deleted</div><div class="ttdoc">Number of deleted messages.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00093">mailbox.h:93</a></div></div>
<div class="ttc" id="astructMailbox_html_af1ff47b8f14a4503c9b8473582b13d5a"><div class="ttname"><a href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">Mailbox::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdoc">Display status messages?</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00117">mailbox.h:117</a></div></div>
<div class="ttc" id="astructNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications.</div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00042">neomutt.h:43</a></div></div>
<div class="ttc" id="astructNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items.</div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00047">neomutt.h:47</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync_ga51ba9115523ffa080d8f71211a821c39_cgraph.svg" width="523" height="532"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ga47a65cbf57a70eb1db4e5aed167ec3d7" name="ga47a65cbf57a70eb1db4e5aed167ec3d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga47a65cbf57a70eb1db4e5aed167ec3d7">&#9670;&#160;</a></span>mbox_mbox_sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> mbox_mbox_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -. </p>

<p class="definition">Definition at line <a class="el" href="mbox_8c_source.html#l01063">1063</a> of file <a class="el" href="mbox_8c_source.html">mbox.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1064</span>{</div>
<div class="line"><span class="lineno"> 1065</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMboxAccountData.html">MboxAccountData</a> *<a class="code hl_variable" href="structAccount.html#ad10abe32dcee204d654a3cd350d8cd8e">adata</a> = <a class="code hl_function" href="mbox_8c.html#a2f989931e9117a9c6598b6c592f69be2">mbox_adata_get</a>(m);</div>
<div class="line"><span class="lineno"> 1066</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structAccount.html#ad10abe32dcee204d654a3cd350d8cd8e">adata</a>)</div>
<div class="line"><span class="lineno"> 1067</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno"> 1068</span> </div>
<div class="line"><span class="lineno"> 1069</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *tempfile = NULL;</div>
<div class="line"><span class="lineno"> 1070</span>  <span class="keywordtype">char</span> buf[32] = { 0 };</div>
<div class="line"><span class="lineno"> 1071</span>  <span class="keywordtype">int</span> j;</div>
<div class="line"><span class="lineno"> 1072</span>  <span class="keywordtype">bool</span> unlink_tempfile = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1073</span>  <span class="keywordtype">bool</span> need_sort = <span class="keyword">false</span>; <span class="comment">/* flag to resort mailbox if new mail arrives */</span></div>
<div class="line"><span class="lineno"> 1074</span>  <span class="keywordtype">int</span> first = -1;         <span class="comment">/* first message to be written */</span></div>
<div class="line"><span class="lineno"> 1075</span>  LOFF_T offset;          <span class="comment">/* location in mailbox to write changed messages */</span></div>
<div class="line"><span class="lineno"> 1076</span>  <span class="keyword">struct </span>stat st = { 0 };</div>
<div class="line"><span class="lineno"> 1077</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMUpdate.html">MUpdate</a> *new_offset = NULL;</div>
<div class="line"><span class="lineno"> 1078</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMUpdate.html">MUpdate</a> *old_offset = NULL;</div>
<div class="line"><span class="lineno"> 1079</span>  FILE *fp = NULL;</div>
<div class="line"><span class="lineno"> 1080</span>  <span class="keyword">struct </span>Progress *progress = NULL;</div>
<div class="line"><span class="lineno"> 1081</span>  <span class="keyword">enum</span> <a class="code hl_enumeration" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> rc = <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno"> 1082</span> </div>
<div class="line"><span class="lineno"> 1083</span>  <span class="comment">/* sort message by their position in the mailbox on disk */</span></div>
<div class="line"><span class="lineno"> 1084</span>  <span class="keyword">const</span> <span class="keyword">enum</span> <a class="code hl_enumeration" href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4">EmailSortType</a> c_sort = <a class="code hl_function" href="config_2helpers_8c.html#af7f3de51c3c2f5b8f527f40c8397a3fc">cs_subset_sort</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;sort&quot;</span>);</div>
<div class="line"><span class="lineno"> 1085</span>  <span class="keywordflow">if</span> (c_sort != <a class="code hl_enumvalue" href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4aa5fa714c8f7a789cb67f5d22cd014361">EMAIL_SORT_UNSORTED</a>)</div>
<div class="line"><span class="lineno"> 1086</span>  {</div>
<div class="line"><span class="lineno"> 1087</span>    <a class="code hl_function" href="email_2sort_8c.html#adce0d7b85a68258fc8579efc04e3790b">mutt_sort_unsorted</a>(m);</div>
<div class="line"><span class="lineno"> 1088</span>    need_sort = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1089</span>  }</div>
<div class="line"><span class="lineno"> 1090</span> </div>
<div class="line"><span class="lineno"> 1091</span>  <span class="comment">/* need to open the file for writing in such a way that it does not truncate</span></div>
<div class="line"><span class="lineno"> 1092</span><span class="comment">   * the file, so use read-write mode.  */</span></div>
<div class="line"><span class="lineno"> 1093</span>  adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a> = freopen(<a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), <span class="stringliteral">&quot;r+&quot;</span>, adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>);</div>
<div class="line"><span class="lineno"> 1094</span>  <span class="keywordflow">if</span> (!adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>)</div>
<div class="line"><span class="lineno"> 1095</span>  {</div>
<div class="line"><span class="lineno"> 1096</span>    <a class="code hl_function" href="mx_8c.html#a4e4de522e1ca1db28736065f1499c55d">mx_fastclose_mailbox</a>(m, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1097</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Fatal error!  Could not reopen mailbox!&quot;</span>));</div>
<div class="line"><span class="lineno"> 1098</span>    <span class="keywordflow">goto</span> fatal;</div>
<div class="line"><span class="lineno"> 1099</span>  }</div>
<div class="line"><span class="lineno"> 1100</span> </div>
<div class="line"><span class="lineno"> 1101</span>  <a class="code hl_function" href="signal_8c.html#aa6c49e5535cdffeffd2cd4eee28bc96b">mutt_sig_block</a>();</div>
<div class="line"><span class="lineno"> 1102</span> </div>
<div class="line"><span class="lineno"> 1103</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="mbox_8c.html#a1c304c29562f920b2ba11fabcc14c268">mbox_lock_mailbox</a>(m, <span class="keyword">true</span>, <span class="keyword">true</span>) == -1)</div>
<div class="line"><span class="lineno"> 1104</span>  {</div>
<div class="line"><span class="lineno"> 1105</span>    <a class="code hl_function" href="signal_8c.html#aa9356c41baa1b35d3a7719f90570e6b7">mutt_sig_unblock</a>();</div>
<div class="line"><span class="lineno"> 1106</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Unable to lock mailbox&quot;</span>));</div>
<div class="line"><span class="lineno"> 1107</span>    <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1108</span>  }</div>
<div class="line"><span class="lineno"> 1109</span> </div>
<div class="line"><span class="lineno"> 1110</span>  <span class="comment">/* Check to make sure that the file hasn&#39;t changed on disk */</span></div>
<div class="line"><span class="lineno"> 1111</span>  <span class="keyword">enum</span> <a class="code hl_enumeration" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> check = <a class="code hl_function" href="group__mx__mbox__check.html#gafb376aac365fa068eeb370915b2d309d">mbox_mbox_check</a>(m);</div>
<div class="line"><span class="lineno"> 1112</span>  <span class="keywordflow">if</span> ((check == <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432af3d8ebc52b40a1f9f22b7b4366d0315b">MX_STATUS_NEW_MAIL</a>) || (check == <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432ad9cf54713c660db891b05384830e57f4">MX_STATUS_REOPENED</a>))</div>
<div class="line"><span class="lineno"> 1113</span>  {</div>
<div class="line"><span class="lineno"> 1114</span>    <span class="comment">/* new mail arrived, or mailbox reopened */</span></div>
<div class="line"><span class="lineno"> 1115</span>    rc = check;</div>
<div class="line"><span class="lineno"> 1116</span>    <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1117</span>  }</div>
<div class="line"><span class="lineno"> 1118</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (check &lt; 0)</div>
<div class="line"><span class="lineno"> 1119</span>  {</div>
<div class="line"><span class="lineno"> 1120</span>    <span class="keywordflow">goto</span> fatal;</div>
<div class="line"><span class="lineno"> 1121</span>  }</div>
<div class="line"><span class="lineno"> 1122</span> </div>
<div class="line"><span class="lineno"> 1123</span>  <span class="comment">/* Create a temporary file to write the new version of the mailbox in. */</span></div>
<div class="line"><span class="lineno"> 1124</span>  tempfile = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno"> 1125</span>  <a class="code hl_define" href="tmp_8h.html#a271a7828888985955df49205d7846a45">buf_mktemp</a>(tempfile);</div>
<div class="line"><span class="lineno"> 1126</span>  <span class="keywordtype">int</span> fd = open(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile), O_WRONLY | O_EXCL | O_CREAT, 0600);</div>
<div class="line"><span class="lineno"> 1127</span>  <span class="keywordflow">if</span> ((fd == -1) || !(fp = fdopen(fd, <span class="stringliteral">&quot;w&quot;</span>)))</div>
<div class="line"><span class="lineno"> 1128</span>  {</div>
<div class="line"><span class="lineno"> 1129</span>    <span class="keywordflow">if</span> (fd != -1)</div>
<div class="line"><span class="lineno"> 1130</span>    {</div>
<div class="line"><span class="lineno"> 1131</span>      close(fd);</div>
<div class="line"><span class="lineno"> 1132</span>      unlink_tempfile = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1133</span>    }</div>
<div class="line"><span class="lineno"> 1134</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Could not create temporary file&quot;</span>));</div>
<div class="line"><span class="lineno"> 1135</span>    <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1136</span>  }</div>
<div class="line"><span class="lineno"> 1137</span>  unlink_tempfile = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1138</span> </div>
<div class="line"><span class="lineno"> 1139</span>  <span class="comment">/* find the first deleted/changed message.  we save a lot of time by only</span></div>
<div class="line"><span class="lineno"> 1140</span><span class="comment">   * rewriting the mailbox from the point where it has actually changed.  */</span></div>
<div class="line"><span class="lineno"> 1141</span>  <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><span class="lineno"> 1142</span>  <span class="keywordflow">for</span> (; (i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>) &amp;&amp; !m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a> &amp;&amp;</div>
<div class="line"><span class="lineno"> 1143</span>         !m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a> &amp;&amp; !m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a8d4df03be101c132581352d182ae99ae">attach_del</a>;</div>
<div class="line"><span class="lineno"> 1144</span>       i++)</div>
<div class="line"><span class="lineno"> 1145</span>  {</div>
<div class="line"><span class="lineno"> 1146</span>  }</div>
<div class="line"><span class="lineno"> 1147</span>  <span class="keywordflow">if</span> (i == m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>)</div>
<div class="line"><span class="lineno"> 1148</span>  {</div>
<div class="line"><span class="lineno"> 1149</span>    <span class="comment">/* this means m-&gt;changed or m-&gt;msg_deleted was set, but no</span></div>
<div class="line"><span class="lineno"> 1150</span><span class="comment">     * messages were found to be changed or deleted.  This should</span></div>
<div class="line"><span class="lineno"> 1151</span><span class="comment">     * never happen, is we presume it is a bug in neomutt.  */</span></div>
<div class="line"><span class="lineno"> 1152</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;sync: mbox modified, but no modified messages (report this bug)&quot;</span>));</div>
<div class="line"><span class="lineno"> 1153</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;no modified messages\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1154</span>    <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1155</span>  }</div>
<div class="line"><span class="lineno"> 1156</span> </div>
<div class="line"><span class="lineno"> 1157</span>  <span class="comment">/* save the index of the first changed/deleted message */</span></div>
<div class="line"><span class="lineno"> 1158</span>  first = i;</div>
<div class="line"><span class="lineno"> 1159</span>  <span class="comment">/* where to start overwriting */</span></div>
<div class="line"><span class="lineno"> 1160</span>  offset = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a8d35ff6f232f83e89e2d46af416708cc">offset</a>;</div>
<div class="line"><span class="lineno"> 1161</span> </div>
<div class="line"><span class="lineno"> 1162</span>  <span class="comment">/* the offset stored in the header does not include the MMDF_SEP, so make</span></div>
<div class="line"><span class="lineno"> 1163</span><span class="comment">   * sure we seek to the correct location */</span></div>
<div class="line"><span class="lineno"> 1164</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> == <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da09cef4c4e3dc42c9137860413dcdb374">MUTT_MMDF</a>)</div>
<div class="line"><span class="lineno"> 1165</span>    offset -= (<span class="keyword">sizeof</span>(<a class="code hl_define" href="mbox_2lib_8h.html#a02e41ebb72c6ab451fed824a9c41283c">MMDF_SEP</a>) - 1);</div>
<div class="line"><span class="lineno"> 1166</span> </div>
<div class="line"><span class="lineno"> 1167</span>  <span class="comment">/* allocate space for the new offsets */</span></div>
<div class="line"><span class="lineno"> 1168</span>  new_offset = <a class="code hl_define" href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a>(m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a> - first, <span class="keyword">struct</span> <a class="code hl_struct" href="structMUpdate.html">MUpdate</a>);</div>
<div class="line"><span class="lineno"> 1169</span>  old_offset = <a class="code hl_define" href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a>(m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a> - first, <span class="keyword">struct</span> <a class="code hl_struct" href="structMUpdate.html">MUpdate</a>);</div>
<div class="line"><span class="lineno"> 1170</span> </div>
<div class="line"><span class="lineno"> 1171</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno"> 1172</span>  {</div>
<div class="line"><span class="lineno"> 1173</span>    progress = <a class="code hl_function" href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a>(<a class="code hl_enumvalue" href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75ae89b45d8e4dad79ccfd4fc6df66c6bfe">MUTT_PROGRESS_WRITE</a>, m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>);</div>
<div class="line"><span class="lineno"> 1174</span>    <a class="code hl_function" href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a>(progress, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Writing %s...&quot;</span>), <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno"> 1175</span>  }</div>
<div class="line"><span class="lineno"> 1176</span> </div>
<div class="line"><span class="lineno"> 1177</span>  <span class="keywordflow">for</span> (i = first, j = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno"> 1178</span>  {</div>
<div class="line"><span class="lineno"> 1179</span>    <a class="code hl_function" href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a>(progress, i, i / (m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a> / 100 + 1));</div>
<div class="line"><span class="lineno"> 1180</span>    <span class="comment">/* back up some information which is needed to restore offsets when</span></div>
<div class="line"><span class="lineno"> 1181</span><span class="comment">     * something fails.  */</span></div>
<div class="line"><span class="lineno"> 1182</span> </div>
<div class="line"><span class="lineno"> 1183</span>    old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#ac4ff1f4e3d6bfa6d2a0ea29d95934965">valid</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1184</span>    old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a79326bce090fb8e01d21ddd96f6672bb">hdr</a> = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a8d35ff6f232f83e89e2d46af416708cc">offset</a>;</div>
<div class="line"><span class="lineno"> 1185</span>    old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#ab4ab3bf8092f0bde3e1ecc84bab30e21">body</a> = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a>;</div>
<div class="line"><span class="lineno"> 1186</span>    old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a62dc0eee290a380be901369f3eafcf53">lines</a> = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a562a3aee45efc37c07dedcc8e1fef93f">lines</a>;</div>
<div class="line"><span class="lineno"> 1187</span>    old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#ab068c45a3e06d118bea30898066a3737">length</a> = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a>;</div>
<div class="line"><span class="lineno"> 1188</span> </div>
<div class="line"><span class="lineno"> 1189</span>    <span class="keywordflow">if</span> (!m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>)</div>
<div class="line"><span class="lineno"> 1190</span>    {</div>
<div class="line"><span class="lineno"> 1191</span>      j++;</div>
<div class="line"><span class="lineno"> 1192</span> </div>
<div class="line"><span class="lineno"> 1193</span>      <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> == <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da09cef4c4e3dc42c9137860413dcdb374">MUTT_MMDF</a>)</div>
<div class="line"><span class="lineno"> 1194</span>      {</div>
<div class="line"><span class="lineno"> 1195</span>        <span class="keywordflow">if</span> (fputs(<a class="code hl_define" href="mbox_2lib_8h.html#a02e41ebb72c6ab451fed824a9c41283c">MMDF_SEP</a>, fp) == EOF)</div>
<div class="line"><span class="lineno"> 1196</span>        {</div>
<div class="line"><span class="lineno"> 1197</span>          <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1198</span>          <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1199</span>        }</div>
<div class="line"><span class="lineno"> 1200</span>      }</div>
<div class="line"><span class="lineno"> 1201</span> </div>
<div class="line"><span class="lineno"> 1202</span>      <span class="comment">/* save the new offset for this message.  we add &#39;offset&#39; because the</span></div>
<div class="line"><span class="lineno"> 1203</span><span class="comment">       * temporary file only contains saved message which are located after</span></div>
<div class="line"><span class="lineno"> 1204</span><span class="comment">       * &#39;offset&#39; in the real mailbox */</span></div>
<div class="line"><span class="lineno"> 1205</span>      new_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a79326bce090fb8e01d21ddd96f6672bb">hdr</a> = ftello(fp) + offset;</div>
<div class="line"><span class="lineno"> 1206</span> </div>
<div class="line"><span class="lineno"> 1207</span>      <span class="keyword">struct </span><a class="code hl_struct" href="structMessage.html">Message</a> *msg = <a class="code hl_function" href="mx_8c.html#a9b2902ecb2bebbd553a8ec733ca59886">mx_msg_open</a>(m, m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]);</div>
<div class="line"><span class="lineno"> 1208</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> rc2 = <a class="code hl_function" href="copy_8c.html#a72172841415fb14e143da3c102be0364">mutt_copy_message</a>(<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>, m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i], msg, <a class="code hl_define" href="copy_8h.html#a2a61b3ef55bc40f9364eea3f09bb4da8">MUTT_CM_UPDATE</a>,</div>
<div class="line"><span class="lineno"> 1209</span>                                        <a class="code hl_define" href="copy_8h.html#a3ff472dcfcc60933d0deaba111527d6c">CH_FROM</a> | <a class="code hl_define" href="copy_8h.html#a397b6166af3a14708bddb8ccd0241e11">CH_UPDATE</a> | <a class="code hl_define" href="copy_8h.html#a94e818174cb0508df54058debb1c631a">CH_UPDATE_LEN</a>, 0);</div>
<div class="line"><span class="lineno"> 1210</span>      <a class="code hl_function" href="mx_8c.html#a2610a2afe8887bb874131a4ba092aa6a">mx_msg_close</a>(m, &amp;msg);</div>
<div class="line"><span class="lineno"> 1211</span>      <span class="keywordflow">if</span> (rc2 != 0)</div>
<div class="line"><span class="lineno"> 1212</span>      {</div>
<div class="line"><span class="lineno"> 1213</span>        <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1214</span>        <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1215</span>      }</div>
<div class="line"><span class="lineno"> 1216</span> </div>
<div class="line"><span class="lineno"> 1217</span>      <span class="comment">/* Since messages could have been deleted, the offsets stored in memory</span></div>
<div class="line"><span class="lineno"> 1218</span><span class="comment">       * will be wrong, so update what we can, which is the offset of this</span></div>
<div class="line"><span class="lineno"> 1219</span><span class="comment">       * message, and the offset of the body.  If this is a multipart message,</span></div>
<div class="line"><span class="lineno"> 1220</span><span class="comment">       * we just flush the in memory cache so that the message will be reparsed</span></div>
<div class="line"><span class="lineno"> 1221</span><span class="comment">       * if the user accesses it later.  */</span></div>
<div class="line"><span class="lineno"> 1222</span>      new_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#ab4ab3bf8092f0bde3e1ecc84bab30e21">body</a> = ftello(<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>) - m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a> + offset;</div>
<div class="line"><span class="lineno"> 1223</span>      <a class="code hl_function" href="email_2body_8c.html#a129af1c316fcbc26b55fb48957bab2cb">mutt_body_free</a>(&amp;m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">parts</a>);</div>
<div class="line"><span class="lineno"> 1224</span> </div>
<div class="line"><span class="lineno"> 1225</span>      <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> == <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da09cef4c4e3dc42c9137860413dcdb374">MUTT_MMDF</a>)</div>
<div class="line"><span class="lineno"> 1226</span>      {</div>
<div class="line"><span class="lineno"> 1227</span>        <span class="keywordflow">if</span> (fputs(<a class="code hl_define" href="mbox_2lib_8h.html#a02e41ebb72c6ab451fed824a9c41283c">MMDF_SEP</a>, <a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>) == EOF)</div>
<div class="line"><span class="lineno"> 1228</span>        {</div>
<div class="line"><span class="lineno"> 1229</span>          <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1230</span>          <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1231</span>        }</div>
<div class="line"><span class="lineno"> 1232</span>      }</div>
<div class="line"><span class="lineno"> 1233</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1234</span>      {</div>
<div class="line"><span class="lineno"> 1235</span>        <span class="keywordflow">if</span> (fputs(<span class="stringliteral">&quot;\n&quot;</span>, <a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>) == EOF)</div>
<div class="line"><span class="lineno"> 1236</span>        {</div>
<div class="line"><span class="lineno"> 1237</span>          <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1238</span>          <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1239</span>        }</div>
<div class="line"><span class="lineno"> 1240</span>      }</div>
<div class="line"><span class="lineno"> 1241</span>    }</div>
<div class="line"><span class="lineno"> 1242</span>  }</div>
<div class="line"><span class="lineno"> 1243</span> </div>
<div class="line"><span class="lineno"> 1244</span>  <span class="keywordflow">if</span> (<a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>) != 0)</div>
<div class="line"><span class="lineno"> 1245</span>  {</div>
<div class="line"><span class="lineno"> 1246</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;mutt_file_fclose (&amp;) returned non-zero\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1247</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1248</span>    <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1249</span>  }</div>
<div class="line"><span class="lineno"> 1250</span> </div>
<div class="line"><span class="lineno"> 1251</span>  <span class="comment">/* Save the state of this folder. */</span></div>
<div class="line"><span class="lineno"> 1252</span>  <span class="keywordflow">if</span> (stat(<a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), &amp;st) == -1)</div>
<div class="line"><span class="lineno"> 1253</span>  {</div>
<div class="line"><span class="lineno"> 1254</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno"> 1255</span>    <span class="keywordflow">goto</span> bail;</div>
<div class="line"><span class="lineno"> 1256</span>  }</div>
<div class="line"><span class="lineno"> 1257</span> </div>
<div class="line"><span class="lineno"> 1258</span>  unlink_tempfile = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1259</span> </div>
<div class="line"><span class="lineno"> 1260</span>  <a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a> = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile), <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno"> 1261</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>)</div>
<div class="line"><span class="lineno"> 1262</span>  {</div>
<div class="line"><span class="lineno"> 1263</span>    <a class="code hl_function" href="signal_8c.html#aa9356c41baa1b35d3a7719f90570e6b7">mutt_sig_unblock</a>();</div>
<div class="line"><span class="lineno"> 1264</span>    <a class="code hl_function" href="mx_8c.html#a4e4de522e1ca1db28736065f1499c55d">mx_fastclose_mailbox</a>(m, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1265</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;unable to reopen temp copy of mailbox!\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1266</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1267</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;new_offset);</div>
<div class="line"><span class="lineno"> 1268</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;old_offset);</div>
<div class="line"><span class="lineno"> 1269</span>    <span class="keywordflow">goto</span> fatal;</div>
<div class="line"><span class="lineno"> 1270</span>  }</div>
<div class="line"><span class="lineno"> 1271</span> </div>
<div class="line"><span class="lineno"> 1272</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="file_8c.html#a6b60cb2044041374689e6e6641c5cc05">mutt_file_seek</a>(adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>, offset, SEEK_SET) || <span class="comment">/* seek the append location */</span></div>
<div class="line"><span class="lineno"> 1273</span>      <span class="comment">/* do a sanity check to make sure the mailbox looks ok */</span></div>
<div class="line"><span class="lineno"> 1274</span>      !fgets(buf, <span class="keyword">sizeof</span>(buf), adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>) ||</div>
<div class="line"><span class="lineno"> 1275</span>      ((m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> == <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da817ef3cf5f529965875400b412678525">MUTT_MBOX</a>) &amp;&amp; !<a class="code hl_function" href="mutt_2string_8c.html#a9bf968304f4f9b49e24215cb2e28d22d">mutt_str_startswith</a>(buf, <span class="stringliteral">&quot;From &quot;</span>)) ||</div>
<div class="line"><span class="lineno"> 1276</span>      ((m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> == <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da09cef4c4e3dc42c9137860413dcdb374">MUTT_MMDF</a>) &amp;&amp; !<a class="code hl_function" href="mutt_2string_8c.html#a6b6a50296dd2a31863a43379ef4a343d">mutt_str_equal</a>(<a class="code hl_define" href="mbox_2lib_8h.html#a02e41ebb72c6ab451fed824a9c41283c">MMDF_SEP</a>, buf)))</div>
<div class="line"><span class="lineno"> 1277</span>  {</div>
<div class="line"><span class="lineno"> 1278</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;message not in expected position\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1279</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;    LINE: %s\n&quot;</span>, buf);</div>
<div class="line"><span class="lineno"> 1280</span>    i = -1;</div>
<div class="line"><span class="lineno"> 1281</span>  }</div>
<div class="line"><span class="lineno"> 1282</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1283</span>  {</div>
<div class="line"><span class="lineno"> 1284</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="file_8c.html#a6b60cb2044041374689e6e6641c5cc05">mutt_file_seek</a>(adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>, offset, SEEK_SET)) <span class="comment">/* return to proper offset */</span></div>
<div class="line"><span class="lineno"> 1285</span>    {</div>
<div class="line"><span class="lineno"> 1286</span>      i = -1;</div>
<div class="line"><span class="lineno"> 1287</span>    }</div>
<div class="line"><span class="lineno"> 1288</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1289</span>    {</div>
<div class="line"><span class="lineno"> 1290</span>      <span class="comment">/* copy the temp mailbox back into place starting at the first</span></div>
<div class="line"><span class="lineno"> 1291</span><span class="comment">       * change/deleted message */</span></div>
<div class="line"><span class="lineno"> 1292</span>      <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno"> 1293</span>        <a class="code hl_define" href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Committing changes...&quot;</span>));</div>
<div class="line"><span class="lineno"> 1294</span>      i = <a class="code hl_function" href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a>(<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>, adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>);</div>
<div class="line"><span class="lineno"> 1295</span> </div>
<div class="line"><span class="lineno"> 1296</span>      <span class="keywordflow">if</span> (ferror(adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>))</div>
<div class="line"><span class="lineno"> 1297</span>        i = -1;</div>
<div class="line"><span class="lineno"> 1298</span>    }</div>
<div class="line"><span class="lineno"> 1299</span>    <span class="keywordflow">if</span> (i &gt;= 0)</div>
<div class="line"><span class="lineno"> 1300</span>    {</div>
<div class="line"><span class="lineno"> 1301</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#ace276d581d6d299ecf227be214841148">size</a> = ftello(adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>); <span class="comment">/* update the mailbox-&gt;size of the mailbox */</span></div>
<div class="line"><span class="lineno"> 1302</span>      <span class="keywordflow">if</span> ((m-&gt;<a class="code hl_variable" href="structMailbox.html#ace276d581d6d299ecf227be214841148">size</a> &lt; 0) || (ftruncate(fileno(adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>), m-&gt;<a class="code hl_variable" href="structMailbox.html#ace276d581d6d299ecf227be214841148">size</a>) != 0))</div>
<div class="line"><span class="lineno"> 1303</span>      {</div>
<div class="line"><span class="lineno"> 1304</span>        i = -1;</div>
<div class="line"><span class="lineno"> 1305</span>        <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;ftruncate() failed\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1306</span>      }</div>
<div class="line"><span class="lineno"> 1307</span>    }</div>
<div class="line"><span class="lineno"> 1308</span>  }</div>
<div class="line"><span class="lineno"> 1309</span> </div>
<div class="line"><span class="lineno"> 1310</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>);</div>
<div class="line"><span class="lineno"> 1311</span>  <a class="code hl_function" href="mbox_8c.html#aad6c03c38f626757199e4fd0835253ae">mbox_unlock_mailbox</a>(m);</div>
<div class="line"><span class="lineno"> 1312</span> </div>
<div class="line"><span class="lineno"> 1313</span>  <span class="keywordflow">if</span> ((<a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>) != 0) || (i == -1))</div>
<div class="line"><span class="lineno"> 1314</span>  {</div>
<div class="line"><span class="lineno"> 1315</span>    <span class="comment">/* error occurred while writing the mailbox back, so keep the temp copy around */</span></div>
<div class="line"><span class="lineno"> 1316</span> </div>
<div class="line"><span class="lineno"> 1317</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *savefile = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno"> 1318</span> </div>
<div class="line"><span class="lineno"> 1319</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_tmp_dir = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;tmp_dir&quot;</span>);</div>
<div class="line"><span class="lineno"> 1320</span>    <a class="code hl_function" href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a>(savefile, <span class="stringliteral">&quot;%s/neomutt.%s-%s-%u&quot;</span>, <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(c_tmp_dir),</div>
<div class="line"><span class="lineno"> 1321</span>               <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#a5c2d30a2f734f94412bd5b3a7367b981">username</a>), <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(<a class="code hl_variable" href="globals_8c.html#a12bc91409c8ec9f5b1600f34d1f557b6">ShortHostname</a>), (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) getpid());</div>
<div class="line"><span class="lineno"> 1322</span>    rename(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(savefile));</div>
<div class="line"><span class="lineno"> 1323</span>    <a class="code hl_function" href="signal_8c.html#aa9356c41baa1b35d3a7719f90570e6b7">mutt_sig_unblock</a>();</div>
<div class="line"><span class="lineno"> 1324</span>    <a class="code hl_function" href="mx_8c.html#a4e4de522e1ca1db28736065f1499c55d">mx_fastclose_mailbox</a>(m, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1325</span>    <a class="code hl_function" href="muttlib_8c.html#a777680c324667521d8c486051c22fe10">buf_pretty_mailbox</a>(savefile);</div>
<div class="line"><span class="lineno"> 1326</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Write failed!  Saved partial mailbox to %s&quot;</span>), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(savefile));</div>
<div class="line"><span class="lineno"> 1327</span>    <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;savefile);</div>
<div class="line"><span class="lineno"> 1328</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;new_offset);</div>
<div class="line"><span class="lineno"> 1329</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;old_offset);</div>
<div class="line"><span class="lineno"> 1330</span>    <span class="keywordflow">goto</span> fatal;</div>
<div class="line"><span class="lineno"> 1331</span>  }</div>
<div class="line"><span class="lineno"> 1332</span> </div>
<div class="line"><span class="lineno"> 1333</span>  <span class="comment">/* Restore the previous access/modification times */</span></div>
<div class="line"><span class="lineno"> 1334</span>  <a class="code hl_function" href="mbox_8c.html#adb9d8c2e11532c0b952ad90a44f2b5f9">mbox_reset_atime</a>(m, &amp;st);</div>
<div class="line"><span class="lineno"> 1335</span> </div>
<div class="line"><span class="lineno"> 1336</span>  <span class="comment">/* reopen the mailbox in read-only mode */</span></div>
<div class="line"><span class="lineno"> 1337</span>  adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a> = <a class="code hl_function" href="mbox_8c.html#a6d89e11c484e354f83abcba8e2f3eada">mbox_open_readwrite</a>(m);</div>
<div class="line"><span class="lineno"> 1338</span>  <span class="keywordflow">if</span> (!adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>)</div>
<div class="line"><span class="lineno"> 1339</span>  {</div>
<div class="line"><span class="lineno"> 1340</span>    adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a> = <a class="code hl_function" href="mbox_8c.html#a98f84a46a763392a934a9c920232391a">mbox_open_readonly</a>(m);</div>
<div class="line"><span class="lineno"> 1341</span>  }</div>
<div class="line"><span class="lineno"> 1342</span>  <span class="keywordflow">if</span> (!adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>)</div>
<div class="line"><span class="lineno"> 1343</span>  {</div>
<div class="line"><span class="lineno"> 1344</span>    unlink(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1345</span>    <a class="code hl_function" href="signal_8c.html#aa9356c41baa1b35d3a7719f90570e6b7">mutt_sig_unblock</a>();</div>
<div class="line"><span class="lineno"> 1346</span>    <a class="code hl_function" href="mx_8c.html#a4e4de522e1ca1db28736065f1499c55d">mx_fastclose_mailbox</a>(m, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1347</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Fatal error!  Could not reopen mailbox!&quot;</span>));</div>
<div class="line"><span class="lineno"> 1348</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;new_offset);</div>
<div class="line"><span class="lineno"> 1349</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;old_offset);</div>
<div class="line"><span class="lineno"> 1350</span>    <span class="keywordflow">goto</span> fatal;</div>
<div class="line"><span class="lineno"> 1351</span>  }</div>
<div class="line"><span class="lineno"> 1352</span> </div>
<div class="line"><span class="lineno"> 1353</span>  <span class="comment">/* update the offsets of the rewritten messages */</span></div>
<div class="line"><span class="lineno"> 1354</span>  <span class="keywordflow">for</span> (i = first, j = first; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno"> 1355</span>  {</div>
<div class="line"><span class="lineno"> 1356</span>    <span class="keywordflow">if</span> (!m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>)</div>
<div class="line"><span class="lineno"> 1357</span>    {</div>
<div class="line"><span class="lineno"> 1358</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a8d35ff6f232f83e89e2d46af416708cc">offset</a> = new_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a79326bce090fb8e01d21ddd96f6672bb">hdr</a>;</div>
<div class="line"><span class="lineno"> 1359</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#ae6ebb9758689003ed9ae055272420dd9">hdr_offset</a> = new_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a79326bce090fb8e01d21ddd96f6672bb">hdr</a>;</div>
<div class="line"><span class="lineno"> 1360</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a> = new_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#ab4ab3bf8092f0bde3e1ecc84bab30e21">body</a>;</div>
<div class="line"><span class="lineno"> 1361</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#ace0e20a11dbdc84ca9ea63497c05b603">index</a> = j++;</div>
<div class="line"><span class="lineno"> 1362</span>    }</div>
<div class="line"><span class="lineno"> 1363</span>  }</div>
<div class="line"><span class="lineno"> 1364</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;new_offset);</div>
<div class="line"><span class="lineno"> 1365</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;old_offset);</div>
<div class="line"><span class="lineno"> 1366</span>  unlink(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile)); <span class="comment">/* remove partial copy of the mailbox */</span></div>
<div class="line"><span class="lineno"> 1367</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;tempfile);</div>
<div class="line"><span class="lineno"> 1368</span>  <a class="code hl_function" href="signal_8c.html#aa9356c41baa1b35d3a7719f90570e6b7">mutt_sig_unblock</a>();</div>
<div class="line"><span class="lineno"> 1369</span> </div>
<div class="line"><span class="lineno"> 1370</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_check_mbox_size = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;check_mbox_size&quot;</span>);</div>
<div class="line"><span class="lineno"> 1371</span>  <span class="keywordflow">if</span> (c_check_mbox_size)</div>
<div class="line"><span class="lineno"> 1372</span>  {</div>
<div class="line"><span class="lineno"> 1373</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structMailbox.html">Mailbox</a> *m_tmp = <a class="code hl_function" href="core_2mailbox_8c.html#afa6e5cc34622044961308aa23da3b570">mailbox_find</a>(<a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno"> 1374</span>    <span class="keywordflow">if</span> (m_tmp &amp;&amp; !m_tmp-&gt;<a class="code hl_variable" href="structMailbox.html#a185d46a268fdf1e34ee061a28d51414e">has_new</a>)</div>
<div class="line"><span class="lineno"> 1375</span>      <a class="code hl_function" href="core_2mailbox_8c.html#ab614961b6e97592c0e56c30b47f65f29">mailbox_update</a>(m_tmp);</div>
<div class="line"><span class="lineno"> 1376</span>  }</div>
<div class="line"><span class="lineno"> 1377</span> </div>
<div class="line"><span class="lineno"> 1378</span>  <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno"> 1379</span>  <span class="keywordflow">return</span> 0; <span class="comment">/* signal success */</span></div>
<div class="line"><span class="lineno"> 1380</span> </div>
<div class="line"><span class="lineno"> 1381</span>bail: <span class="comment">/* Come here in case of disaster */</span></div>
<div class="line"><span class="lineno"> 1382</span> </div>
<div class="line"><span class="lineno"> 1383</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno"> 1384</span> </div>
<div class="line"><span class="lineno"> 1385</span>  <span class="keywordflow">if</span> (tempfile &amp;&amp; unlink_tempfile)</div>
<div class="line"><span class="lineno"> 1386</span>    unlink(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(tempfile));</div>
<div class="line"><span class="lineno"> 1387</span> </div>
<div class="line"><span class="lineno"> 1388</span>  <span class="comment">/* restore offsets, as far as they are valid */</span></div>
<div class="line"><span class="lineno"> 1389</span>  <span class="keywordflow">if</span> ((first &gt;= 0) &amp;&amp; old_offset)</div>
<div class="line"><span class="lineno"> 1390</span>  {</div>
<div class="line"><span class="lineno"> 1391</span>    <span class="keywordflow">for</span> (i = first; (i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>) &amp;&amp; old_offset[i - first].valid; i++)</div>
<div class="line"><span class="lineno"> 1392</span>    {</div>
<div class="line"><span class="lineno"> 1393</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a8d35ff6f232f83e89e2d46af416708cc">offset</a> = old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a79326bce090fb8e01d21ddd96f6672bb">hdr</a>;</div>
<div class="line"><span class="lineno"> 1394</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#ae6ebb9758689003ed9ae055272420dd9">hdr_offset</a> = old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a79326bce090fb8e01d21ddd96f6672bb">hdr</a>;</div>
<div class="line"><span class="lineno"> 1395</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a> = old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#ab4ab3bf8092f0bde3e1ecc84bab30e21">body</a>;</div>
<div class="line"><span class="lineno"> 1396</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a562a3aee45efc37c07dedcc8e1fef93f">lines</a> = old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#a62dc0eee290a380be901369f3eafcf53">lines</a>;</div>
<div class="line"><span class="lineno"> 1397</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a> = old_offset[i - first].<a class="code hl_variable" href="structMUpdate.html#ab068c45a3e06d118bea30898066a3737">length</a>;</div>
<div class="line"><span class="lineno"> 1398</span>    }</div>
<div class="line"><span class="lineno"> 1399</span>  }</div>
<div class="line"><span class="lineno"> 1400</span> </div>
<div class="line"><span class="lineno"> 1401</span>  <span class="comment">/* this is ok to call even if we haven&#39;t locked anything */</span></div>
<div class="line"><span class="lineno"> 1402</span>  <a class="code hl_function" href="mbox_8c.html#aad6c03c38f626757199e4fd0835253ae">mbox_unlock_mailbox</a>(m);</div>
<div class="line"><span class="lineno"> 1403</span> </div>
<div class="line"><span class="lineno"> 1404</span>  <a class="code hl_function" href="signal_8c.html#aa9356c41baa1b35d3a7719f90570e6b7">mutt_sig_unblock</a>();</div>
<div class="line"><span class="lineno"> 1405</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;new_offset);</div>
<div class="line"><span class="lineno"> 1406</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;old_offset);</div>
<div class="line"><span class="lineno"> 1407</span> </div>
<div class="line"><span class="lineno"> 1408</span>  adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a> = freopen(<a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), <span class="stringliteral">&quot;r&quot;</span>, adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>);</div>
<div class="line"><span class="lineno"> 1409</span>  <span class="keywordflow">if</span> (!adata-&gt;<a class="code hl_variable" href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">fp</a>)</div>
<div class="line"><span class="lineno"> 1410</span>  {</div>
<div class="line"><span class="lineno"> 1411</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Could not reopen mailbox&quot;</span>));</div>
<div class="line"><span class="lineno"> 1412</span>    <a class="code hl_function" href="mx_8c.html#a4e4de522e1ca1db28736065f1499c55d">mx_fastclose_mailbox</a>(m, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1413</span>    <span class="keywordflow">goto</span> fatal;</div>
<div class="line"><span class="lineno"> 1414</span>  }</div>
<div class="line"><span class="lineno"> 1415</span> </div>
<div class="line"><span class="lineno"> 1416</span>  <a class="code hl_function" href="core_2mailbox_8c.html#af09ac36728ca3255523cd3b0bfd1f172">mailbox_changed</a>(m, <a class="code hl_enumvalue" href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4ad0c3ae03b6a1ba8f4a91d5f8c81796ac">NT_MAILBOX_UPDATE</a>);</div>
<div class="line"><span class="lineno"> 1417</span>  <span class="keywordflow">if</span> (need_sort)</div>
<div class="line"><span class="lineno"> 1418</span>  {</div>
<div class="line"><span class="lineno"> 1419</span>    <span class="comment">/* if the mailbox was reopened, the thread tree will be invalid so make</span></div>
<div class="line"><span class="lineno"> 1420</span><span class="comment">     * sure to start threading from scratch.  */</span></div>
<div class="line"><span class="lineno"> 1421</span>    <a class="code hl_function" href="core_2mailbox_8c.html#af09ac36728ca3255523cd3b0bfd1f172">mailbox_changed</a>(m, <a class="code hl_enumvalue" href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4a96d28ff20a133d31e2e6ce8bb4e8b78f">NT_MAILBOX_RESORT</a>);</div>
<div class="line"><span class="lineno"> 1422</span>  }</div>
<div class="line"><span class="lineno"> 1423</span> </div>
<div class="line"><span class="lineno"> 1424</span>fatal:</div>
<div class="line"><span class="lineno"> 1425</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;tempfile);</div>
<div class="line"><span class="lineno"> 1426</span>  <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno"> 1427</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno"> 1428</span>}</div>
<div class="ttc" id="abuffer_8c_html_a02123807d31181ac701b566226e93b33"><div class="ttname"><a href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a></div><div class="ttdeci">int buf_printf(struct Buffer *buf, const char *fmt,...)</div><div class="ttdoc">Format a string overwriting a Buffer.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00161">buffer.c:161</a></div></div>
<div class="ttc" id="abuffer_8h_html_a728ebc5a947b77c8d56db44ce553a7ab"><div class="ttname"><a href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a></div><div class="ttdeci">static const char * buf_string(const struct Buffer *buf)</div><div class="ttdoc">Convert a buffer to a const char * &quot;string&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00096">buffer.h:96</a></div></div>
<div class="ttc" id="aconfig_2helpers_8c_html_a9f184e61342916799259930333f4205f"><div class="ttname"><a href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name.</div><div class="ttdef"><b>Definition:</b> <a href="config_2helpers_8c_source.html#l00168">helpers.c:168</a></div></div>
<div class="ttc" id="aconfig_2helpers_8c_html_af7f3de51c3c2f5b8f527f40c8397a3fc"><div class="ttname"><a href="config_2helpers_8c.html#af7f3de51c3c2f5b8f527f40c8397a3fc">cs_subset_sort</a></div><div class="ttdeci">short cs_subset_sort(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a sort config item by name.</div><div class="ttdef"><b>Definition:</b> <a href="config_2helpers_8c_source.html#l00266">helpers.c:266</a></div></div>
<div class="ttc" id="acopy_8c_html_a72172841415fb14e143da3c102be0364"><div class="ttname"><a href="copy_8c.html#a72172841415fb14e143da3c102be0364">mutt_copy_message</a></div><div class="ttdeci">int mutt_copy_message(FILE *fp_out, struct Email *e, struct Message *msg, CopyMessageFlags cmflags, CopyHeaderFlags chflags, int wraplen)</div><div class="ttdoc">Copy a message from a Mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="copy_8c_source.html#l00908">copy.c:908</a></div></div>
<div class="ttc" id="acopy_8h_html_a2a61b3ef55bc40f9364eea3f09bb4da8"><div class="ttname"><a href="copy_8h.html#a2a61b3ef55bc40f9364eea3f09bb4da8">MUTT_CM_UPDATE</a></div><div class="ttdeci">#define MUTT_CM_UPDATE</div><div class="ttdoc">Update structs on sync.</div><div class="ttdef"><b>Definition:</b> <a href="copy_8h_source.html#l00042">copy.h:42</a></div></div>
<div class="ttc" id="acopy_8h_html_a397b6166af3a14708bddb8ccd0241e11"><div class="ttname"><a href="copy_8h.html#a397b6166af3a14708bddb8ccd0241e11">CH_UPDATE</a></div><div class="ttdeci">#define CH_UPDATE</div><div class="ttdoc">Update the status and x-status fields?</div><div class="ttdef"><b>Definition:</b> <a href="copy_8h_source.html#l00054">copy.h:54</a></div></div>
<div class="ttc" id="acopy_8h_html_a3ff472dcfcc60933d0deaba111527d6c"><div class="ttname"><a href="copy_8h.html#a3ff472dcfcc60933d0deaba111527d6c">CH_FROM</a></div><div class="ttdeci">#define CH_FROM</div><div class="ttdoc">Retain the &quot;From &quot; message separator?</div><div class="ttdef"><b>Definition:</b> <a href="copy_8h_source.html#l00058">copy.h:58</a></div></div>
<div class="ttc" id="acopy_8h_html_a94e818174cb0508df54058debb1c631a"><div class="ttname"><a href="copy_8h.html#a94e818174cb0508df54058debb1c631a">CH_UPDATE_LEN</a></div><div class="ttdeci">#define CH_UPDATE_LEN</div><div class="ttdoc">Update Lines: and Content-Length:</div><div class="ttdef"><b>Definition:</b> <a href="copy_8h_source.html#l00064">copy.h:64</a></div></div>
<div class="ttc" id="acore_2mailbox_8c_html_ab614961b6e97592c0e56c30b47f65f29"><div class="ttname"><a href="core_2mailbox_8c.html#ab614961b6e97592c0e56c30b47f65f29">mailbox_update</a></div><div class="ttdeci">void mailbox_update(struct Mailbox *m)</div><div class="ttdoc">Get the mailbox's current size.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8c_source.html#l00215">mailbox.c:215</a></div></div>
<div class="ttc" id="acore_2mailbox_8c_html_af09ac36728ca3255523cd3b0bfd1f172"><div class="ttname"><a href="core_2mailbox_8c.html#af09ac36728ca3255523cd3b0bfd1f172">mailbox_changed</a></div><div class="ttdeci">void mailbox_changed(struct Mailbox *m, enum NotifyMailbox action)</div><div class="ttdoc">Notify observers of a change to a Mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8c_source.html#l00233">mailbox.c:233</a></div></div>
<div class="ttc" id="acore_2mailbox_8c_html_afa6e5cc34622044961308aa23da3b570"><div class="ttname"><a href="core_2mailbox_8c.html#afa6e5cc34622044961308aa23da3b570">mailbox_find</a></div><div class="ttdeci">struct Mailbox * mailbox_find(const char *path)</div><div class="ttdoc">Find the mailbox with a given path.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8c_source.html#l00150">mailbox.c:150</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_a01795608bad9d16eed1bc017f0bd96c4a96d28ff20a133d31e2e6ce8bb4e8b78f"><div class="ttname"><a href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4a96d28ff20a133d31e2e6ce8bb4e8b78f">NT_MAILBOX_RESORT</a></div><div class="ttdeci">@ NT_MAILBOX_RESORT</div><div class="ttdoc">Email list needs resorting.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00190">mailbox.h:190</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_a01795608bad9d16eed1bc017f0bd96c4ad0c3ae03b6a1ba8f4a91d5f8c81796ac"><div class="ttname"><a href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4ad0c3ae03b6a1ba8f4a91d5f8c81796ac">NT_MAILBOX_UPDATE</a></div><div class="ttdeci">@ NT_MAILBOX_UPDATE</div><div class="ttdoc">Update internal tables.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00191">mailbox.h:191</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_af65addf714c28dd5d483cb426100921da09cef4c4e3dc42c9137860413dcdb374"><div class="ttname"><a href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da09cef4c4e3dc42c9137860413dcdb374">MUTT_MMDF</a></div><div class="ttdeci">@ MUTT_MMDF</div><div class="ttdoc">'mmdf' Mailbox type</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00046">mailbox.h:46</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_af65addf714c28dd5d483cb426100921da817ef3cf5f529965875400b412678525"><div class="ttname"><a href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da817ef3cf5f529965875400b412678525">MUTT_MBOX</a></div><div class="ttdeci">@ MUTT_MBOX</div><div class="ttdoc">'mbox' Mailbox type</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00045">mailbox.h:45</a></div></div>
<div class="ttc" id="aemail_2body_8c_html_a129af1c316fcbc26b55fb48957bab2cb"><div class="ttname"><a href="email_2body_8c.html#a129af1c316fcbc26b55fb48957bab2cb">mutt_body_free</a></div><div class="ttdeci">void mutt_body_free(struct Body **ptr)</div><div class="ttdoc">Free a Body.</div><div class="ttdef"><b>Definition:</b> <a href="email_2body_8c_source.html#l00058">body.c:58</a></div></div>
<div class="ttc" id="aemail_2sort_8c_html_adce0d7b85a68258fc8579efc04e3790b"><div class="ttname"><a href="email_2sort_8c.html#adce0d7b85a68258fc8579efc04e3790b">mutt_sort_unsorted</a></div><div class="ttdeci">void mutt_sort_unsorted(struct Mailbox *m)</div><div class="ttdoc">Sort emails by their disk order.</div><div class="ttdef"><b>Definition:</b> <a href="email_2sort_8c_source.html#l00449">sort.c:449</a></div></div>
<div class="ttc" id="aemail_2sort_8h_html_aefa89e4f16231d09e09e4693bebf6dd4"><div class="ttname"><a href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4">EmailSortType</a></div><div class="ttdeci">EmailSortType</div><div class="ttdoc">Methods for sorting Emails.</div><div class="ttdef"><b>Definition:</b> <a href="email_2sort_8h_source.html#l00052">sort.h:53</a></div></div>
<div class="ttc" id="aemail_2sort_8h_html_aefa89e4f16231d09e09e4693bebf6dd4aa5fa714c8f7a789cb67f5d22cd014361"><div class="ttname"><a href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4aa5fa714c8f7a789cb67f5d22cd014361">EMAIL_SORT_UNSORTED</a></div><div class="ttdeci">@ EMAIL_SORT_UNSORTED</div><div class="ttdoc">Sort by the order the messages appear in the mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="email_2sort_8h_source.html#l00064">sort.h:64</a></div></div>
<div class="ttc" id="afile_8c_html_a0a6ff09a685fb6fa1120a582a5a6ef4a"><div class="ttname"><a href="file_8c.html#a0a6ff09a685fb6fa1120a582a5a6ef4a">mutt_file_copy_stream</a></div><div class="ttdeci">int mutt_file_copy_stream(FILE *fp_in, FILE *fp_out)</div><div class="ttdoc">Copy the contents of one file into another.</div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00225">file.c:225</a></div></div>
<div class="ttc" id="afile_8c_html_a6b60cb2044041374689e6e6641c5cc05"><div class="ttname"><a href="file_8c.html#a6b60cb2044041374689e6e6641c5cc05">mutt_file_seek</a></div><div class="ttdeci">bool mutt_file_seek(FILE *fp, LOFF_T offset, int whence)</div><div class="ttdoc">Wrapper for fseeko with error handling.</div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00655">file.c:655</a></div></div>
<div class="ttc" id="afile_8h_html_a9b519e795f098be88b93cd72c49a35ec"><div class="ttname"><a href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a></div><div class="ttdeci">#define mutt_file_fclose(FP)</div><div class="ttdef"><b>Definition:</b> <a href="file_8h_source.html#l00139">file.h:139</a></div></div>
<div class="ttc" id="afile_8h_html_a9fa358d76519cb6bc8ffca5850976d46"><div class="ttname"><a href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a></div><div class="ttdeci">#define mutt_file_fopen(PATH, MODE)</div><div class="ttdef"><b>Definition:</b> <a href="file_8h_source.html#l00138">file.h:138</a></div></div>
<div class="ttc" id="aglobals_8c_html_a12bc91409c8ec9f5b1600f34d1f557b6"><div class="ttname"><a href="globals_8c.html#a12bc91409c8ec9f5b1600f34d1f557b6">ShortHostname</a></div><div class="ttdeci">char * ShortHostname</div><div class="ttdoc">Short version of the hostname.</div><div class="ttdef"><b>Definition:</b> <a href="globals_8c_source.html#l00037">globals.c:37</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gae108f891125caafa9250cf0959c40c04"><div class="ttname"><a href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a></div><div class="ttdeci">#define mutt_message(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging2_8h_source.html#l00092">logging2.h:92</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging2_8h_source.html#l00090">logging2.h:90</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gafaa521ab22db877ccf1b87e679e1b43e"><div class="ttname"><a href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a></div><div class="ttdeci">#define mutt_perror(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging2_8h_source.html#l00094">logging2.h:94</a></div></div>
<div class="ttc" id="agroup__mx__mbox__check_html_gafb376aac365fa068eeb370915b2d309d"><div class="ttname"><a href="group__mx__mbox__check.html#gafb376aac365fa068eeb370915b2d309d">mbox_mbox_check</a></div><div class="ttdeci">static enum MxStatus mbox_mbox_check(struct Mailbox *m)</div><div class="ttdoc">Check for new mail - Implements MxOps::mbox_check() -.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00929">mbox.c:929</a></div></div>
<div class="ttc" id="alogging2_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdeci">@ LL_DEBUG1</div><div class="ttdoc">Log at debug level 1.</div><div class="ttdef"><b>Definition:</b> <a href="logging2_8h_source.html#l00044">logging2.h:44</a></div></div>
<div class="ttc" id="ambox_2lib_8h_html_a02e41ebb72c6ab451fed824a9c41283c"><div class="ttname"><a href="mbox_2lib_8h.html#a02e41ebb72c6ab451fed824a9c41283c">MMDF_SEP</a></div><div class="ttdeci">#define MMDF_SEP</div><div class="ttdef"><b>Definition:</b> <a href="mbox_2lib_8h_source.html#l00062">lib.h:62</a></div></div>
<div class="ttc" id="ambox_8c_html_a1c304c29562f920b2ba11fabcc14c268"><div class="ttname"><a href="mbox_8c.html#a1c304c29562f920b2ba11fabcc14c268">mbox_lock_mailbox</a></div><div class="ttdeci">static int mbox_lock_mailbox(struct Mailbox *m, bool excl, bool retry)</div><div class="ttdoc">Lock a mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00139">mbox.c:139</a></div></div>
<div class="ttc" id="ambox_8c_html_a2f989931e9117a9c6598b6c592f69be2"><div class="ttname"><a href="mbox_8c.html#a2f989931e9117a9c6598b6c592f69be2">mbox_adata_get</a></div><div class="ttdeci">static struct MboxAccountData * mbox_adata_get(struct Mailbox *m)</div><div class="ttdoc">Get the private data associated with a Mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00124">mbox.c:124</a></div></div>
<div class="ttc" id="ambox_8c_html_a6d89e11c484e354f83abcba8e2f3eada"><div class="ttname"><a href="mbox_8c.html#a6d89e11c484e354f83abcba8e2f3eada">mbox_open_readwrite</a></div><div class="ttdeci">static FILE * mbox_open_readwrite(struct Mailbox *m)</div><div class="ttdoc">Open an mbox read-write.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00802">mbox.c:802</a></div></div>
<div class="ttc" id="ambox_8c_html_a98f84a46a763392a934a9c920232391a"><div class="ttname"><a href="mbox_8c.html#a98f84a46a763392a934a9c920232391a">mbox_open_readonly</a></div><div class="ttdeci">static FILE * mbox_open_readonly(struct Mailbox *m)</div><div class="ttdoc">Open an mbox read-only.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00817">mbox.c:817</a></div></div>
<div class="ttc" id="ambox_8c_html_aad6c03c38f626757199e4fd0835253ae"><div class="ttname"><a href="mbox_8c.html#aad6c03c38f626757199e4fd0835253ae">mbox_unlock_mailbox</a></div><div class="ttdeci">static void mbox_unlock_mailbox(struct Mailbox *m)</div><div class="ttdoc">Unlock a mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00163">mbox.c:163</a></div></div>
<div class="ttc" id="ambox_8c_html_adb9d8c2e11532c0b952ad90a44f2b5f9"><div class="ttname"><a href="mbox_8c.html#adb9d8c2e11532c0b952ad90a44f2b5f9">mbox_reset_atime</a></div><div class="ttdeci">void mbox_reset_atime(struct Mailbox *m, struct stat *st)</div><div class="ttdoc">Reset the access time on the mailbox file.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00747">mbox.c:747</a></div></div>
<div class="ttc" id="amemory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00062">memory.h:62</a></div></div>
<div class="ttc" id="amemory_8h_html_a9aaf8f21a29735767a069ff1aee9d7d9"><div class="ttname"><a href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a></div><div class="ttdeci">#define MUTT_MEM_CALLOC(n, type)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00047">memory.h:47</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a6b6a50296dd2a31863a43379ef4a343d"><div class="ttname"><a href="mutt_2string_8c.html#a6b6a50296dd2a31863a43379ef4a343d">mutt_str_equal</a></div><div class="ttdeci">bool mutt_str_equal(const char *a, const char *b)</div><div class="ttdoc">Compare two strings.</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00660">string.c:660</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a9bf968304f4f9b49e24215cb2e28d22d"><div class="ttname"><a href="mutt_2string_8c.html#a9bf968304f4f9b49e24215cb2e28d22d">mutt_str_startswith</a></div><div class="ttdeci">size_t mutt_str_startswith(const char *str, const char *prefix)</div><div class="ttdoc">Check whether a string starts with a prefix.</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00232">string.c:232</a></div></div>
<div class="ttc" id="amuttlib_8c_html_a777680c324667521d8c486051c22fe10"><div class="ttname"><a href="muttlib_8c.html#a777680c324667521d8c486051c22fe10">buf_pretty_mailbox</a></div><div class="ttdeci">void buf_pretty_mailbox(struct Buffer *buf)</div><div class="ttdoc">Shorten a mailbox path using '~' or '='.</div><div class="ttdef"><b>Definition:</b> <a href="muttlib_8c_source.html#l00518">muttlib.c:518</a></div></div>
<div class="ttc" id="amx_8c_html_a2610a2afe8887bb874131a4ba092aa6a"><div class="ttname"><a href="mx_8c.html#a2610a2afe8887bb874131a4ba092aa6a">mx_msg_close</a></div><div class="ttdeci">int mx_msg_close(struct Mailbox *m, struct Message **ptr)</div><div class="ttdoc">Close a message.</div><div class="ttdef"><b>Definition:</b> <a href="mx_8c_source.html#l01185">mx.c:1185</a></div></div>
<div class="ttc" id="amx_8c_html_a4e4de522e1ca1db28736065f1499c55d"><div class="ttname"><a href="mx_8c.html#a4e4de522e1ca1db28736065f1499c55d">mx_fastclose_mailbox</a></div><div class="ttdeci">void mx_fastclose_mailbox(struct Mailbox *m, bool keep_account)</div><div class="ttdoc">Free up memory associated with the Mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="mx_8c_source.html#l00414">mx.c:414</a></div></div>
<div class="ttc" id="amx_8c_html_a9b2902ecb2bebbd553a8ec733ca59886"><div class="ttname"><a href="mx_8c.html#a9b2902ecb2bebbd553a8ec733ca59886">mx_msg_open</a></div><div class="ttdeci">struct Message * mx_msg_open(struct Mailbox *m, struct Email *e)</div><div class="ttdoc">Return a stream pointer for a message.</div><div class="ttdef"><b>Definition:</b> <a href="mx_8c_source.html#l01139">mx.c:1139</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432ad9cf54713c660db891b05384830e57f4"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432ad9cf54713c660db891b05384830e57f4">MX_STATUS_REOPENED</a></div><div class="ttdeci">@ MX_STATUS_REOPENED</div><div class="ttdoc">Mailbox was reopened.</div><div class="ttdef"><b>Definition:</b> <a href="mxapi_8h_source.html#l00065">mxapi.h:65</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432af3d8ebc52b40a1f9f22b7b4366d0315b"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432af3d8ebc52b40a1f9f22b7b4366d0315b">MX_STATUS_NEW_MAIL</a></div><div class="ttdeci">@ MX_STATUS_NEW_MAIL</div><div class="ttdoc">New mail received in Mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="mxapi_8h_source.html#l00063">mxapi.h:63</a></div></div>
<div class="ttc" id="apool_8c_html_a41cba27c25d33cb6822789a2856093f2"><div class="ttname"><a href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a></div><div class="ttdeci">struct Buffer * buf_pool_get(void)</div><div class="ttdoc">Get a Buffer from the pool.</div><div class="ttdef"><b>Definition:</b> <a href="pool_8c_source.html#l00082">pool.c:82</a></div></div>
<div class="ttc" id="apool_8c_html_a4cc6068279461cb8628219586dfa35a1"><div class="ttname"><a href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a></div><div class="ttdeci">void buf_pool_release(struct Buffer **ptr)</div><div class="ttdoc">Return a Buffer to the pool.</div><div class="ttdef"><b>Definition:</b> <a href="pool_8c_source.html#l00096">pool.c:96</a></div></div>
<div class="ttc" id="asignal_8c_html_aa6c49e5535cdffeffd2cd4eee28bc96b"><div class="ttname"><a href="signal_8c.html#aa6c49e5535cdffeffd2cd4eee28bc96b">mutt_sig_block</a></div><div class="ttdeci">void mutt_sig_block(void)</div><div class="ttdoc">Block signals during critical operations.</div><div class="ttdef"><b>Definition:</b> <a href="signal_8c_source.html#l00228">signal.c:228</a></div></div>
<div class="ttc" id="asignal_8c_html_aa9356c41baa1b35d3a7719f90570e6b7"><div class="ttname"><a href="signal_8c.html#aa9356c41baa1b35d3a7719f90570e6b7">mutt_sig_unblock</a></div><div class="ttdeci">void mutt_sig_unblock(void)</div><div class="ttdoc">Restore previously blocked signals.</div><div class="ttdef"><b>Definition:</b> <a href="signal_8c_source.html#l00246">signal.c:246</a></div></div>
<div class="ttc" id="astring2_8h_html_a7e0481bed27661ea2679f256b24e0283"><div class="ttname"><a href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a></div><div class="ttdeci">#define NONULL(x)</div><div class="ttdef"><b>Definition:</b> <a href="string2_8h_source.html#l00043">string2.h:43</a></div></div>
<div class="ttc" id="astructAccount_html_ad10abe32dcee204d654a3cd350d8cd8e"><div class="ttname"><a href="structAccount.html#ad10abe32dcee204d654a3cd350d8cd8e">Account::adata</a></div><div class="ttdeci">void * adata</div><div class="ttdoc">Private data (for Mailbox backends)</div><div class="ttdef"><b>Definition:</b> <a href="core_2account_8h_source.html#l00042">account.h:42</a></div></div>
<div class="ttc" id="astructBody_html_a0b87b7bdb6faef44d9aac4854975f805"><div class="ttname"><a href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">Body::parts</a></div><div class="ttdeci">struct Body * parts</div><div class="ttdoc">parts of a multipart or message/rfc822</div><div class="ttdef"><b>Definition:</b> <a href="email_2body_8h_source.html#l00073">body.h:73</a></div></div>
<div class="ttc" id="astructBody_html_a1969dfeb0a155ccb16153fe777a103b0"><div class="ttname"><a href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">Body::offset</a></div><div class="ttdeci">LOFF_T offset</div><div class="ttdoc">offset where the actual data begins</div><div class="ttdef"><b>Definition:</b> <a href="email_2body_8h_source.html#l00052">body.h:52</a></div></div>
<div class="ttc" id="astructBody_html_a6f92d7ec8568ca04ae07931c56dd0790"><div class="ttname"><a href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">Body::length</a></div><div class="ttdeci">LOFF_T length</div><div class="ttdoc">length (in bytes) of attachment</div><div class="ttdef"><b>Definition:</b> <a href="email_2body_8h_source.html#l00053">body.h:53</a></div></div>
<div class="ttc" id="astructBody_html_ae6ebb9758689003ed9ae055272420dd9"><div class="ttname"><a href="structBody.html#ae6ebb9758689003ed9ae055272420dd9">Body::hdr_offset</a></div><div class="ttdeci">long hdr_offset</div><div class="ttdoc">Offset in stream where the headers begin.</div><div class="ttdef"><b>Definition:</b> <a href="email_2body_8h_source.html#l00081">body.h:81</a></div></div>
<div class="ttc" id="astructBuffer_html"><div class="ttname"><a href="structBuffer.html">Buffer</a></div><div class="ttdoc">String manipulation buffer.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00035">buffer.h:36</a></div></div>
<div class="ttc" id="astructEmail_html_a562a3aee45efc37c07dedcc8e1fef93f"><div class="ttname"><a href="structEmail.html#a562a3aee45efc37c07dedcc8e1fef93f">Email::lines</a></div><div class="ttdeci">int lines</div><div class="ttdoc">How many lines in the body of this message?</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00062">email.h:62</a></div></div>
<div class="ttc" id="astructEmail_html_a57ad6ac618c0f685804f6f5bb390b3a6"><div class="ttname"><a href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">Email::body</a></div><div class="ttdeci">struct Body * body</div><div class="ttdoc">List of MIME parts.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00069">email.h:69</a></div></div>
<div class="ttc" id="astructEmail_html_a8b1e186b9d388e199ba9c6239c612627"><div class="ttname"><a href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">Email::changed</a></div><div class="ttdeci">bool changed</div><div class="ttdoc">Email has been edited.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00077">email.h:77</a></div></div>
<div class="ttc" id="astructEmail_html_a8d35ff6f232f83e89e2d46af416708cc"><div class="ttname"><a href="structEmail.html#a8d35ff6f232f83e89e2d46af416708cc">Email::offset</a></div><div class="ttdeci">LOFF_T offset</div><div class="ttdoc">Where in the stream does this message begin?</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00071">email.h:71</a></div></div>
<div class="ttc" id="astructEmail_html_a8d4df03be101c132581352d182ae99ae"><div class="ttname"><a href="structEmail.html#a8d4df03be101c132581352d182ae99ae">Email::attach_del</a></div><div class="ttdeci">bool attach_del</div><div class="ttdoc">Has an attachment marked for deletion.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00099">email.h:99</a></div></div>
<div class="ttc" id="astructMUpdate_html"><div class="ttname"><a href="structMUpdate.html">MUpdate</a></div><div class="ttdoc">Store of new offsets, used by mutt_sync_mailbox()</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00067">mbox.c:68</a></div></div>
<div class="ttc" id="astructMUpdate_html_a62dc0eee290a380be901369f3eafcf53"><div class="ttname"><a href="structMUpdate.html#a62dc0eee290a380be901369f3eafcf53">MUpdate::lines</a></div><div class="ttdeci">long lines</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00072">mbox.c:72</a></div></div>
<div class="ttc" id="astructMUpdate_html_a79326bce090fb8e01d21ddd96f6672bb"><div class="ttname"><a href="structMUpdate.html#a79326bce090fb8e01d21ddd96f6672bb">MUpdate::hdr</a></div><div class="ttdeci">LOFF_T hdr</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00070">mbox.c:70</a></div></div>
<div class="ttc" id="astructMUpdate_html_ab068c45a3e06d118bea30898066a3737"><div class="ttname"><a href="structMUpdate.html#ab068c45a3e06d118bea30898066a3737">MUpdate::length</a></div><div class="ttdeci">LOFF_T length</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00073">mbox.c:73</a></div></div>
<div class="ttc" id="astructMUpdate_html_ab4ab3bf8092f0bde3e1ecc84bab30e21"><div class="ttname"><a href="structMUpdate.html#ab4ab3bf8092f0bde3e1ecc84bab30e21">MUpdate::body</a></div><div class="ttdeci">LOFF_T body</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00071">mbox.c:71</a></div></div>
<div class="ttc" id="astructMUpdate_html_ac4ff1f4e3d6bfa6d2a0ea29d95934965"><div class="ttname"><a href="structMUpdate.html#ac4ff1f4e3d6bfa6d2a0ea29d95934965">MUpdate::valid</a></div><div class="ttdeci">bool valid</div><div class="ttdef"><b>Definition:</b> <a href="mbox_8c_source.html#l00069">mbox.c:69</a></div></div>
<div class="ttc" id="astructMailbox_html"><div class="ttname"><a href="structMailbox.html">Mailbox</a></div><div class="ttdoc">A mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00078">mailbox.h:79</a></div></div>
<div class="ttc" id="astructMailbox_html_a185d46a268fdf1e34ee061a28d51414e"><div class="ttname"><a href="structMailbox.html#a185d46a268fdf1e34ee061a28d51414e">Mailbox::has_new</a></div><div class="ttdeci">bool has_new</div><div class="ttdoc">Mailbox has new mail.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00085">mailbox.h:85</a></div></div>
<div class="ttc" id="astructMailbox_html_a5638329fb2ebd4bbe1f4a949ec8de174"><div class="ttname"><a href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">Mailbox::type</a></div><div class="ttdeci">enum MailboxType type</div><div class="ttdoc">Mailbox type.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00102">mailbox.h:102</a></div></div>
<div class="ttc" id="astructMailbox_html_ace276d581d6d299ecf227be214841148"><div class="ttname"><a href="structMailbox.html#ace276d581d6d299ecf227be214841148">Mailbox::size</a></div><div class="ttdeci">off_t size</div><div class="ttdoc">Size of the Mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00084">mailbox.h:84</a></div></div>
<div class="ttc" id="astructMboxAccountData_html"><div class="ttname"><a href="structMboxAccountData.html">MboxAccountData</a></div><div class="ttdoc">Mbox-specific Account data -.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_2lib_8h_source.html#l00048">lib.h:49</a></div></div>
<div class="ttc" id="astructMboxAccountData_html_a5b98e08c3191fc9525c5785a68fd6281"><div class="ttname"><a href="structMboxAccountData.html#a5b98e08c3191fc9525c5785a68fd6281">MboxAccountData::fp</a></div><div class="ttdeci">FILE * fp</div><div class="ttdoc">Mailbox file.</div><div class="ttdef"><b>Definition:</b> <a href="mbox_2lib_8h_source.html#l00050">lib.h:50</a></div></div>
<div class="ttc" id="astructMessage_html"><div class="ttname"><a href="structMessage.html">Message</a></div><div class="ttdoc">A local copy of an email.</div><div class="ttdef"><b>Definition:</b> <a href="core_2message_8h_source.html#l00033">message.h:34</a></div></div>
<div class="ttc" id="astructMessage_html_a11d53ee4319e8735c1677d8780a7b517"><div class="ttname"><a href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">Message::fp</a></div><div class="ttdeci">FILE * fp</div><div class="ttdoc">pointer to the message data</div><div class="ttdef"><b>Definition:</b> <a href="core_2message_8h_source.html#l00035">message.h:35</a></div></div>
<div class="ttc" id="astructNeoMutt_html_a5c2d30a2f734f94412bd5b3a7367b981"><div class="ttname"><a href="structNeoMutt.html#a5c2d30a2f734f94412bd5b3a7367b981">NeoMutt::username</a></div><div class="ttdeci">char * username</div><div class="ttdoc">User's login name.</div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00054">neomutt.h:54</a></div></div>
<div class="ttc" id="atmp_8h_html_a271a7828888985955df49205d7846a45"><div class="ttname"><a href="tmp_8h.html#a271a7828888985955df49205d7846a45">buf_mktemp</a></div><div class="ttdeci">#define buf_mktemp(buf)</div><div class="ttdef"><b>Definition:</b> <a href="tmp_8h_source.html#l00033">tmp.h:33</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync_ga47a65cbf57a70eb1db4e5aed167ec3d7_cgraph.svg" width="730" height="1760"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ga0a28d46645d6c462bb1b43c2210b3672" name="ga0a28d46645d6c462bb1b43c2210b3672"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0a28d46645d6c462bb1b43c2210b3672">&#9670;&#160;</a></span>mh_mbox_sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> mh_mbox_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432ad9cf54713c660db891b05384830e57f4" title="Mailbox was reopened.">MX_STATUS_REOPENED</a></td><td>mailbox has been externally modified </td></tr>
    <tr><td class="paramname"><a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432af3d8ebc52b40a1f9f22b7b4366d0315b" title="New mail received in Mailbox.">MX_STATUS_NEW_MAIL</a></td><td>new mail has arrived </td></tr>
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The flag retvals come from a call to a backend sync function </dd></dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l01063">1063</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1064</span>{</div>
<div class="line"><span class="lineno"> 1065</span>  <span class="keyword">enum</span> <a class="code hl_enumeration" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> check = <a class="code hl_function" href="mh_8c.html#a99c7310c93b72b3d8865be13d22c9d5f">mh_check</a>(m);</div>
<div class="line"><span class="lineno"> 1066</span>  <span class="keywordflow">if</span> (check == <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>)</div>
<div class="line"><span class="lineno"> 1067</span>    <span class="keywordflow">return</span> check;</div>
<div class="line"><span class="lineno"> 1068</span> </div>
<div class="line"><span class="lineno"> 1069</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structHeaderCache.html">HeaderCache</a> *hc = NULL;</div>
<div class="line"><span class="lineno"> 1070</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno"> 1071</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_header_cache = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;header_cache&quot;</span>);</div>
<div class="line"><span class="lineno"> 1072</span>  hc = <a class="code hl_function" href="hcache_2hcache_8c.html#a5691b8a075665d48c570eb105a472556">hcache_open</a>(c_header_cache, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), NULL, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1073</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1074</span> </div>
<div class="line"><span class="lineno"> 1075</span>  <span class="keyword">struct </span>Progress *progress = NULL;</div>
<div class="line"><span class="lineno"> 1076</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno"> 1077</span>  {</div>
<div class="line"><span class="lineno"> 1078</span>    progress = <a class="code hl_function" href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a>(<a class="code hl_enumvalue" href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75ae89b45d8e4dad79ccfd4fc6df66c6bfe">MUTT_PROGRESS_WRITE</a>, m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>);</div>
<div class="line"><span class="lineno"> 1079</span>    <a class="code hl_function" href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a>(progress, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Writing %s...&quot;</span>), <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno"> 1080</span>  }</div>
<div class="line"><span class="lineno"> 1081</span> </div>
<div class="line"><span class="lineno"> 1082</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno"> 1083</span>  {</div>
<div class="line"><span class="lineno"> 1084</span>    <a class="code hl_function" href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a>(progress, i, -1);</div>
<div class="line"><span class="lineno"> 1085</span> </div>
<div class="line"><span class="lineno"> 1086</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i];</div>
<div class="line"><span class="lineno"> 1087</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="mh_8c.html#a9a6412540f5b990d8f82823d537ce824">mh_sync_mailbox_message</a>(m, e, hc) == -1)</div>
<div class="line"><span class="lineno"> 1088</span>    {</div>
<div class="line"><span class="lineno"> 1089</span>      <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno"> 1090</span>      <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno"> 1091</span>    }</div>
<div class="line"><span class="lineno"> 1092</span>  }</div>
<div class="line"><span class="lineno"> 1093</span>  <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno"> 1094</span> </div>
<div class="line"><span class="lineno"> 1095</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno"> 1096</span>  <a class="code hl_function" href="hcache_2hcache_8c.html#a791c8437997aca5d8747271ff4c75e98">hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno"> 1097</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1098</span> </div>
<div class="line"><span class="lineno"> 1099</span>  <a class="code hl_function" href="sequence_8c.html#acb1cb62fd7fae352276a1ea321568dd8">mh_seq_update</a>(m);</div>
<div class="line"><span class="lineno"> 1100</span> </div>
<div class="line"><span class="lineno"> 1101</span>  <span class="comment">/* XXX race condition? */</span></div>
<div class="line"><span class="lineno"> 1102</span> </div>
<div class="line"><span class="lineno"> 1103</span>  <a class="code hl_function" href="mh_8c.html#a18d1d5ae034020d3672a2bfb04d3ed68">mh_update_mtime</a>(m);</div>
<div class="line"><span class="lineno"> 1104</span> </div>
<div class="line"><span class="lineno"> 1105</span>  <span class="comment">/* adjust indices */</span></div>
<div class="line"><span class="lineno"> 1106</span> </div>
<div class="line"><span class="lineno"> 1107</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#ab5863d8f516c6db52e2fadb531bf8557">msg_deleted</a>)</div>
<div class="line"><span class="lineno"> 1108</span>  {</div>
<div class="line"><span class="lineno"> 1109</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, j = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno"> 1110</span>    {</div>
<div class="line"><span class="lineno"> 1111</span>      <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i];</div>
<div class="line"><span class="lineno"> 1112</span>      <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno"> 1113</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1114</span> </div>
<div class="line"><span class="lineno"> 1115</span>      <span class="keywordflow">if</span> (!e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>)</div>
<div class="line"><span class="lineno"> 1116</span>        e-&gt;<a class="code hl_variable" href="structEmail.html#ace0e20a11dbdc84ca9ea63497c05b603">index</a> = j++;</div>
<div class="line"><span class="lineno"> 1117</span>    }</div>
<div class="line"><span class="lineno"> 1118</span>  }</div>
<div class="line"><span class="lineno"> 1119</span> </div>
<div class="line"><span class="lineno"> 1120</span>  <span class="keywordflow">return</span> check;</div>
<div class="line"><span class="lineno"> 1121</span> </div>
<div class="line"><span class="lineno"> 1122</span>err:</div>
<div class="line"><span class="lineno"> 1123</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno"> 1124</span>  <a class="code hl_function" href="hcache_2hcache_8c.html#a791c8437997aca5d8747271ff4c75e98">hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno"> 1125</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1126</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno"> 1127</span>}</div>
<div class="ttc" id="ahcache_2hcache_8c_html_a5691b8a075665d48c570eb105a472556"><div class="ttname"><a href="hcache_2hcache_8c.html#a5691b8a075665d48c570eb105a472556">hcache_open</a></div><div class="ttdeci">struct HeaderCache * hcache_open(const char *path, const char *folder, hcache_namer_t namer, bool create)</div><div class="ttdoc">Multiplexor for StoreOps::open.</div><div class="ttdef"><b>Definition:</b> <a href="hcache_2hcache_8c_source.html#l00473">hcache.c:473</a></div></div>
<div class="ttc" id="ahcache_2hcache_8c_html_a791c8437997aca5d8747271ff4c75e98"><div class="ttname"><a href="hcache_2hcache_8c.html#a791c8437997aca5d8747271ff4c75e98">hcache_close</a></div><div class="ttdeci">void hcache_close(struct HeaderCache **ptr)</div><div class="ttdoc">Multiplexor for StoreOps::close.</div><div class="ttdef"><b>Definition:</b> <a href="hcache_2hcache_8c_source.html#l00544">hcache.c:544</a></div></div>
<div class="ttc" id="amh_8c_html_a18d1d5ae034020d3672a2bfb04d3ed68"><div class="ttname"><a href="mh_8c.html#a18d1d5ae034020d3672a2bfb04d3ed68">mh_update_mtime</a></div><div class="ttdeci">static void mh_update_mtime(struct Mailbox *m)</div><div class="ttdoc">Update our record of the mailbox modification time.</div><div class="ttdef"><b>Definition:</b> <a href="mh_8c_source.html#l00417">mh.c:417</a></div></div>
<div class="ttc" id="amh_8c_html_a99c7310c93b72b3d8865be13d22c9d5f"><div class="ttname"><a href="mh_8c.html#a99c7310c93b72b3d8865be13d22c9d5f">mh_check</a></div><div class="ttdeci">static enum MxStatus mh_check(struct Mailbox *m)</div><div class="ttdoc">Check for new mail.</div><div class="ttdef"><b>Definition:</b> <a href="mh_8c_source.html#l00907">mh.c:907</a></div></div>
<div class="ttc" id="amh_8c_html_a9a6412540f5b990d8f82823d537ce824"><div class="ttname"><a href="mh_8c.html#a9a6412540f5b990d8f82823d537ce824">mh_sync_mailbox_message</a></div><div class="ttdeci">int mh_sync_mailbox_message(struct Mailbox *m, struct Email *e, struct HeaderCache *hc)</div><div class="ttdoc">Save changes to the mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="mh_8c_source.html#l00726">mh.c:726</a></div></div>
<div class="ttc" id="asequence_8c_html_acb1cb62fd7fae352276a1ea321568dd8"><div class="ttname"><a href="sequence_8c.html#acb1cb62fd7fae352276a1ea321568dd8">mh_seq_update</a></div><div class="ttdeci">void mh_seq_update(struct Mailbox *m)</div><div class="ttdoc">Update sequence numbers.</div><div class="ttdef"><b>Definition:</b> <a href="sequence_8c_source.html#l00234">sequence.c:234</a></div></div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync_ga0a28d46645d6c462bb1b43c2210b3672_cgraph.svg" width="518" height="582"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ga64573e1bd7aca7ae22829562a82ae730" name="ga64573e1bd7aca7ae22829562a82ae730"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga64573e1bd7aca7ae22829562a82ae730">&#9670;&#160;</a></span>nntp_mbox_sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> nntp_mbox_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -. </p>
<dl class="section note"><dt>Note</dt><dd>May also return values from <a class="el" href="nntp_8c.html#a7976c474921669134da49b0c5fcdc8d6" title="Check current newsgroup for new articles.">check_mailbox()</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="nntp_8c_source.html#l02563">2563</a> of file <a class="el" href="nntp_8c_source.html">nntp.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2564</span>{</div>
<div class="line"><span class="lineno"> 2565</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structNntpMboxData.html">NntpMboxData</a> *<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a> = m-&gt;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>;</div>
<div class="line"><span class="lineno"> 2566</span> </div>
<div class="line"><span class="lineno"> 2567</span>  <span class="comment">/* check for new articles */</span></div>
<div class="line"><span class="lineno"> 2568</span>  <a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;adata-&gt;check_time = 0;</div>
<div class="line"><span class="lineno"> 2569</span>  <span class="keyword">enum</span> <a class="code hl_enumeration" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> check = <a class="code hl_function" href="nntp_8c.html#a7976c474921669134da49b0c5fcdc8d6">check_mailbox</a>(m);</div>
<div class="line"><span class="lineno"> 2570</span>  <span class="keywordflow">if</span> (check != <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>)</div>
<div class="line"><span class="lineno"> 2571</span>    <span class="keywordflow">return</span> check;</div>
<div class="line"><span class="lineno"> 2572</span> </div>
<div class="line"><span class="lineno"> 2573</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno"> 2574</span>  <a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;last_cached = 0;</div>
<div class="line"><span class="lineno"> 2575</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structHeaderCache.html">HeaderCache</a> *hc = <a class="code hl_function" href="newsrc_8c.html#a00132ef57a28e8ec428b6fa298ea63d4">nntp_hcache_open</a>(mdata);</div>
<div class="line"><span class="lineno"> 2576</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2577</span> </div>
<div class="line"><span class="lineno"> 2578</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno"> 2579</span>  {</div>
<div class="line"><span class="lineno"> 2580</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i];</div>
<div class="line"><span class="lineno"> 2581</span>    <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno"> 2582</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2583</span> </div>
<div class="line"><span class="lineno"> 2584</span>    <span class="keywordtype">char</span> buf[16] = { 0 };</div>
<div class="line"><span class="lineno"> 2585</span> </div>
<div class="line"><span class="lineno"> 2586</span>    snprintf(buf, <span class="keyword">sizeof</span>(buf), <a class="code hl_define" href="nntp_2lib_8h.html#a9d3ef937cceedd7b24520f69c5191d68">ANUM_FMT</a>, <a class="code hl_function" href="nntp_2edata_8c.html#a78e1fab53bc6f3d3813bcef508414349">nntp_edata_get</a>(e)-&gt;article_num);</div>
<div class="line"><span class="lineno"> 2587</span>    <span class="keywordflow">if</span> (mdata-&gt;<a class="code hl_variable" href="structNntpMboxData.html#a4a0fee3ab5b7ee9b0027505083f16790">bcache</a> &amp;&amp; e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>)</div>
<div class="line"><span class="lineno"> 2588</span>    {</div>
<div class="line"><span class="lineno"> 2589</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;mutt_bcache_del %s\n&quot;</span>, buf);</div>
<div class="line"><span class="lineno"> 2590</span>      <a class="code hl_function" href="bcache_8c.html#a81a73e04de0e74abec304abb57f9a21a">mutt_bcache_del</a>(mdata-&gt;<a class="code hl_variable" href="structNntpMboxData.html#a4a0fee3ab5b7ee9b0027505083f16790">bcache</a>, buf);</div>
<div class="line"><span class="lineno"> 2591</span>    }</div>
<div class="line"><span class="lineno"> 2592</span> </div>
<div class="line"><span class="lineno"> 2593</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno"> 2594</span>    <span class="keywordflow">if</span> (hc &amp;&amp; (e-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a> || e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>))</div>
<div class="line"><span class="lineno"> 2595</span>    {</div>
<div class="line"><span class="lineno"> 2596</span>      <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a> &amp;&amp; !e-&gt;<a class="code hl_variable" href="structEmail.html#a0bd79550be901d44e50953fb43614e10">read</a>)</div>
<div class="line"><span class="lineno"> 2597</span>        mdata-&gt;<a class="code hl_variable" href="structNntpMboxData.html#a98dfbd45b53b18796fa524f87b8ce32e">unread</a>--;</div>
<div class="line"><span class="lineno"> 2598</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;hcache_store_email %s\n&quot;</span>, buf);</div>
<div class="line"><span class="lineno"> 2599</span>      <a class="code hl_function" href="hcache_2hcache_8c.html#a9e0172956ca278dc113eefc10baef638">hcache_store_email</a>(hc, buf, strlen(buf), e, 0);</div>
<div class="line"><span class="lineno"> 2600</span>    }</div>
<div class="line"><span class="lineno"> 2601</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2602</span>  }</div>
<div class="line"><span class="lineno"> 2603</span> </div>
<div class="line"><span class="lineno"> 2604</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno"> 2605</span>  <span class="keywordflow">if</span> (hc)</div>
<div class="line"><span class="lineno"> 2606</span>  {</div>
<div class="line"><span class="lineno"> 2607</span>    <a class="code hl_function" href="hcache_2hcache_8c.html#a791c8437997aca5d8747271ff4c75e98">hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno"> 2608</span>    mdata-&gt;<a class="code hl_variable" href="structNntpMboxData.html#a2869a3060aa018d6c8e8e2b6ab6cfa21">last_cached</a> = mdata-&gt;<a class="code hl_variable" href="structNntpMboxData.html#a9cecad8ca33cea69ef91939fc3088e72">last_loaded</a>;</div>
<div class="line"><span class="lineno"> 2609</span>  }</div>
<div class="line"><span class="lineno"> 2610</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2611</span> </div>
<div class="line"><span class="lineno"> 2612</span>  <span class="comment">/* save .newsrc entries */</span></div>
<div class="line"><span class="lineno"> 2613</span>  <a class="code hl_function" href="newsrc_8c.html#a21d6dfb74310c442a524deed9579395a">nntp_newsrc_gen_entries</a>(m);</div>
<div class="line"><span class="lineno"> 2614</span>  <a class="code hl_function" href="nntp_2lib_8h.html#a6ae05e2f17614ff64c3429ac40ec5119">nntp_newsrc_update</a>(mdata-&gt;<a class="code hl_variable" href="structNntpMboxData.html#a5fe54958715f3c542698ee11e6fd6687">adata</a>);</div>
<div class="line"><span class="lineno"> 2615</span>  <a class="code hl_function" href="nntp_2lib_8h.html#a64fdec9977db62a95daa5af59d280673">nntp_newsrc_close</a>(mdata-&gt;<a class="code hl_variable" href="structNntpMboxData.html#a5fe54958715f3c542698ee11e6fd6687">adata</a>);</div>
<div class="line"><span class="lineno"> 2616</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>;</div>
<div class="line"><span class="lineno"> 2617</span>}</div>
<div class="ttc" id="abcache_8c_html_a81a73e04de0e74abec304abb57f9a21a"><div class="ttname"><a href="bcache_8c.html#a81a73e04de0e74abec304abb57f9a21a">mutt_bcache_del</a></div><div class="ttdeci">int mutt_bcache_del(struct BodyCache *bcache, const char *id)</div><div class="ttdoc">Delete a file from the Body Cache.</div><div class="ttdef"><b>Definition:</b> <a href="bcache_8c_source.html#l00269">bcache.c:269</a></div></div>
<div class="ttc" id="ahcache_2hcache_8c_html_a9e0172956ca278dc113eefc10baef638"><div class="ttname"><a href="hcache_2hcache_8c.html#a9e0172956ca278dc113eefc10baef638">hcache_store_email</a></div><div class="ttdeci">int hcache_store_email(struct HeaderCache *hc, const char *key, size_t keylen, struct Email *e, uint32_t uidvalidity)</div><div class="ttdoc">Multiplexor for StoreOps::store.</div><div class="ttdef"><b>Definition:</b> <a href="hcache_2hcache_8c_source.html#l00672">hcache.c:672</a></div></div>
<div class="ttc" id="alogging2_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdeci">@ LL_DEBUG2</div><div class="ttdoc">Log at debug level 2.</div><div class="ttdef"><b>Definition:</b> <a href="logging2_8h_source.html#l00045">logging2.h:45</a></div></div>
<div class="ttc" id="anewsrc_8c_html_a00132ef57a28e8ec428b6fa298ea63d4"><div class="ttname"><a href="newsrc_8c.html#a00132ef57a28e8ec428b6fa298ea63d4">nntp_hcache_open</a></div><div class="ttdeci">struct HeaderCache * nntp_hcache_open(struct NntpMboxData *mdata)</div><div class="ttdoc">Open newsgroup hcache.</div><div class="ttdef"><b>Definition:</b> <a href="newsrc_8c_source.html#l00707">newsrc.c:707</a></div></div>
<div class="ttc" id="anewsrc_8c_html_a21d6dfb74310c442a524deed9579395a"><div class="ttname"><a href="newsrc_8c.html#a21d6dfb74310c442a524deed9579395a">nntp_newsrc_gen_entries</a></div><div class="ttdeci">void nntp_newsrc_gen_entries(struct Mailbox *m)</div><div class="ttdoc">Generate array of .newsrc entries.</div><div class="ttdef"><b>Definition:</b> <a href="newsrc_8c_source.html#l00301">newsrc.c:301</a></div></div>
<div class="ttc" id="anntp_2edata_8c_html_a78e1fab53bc6f3d3813bcef508414349"><div class="ttname"><a href="nntp_2edata_8c.html#a78e1fab53bc6f3d3813bcef508414349">nntp_edata_get</a></div><div class="ttdeci">struct NntpEmailData * nntp_edata_get(struct Email *e)</div><div class="ttdoc">Get the private data for this Email.</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2edata_8c_source.html#l00060">edata.c:60</a></div></div>
<div class="ttc" id="anntp_2lib_8h_html_a64fdec9977db62a95daa5af59d280673"><div class="ttname"><a href="nntp_2lib_8h.html#a64fdec9977db62a95daa5af59d280673">nntp_newsrc_close</a></div><div class="ttdeci">void nntp_newsrc_close(struct NntpAccountData *adata)</div><div class="ttdoc">Unlock and close .newsrc file.</div><div class="ttdef"><b>Definition:</b> <a href="newsrc_8c_source.html#l00120">newsrc.c:120</a></div></div>
<div class="ttc" id="anntp_2lib_8h_html_a6ae05e2f17614ff64c3429ac40ec5119"><div class="ttname"><a href="nntp_2lib_8h.html#a6ae05e2f17614ff64c3429ac40ec5119">nntp_newsrc_update</a></div><div class="ttdeci">int nntp_newsrc_update(struct NntpAccountData *adata)</div><div class="ttdoc">Update .newsrc file.</div><div class="ttdef"><b>Definition:</b> <a href="newsrc_8c_source.html#l00443">newsrc.c:443</a></div></div>
<div class="ttc" id="anntp_2lib_8h_html_a9d3ef937cceedd7b24520f69c5191d68"><div class="ttname"><a href="nntp_2lib_8h.html#a9d3ef937cceedd7b24520f69c5191d68">ANUM_FMT</a></div><div class="ttdeci">#define ANUM_FMT</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2lib_8h_source.html#l00062">lib.h:62</a></div></div>
<div class="ttc" id="anntp_8c_html_a7976c474921669134da49b0c5fcdc8d6"><div class="ttname"><a href="nntp_8c.html#a7976c474921669134da49b0c5fcdc8d6">check_mailbox</a></div><div class="ttdeci">static enum MxStatus check_mailbox(struct Mailbox *m)</div><div class="ttdoc">Check current newsgroup for new articles.</div><div class="ttdef"><b>Definition:</b> <a href="nntp_8c_source.html#l01490">nntp.c:1490</a></div></div>
<div class="ttc" id="astructEmail_html_a0bd79550be901d44e50953fb43614e10"><div class="ttname"><a href="structEmail.html#a0bd79550be901d44e50953fb43614e10">Email::read</a></div><div class="ttdeci">bool read</div><div class="ttdoc">Email is read.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00050">email.h:50</a></div></div>
<div class="ttc" id="astructMailbox_html_a69b544c5c748ab3046dcc6e61a41f595"><div class="ttname"><a href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">Mailbox::mdata</a></div><div class="ttdeci">void * mdata</div><div class="ttdoc">Driver specific data.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00132">mailbox.h:132</a></div></div>
<div class="ttc" id="astructNntpMboxData_html"><div class="ttname"><a href="structNntpMboxData.html">NntpMboxData</a></div><div class="ttdoc">NNTP-specific Mailbox data -.</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2mdata_8h_source.html#l00033">mdata.h:34</a></div></div>
<div class="ttc" id="astructNntpMboxData_html_a2869a3060aa018d6c8e8e2b6ab6cfa21"><div class="ttname"><a href="structNntpMboxData.html#a2869a3060aa018d6c8e8e2b6ab6cfa21">NntpMboxData::last_cached</a></div><div class="ttdeci">anum_t last_cached</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2mdata_8h_source.html#l00040">mdata.h:40</a></div></div>
<div class="ttc" id="astructNntpMboxData_html_a4a0fee3ab5b7ee9b0027505083f16790"><div class="ttname"><a href="structNntpMboxData.html#a4a0fee3ab5b7ee9b0027505083f16790">NntpMboxData::bcache</a></div><div class="ttdeci">struct BodyCache * bcache</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2mdata_8h_source.html#l00050">mdata.h:50</a></div></div>
<div class="ttc" id="astructNntpMboxData_html_a5fe54958715f3c542698ee11e6fd6687"><div class="ttname"><a href="structNntpMboxData.html#a5fe54958715f3c542698ee11e6fd6687">NntpMboxData::adata</a></div><div class="ttdeci">struct NntpAccountData * adata</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2mdata_8h_source.html#l00048">mdata.h:48</a></div></div>
<div class="ttc" id="astructNntpMboxData_html_a98dfbd45b53b18796fa524f87b8ce32e"><div class="ttname"><a href="structNntpMboxData.html#a98dfbd45b53b18796fa524f87b8ce32e">NntpMboxData::unread</a></div><div class="ttdeci">anum_t unread</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2mdata_8h_source.html#l00041">mdata.h:41</a></div></div>
<div class="ttc" id="astructNntpMboxData_html_a9cecad8ca33cea69ef91939fc3088e72"><div class="ttname"><a href="structNntpMboxData.html#a9cecad8ca33cea69ef91939fc3088e72">NntpMboxData::last_loaded</a></div><div class="ttdeci">anum_t last_loaded</div><div class="ttdef"><b>Definition:</b> <a href="nntp_2mdata_8h_source.html#l00039">mdata.h:39</a></div></div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync_ga64573e1bd7aca7ae22829562a82ae730_cgraph.svg" width="550" height="432"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="gaf34af0a876b8063034f021754bf66886" name="gaf34af0a876b8063034f021754bf66886"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf34af0a876b8063034f021754bf66886">&#9670;&#160;</a></span>nm_mbox_sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> nm_mbox_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -. </p>

<p class="definition">Definition at line <a class="el" href="notmuch_8c_source.html#l02253">2253</a> of file <a class="el" href="notmuch_8c_source.html">notmuch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2254</span>{</div>
<div class="line"><span class="lineno"> 2255</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structNmMboxData.html">NmMboxData</a> *<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a> = <a class="code hl_function" href="notmuch_2mdata_8c.html#a8906852e9cd707fc4e4fb61a264799dc">nm_mdata_get</a>(m);</div>
<div class="line"><span class="lineno"> 2256</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>)</div>
<div class="line"><span class="lineno"> 2257</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno"> 2258</span> </div>
<div class="line"><span class="lineno"> 2259</span>  <span class="keyword">enum</span> <a class="code hl_enumeration" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> rc = <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>;</div>
<div class="line"><span class="lineno"> 2260</span>  <span class="keyword">struct </span>Progress *progress = NULL;</div>
<div class="line"><span class="lineno"> 2261</span>  <span class="keywordtype">char</span> *url = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(<a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno"> 2262</span>  <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2263</span> </div>
<div class="line"><span class="lineno"> 2264</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;nm: sync start\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 2265</span> </div>
<div class="line"><span class="lineno"> 2266</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno"> 2267</span>  {</div>
<div class="line"><span class="lineno"> 2268</span>    <span class="comment">/* all is in this function so we don&#39;t use data-&gt;progress here */</span></div>
<div class="line"><span class="lineno"> 2269</span>    progress = <a class="code hl_function" href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a>(<a class="code hl_enumvalue" href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75ae89b45d8e4dad79ccfd4fc6df66c6bfe">MUTT_PROGRESS_WRITE</a>, m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>);</div>
<div class="line"><span class="lineno"> 2270</span>    <a class="code hl_function" href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a>(progress, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Writing %s...&quot;</span>), <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno"> 2271</span>  }</div>
<div class="line"><span class="lineno"> 2272</span> </div>
<div class="line"><span class="lineno"> 2273</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structHeaderCache.html">HeaderCache</a> *hc = <a class="code hl_function" href="notmuch_8c.html#a99bcf8d4cf20029c6285d28d681efe00">nm_hcache_open</a>(m);</div>
<div class="line"><span class="lineno"> 2274</span> </div>
<div class="line"><span class="lineno"> 2275</span>  <span class="keywordtype">int</span> mh_sync_errors = 0;</div>
<div class="line"><span class="lineno"> 2276</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno"> 2277</span>  {</div>
<div class="line"><span class="lineno"> 2278</span>    <span class="keywordtype">char</span> old_file[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>], new_file[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 2279</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i];</div>
<div class="line"><span class="lineno"> 2280</span>    <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno"> 2281</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2282</span> </div>
<div class="line"><span class="lineno"> 2283</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structNmEmailData.html">NmEmailData</a> *<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a> = <a class="code hl_function" href="notmuch_2edata_8c.html#a6f1508526644c430c650ac2678590635">nm_edata_get</a>(e);</div>
<div class="line"><span class="lineno"> 2284</span> </div>
<div class="line"><span class="lineno"> 2285</span>    <a class="code hl_function" href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a>(progress, i, -1);</div>
<div class="line"><span class="lineno"> 2286</span> </div>
<div class="line"><span class="lineno"> 2287</span>    *old_file = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 2288</span>    *new_file = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 2289</span> </div>
<div class="line"><span class="lineno"> 2290</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;oldpath)</div>
<div class="line"><span class="lineno"> 2291</span>    {</div>
<div class="line"><span class="lineno"> 2292</span>      <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(old_file, <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;oldpath, <span class="keyword">sizeof</span>(old_file));</div>
<div class="line"><span class="lineno"> 2293</span>      old_file[<span class="keyword">sizeof</span>(old_file) - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 2294</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;nm: fixing obsolete path &#39;%s&#39;\n&quot;</span>, old_file);</div>
<div class="line"><span class="lineno"> 2295</span>    }</div>
<div class="line"><span class="lineno"> 2296</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2297</span>    {</div>
<div class="line"><span class="lineno"> 2298</span>      <a class="code hl_function" href="notmuch_8c.html#a286bd4e8384ba50b8a064d17ba211e12">email_get_fullpath</a>(e, old_file, <span class="keyword">sizeof</span>(old_file));</div>
<div class="line"><span class="lineno"> 2299</span>    }</div>
<div class="line"><span class="lineno"> 2300</span> </div>
<div class="line"><span class="lineno"> 2301</span>    <a class="code hl_function" href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a>(&amp;m-&gt;<a class="code hl_variable" href="structMailbox.html#aa44c1232018ddd1953039aa857b23ab5">pathbuf</a>, <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;folder);</div>
<div class="line"><span class="lineno"> 2302</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> = <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;type;</div>
<div class="line"><span class="lineno"> 2303</span> </div>
<div class="line"><span class="lineno"> 2304</span>    <span class="keywordtype">bool</span> ok = <a class="code hl_function" href="maildir_2message_8c.html#aaab54af8091d9fc9b1d034295e5d2331">maildir_sync_mailbox_message</a>(m, e, hc);</div>
<div class="line"><span class="lineno"> 2305</span>    <span class="keywordflow">if</span> (!ok)</div>
<div class="line"><span class="lineno"> 2306</span>    {</div>
<div class="line"><span class="lineno"> 2307</span>      <span class="comment">// Syncing file failed, query notmuch for new filepath.</span></div>
<div class="line"><span class="lineno"> 2308</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> = <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da05c2d20da557ac5b2c45a349eec1fba6">MUTT_NOTMUCH</a>;</div>
<div class="line"><span class="lineno"> 2309</span>      notmuch_database_t *db = <a class="code hl_function" href="notmuch_2db_8c.html#a19b35f35a4315f940b355e3b6f776846">nm_db_get</a>(m, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 2310</span>      <span class="keywordflow">if</span> (db)</div>
<div class="line"><span class="lineno"> 2311</span>      {</div>
<div class="line"><span class="lineno"> 2312</span>        notmuch_message_t *msg = <a class="code hl_function" href="notmuch_8c.html#a5ea2e0203ec9a6bf6c9d346d7178c9da">get_nm_message</a>(db, e);</div>
<div class="line"><span class="lineno"> 2313</span> </div>
<div class="line"><span class="lineno"> 2314</span>        <a class="code hl_function" href="notmuch_8c.html#a5d9e6d209beb0f018e50e865a7b53c44">sync_email_path_with_nm</a>(e, msg);</div>
<div class="line"><span class="lineno"> 2315</span> </div>
<div class="line"><span class="lineno"> 2316</span>        <a class="code hl_function" href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a>(&amp;m-&gt;<a class="code hl_variable" href="structMailbox.html#aa44c1232018ddd1953039aa857b23ab5">pathbuf</a>, <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;folder);</div>
<div class="line"><span class="lineno"> 2317</span>        m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> = <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;type;</div>
<div class="line"><span class="lineno"> 2318</span>        ok = <a class="code hl_function" href="maildir_2message_8c.html#aaab54af8091d9fc9b1d034295e5d2331">maildir_sync_mailbox_message</a>(m, e, hc);</div>
<div class="line"><span class="lineno"> 2319</span>        m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> = <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da05c2d20da557ac5b2c45a349eec1fba6">MUTT_NOTMUCH</a>;</div>
<div class="line"><span class="lineno"> 2320</span>      }</div>
<div class="line"><span class="lineno"> 2321</span>      <a class="code hl_function" href="notmuch_2db_8c.html#ab42f2a23cdaa9f6c5653fa7e9f9a8911">nm_db_release</a>(m);</div>
<div class="line"><span class="lineno"> 2322</span>      m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> = <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;type;</div>
<div class="line"><span class="lineno"> 2323</span>    }</div>
<div class="line"><span class="lineno"> 2324</span> </div>
<div class="line"><span class="lineno"> 2325</span>    <a class="code hl_function" href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a>(&amp;m-&gt;<a class="code hl_variable" href="structMailbox.html#aa44c1232018ddd1953039aa857b23ab5">pathbuf</a>, url);</div>
<div class="line"><span class="lineno"> 2326</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> = <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da05c2d20da557ac5b2c45a349eec1fba6">MUTT_NOTMUCH</a>;</div>
<div class="line"><span class="lineno"> 2327</span> </div>
<div class="line"><span class="lineno"> 2328</span>    <span class="keywordflow">if</span> (!ok)</div>
<div class="line"><span class="lineno"> 2329</span>    {</div>
<div class="line"><span class="lineno"> 2330</span>      mh_sync_errors += 1;</div>
<div class="line"><span class="lineno"> 2331</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 2332</span>    }</div>
<div class="line"><span class="lineno"> 2333</span> </div>
<div class="line"><span class="lineno"> 2334</span>    <span class="keywordflow">if</span> (!e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>)</div>
<div class="line"><span class="lineno"> 2335</span>      <a class="code hl_function" href="notmuch_8c.html#a286bd4e8384ba50b8a064d17ba211e12">email_get_fullpath</a>(e, new_file, <span class="keyword">sizeof</span>(new_file));</div>
<div class="line"><span class="lineno"> 2336</span> </div>
<div class="line"><span class="lineno"> 2337</span>    <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a> || !<a class="code hl_function" href="mutt_2string_8c.html#a6b6a50296dd2a31863a43379ef4a343d">mutt_str_equal</a>(old_file, new_file))</div>
<div class="line"><span class="lineno"> 2338</span>    {</div>
<div class="line"><span class="lineno"> 2339</span>      <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a> &amp;&amp; (<a class="code hl_function" href="notmuch_8c.html#adc3bd6b21e3f137f3bb6a9b90b39be38">remove_filename</a>(m, old_file) == 0))</div>
<div class="line"><span class="lineno"> 2340</span>        <a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2341</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*new_file &amp;&amp; *old_file &amp;&amp; (<a class="code hl_function" href="notmuch_8c.html#a9007300d0a2336c11035d0d34f9458aa">rename_filename</a>(m, old_file, new_file, e) == 0))</div>
<div class="line"><span class="lineno"> 2342</span>        <a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2343</span>    }</div>
<div class="line"><span class="lineno"> 2344</span> </div>
<div class="line"><span class="lineno"> 2345</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;oldpath);</div>
<div class="line"><span class="lineno"> 2346</span>  }</div>
<div class="line"><span class="lineno"> 2347</span> </div>
<div class="line"><span class="lineno"> 2348</span>  <span class="keywordflow">if</span> (mh_sync_errors &gt; 0)</div>
<div class="line"><span class="lineno"> 2349</span>  {</div>
<div class="line"><span class="lineno"> 2350</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(ngettext(<span class="stringliteral">&quot;Unable to sync %d message due to external mailbox modification&quot;</span>,</div>
<div class="line"><span class="lineno"> 2351</span>                        <span class="stringliteral">&quot;Unable to sync %d messages due to external mailbox modification&quot;</span>,</div>
<div class="line"><span class="lineno"> 2352</span>                        mh_sync_errors),</div>
<div class="line"><span class="lineno"> 2353</span>               mh_sync_errors);</div>
<div class="line"><span class="lineno"> 2354</span>  }</div>
<div class="line"><span class="lineno"> 2355</span> </div>
<div class="line"><span class="lineno"> 2356</span>  <a class="code hl_function" href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a>(&amp;m-&gt;<a class="code hl_variable" href="structMailbox.html#aa44c1232018ddd1953039aa857b23ab5">pathbuf</a>, url);</div>
<div class="line"><span class="lineno"> 2357</span>  m-&gt;<a class="code hl_variable" href="structMailbox.html#a5638329fb2ebd4bbe1f4a949ec8de174">type</a> = <a class="code hl_enumvalue" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da05c2d20da557ac5b2c45a349eec1fba6">MUTT_NOTMUCH</a>;</div>
<div class="line"><span class="lineno"> 2358</span> </div>
<div class="line"><span class="lineno"> 2359</span>  <a class="code hl_function" href="notmuch_2db_8c.html#ab42f2a23cdaa9f6c5653fa7e9f9a8911">nm_db_release</a>(m);</div>
<div class="line"><span class="lineno"> 2360</span> </div>
<div class="line"><span class="lineno"> 2361</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a>)</div>
<div class="line"><span class="lineno"> 2362</span>  {</div>
<div class="line"><span class="lineno"> 2363</span>    mdata-&gt;<a class="code hl_variable" href="structNmMboxData.html#a4f64263b206f43a6bf79de732b95b1a0">mtime</a>.tv_sec = <a class="code hl_function" href="mutt_2date_8c.html#ad1e6304a91c7b6f3c266a9b17c1740fe">mutt_date_now</a>();</div>
<div class="line"><span class="lineno"> 2364</span>    mdata-&gt;<a class="code hl_variable" href="structNmMboxData.html#a4f64263b206f43a6bf79de732b95b1a0">mtime</a>.tv_nsec = 0;</div>
<div class="line"><span class="lineno"> 2365</span>  }</div>
<div class="line"><span class="lineno"> 2366</span> </div>
<div class="line"><span class="lineno"> 2367</span>  <a class="code hl_function" href="notmuch_8c.html#aea09d673b9d50ceb497435f800bb4075">nm_hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno"> 2368</span> </div>
<div class="line"><span class="lineno"> 2369</span>  <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno"> 2370</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;url);</div>
<div class="line"><span class="lineno"> 2371</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;nm: .... sync done [rc=%d]\n&quot;</span>, rc);</div>
<div class="line"><span class="lineno"> 2372</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno"> 2373</span>}</div>
<div class="ttc" id="abuffer_8c_html_ac958acbd189e463a2c3bbc2f23aaeb1e"><div class="ttname"><a href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a></div><div class="ttdeci">size_t buf_strcpy(struct Buffer *buf, const char *s)</div><div class="ttdoc">Copy a string into a Buffer.</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00395">buffer.c:395</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_af65addf714c28dd5d483cb426100921da05c2d20da557ac5b2c45a349eec1fba6"><div class="ttname"><a href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921da05c2d20da557ac5b2c45a349eec1fba6">MUTT_NOTMUCH</a></div><div class="ttdeci">@ MUTT_NOTMUCH</div><div class="ttdoc">'Notmuch' (virtual) Mailbox type</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00051">mailbox.h:51</a></div></div>
<div class="ttc" id="amutt_2date_8c_html_ad1e6304a91c7b6f3c266a9b17c1740fe"><div class="ttname"><a href="mutt_2date_8c.html#ad1e6304a91c7b6f3c266a9b17c1740fe">mutt_date_now</a></div><div class="ttdeci">time_t mutt_date_now(void)</div><div class="ttdoc">Return the number of seconds since the Unix epoch.</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2date_8c_source.html#l00456">date.c:456</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a3fe33d90e4814281cd57de048119c950"><div class="ttname"><a href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a></div><div class="ttdeci">char * mutt_str_dup(const char *str)</div><div class="ttdoc">Copy a string, safely.</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00255">string.c:255</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_ad20e00309de897a1e882fc7400335b83"><div class="ttname"><a href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a></div><div class="ttdeci">size_t mutt_str_copy(char *dest, const char *src, size_t dsize)</div><div class="ttdoc">Copy a string into a buffer (guaranteeing NUL-termination)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00581">string.c:581</a></div></div>
<div class="ttc" id="amutt_8h_html_ae688d728e1acdfe5988c7db45d6f0166"><div class="ttname"><a href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a></div><div class="ttdeci">#define PATH_MAX</div><div class="ttdef"><b>Definition:</b> <a href="mutt_8h_source.html#l00042">mutt.h:42</a></div></div>
<div class="ttc" id="anotmuch_2db_8c_html_a19b35f35a4315f940b355e3b6f776846"><div class="ttname"><a href="notmuch_2db_8c.html#a19b35f35a4315f940b355e3b6f776846">nm_db_get</a></div><div class="ttdeci">notmuch_database_t * nm_db_get(struct Mailbox *m, bool writable)</div><div class="ttdoc">Get the Notmuch database.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_2db_8c_source.html#l00209">db.c:209</a></div></div>
<div class="ttc" id="anotmuch_2db_8c_html_ab42f2a23cdaa9f6c5653fa7e9f9a8911"><div class="ttname"><a href="notmuch_2db_8c.html#ab42f2a23cdaa9f6c5653fa7e9f9a8911">nm_db_release</a></div><div class="ttdeci">int nm_db_release(struct Mailbox *m)</div><div class="ttdoc">Close the Notmuch database.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_2db_8c_source.html#l00233">db.c:233</a></div></div>
<div class="ttc" id="anotmuch_2edata_8c_html_a6f1508526644c430c650ac2678590635"><div class="ttname"><a href="notmuch_2edata_8c.html#a6f1508526644c430c650ac2678590635">nm_edata_get</a></div><div class="ttdeci">struct NmEmailData * nm_edata_get(struct Email *e)</div><div class="ttdoc">Get the Notmuch Email data.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_2edata_8c_source.html#l00072">edata.c:72</a></div></div>
<div class="ttc" id="anotmuch_2mdata_8c_html_a8906852e9cd707fc4e4fb61a264799dc"><div class="ttname"><a href="notmuch_2mdata_8c.html#a8906852e9cd707fc4e4fb61a264799dc">nm_mdata_get</a></div><div class="ttdeci">struct NmMboxData * nm_mdata_get(struct Mailbox *m)</div><div class="ttdoc">Get the Notmuch Mailbox data.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_2mdata_8c_source.html#l00096">mdata.c:96</a></div></div>
<div class="ttc" id="anotmuch_8c_html_a286bd4e8384ba50b8a064d17ba211e12"><div class="ttname"><a href="notmuch_8c.html#a286bd4e8384ba50b8a064d17ba211e12">email_get_fullpath</a></div><div class="ttdeci">static char * email_get_fullpath(struct Email *e, char *buf, size_t buflen)</div><div class="ttdoc">Get the full path of an email.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_8c_source.html#l00238">notmuch.c:238</a></div></div>
<div class="ttc" id="anotmuch_8c_html_a5d9e6d209beb0f018e50e865a7b53c44"><div class="ttname"><a href="notmuch_8c.html#a5d9e6d209beb0f018e50e865a7b53c44">sync_email_path_with_nm</a></div><div class="ttdeci">static void sync_email_path_with_nm(struct Email *e, notmuch_message_t *msg)</div><div class="ttdoc">Synchronize Neomutt's Email path with notmuch.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_8c_source.html#l01110">notmuch.c:1110</a></div></div>
<div class="ttc" id="anotmuch_8c_html_a5ea2e0203ec9a6bf6c9d346d7178c9da"><div class="ttname"><a href="notmuch_8c.html#a5ea2e0203ec9a6bf6c9d346d7178c9da">get_nm_message</a></div><div class="ttdeci">static notmuch_message_t * get_nm_message(notmuch_database_t *db, struct Email *e)</div><div class="ttdoc">Find a Notmuch message.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_8c_source.html#l01069">notmuch.c:1069</a></div></div>
<div class="ttc" id="anotmuch_8c_html_a9007300d0a2336c11035d0d34f9458aa"><div class="ttname"><a href="notmuch_8c.html#a9007300d0a2336c11035d0d34f9458aa">rename_filename</a></div><div class="ttdeci">static int rename_filename(struct Mailbox *m, const char *old_file, const char *new_file, struct Email *e)</div><div class="ttdoc">Rename the file.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_8c_source.html#l01353">notmuch.c:1353</a></div></div>
<div class="ttc" id="anotmuch_8c_html_a99bcf8d4cf20029c6285d28d681efe00"><div class="ttname"><a href="notmuch_8c.html#a99bcf8d4cf20029c6285d28d681efe00">nm_hcache_open</a></div><div class="ttdeci">static struct HeaderCache * nm_hcache_open(struct Mailbox *m)</div><div class="ttdoc">Open a header cache.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_8c_source.html#l00119">notmuch.c:119</a></div></div>
<div class="ttc" id="anotmuch_8c_html_adc3bd6b21e3f137f3bb6a9b90b39be38"><div class="ttname"><a href="notmuch_8c.html#adc3bd6b21e3f137f3bb6a9b90b39be38">remove_filename</a></div><div class="ttdeci">static int remove_filename(struct Mailbox *m, const char *path)</div><div class="ttdoc">Delete a file.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_8c_source.html#l01289">notmuch.c:1289</a></div></div>
<div class="ttc" id="anotmuch_8c_html_aea09d673b9d50ceb497435f800bb4075"><div class="ttname"><a href="notmuch_8c.html#aea09d673b9d50ceb497435f800bb4075">nm_hcache_close</a></div><div class="ttdeci">static void nm_hcache_close(struct HeaderCache **ptr)</div><div class="ttdoc">Close the header cache.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_8c_source.html#l00133">notmuch.c:133</a></div></div>
<div class="ttc" id="astructEmail_html_a50d8a8dde5fbf0b6dba934ff7e07fb6b"><div class="ttname"><a href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">Email::edata</a></div><div class="ttdeci">void * edata</div><div class="ttdoc">Driver-specific data.</div><div class="ttdef"><b>Definition:</b> <a href="email_8h_source.html#l00074">email.h:74</a></div></div>
<div class="ttc" id="astructMailbox_html_aa44c1232018ddd1953039aa857b23ab5"><div class="ttname"><a href="structMailbox.html#aa44c1232018ddd1953039aa857b23ab5">Mailbox::pathbuf</a></div><div class="ttdeci">struct Buffer pathbuf</div><div class="ttdoc">Path of the Mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="core_2mailbox_8h_source.html#l00080">mailbox.h:80</a></div></div>
<div class="ttc" id="astructNmEmailData_html"><div class="ttname"><a href="structNmEmailData.html">NmEmailData</a></div><div class="ttdoc">Notmuch-specific Email data -.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_2edata_8h_source.html#l00033">edata.h:34</a></div></div>
<div class="ttc" id="astructNmMboxData_html"><div class="ttname"><a href="structNmMboxData.html">NmMboxData</a></div><div class="ttdoc">Notmuch-specific Mailbox data -.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_2mdata_8h_source.html#l00034">mdata.h:35</a></div></div>
<div class="ttc" id="astructNmMboxData_html_a4f64263b206f43a6bf79de732b95b1a0"><div class="ttname"><a href="structNmMboxData.html#a4f64263b206f43a6bf79de732b95b1a0">NmMboxData::mtime</a></div><div class="ttdeci">struct timespec mtime</div><div class="ttdoc">Time Mailbox was last changed.</div><div class="ttdef"><b>Definition:</b> <a href="notmuch_2mdata_8h_source.html#l00044">mdata.h:44</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync_gaf34af0a876b8063034f021754bf66886_cgraph.svg" width="538" height="1100"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="gaf4f176edf88cdbf7c4ded57e9838f008" name="gaf4f176edf88cdbf7c4ded57e9838f008"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf4f176edf88cdbf7c4ded57e9838f008">&#9670;&#160;</a></span>pop_mbox_sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> pop_mbox_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -. </p>
<p>Update POP mailbox, delete messages from server </p>

<p class="definition">Definition at line <a class="el" href="pop_8c_source.html#l00859">859</a> of file <a class="el" href="pop_8c_source.html">pop.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  860</span>{</div>
<div class="line"><span class="lineno">  861</span>  <span class="keywordtype">int</span> i, j, rc = 0;</div>
<div class="line"><span class="lineno">  862</span>  <span class="keywordtype">char</span> buf[1024] = { 0 };</div>
<div class="line"><span class="lineno">  863</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structPopAccountData.html">PopAccountData</a> *<a class="code hl_variable" href="structAccount.html#ad10abe32dcee204d654a3cd350d8cd8e">adata</a> = <a class="code hl_function" href="pop_2adata_8c.html#a4471b5a6fcc25d086f1ff563370297f4">pop_adata_get</a>(m);</div>
<div class="line"><span class="lineno">  864</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  865</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structHeaderCache.html">HeaderCache</a> *hc = NULL;</div>
<div class="line"><span class="lineno">  866</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  867</span> </div>
<div class="line"><span class="lineno">  868</span>  adata-&gt;<a class="code hl_variable" href="structPopAccountData.html#a7d3b3740a49e6a24a9b89dce7c140df2">check_time</a> = 0;</div>
<div class="line"><span class="lineno">  869</span> </div>
<div class="line"><span class="lineno">  870</span>  <span class="keywordtype">int</span> num_deleted = 0;</div>
<div class="line"><span class="lineno">  871</span>  <span class="keywordflow">for</span> (i = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno">  872</span>  {</div>
<div class="line"><span class="lineno">  873</span>    <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>)</div>
<div class="line"><span class="lineno">  874</span>      num_deleted++;</div>
<div class="line"><span class="lineno">  875</span>  }</div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span>  <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><span class="lineno">  878</span>  {</div>
<div class="line"><span class="lineno">  879</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="pop_2lib_8c.html#af75fadb2503181ccec226915d3e1984f">pop_reconnect</a>(m) &lt; 0)</div>
<div class="line"><span class="lineno">  880</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  881</span> </div>
<div class="line"><span class="lineno">  882</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  883</span>    hc = <a class="code hl_function" href="pop_8c.html#aa0a6ddc22898d702a5ea50cb2f16bb11">pop_hcache_open</a>(adata, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  884</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  885</span> </div>
<div class="line"><span class="lineno">  886</span>    <span class="keyword">struct </span>Progress *progress = NULL;</div>
<div class="line"><span class="lineno">  887</span>    <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno">  888</span>    {</div>
<div class="line"><span class="lineno">  889</span>      progress = <a class="code hl_function" href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a>(<a class="code hl_enumvalue" href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75ae89b45d8e4dad79ccfd4fc6df66c6bfe">MUTT_PROGRESS_WRITE</a>, num_deleted);</div>
<div class="line"><span class="lineno">  890</span>      <a class="code hl_function" href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a>(progress, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Marking messages deleted...&quot;</span>));</div>
<div class="line"><span class="lineno">  891</span>    }</div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>    <span class="keywordflow">for</span> (i = 0, j = 0, rc = 0; (rc == 0) &amp;&amp; (i &lt; m-&gt;msg_count); i++)</div>
<div class="line"><span class="lineno">  894</span>    {</div>
<div class="line"><span class="lineno">  895</span>      <span class="keyword">struct </span><a class="code hl_struct" href="structPopEmailData.html">PopEmailData</a> *<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a> = <a class="code hl_function" href="pop_2edata_8c.html#ad4dcf65aac92ae7178a31e362bf62166">pop_edata_get</a>(m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]);</div>
<div class="line"><span class="lineno">  896</span>      <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a> &amp;&amp; (<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;refno != -1))</div>
<div class="line"><span class="lineno">  897</span>      {</div>
<div class="line"><span class="lineno">  898</span>        j++;</div>
<div class="line"><span class="lineno">  899</span>        <a class="code hl_function" href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a>(progress, j, -1);</div>
<div class="line"><span class="lineno">  900</span>        snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;DELE %d\r\n&quot;</span>, <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;refno);</div>
<div class="line"><span class="lineno">  901</span>        rc = <a class="code hl_define" href="pop_2private_8h.html#a517e9120e2ec9d86ea2f93dd10696e4f">pop_query</a>(adata, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  902</span>        <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  903</span>        {</div>
<div class="line"><span class="lineno">  904</span>          <a class="code hl_function" href="bcache_8c.html#a81a73e04de0e74abec304abb57f9a21a">mutt_bcache_del</a>(adata-&gt;<a class="code hl_variable" href="structPopAccountData.html#ad54e1437730d092d35f53d7c4aba6e5a">bcache</a>, <a class="code hl_function" href="pop_8c.html#a8028dffa5685f875d203a82270d9dcc0">cache_id</a>(<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;uid));</div>
<div class="line"><span class="lineno">  905</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  906</span>          <a class="code hl_function" href="hcache_2hcache_8c.html#a66e48b640205127c7a4bb987b8d0192d">hcache_delete_email</a>(hc, <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;uid, strlen(<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;uid));</div>
<div class="line"><span class="lineno">  907</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  908</span>        }</div>
<div class="line"><span class="lineno">  909</span>      }</div>
<div class="line"><span class="lineno">  910</span> </div>
<div class="line"><span class="lineno">  911</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  912</span>      <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i]-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a>)</div>
<div class="line"><span class="lineno">  913</span>      {</div>
<div class="line"><span class="lineno">  914</span>        <a class="code hl_function" href="hcache_2hcache_8c.html#a9e0172956ca278dc113eefc10baef638">hcache_store_email</a>(hc, <a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;uid, strlen(<a class="code hl_variable" href="structEmail.html#a50d8a8dde5fbf0b6dba934ff7e07fb6b">edata</a>-&gt;uid), m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i], 0);</div>
<div class="line"><span class="lineno">  915</span>      }</div>
<div class="line"><span class="lineno">  916</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  917</span>    }</div>
<div class="line"><span class="lineno">  918</span>    <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno">  919</span> </div>
<div class="line"><span class="lineno">  920</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  921</span>    <a class="code hl_function" href="hcache_2hcache_8c.html#a791c8437997aca5d8747271ff4c75e98">hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno">  922</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  923</span> </div>
<div class="line"><span class="lineno">  924</span>    <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  925</span>    {</div>
<div class="line"><span class="lineno">  926</span>      <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(buf, <span class="stringliteral">&quot;QUIT\r\n&quot;</span>, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  927</span>      rc = <a class="code hl_define" href="pop_2private_8h.html#a517e9120e2ec9d86ea2f93dd10696e4f">pop_query</a>(adata, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  928</span>    }</div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>    <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  931</span>    {</div>
<div class="line"><span class="lineno">  932</span>      adata-&gt;<a class="code hl_variable" href="structPopAccountData.html#a4b1f71d4fefd265f465f0cbadcf237b8">clear_cache</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  933</span>      <a class="code hl_function" href="pop_8c.html#a306deeb158f76bd338f04b1a5494d6a9">pop_clear_cache</a>(adata);</div>
<div class="line"><span class="lineno">  934</span>      adata-&gt;<a class="code hl_variable" href="structPopAccountData.html#a9a44d4bc626dbc9fbb085cff6e0b790c">status</a> = <a class="code hl_enumvalue" href="pop_2private_8h.html#abf5ce360d246b1f6d637d953c182ea39a05f59c3c4b782d93659d94ca5df16b7d">POP_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno">  935</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>;</div>
<div class="line"><span class="lineno">  936</span>    }</div>
<div class="line"><span class="lineno">  937</span> </div>
<div class="line"><span class="lineno">  938</span>    <span class="keywordflow">if</span> (rc == -2)</div>
<div class="line"><span class="lineno">  939</span>    {</div>
<div class="line"><span class="lineno">  940</span>      <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<span class="stringliteral">&quot;%s&quot;</span>, adata-&gt;<a class="code hl_variable" href="structPopAccountData.html#a84cf659582c28abdd77d78e74257143f">err_msg</a>);</div>
<div class="line"><span class="lineno">  941</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  942</span>    }</div>
<div class="line"><span class="lineno">  943</span>  }</div>
<div class="line"><span class="lineno">  944</span>}</div>
<div class="ttc" id="ahcache_2hcache_8c_html_a66e48b640205127c7a4bb987b8d0192d"><div class="ttname"><a href="hcache_2hcache_8c.html#a66e48b640205127c7a4bb987b8d0192d">hcache_delete_email</a></div><div class="ttdeci">int hcache_delete_email(struct HeaderCache *hc, const char *key, size_t keylen)</div><div class="ttdoc">Multiplexor for StoreOps::delete_record.</div><div class="ttdef"><b>Definition:</b> <a href="hcache_2hcache_8c_source.html#l00741">hcache.c:741</a></div></div>
<div class="ttc" id="apop_2adata_8c_html_a4471b5a6fcc25d086f1ff563370297f4"><div class="ttname"><a href="pop_2adata_8c.html#a4471b5a6fcc25d086f1ff563370297f4">pop_adata_get</a></div><div class="ttdeci">struct PopAccountData * pop_adata_get(struct Mailbox *m)</div><div class="ttdoc">Get the Account data for this mailbox.</div><div class="ttdef"><b>Definition:</b> <a href="pop_2adata_8c_source.html#l00073">adata.c:73</a></div></div>
<div class="ttc" id="apop_2edata_8c_html_ad4dcf65aac92ae7178a31e362bf62166"><div class="ttname"><a href="pop_2edata_8c.html#ad4dcf65aac92ae7178a31e362bf62166">pop_edata_get</a></div><div class="ttdeci">struct PopEmailData * pop_edata_get(struct Email *e)</div><div class="ttdoc">Get the private data for this Email.</div><div class="ttdef"><b>Definition:</b> <a href="pop_2edata_8c_source.html#l00068">edata.c:68</a></div></div>
<div class="ttc" id="apop_2lib_8c_html_af75fadb2503181ccec226915d3e1984f"><div class="ttname"><a href="pop_2lib_8c.html#af75fadb2503181ccec226915d3e1984f">pop_reconnect</a></div><div class="ttdeci">int pop_reconnect(struct Mailbox *m)</div><div class="ttdoc">Reconnect and verify indexes if connection was lost.</div><div class="ttdef"><b>Definition:</b> <a href="pop_2lib_8c_source.html#l00608">lib.c:608</a></div></div>
<div class="ttc" id="apop_2private_8h_html_a517e9120e2ec9d86ea2f93dd10696e4f"><div class="ttname"><a href="pop_2private_8h.html#a517e9120e2ec9d86ea2f93dd10696e4f">pop_query</a></div><div class="ttdeci">#define pop_query(adata, buf, buflen)</div><div class="ttdef"><b>Definition:</b> <a href="pop_2private_8h_source.html#l00111">private.h:111</a></div></div>
<div class="ttc" id="apop_2private_8h_html_abf5ce360d246b1f6d637d953c182ea39a05f59c3c4b782d93659d94ca5df16b7d"><div class="ttname"><a href="pop_2private_8h.html#abf5ce360d246b1f6d637d953c182ea39a05f59c3c4b782d93659d94ca5df16b7d">POP_DISCONNECTED</a></div><div class="ttdeci">@ POP_DISCONNECTED</div><div class="ttdoc">Disconnected from server.</div><div class="ttdef"><b>Definition:</b> <a href="pop_2private_8h_source.html#l00051">private.h:51</a></div></div>
<div class="ttc" id="apop_8c_html_a306deeb158f76bd338f04b1a5494d6a9"><div class="ttname"><a href="pop_8c.html#a306deeb158f76bd338f04b1a5494d6a9">pop_clear_cache</a></div><div class="ttdeci">static void pop_clear_cache(struct PopAccountData *adata)</div><div class="ttdoc">Delete all cached messages.</div><div class="ttdef"><b>Definition:</b> <a href="pop_8c_source.html#l00492">pop.c:492</a></div></div>
<div class="ttc" id="apop_8c_html_a8028dffa5685f875d203a82270d9dcc0"><div class="ttname"><a href="pop_8c.html#a8028dffa5685f875d203a82270d9dcc0">cache_id</a></div><div class="ttdeci">static const char * cache_id(const char *id)</div><div class="ttdoc">Make a message-cache-compatible id.</div><div class="ttdef"><b>Definition:</b> <a href="pop_8c_source.html#l00081">pop.c:81</a></div></div>
<div class="ttc" id="apop_8c_html_aa0a6ddc22898d702a5ea50cb2f16bb11"><div class="ttname"><a href="pop_8c.html#aa0a6ddc22898d702a5ea50cb2f16bb11">pop_hcache_open</a></div><div class="ttdeci">static struct HeaderCache * pop_hcache_open(struct PopAccountData *adata, const char *path)</div><div class="ttdoc">Open the header cache.</div><div class="ttdef"><b>Definition:</b> <a href="pop_8c_source.html#l00299">pop.c:299</a></div></div>
<div class="ttc" id="astructPopAccountData_html"><div class="ttname"><a href="structPopAccountData.html">PopAccountData</a></div><div class="ttdoc">POP-specific Account data -.</div><div class="ttdef"><b>Definition:</b> <a href="pop_2adata_8h_source.html#l00036">adata.h:37</a></div></div>
<div class="ttc" id="astructPopAccountData_html_a4b1f71d4fefd265f465f0cbadcf237b8"><div class="ttname"><a href="structPopAccountData.html#a4b1f71d4fefd265f465f0cbadcf237b8">PopAccountData::clear_cache</a></div><div class="ttdeci">bool clear_cache</div><div class="ttdef"><b>Definition:</b> <a href="pop_2adata_8h_source.html#l00049">adata.h:49</a></div></div>
<div class="ttc" id="astructPopAccountData_html_a7d3b3740a49e6a24a9b89dce7c140df2"><div class="ttname"><a href="structPopAccountData.html#a7d3b3740a49e6a24a9b89dce7c140df2">PopAccountData::check_time</a></div><div class="ttdeci">time_t check_time</div><div class="ttdef"><b>Definition:</b> <a href="pop_2adata_8h_source.html#l00051">adata.h:51</a></div></div>
<div class="ttc" id="astructPopAccountData_html_a84cf659582c28abdd77d78e74257143f"><div class="ttname"><a href="structPopAccountData.html#a84cf659582c28abdd77d78e74257143f">PopAccountData::err_msg</a></div><div class="ttdeci">char err_msg[POP_CMD_RESPONSE]</div><div class="ttdef"><b>Definition:</b> <a href="pop_2adata_8h_source.html#l00056">adata.h:56</a></div></div>
<div class="ttc" id="astructPopAccountData_html_a9a44d4bc626dbc9fbb085cff6e0b790c"><div class="ttname"><a href="structPopAccountData.html#a9a44d4bc626dbc9fbb085cff6e0b790c">PopAccountData::status</a></div><div class="ttdeci">unsigned int status</div><div class="ttdef"><b>Definition:</b> <a href="pop_2adata_8h_source.html#l00039">adata.h:39</a></div></div>
<div class="ttc" id="astructPopAccountData_html_ad54e1437730d092d35f53d7c4aba6e5a"><div class="ttname"><a href="structPopAccountData.html#ad54e1437730d092d35f53d7c4aba6e5a">PopAccountData::bcache</a></div><div class="ttdeci">struct BodyCache * bcache</div><div class="ttdoc">body cache</div><div class="ttdef"><b>Definition:</b> <a href="pop_2adata_8h_source.html#l00055">adata.h:55</a></div></div>
<div class="ttc" id="astructPopEmailData_html"><div class="ttname"><a href="structPopEmailData.html">PopEmailData</a></div><div class="ttdoc">POP-specific Email data -.</div><div class="ttdef"><b>Definition:</b> <a href="pop_2edata_8h_source.html#l00031">edata.h:32</a></div></div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mx__mbox__sync_gaf4f176edf88cdbf7c4ded57e9838f008_cgraph.svg" width="540" height="782"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
