<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NeoMutt: mh/mh.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><a href="https://neomutt.org"><img alt="Logo" src="neomutt-64.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <a style="color: black; text-decoration: none;" href="https://neomutt.org">
   <div id="projectname">NeoMutt
   &#160;<span id="projectnumber">2025-09-05-84-g3cce42</span>
   </div>
   <div id="projectbrief">Teaching an old dog new tricks</div>
   </a>
   <a href="https://github.com/neomutt/neomutt" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000000; color:#fff; position: fixed; top: 0; border: 0; right: 0; z-index: 9999;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </td>
   <td><a style="text-decoration: none; position: absolute; right: 0; top: 25px; margin-right: 100px; color: #66d866; font-size: 400%;" href="http://www.doxygen.org/index.html">DOXYGEN</a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('mh_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">mh.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>MH local mailbox type.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;config.h&quot;</code><br />
<code>#include &lt;dirent.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;inttypes.h&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="mutt_2lib_8h_source.html">mutt/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_2lib_8h_source.html">config/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="email_2lib_8h_source.html">email/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="core_2lib_8h_source.html">core/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt_8h_source.html">mutt.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="progress_2lib_8h_source.html">progress/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="copy_8h_source.html">copy.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mh_2mdata_8h_source.html">mdata.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mhemail_8h_source.html">mhemail.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mx_8h_source.html">mx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="protos_8h_source.html">protos.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sequence_8h_source.html">sequence.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mh_2shared_8h_source.html">shared.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="monitor_8h_source.html">monitor.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hcache_2lib_8h_source.html">hcache/lib.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for mh.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c__incl.svg" width="2130" height="274"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="mh_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac355ba6e8c9b1ab7fa886e52ac6f5d4e" id="r_ac355ba6e8c9b1ab7fa886e52ac6f5d4e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac355ba6e8c9b1ab7fa886e52ac6f5d4e">mh_already_notified</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, int msgno)</td></tr>
<tr class="memdesc:ac355ba6e8c9b1ab7fa886e52ac6f5d4e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Has the message changed.  <br /></td></tr>
<tr class="separator:ac355ba6e8c9b1ab7fa886e52ac6f5d4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6223240d84e5ce2b19911dd83877cbed" id="r_a6223240d84e5ce2b19911dd83877cbed"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6223240d84e5ce2b19911dd83877cbed">mh_valid_message</a> (const char *s)</td></tr>
<tr class="memdesc:a6223240d84e5ce2b19911dd83877cbed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is this a valid MH message filename.  <br /></td></tr>
<tr class="separator:a6223240d84e5ce2b19911dd83877cbed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a255adaa00e9d3d619b5752ce0456c63b" id="r_a255adaa00e9d3d619b5752ce0456c63b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a255adaa00e9d3d619b5752ce0456c63b">mh_check_empty</a> (struct <a class="el" href="structBuffer.html">Buffer</a> *path)</td></tr>
<tr class="memdesc:a255adaa00e9d3d619b5752ce0456c63b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is mailbox empty.  <br /></td></tr>
<tr class="separator:a255adaa00e9d3d619b5752ce0456c63b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac8762d7e3dcc5f33d48603e0a083e600" id="r_gac8762d7e3dcc5f33d48603e0a083e600"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__check__stats.html#gac8762d7e3dcc5f33d48603e0a083e600">mh_mbox_check_stats</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, uint8_t flags)</td></tr>
<tr class="memdesc:gac8762d7e3dcc5f33d48603e0a083e600"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> statistics - Implements <a class="el" href="structMxOps.html#abfbc84e79f106de70ebed8e4dbccd1f6">MxOps::mbox_check_stats()</a> -.  <br /></td></tr>
<tr class="separator:gac8762d7e3dcc5f33d48603e0a083e600"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae06b4547b1aaad67848597ff451ca584" id="r_ae06b4547b1aaad67848597ff451ca584"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae06b4547b1aaad67848597ff451ca584">mh_update_emails</a> (struct MhEmailArray *mha, struct <a class="el" href="structMhSequences.html">MhSequences</a> *mhs)</td></tr>
<tr class="memdesc:ae06b4547b1aaad67848597ff451ca584"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update our record of flags.  <br /></td></tr>
<tr class="separator:ae06b4547b1aaad67848597ff451ca584"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1ea60e60bbc020f83707ee6671fd19c" id="r_ac1ea60e60bbc020f83707ee6671fd19c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac1ea60e60bbc020f83707ee6671fd19c">mh_commit_msg</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structMessage.html">Message</a> *msg, struct <a class="el" href="structEmail.html">Email</a> *e, bool updseq)</td></tr>
<tr class="memdesc:ac1ea60e60bbc020f83707ee6671fd19c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Commit a message to an MH folder.  <br /></td></tr>
<tr class="separator:ac1ea60e60bbc020f83707ee6671fd19c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af171daaf22fb156b2426447ab54e861c" id="r_af171daaf22fb156b2426447ab54e861c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af171daaf22fb156b2426447ab54e861c">mh_rewrite_message</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structEmail.html">Email</a> *e)</td></tr>
<tr class="memdesc:af171daaf22fb156b2426447ab54e861c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sync a message in an MH folder.  <br /></td></tr>
<tr class="separator:af171daaf22fb156b2426447ab54e861c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f975cd8a104fe6a996e4506eadb8f95" id="r_a8f975cd8a104fe6a996e4506eadb8f95"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8f975cd8a104fe6a996e4506eadb8f95">mh_sync_message</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structEmail.html">Email</a> *e)</td></tr>
<tr class="memdesc:a8f975cd8a104fe6a996e4506eadb8f95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sync an email to an MH folder.  <br /></td></tr>
<tr class="separator:a8f975cd8a104fe6a996e4506eadb8f95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18d1d5ae034020d3672a2bfb04d3ed68" id="r_a18d1d5ae034020d3672a2bfb04d3ed68"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a18d1d5ae034020d3672a2bfb04d3ed68">mh_update_mtime</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:a18d1d5ae034020d3672a2bfb04d3ed68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update our record of the mailbox modification time.  <br /></td></tr>
<tr class="separator:a18d1d5ae034020d3672a2bfb04d3ed68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7aadbbd4acc00a4cd42fd42faf97f806" id="r_a7aadbbd4acc00a4cd42fd42faf97f806"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7aadbbd4acc00a4cd42fd42faf97f806">mh_parse_dir</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct MhEmailArray *mha, struct Progress *progress)</td></tr>
<tr class="memdesc:a7aadbbd4acc00a4cd42fd42faf97f806"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read an Mh mailbox.  <br /></td></tr>
<tr class="separator:a7aadbbd4acc00a4cd42fd42faf97f806"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6f4af5f39354f7748e2268bd53538de4" id="r_ga6f4af5f39354f7748e2268bd53538de4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sort__api.html#ga6f4af5f39354f7748e2268bd53538de4">mh_sort_path</a> (const void *a, const void *b, void *sdata)</td></tr>
<tr class="memdesc:ga6f4af5f39354f7748e2268bd53538de4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare two Mh Mailboxes by path - Implements <a class="el" href="qsort__r_8h.html#aba6ac91047d93d4a94103cd9db50d759">sort_t</a> -.  <br /></td></tr>
<tr class="separator:ga6f4af5f39354f7748e2268bd53538de4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0af3fc3f68028dca25071dde7f27791" id="r_af0af3fc3f68028dca25071dde7f27791"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structEmail.html">Email</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af0af3fc3f68028dca25071dde7f27791">mh_parse_message</a> (const char *fname, struct <a class="el" href="structEmail.html">Email</a> *e)</td></tr>
<tr class="memdesc:af0af3fc3f68028dca25071dde7f27791"><td class="mdescLeft">&#160;</td><td class="mdescRight">Actually parse an MH message.  <br /></td></tr>
<tr class="separator:af0af3fc3f68028dca25071dde7f27791"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2d3ae203f62bb52381ac736a0e8292b" id="r_ad2d3ae203f62bb52381ac736a0e8292b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad2d3ae203f62bb52381ac736a0e8292b">mh_delayed_parsing</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct MhEmailArray *mha, struct Progress *progress)</td></tr>
<tr class="memdesc:ad2d3ae203f62bb52381ac736a0e8292b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function does the second parsing pass.  <br /></td></tr>
<tr class="separator:ad2d3ae203f62bb52381ac736a0e8292b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae417c6c4670e084ec2e371ef09e26e35" id="r_ae417c6c4670e084ec2e371ef09e26e35"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae417c6c4670e084ec2e371ef09e26e35">mh_move_to_mailbox</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, const struct MhEmailArray *mha)</td></tr>
<tr class="memdesc:ae417c6c4670e084ec2e371ef09e26e35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy the Mh list to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a>.  <br /></td></tr>
<tr class="separator:ae417c6c4670e084ec2e371ef09e26e35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae374fa312c846e5836c0fcce3aeec4f4" id="r_ae374fa312c846e5836c0fcce3aeec4f4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae374fa312c846e5836c0fcce3aeec4f4">mh_read_dir</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ae374fa312c846e5836c0fcce3aeec4f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read an MH mailbox.  <br /></td></tr>
<tr class="separator:ae374fa312c846e5836c0fcce3aeec4f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a6412540f5b990d8f82823d537ce824" id="r_a9a6412540f5b990d8f82823d537ce824"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9a6412540f5b990d8f82823d537ce824">mh_sync_mailbox_message</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structEmail.html">Email</a> *e, struct <a class="el" href="structHeaderCache.html">HeaderCache</a> *hc)</td></tr>
<tr class="memdesc:a9a6412540f5b990d8f82823d537ce824"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the mailbox.  <br /></td></tr>
<tr class="separator:a9a6412540f5b990d8f82823d537ce824"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2f4a396cede56e0868a6ecd48385b696" id="r_ga2f4a396cede56e0868a6ecd48385b696"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__msg__save__hcache.html#ga2f4a396cede56e0868a6ecd48385b696">mh_msg_save_hcache</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structEmail.html">Email</a> *e)</td></tr>
<tr class="memdesc:ga2f4a396cede56e0868a6ecd48385b696"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save message to the header cache - Implements <a class="el" href="structMxOps.html#a4c0ce9432905dfb3f6849c97ae504f84">MxOps::msg_save_hcache()</a> -.  <br /></td></tr>
<tr class="separator:ga2f4a396cede56e0868a6ecd48385b696"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9a8caacacc10895af8a175387ae4a808" id="r_ga9a8caacacc10895af8a175387ae4a808"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__ac__owns__path.html#ga9a8caacacc10895af8a175387ae4a808">mh_ac_owns_path</a> (struct <a class="el" href="structAccount.html">Account</a> *a, const char *path)</td></tr>
<tr class="memdesc:ga9a8caacacc10895af8a175387ae4a808"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether an <a class="el" href="structAccount.html" title="A group of associated Mailboxes.">Account</a> owns a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> path - Implements <a class="el" href="structMxOps.html#a8036f191d1b0ace220c5a5ff52f609b4">MxOps::ac_owns_path()</a> -.  <br /></td></tr>
<tr class="separator:ga9a8caacacc10895af8a175387ae4a808"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga321bb2a9829e85b8e3ac54aee8f575eb" id="r_ga321bb2a9829e85b8e3ac54aee8f575eb"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__ac__add.html#ga321bb2a9829e85b8e3ac54aee8f575eb">mh_ac_add</a> (struct <a class="el" href="structAccount.html">Account</a> *a, struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ga321bb2a9829e85b8e3ac54aee8f575eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> to an <a class="el" href="structAccount.html" title="A group of associated Mailboxes.">Account</a> - Implements <a class="el" href="structMxOps.html#ac432a4900b0ca5a5ca2dc98319dbf737">MxOps::ac_add()</a> -.  <br /></td></tr>
<tr class="separator:ga321bb2a9829e85b8e3ac54aee8f575eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab7ce024784207f6e476aa788c55b0e9b" id="r_gab7ce024784207f6e476aa788c55b0e9b"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#a95aa6f9d458f82609e795a7f449f4cad">MxOpenReturns</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__open.html#gab7ce024784207f6e476aa788c55b0e9b">mh_mbox_open</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:gab7ce024784207f6e476aa788c55b0e9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#ac504b1095f3ce15cae85466ab6c7bd45">MxOps::mbox_open()</a> -.  <br /></td></tr>
<tr class="separator:gab7ce024784207f6e476aa788c55b0e9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafd578e9b5b40e9367fe840868c959828" id="r_gafd578e9b5b40e9367fe840868c959828"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__open__append.html#gafd578e9b5b40e9367fe840868c959828">mh_mbox_open_append</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, <a class="el" href="mxapi_8h.html#a12d50555671e01ef64b027974fc5acfa">OpenMailboxFlags</a> flags)</td></tr>
<tr class="memdesc:gafd578e9b5b40e9367fe840868c959828"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> for appending - Implements <a class="el" href="structMxOps.html#af201c2c2f87a1253cbaf8ae24f062ef3">MxOps::mbox_open_append()</a> -.  <br /></td></tr>
<tr class="separator:gafd578e9b5b40e9367fe840868c959828"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15c5a67872d2f500dba92e40ebca90d2" id="r_a15c5a67872d2f500dba92e40ebca90d2"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a15c5a67872d2f500dba92e40ebca90d2">mh_update_flags</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structEmail.html">Email</a> *e_old, struct <a class="el" href="structEmail.html">Email</a> *e_new)</td></tr>
<tr class="memdesc:a15c5a67872d2f500dba92e40ebca90d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the mailbox flags.  <br /></td></tr>
<tr class="separator:a15c5a67872d2f500dba92e40ebca90d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99c7310c93b72b3d8865be13d22c9d5f" id="r_a99c7310c93b72b3d8865be13d22c9d5f"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a99c7310c93b72b3d8865be13d22c9d5f">mh_check</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:a99c7310c93b72b3d8865be13d22c9d5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check for new mail.  <br /></td></tr>
<tr class="separator:a99c7310c93b72b3d8865be13d22c9d5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadebc9458952b6a4638328fad15e5b44f" id="r_gadebc9458952b6a4638328fad15e5b44f"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__check.html#gadebc9458952b6a4638328fad15e5b44f">mh_mbox_check</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:gadebc9458952b6a4638328fad15e5b44f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check for new mail - Implements <a class="el" href="structMxOps.html#af72b7c6ef064d1ca86b71ac9aff3e875">MxOps::mbox_check()</a> -.  <br /></td></tr>
<tr class="separator:gadebc9458952b6a4638328fad15e5b44f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a28d46645d6c462bb1b43c2210b3672" id="r_ga0a28d46645d6c462bb1b43c2210b3672"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__sync.html#ga0a28d46645d6c462bb1b43c2210b3672">mh_mbox_sync</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ga0a28d46645d6c462bb1b43c2210b3672"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#aebbfeec5651637ec053cc47b95c124af">MxOps::mbox_sync()</a> -.  <br /></td></tr>
<tr class="separator:ga0a28d46645d6c462bb1b43c2210b3672"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1dae01a8f8c8597897c0a6213cf8df10" id="r_ga1dae01a8f8c8597897c0a6213cf8df10"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__mbox__close.html#ga1dae01a8f8c8597897c0a6213cf8df10">mh_mbox_close</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m)</td></tr>
<tr class="memdesc:ga1dae01a8f8c8597897c0a6213cf8df10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#ae97b81d5371def5f6f2e64544cdec5fc">MxOps::mbox_close()</a> -.  <br /></td></tr>
<tr class="separator:ga1dae01a8f8c8597897c0a6213cf8df10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2403cfa29466f75ce776880e32fcbd66" id="r_ga2403cfa29466f75ce776880e32fcbd66"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__msg__open.html#ga2403cfa29466f75ce776880e32fcbd66">mh_msg_open</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structMessage.html">Message</a> *msg, struct <a class="el" href="structEmail.html">Email</a> *e)</td></tr>
<tr class="memdesc:ga2403cfa29466f75ce776880e32fcbd66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open an email message in a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#a1eaafb57e50a69b5d091f03cbd2521cc">MxOps::msg_open()</a> -.  <br /></td></tr>
<tr class="separator:ga2403cfa29466f75ce776880e32fcbd66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad96446cb76c88229db29a0e3f052abcb" id="r_gad96446cb76c88229db29a0e3f052abcb"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__msg__open__new.html#gad96446cb76c88229db29a0e3f052abcb">mh_msg_open_new</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structMessage.html">Message</a> *msg, const struct <a class="el" href="structEmail.html">Email</a> *e)</td></tr>
<tr class="memdesc:gad96446cb76c88229db29a0e3f052abcb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open a new message in a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html#ada910d49b8f3d007c32aa8a4adc15637">MxOps::msg_open_new()</a> -.  <br /></td></tr>
<tr class="separator:gad96446cb76c88229db29a0e3f052abcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab7cdabd2411f9704a83e58359212256a" id="r_gab7cdabd2411f9704a83e58359212256a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__msg__commit.html#gab7cdabd2411f9704a83e58359212256a">mh_msg_commit</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structMessage.html">Message</a> *msg)</td></tr>
<tr class="memdesc:gab7cdabd2411f9704a83e58359212256a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save changes to an email - Implements <a class="el" href="structMxOps.html#ab59dadf81aec5575a1c690caa4822e37">MxOps::msg_commit()</a> -.  <br /></td></tr>
<tr class="separator:gab7cdabd2411f9704a83e58359212256a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga332b2aca9b3bd38322f3f72d93c4d1d7" id="r_ga332b2aca9b3bd38322f3f72d93c4d1d7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__msg__close.html#ga332b2aca9b3bd38322f3f72d93c4d1d7">mh_msg_close</a> (struct <a class="el" href="structMailbox.html">Mailbox</a> *m, struct <a class="el" href="structMessage.html">Message</a> *msg)</td></tr>
<tr class="memdesc:ga332b2aca9b3bd38322f3f72d93c4d1d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an email - Implements <a class="el" href="structMxOps.html#ad53e3df1ff124eea52bc0488915e9ae4">MxOps::msg_close()</a> -.  <br /></td></tr>
<tr class="separator:ga332b2aca9b3bd38322f3f72d93c4d1d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac1024c3ff7f8d177ebfc5bf3afdaa95b" id="r_gac1024c3ff7f8d177ebfc5bf3afdaa95b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__path__canon.html#gac1024c3ff7f8d177ebfc5bf3afdaa95b">mh_path_canon</a> (struct <a class="el" href="structBuffer.html">Buffer</a> *path)</td></tr>
<tr class="memdesc:gac1024c3ff7f8d177ebfc5bf3afdaa95b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Canonicalise a <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> path - Implements <a class="el" href="structMxOps.html#ae8d7490a00b551c9430cd45db3cd517a">MxOps::path_canon()</a> -.  <br /></td></tr>
<tr class="separator:gac1024c3ff7f8d177ebfc5bf3afdaa95b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6d5988bb4154475a9d8cb94a4c7c77d4" id="r_ga6d5988bb4154475a9d8cb94a4c7c77d4"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="core_2mailbox_8h.html#af65addf714c28dd5d483cb426100921d">MailboxType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__path__probe.html#ga6d5988bb4154475a9d8cb94a4c7c77d4">mh_path_probe</a> (const char *path, const struct stat *st)</td></tr>
<tr class="memdesc:ga6d5988bb4154475a9d8cb94a4c7c77d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is this an mh <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a>?  <br /></td></tr>
<tr class="separator:ga6d5988bb4154475a9d8cb94a4c7c77d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga6ed664fd101a1e0e513910616c425918" id="r_ga6ed664fd101a1e0e513910616c425918"><td class="memItemLeft" align="right" valign="top">const struct <a class="el" href="structMxOps.html">MxOps</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mx__api.html#ga6ed664fd101a1e0e513910616c425918">MxMhOps</a></td></tr>
<tr class="memdesc:ga6ed664fd101a1e0e513910616c425918"><td class="mdescLeft">&#160;</td><td class="mdescRight">MH <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> - Implements <a class="el" href="structMxOps.html">MxOps</a> -.  <br /></td></tr>
<tr class="separator:ga6ed664fd101a1e0e513910616c425918"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>MH local mailbox type. </p>
<dl class="section author"><dt>Authors</dt><dd><ul>
<li>Richard Russon</li>
<li>Austin Ray</li>
<li>Pietro Cerutti</li>
<li>Dennis Sch√∂n</li>
</ul>
</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 2 of the License, or (at your option) any later version.</dd></dl>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>

<p class="definition">Definition in file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac355ba6e8c9b1ab7fa886e52ac6f5d4e" name="ac355ba6e8c9b1ab7fa886e52ac6f5d4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac355ba6e8c9b1ab7fa886e52ac6f5d4e">&#9670;&#160;</a></span>mh_already_notified()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mh_already_notified </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>msgno</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Has the message changed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramname">msgno</td><td><a class="el" href="structMessage.html" title="A local copy of an email.">Message</a> number </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>Modification time on the message file is older than the last visit to this mailbox </td></tr>
    <tr><td class="paramname">0</td><td>Modification time on the message file is newer </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00078">78</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   79</span>{</div>
<div class="line"><span class="lineno">   80</span>  <span class="keywordtype">char</span> path[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">   81</span>  <span class="keyword">struct </span>stat st = { 0 };</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>  <span class="keywordflow">if</span> ((snprintf(path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s/%d&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), msgno) &lt; <span class="keyword">sizeof</span>(path)) &amp;&amp;</div>
<div class="line"><span class="lineno">   84</span>      (stat(path, &amp;st) == 0))</div>
<div class="line"><span class="lineno">   85</span>  {</div>
<div class="line"><span class="lineno">   86</span>    <span class="keywordflow">return</span> (<a class="code hl_function" href="file_8c.html#acf5bbc5f63d75ef10f2d16f183de0de0">mutt_file_stat_timespec_compare</a>(&amp;st, <a class="code hl_enumvalue" href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a>, &amp;m-&gt;<a class="code hl_variable" href="structMailbox.html#ae355489c17bcccdd40768ef3f42dfb39">last_visited</a>) &lt;= 0);</div>
<div class="line"><span class="lineno">   87</span>  }</div>
<div class="line"><span class="lineno">   88</span>  <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   89</span>}</div>
<div class="ttc" id="acore_2mailbox_8h_html_a7e9739eb3e94344633f7051c2fb9453e"><div class="ttname"><a href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a></div><div class="ttdeci">static const char * mailbox_path(const struct Mailbox *m)</div><div class="ttdoc">Get the Mailbox&#39;s path string.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00214">mailbox.h:214</a></div></div>
<div class="ttc" id="afile_8c_html_acf5bbc5f63d75ef10f2d16f183de0de0"><div class="ttname"><a href="file_8c.html#acf5bbc5f63d75ef10f2d16f183de0de0">mutt_file_stat_timespec_compare</a></div><div class="ttdeci">int mutt_file_stat_timespec_compare(struct stat *st, enum MuttStatType type, struct timespec *b)</div><div class="ttdoc">Compare stat info with a time value.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l01512">file.c:1512</a></div></div>
<div class="ttc" id="afile_8h_html_ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df"><div class="ttname"><a href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a></div><div class="ttdeci">@ MUTT_STAT_MTIME</div><div class="ttdoc">File/dir&#39;s mtime - last modified time.</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00054">file.h:54</a></div></div>
<div class="ttc" id="amutt_8h_html_ae688d728e1acdfe5988c7db45d6f0166"><div class="ttname"><a href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a></div><div class="ttdeci">#define PATH_MAX</div><div class="ttdef"><b>Definition</b> <a href="mutt_8h_source.html#l00042">mutt.h:42</a></div></div>
<div class="ttc" id="astructMailbox_html_ae355489c17bcccdd40768ef3f42dfb39"><div class="ttname"><a href="structMailbox.html#ae355489c17bcccdd40768ef3f42dfb39">Mailbox::last_visited</a></div><div class="ttdeci">struct timespec last_visited</div><div class="ttdoc">Time of last exit from this mailbox.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00104">mailbox.h:104</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ac355ba6e8c9b1ab7fa886e52ac6f5d4e_cgraph.svg" width="372" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-2" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ac355ba6e8c9b1ab7fa886e52ac6f5d4e_icgraph.svg" width="364" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6223240d84e5ce2b19911dd83877cbed" name="a6223240d84e5ce2b19911dd83877cbed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6223240d84e5ce2b19911dd83877cbed">&#9670;&#160;</a></span>mh_valid_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool mh_valid_message </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>s</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Is this a valid MH message filename. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Pathname to examine </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>name is valid </td></tr>
    <tr><td class="paramname">false</td><td>name is invalid</td></tr>
  </table>
  </dd>
</dl>
<p>Ignore the garbage files. A valid MH message consists of only digits. Deleted message get moved to a filename with a comma before it. </p>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00100">100</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  101</span>{</div>
<div class="line"><span class="lineno">  102</span>  <span class="keywordflow">for</span> (; *s; s++)</div>
<div class="line"><span class="lineno">  103</span>  {</div>
<div class="line"><span class="lineno">  104</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="ctype_8c.html#adb914ebc2b43bd8f37f9684820e77867">mutt_isdigit</a>(*s))</div>
<div class="line"><span class="lineno">  105</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  106</span>  }</div>
<div class="line"><span class="lineno">  107</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  108</span>}</div>
<div class="ttc" id="actype_8c_html_adb914ebc2b43bd8f37f9684820e77867"><div class="ttname"><a href="ctype_8c.html#adb914ebc2b43bd8f37f9684820e77867">mutt_isdigit</a></div><div class="ttdeci">bool mutt_isdigit(int arg)</div><div class="ttdoc">Wrapper for isdigit(3)</div><div class="ttdef"><b>Definition</b> <a href="ctype_8c_source.html#l00065">ctype.c:65</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a6223240d84e5ce2b19911dd83877cbed_cgraph.svg" width="288" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-4" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a6223240d84e5ce2b19911dd83877cbed_icgraph.svg" width="354" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a255adaa00e9d3d619b5752ce0456c63b" name="a255adaa00e9d3d619b5752ce0456c63b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a255adaa00e9d3d619b5752ce0456c63b">&#9670;&#160;</a></span>mh_check_empty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mh_check_empty </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structBuffer.html">Buffer</a> *</td>          <td class="paramname"><span class="paramname"><em>path</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Is mailbox empty. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> to check </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> is empty </td></tr>
    <tr><td class="paramname">0</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> contains mail </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00117">117</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  118</span>{</div>
<div class="line"><span class="lineno">  119</span>  <span class="keyword">struct </span>dirent *de = NULL;</div>
<div class="line"><span class="lineno">  120</span>  <span class="keywordtype">int</span> rc = 1; <span class="comment">/* assume empty until we find a message */</span></div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>  DIR *dir = <a class="code hl_function" href="file_8c.html#a69da918c66c3f22815d6e4aed88b6122">mutt_file_opendir</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(path), <a class="code hl_enumvalue" href="file_8h.html#a222e4f679593f00cd8c126212b3cdb3ba88d03a1ea19c4b7fdccd5dfc936a7a60">MUTT_OPENDIR_NONE</a>);</div>
<div class="line"><span class="lineno">  123</span>  <span class="keywordflow">if</span> (!dir)</div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  125</span>  <span class="keywordflow">while</span> ((de = readdir(dir)))</div>
<div class="line"><span class="lineno">  126</span>  {</div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6223240d84e5ce2b19911dd83877cbed">mh_valid_message</a>(de-&gt;d_name))</div>
<div class="line"><span class="lineno">  128</span>    {</div>
<div class="line"><span class="lineno">  129</span>      rc = 0;</div>
<div class="line"><span class="lineno">  130</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  131</span>    }</div>
<div class="line"><span class="lineno">  132</span>  }</div>
<div class="line"><span class="lineno">  133</span>  closedir(dir);</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  136</span>}</div>
<div class="ttc" id="abuffer_8h_html_a728ebc5a947b77c8d56db44ce553a7ab"><div class="ttname"><a href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a></div><div class="ttdeci">static const char * buf_string(const struct Buffer *buf)</div><div class="ttdoc">Convert a buffer to a const char * &quot;string&quot;.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00096">buffer.h:96</a></div></div>
<div class="ttc" id="afile_8c_html_a69da918c66c3f22815d6e4aed88b6122"><div class="ttname"><a href="file_8c.html#a69da918c66c3f22815d6e4aed88b6122">mutt_file_opendir</a></div><div class="ttdeci">DIR * mutt_file_opendir(const char *path, enum MuttOpenDirMode mode)</div><div class="ttdoc">Open a directory.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00542">file.c:542</a></div></div>
<div class="ttc" id="afile_8h_html_a222e4f679593f00cd8c126212b3cdb3ba88d03a1ea19c4b7fdccd5dfc936a7a60"><div class="ttname"><a href="file_8h.html#a222e4f679593f00cd8c126212b3cdb3ba88d03a1ea19c4b7fdccd5dfc936a7a60">MUTT_OPENDIR_NONE</a></div><div class="ttdeci">@ MUTT_OPENDIR_NONE</div><div class="ttdoc">Plain opendir()</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00063">file.h:63</a></div></div>
<div class="ttc" id="amh_8c_html_a6223240d84e5ce2b19911dd83877cbed"><div class="ttname"><a href="#a6223240d84e5ce2b19911dd83877cbed">mh_valid_message</a></div><div class="ttdeci">static bool mh_valid_message(const char *s)</div><div class="ttdoc">Is this a valid MH message filename.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00100">mh.c:100</a></div></div>
</div><!-- fragment --><div id="dynsection-5" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a255adaa00e9d3d619b5752ce0456c63b_cgraph.svg" width="324" height="171"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae06b4547b1aaad67848597ff451ca584" name="ae06b4547b1aaad67848597ff451ca584"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae06b4547b1aaad67848597ff451ca584">&#9670;&#160;</a></span>mh_update_emails()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mh_update_emails </td>
          <td>(</td>
          <td class="paramtype">struct MhEmailArray *</td>          <td class="paramname"><span class="paramname"><em>mha</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structMhSequences.html">MhSequences</a> *</td>          <td class="paramname"><span class="paramname"><em>mhs</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update our record of flags. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mha</td><td>Mh array to update </td></tr>
    <tr><td class="paramname">mhs</td><td>Sequences </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00211">211</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  212</span>{</div>
<div class="line"><span class="lineno">  213</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> *md = NULL;</div>
<div class="line"><span class="lineno">  214</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> **mdp = NULL;</div>
<div class="line"><span class="lineno">  215</span>  <a class="code hl_define" href="array_8h.html#a6b8ea5fb2f366d7716f5042b347093a6">ARRAY_FOREACH</a>(mdp, mha)</div>
<div class="line"><span class="lineno">  216</span>  {</div>
<div class="line"><span class="lineno">  217</span>    md = *mdp;</div>
<div class="line"><span class="lineno">  218</span>    <span class="keywordtype">char</span> *p = strrchr(md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">if</span> (p)</div>
<div class="line"><span class="lineno">  220</span>      p++;</div>
<div class="line"><span class="lineno">  221</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  222</span>      p = md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>;</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><span class="lineno">  225</span>    <span class="keywordflow">if</span> (!mutt_str_atoi_full(p, &amp;i))</div>
<div class="line"><span class="lineno">  226</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  227</span>    <a class="code hl_typedef" href="sequence_8h.html#ac6a1ef17d0d72f67fa4b5d56188bf1b6">MhSeqFlags</a> flags = <a class="code hl_function" href="sequence_8c.html#a82a7536102418feb9b5f4542cb30b9b2">mh_seq_check</a>(mhs, i);</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>    md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#a0bd79550be901d44e50953fb43614e10">read</a> = !(flags &amp; <a class="code hl_define" href="sequence_8h.html#a28ef3736b45bc532d96b2de611073047">MH_SEQ_UNSEEN</a>);</div>
<div class="line"><span class="lineno">  230</span>    md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#a8e810bc67ce7fea04bfe8a3739093d78">flagged</a> = (flags &amp; <a class="code hl_define" href="sequence_8h.html#acd4b02f6f6422afa6b014e5795c9cc0d">MH_SEQ_FLAGGED</a>);</div>
<div class="line"><span class="lineno">  231</span>    md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#aa26dd591f92e548bc3c56d0b7fdb3e8c">replied</a> = (flags &amp; <a class="code hl_define" href="sequence_8h.html#a362bff56c4631e04b267e8c5a178c285">MH_SEQ_REPLIED</a>);</div>
<div class="line"><span class="lineno">  232</span>  }</div>
<div class="line"><span class="lineno">  233</span>}</div>
<div class="ttc" id="aarray_8h_html_a6b8ea5fb2f366d7716f5042b347093a6"><div class="ttname"><a href="array_8h.html#a6b8ea5fb2f366d7716f5042b347093a6">ARRAY_FOREACH</a></div><div class="ttdeci">#define ARRAY_FOREACH(elem, head)</div><div class="ttdoc">Iterate over all elements of the array.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00214">array.h:214</a></div></div>
<div class="ttc" id="asequence_8c_html_a82a7536102418feb9b5f4542cb30b9b2"><div class="ttname"><a href="sequence_8c.html#a82a7536102418feb9b5f4542cb30b9b2">mh_seq_check</a></div><div class="ttdeci">MhSeqFlags mh_seq_check(struct MhSequences *mhs, int i)</div><div class="ttdoc">Get the flags for a given sequence.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8c_source.html#l00079">sequence.c:79</a></div></div>
<div class="ttc" id="asequence_8h_html_a28ef3736b45bc532d96b2de611073047"><div class="ttname"><a href="sequence_8h.html#a28ef3736b45bc532d96b2de611073047">MH_SEQ_UNSEEN</a></div><div class="ttdeci">#define MH_SEQ_UNSEEN</div><div class="ttdoc">Email hasn&#39;t been read.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8h_source.html#l00033">sequence.h:33</a></div></div>
<div class="ttc" id="asequence_8h_html_a362bff56c4631e04b267e8c5a178c285"><div class="ttname"><a href="sequence_8h.html#a362bff56c4631e04b267e8c5a178c285">MH_SEQ_REPLIED</a></div><div class="ttdeci">#define MH_SEQ_REPLIED</div><div class="ttdoc">Email has been replied to.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8h_source.html#l00034">sequence.h:34</a></div></div>
<div class="ttc" id="asequence_8h_html_ac6a1ef17d0d72f67fa4b5d56188bf1b6"><div class="ttname"><a href="sequence_8h.html#ac6a1ef17d0d72f67fa4b5d56188bf1b6">MhSeqFlags</a></div><div class="ttdeci">uint8_t MhSeqFlags</div><div class="ttdoc">Flags, e.g. MH_SEQ_UNSEEN.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8h_source.html#l00031">sequence.h:31</a></div></div>
<div class="ttc" id="asequence_8h_html_acd4b02f6f6422afa6b014e5795c9cc0d"><div class="ttname"><a href="sequence_8h.html#acd4b02f6f6422afa6b014e5795c9cc0d">MH_SEQ_FLAGGED</a></div><div class="ttdeci">#define MH_SEQ_FLAGGED</div><div class="ttdoc">Email is flagged.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8h_source.html#l00035">sequence.h:35</a></div></div>
<div class="ttc" id="astructEmail_html_a0bd79550be901d44e50953fb43614e10"><div class="ttname"><a href="structEmail.html#a0bd79550be901d44e50953fb43614e10">Email::read</a></div><div class="ttdeci">bool read</div><div class="ttdoc">Email is read.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00050">email.h:50</a></div></div>
<div class="ttc" id="astructEmail_html_a8e810bc67ce7fea04bfe8a3739093d78"><div class="ttname"><a href="structEmail.html#a8e810bc67ce7fea04bfe8a3739093d78">Email::flagged</a></div><div class="ttdeci">bool flagged</div><div class="ttdoc">Marked important?</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00047">email.h:47</a></div></div>
<div class="ttc" id="astructEmail_html_aa26dd591f92e548bc3c56d0b7fdb3e8c"><div class="ttname"><a href="structEmail.html#aa26dd591f92e548bc3c56d0b7fdb3e8c">Email::replied</a></div><div class="ttdeci">bool replied</div><div class="ttdoc">Email has been replied to.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00051">email.h:51</a></div></div>
<div class="ttc" id="astructEmail_html_ac041599cfe41b49e7b8f9d752d07bb39"><div class="ttname"><a href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">Email::path</a></div><div class="ttdeci">char * path</div><div class="ttdoc">Path of Email (for local Mailboxes)</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00070">email.h:70</a></div></div>
<div class="ttc" id="astructMhEmail_html"><div class="ttname"><a href="structMhEmail.html">MhEmail</a></div><div class="ttdoc">A Mh Email helper.</div><div class="ttdef"><b>Definition</b> <a href="mhemail_8h_source.html#l00035">mhemail.h:36</a></div></div>
<div class="ttc" id="astructMhEmail_html_a2c4f25588fb9aa0ef67fa98c9cf90a50"><div class="ttname"><a href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">MhEmail::email</a></div><div class="ttdeci">struct Email * email</div><div class="ttdoc">Temporary Email.</div><div class="ttdef"><b>Definition</b> <a href="mhemail_8h_source.html#l00037">mhemail.h:37</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ae06b4547b1aaad67848597ff451ca584_cgraph.svg" width="306" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-7" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ae06b4547b1aaad67848597ff451ca584_icgraph.svg" width="294" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac1ea60e60bbc020f83707ee6671fd19c" name="ac1ea60e60bbc020f83707ee6671fd19c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1ea60e60bbc020f83707ee6671fd19c">&#9670;&#160;</a></span>mh_commit_msg()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mh_commit_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structMessage.html">Message</a> *</td>          <td class="paramname"><span class="paramname"><em>msg</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structEmail.html">Email</a> *</td>          <td class="paramname"><span class="paramname"><em>e</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>updseq</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Commit a message to an MH folder. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramname">msg</td><td><a class="el" href="structMessage.html" title="A local copy of an email.">Message</a> to commit </td></tr>
    <tr><td class="paramname">e</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> </td></tr>
    <tr><td class="paramname">updseq</td><td>If true, update the sequence number </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00244">244</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  245</span>{</div>
<div class="line"><span class="lineno">  246</span>  <span class="keyword">struct </span>dirent *de = NULL;</div>
<div class="line"><span class="lineno">  247</span>  <span class="keywordtype">char</span> *cp = NULL, *dep = NULL;</div>
<div class="line"><span class="lineno">  248</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n, hi = 0;</div>
<div class="line"><span class="lineno">  249</span>  <span class="keywordtype">char</span> path[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  250</span>  <span class="keywordtype">char</span> tmp[16] = { 0 };</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="file_8c.html#ae6b2571365b85d78aa796fd220c740ce">mutt_file_fsync_close</a>(&amp;msg-&gt;<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>))</div>
<div class="line"><span class="lineno">  253</span>  {</div>
<div class="line"><span class="lineno">  254</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Could not flush message to disk&quot;</span>));</div>
<div class="line"><span class="lineno">  255</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  256</span>  }</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>  DIR *dir = <a class="code hl_function" href="file_8c.html#a69da918c66c3f22815d6e4aed88b6122">mutt_file_opendir</a>(<a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), <a class="code hl_enumvalue" href="file_8h.html#a222e4f679593f00cd8c126212b3cdb3ba88d03a1ea19c4b7fdccd5dfc936a7a60">MUTT_OPENDIR_NONE</a>);</div>
<div class="line"><span class="lineno">  259</span>  <span class="keywordflow">if</span> (!dir)</div>
<div class="line"><span class="lineno">  260</span>  {</div>
<div class="line"><span class="lineno">  261</span>    <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  262</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  263</span>  }</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>  <span class="comment">/* figure out what the next message number is */</span></div>
<div class="line"><span class="lineno">  266</span>  <span class="keywordflow">while</span> ((de = readdir(dir)))</div>
<div class="line"><span class="lineno">  267</span>  {</div>
<div class="line"><span class="lineno">  268</span>    dep = de-&gt;d_name;</div>
<div class="line"><span class="lineno">  269</span>    <span class="keywordflow">if</span> (*dep == <span class="charliteral">&#39;,&#39;</span>)</div>
<div class="line"><span class="lineno">  270</span>      dep++;</div>
<div class="line"><span class="lineno">  271</span>    cp = dep;</div>
<div class="line"><span class="lineno">  272</span>    <span class="keywordflow">while</span> (*cp)</div>
<div class="line"><span class="lineno">  273</span>    {</div>
<div class="line"><span class="lineno">  274</span>      <span class="keywordflow">if</span> (!<a class="code hl_function" href="ctype_8c.html#adb914ebc2b43bd8f37f9684820e77867">mutt_isdigit</a>(*cp))</div>
<div class="line"><span class="lineno">  275</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  276</span>      cp++;</div>
<div class="line"><span class="lineno">  277</span>    }</div>
<div class="line"><span class="lineno">  278</span>    <span class="keywordflow">if</span> (*cp == <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><span class="lineno">  279</span>    {</div>
<div class="line"><span class="lineno">  280</span>      <span class="keywordflow">if</span> (!<a class="code hl_function" href="atoi_8c.html#ad704fc34b6f2eb2132de8bf992994ac1">mutt_str_atoui</a>(dep, &amp;n))</div>
<div class="line"><span class="lineno">  281</span>        <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Invalid MH message number &#39;%s&#39;\n&quot;</span>, dep);</div>
<div class="line"><span class="lineno">  282</span>      <span class="keywordflow">if</span> (n &gt; hi)</div>
<div class="line"><span class="lineno">  283</span>        hi = n;</div>
<div class="line"><span class="lineno">  284</span>    }</div>
<div class="line"><span class="lineno">  285</span>  }</div>
<div class="line"><span class="lineno">  286</span>  closedir(dir);</div>
<div class="line"><span class="lineno">  287</span> </div>
<div class="line"><span class="lineno">  288</span>  <span class="comment">/* Now try to rename the file to the proper name.</span></div>
<div class="line"><span class="lineno">  289</span><span class="comment">   * Note: We may have to try multiple times, until we find a free slot.  */</span></div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>  <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><span class="lineno">  292</span>  {</div>
<div class="line"><span class="lineno">  293</span>    hi++;</div>
<div class="line"><span class="lineno">  294</span>    snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%u&quot;</span>, hi);</div>
<div class="line"><span class="lineno">  295</span>    snprintf(path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), tmp);</div>
<div class="line"><span class="lineno">  296</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="file_8c.html#a1cdf183d05e03b173070aa506d192822">mutt_file_safe_rename</a>(msg-&gt;<a class="code hl_variable" href="structMessage.html#a668759f9813e882a9cfcf3ac725b6200">path</a>, path) == 0)</div>
<div class="line"><span class="lineno">  297</span>    {</div>
<div class="line"><span class="lineno">  298</span>      <span class="keywordflow">if</span> (e)</div>
<div class="line"><span class="lineno">  299</span>        <a class="code hl_function" href="mutt_2string_8c.html#af8c32ffc64dd55e92001a974a4be6bbf">mutt_str_replace</a>(&amp;e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>, tmp);</div>
<div class="line"><span class="lineno">  300</span>      <a class="code hl_function" href="mutt_2string_8c.html#af8c32ffc64dd55e92001a974a4be6bbf">mutt_str_replace</a>(&amp;msg-&gt;<a class="code hl_variable" href="structMessage.html#a817c2e03ff60bae58f117fc3391d3d62">committed_path</a>, path);</div>
<div class="line"><span class="lineno">  301</span>      <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;msg-&gt;<a class="code hl_variable" href="structMessage.html#a668759f9813e882a9cfcf3ac725b6200">path</a>);</div>
<div class="line"><span class="lineno">  302</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  303</span>    }</div>
<div class="line"><span class="lineno">  304</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno != EEXIST)</div>
<div class="line"><span class="lineno">  305</span>    {</div>
<div class="line"><span class="lineno">  306</span>      <a class="code hl_define" href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  307</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  308</span>    }</div>
<div class="line"><span class="lineno">  309</span>  }</div>
<div class="line"><span class="lineno">  310</span>  <span class="keywordflow">if</span> (updseq)</div>
<div class="line"><span class="lineno">  311</span>  {</div>
<div class="line"><span class="lineno">  312</span>    <a class="code hl_function" href="sequence_8c.html#a47f98d56123f5b70ed90af9120e6f06c">mh_seq_add_one</a>(m, hi, !msg-&gt;<a class="code hl_variable" href="structMessage.html#a6b0ccab7dd8eeb0f8c14858d75e872c7">flags</a>.<a class="code hl_variable" href="structMessage.html#ace4606e8dc8aa0c35738e9f788f47705">read</a>, msg-&gt;<a class="code hl_variable" href="structMessage.html#a6b0ccab7dd8eeb0f8c14858d75e872c7">flags</a>.<a class="code hl_variable" href="structMessage.html#aaa255a41e07cb4277d457c0db894a47a">flagged</a>, msg-&gt;<a class="code hl_variable" href="structMessage.html#a6b0ccab7dd8eeb0f8c14858d75e872c7">flags</a>.<a class="code hl_variable" href="structMessage.html#a7fb38cfeca11b8aee9cd598475100dfb">replied</a>);</div>
<div class="line"><span class="lineno">  313</span>  }</div>
<div class="line"><span class="lineno">  314</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  315</span>}</div>
<div class="ttc" id="aatoi_8c_html_ad704fc34b6f2eb2132de8bf992994ac1"><div class="ttname"><a href="atoi_8c.html#ad704fc34b6f2eb2132de8bf992994ac1">mutt_str_atoui</a></div><div class="ttdeci">const char * mutt_str_atoui(const char *str, unsigned int *dst)</div><div class="ttdoc">Convert ASCII string to an unsigned integer.</div><div class="ttdef"><b>Definition</b> <a href="atoi_8c_source.html#l00217">atoi.c:217</a></div></div>
<div class="ttc" id="afile_8c_html_a1cdf183d05e03b173070aa506d192822"><div class="ttname"><a href="file_8c.html#a1cdf183d05e03b173070aa506d192822">mutt_file_safe_rename</a></div><div class="ttdeci">int mutt_file_safe_rename(const char *src, const char *target)</div><div class="ttdoc">NFS-safe renaming of files.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00309">file.c:309</a></div></div>
<div class="ttc" id="afile_8c_html_ae6b2571365b85d78aa796fd220c740ce"><div class="ttname"><a href="file_8c.html#ae6b2571365b85d78aa796fd220c740ce">mutt_file_fsync_close</a></div><div class="ttdeci">int mutt_file_fsync_close(FILE **fp)</div><div class="ttdoc">Flush the data, before closing a file (and NULL the pointer)</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l00131">file.c:131</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00090">logging2.h:90</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gafaa521ab22db877ccf1b87e679e1b43e"><div class="ttname"><a href="group__logging__api.html#gafaa521ab22db877ccf1b87e679e1b43e">mutt_perror</a></div><div class="ttdeci">#define mutt_perror(...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00094">logging2.h:94</a></div></div>
<div class="ttc" id="alogging2_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdeci">@ LL_DEBUG2</div><div class="ttdoc">Log at debug level 2.</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00045">logging2.h:45</a></div></div>
<div class="ttc" id="amemory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition</b> <a href="memory_8h_source.html#l00062">memory.h:62</a></div></div>
<div class="ttc" id="amutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_af8c32ffc64dd55e92001a974a4be6bbf"><div class="ttname"><a href="mutt_2string_8c.html#af8c32ffc64dd55e92001a974a4be6bbf">mutt_str_replace</a></div><div class="ttdeci">char * mutt_str_replace(char **p, const char *s)</div><div class="ttdoc">Replace one string with another.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00282">string.c:282</a></div></div>
<div class="ttc" id="asequence_8c_html_a47f98d56123f5b70ed90af9120e6f06c"><div class="ttname"><a href="sequence_8c.html#a47f98d56123f5b70ed90af9120e6f06c">mh_seq_add_one</a></div><div class="ttdeci">void mh_seq_add_one(struct Mailbox *m, int n, bool unseen, bool flagged, bool replied)</div><div class="ttdoc">Update the flags for one sequence.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8c_source.html#l00108">sequence.c:108</a></div></div>
<div class="ttc" id="astructMessage_html_a11d53ee4319e8735c1677d8780a7b517"><div class="ttname"><a href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">Message::fp</a></div><div class="ttdeci">FILE * fp</div><div class="ttdoc">pointer to the message data</div><div class="ttdef"><b>Definition</b> <a href="core_2message_8h_source.html#l00035">message.h:35</a></div></div>
<div class="ttc" id="astructMessage_html_a668759f9813e882a9cfcf3ac725b6200"><div class="ttname"><a href="structMessage.html#a668759f9813e882a9cfcf3ac725b6200">Message::path</a></div><div class="ttdeci">char * path</div><div class="ttdoc">path to temp file</div><div class="ttdef"><b>Definition</b> <a href="core_2message_8h_source.html#l00036">message.h:36</a></div></div>
<div class="ttc" id="astructMessage_html_a6b0ccab7dd8eeb0f8c14858d75e872c7"><div class="ttname"><a href="structMessage.html#a6b0ccab7dd8eeb0f8c14858d75e872c7">Message::flags</a></div><div class="ttdeci">struct Message::@264267271004327071125374067057142037276212342100 flags</div><div class="ttdoc">Flags for the Message.</div></div>
<div class="ttc" id="astructMessage_html_a7fb38cfeca11b8aee9cd598475100dfb"><div class="ttname"><a href="structMessage.html#a7fb38cfeca11b8aee9cd598475100dfb">Message::replied</a></div><div class="ttdeci">bool replied</div><div class="ttdoc">Message has been replied to.</div><div class="ttdef"><b>Definition</b> <a href="core_2message_8h_source.html#l00043">message.h:43</a></div></div>
<div class="ttc" id="astructMessage_html_a817c2e03ff60bae58f117fc3391d3d62"><div class="ttname"><a href="structMessage.html#a817c2e03ff60bae58f117fc3391d3d62">Message::committed_path</a></div><div class="ttdeci">char * committed_path</div><div class="ttdoc">the final path generated by mx_msg_commit()</div><div class="ttdef"><b>Definition</b> <a href="core_2message_8h_source.html#l00037">message.h:37</a></div></div>
<div class="ttc" id="astructMessage_html_aaa255a41e07cb4277d457c0db894a47a"><div class="ttname"><a href="structMessage.html#aaa255a41e07cb4277d457c0db894a47a">Message::flagged</a></div><div class="ttdeci">bool flagged</div><div class="ttdoc">Message is flagged.</div><div class="ttdef"><b>Definition</b> <a href="core_2message_8h_source.html#l00042">message.h:42</a></div></div>
<div class="ttc" id="astructMessage_html_ace4606e8dc8aa0c35738e9f788f47705"><div class="ttname"><a href="structMessage.html#ace4606e8dc8aa0c35738e9f788f47705">Message::read</a></div><div class="ttdeci">bool read</div><div class="ttdoc">Message has been read.</div><div class="ttdef"><b>Definition</b> <a href="core_2message_8h_source.html#l00041">message.h:41</a></div></div>
</div><!-- fragment --><div id="dynsection-8" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ac1ea60e60bbc020f83707ee6671fd19c_cgraph.svg" width="546" height="400"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-9" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ac1ea60e60bbc020f83707ee6671fd19c_icgraph.svg" width="336" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af171daaf22fb156b2426447ab54e861c" name="af171daaf22fb156b2426447ab54e861c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af171daaf22fb156b2426447ab54e861c">&#9670;&#160;</a></span>mh_rewrite_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mh_rewrite_message </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structEmail.html">Email</a> *</td>          <td class="paramname"><span class="paramname"><em>e</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sync a message in an MH folder. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramname">e</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00324">324</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  325</span>{</div>
<div class="line"><span class="lineno">  326</span>  <span class="keywordflow">if</span> (!m || !e)</div>
<div class="line"><span class="lineno">  327</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>  <span class="keywordtype">bool</span> restore = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>  <span class="keywordtype">long</span> old_body_offset = e-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a>;</div>
<div class="line"><span class="lineno">  332</span>  <span class="keywordtype">long</span> old_body_length = e-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a>;</div>
<div class="line"><span class="lineno">  333</span>  <span class="keywordtype">long</span> old_hdr_lines = e-&gt;<a class="code hl_variable" href="structEmail.html#a562a3aee45efc37c07dedcc8e1fef93f">lines</a>;</div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMessage.html">Message</a> *src = <a class="code hl_function" href="mx_8c.html#a9b2902ecb2bebbd553a8ec733ca59886">mx_msg_open</a>(m, e);</div>
<div class="line"><span class="lineno">  336</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMessage.html">Message</a> *dest = <a class="code hl_function" href="mx_8c.html#ad7adbbda58c642107eadf33b1fbf0c13">mx_msg_open_new</a>(m, e, <a class="code hl_define" href="mx_8h.html#a4f461719ebd7d96d0b2f2492c595fc26">MUTT_MSG_NO_FLAGS</a>);</div>
<div class="line"><span class="lineno">  337</span>  <span class="keywordflow">if</span> (!src || !dest)</div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>  <span class="keywordtype">int</span> rc = <a class="code hl_function" href="copy_8c.html#a72172841415fb14e143da3c102be0364">mutt_copy_message</a>(dest-&gt;<a class="code hl_variable" href="structMessage.html#a11d53ee4319e8735c1677d8780a7b517">fp</a>, e, src, <a class="code hl_define" href="copy_8h.html#a2a61b3ef55bc40f9364eea3f09bb4da8">MUTT_CM_UPDATE</a>, <a class="code hl_define" href="copy_8h.html#a397b6166af3a14708bddb8ccd0241e11">CH_UPDATE</a> | <a class="code hl_define" href="copy_8h.html#a94e818174cb0508df54058debb1c631a">CH_UPDATE_LEN</a>, 0);</div>
<div class="line"><span class="lineno">  341</span>  <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  342</span>  {</div>
<div class="line"><span class="lineno">  343</span>    <span class="keywordtype">char</span> oldpath[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  344</span>    <span class="keywordtype">char</span> partpath[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  345</span>    snprintf(oldpath, <span class="keyword">sizeof</span>(oldpath), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno">  346</span>    <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(partpath, e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>, <span class="keyword">sizeof</span>(partpath));</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>    rc = <a class="code hl_function" href="#ac1ea60e60bbc020f83707ee6671fd19c">mh_commit_msg</a>(m, dest, e, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  349</span> </div>
<div class="line"><span class="lineno">  350</span>    <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  351</span>    {</div>
<div class="line"><span class="lineno">  352</span>      unlink(oldpath);</div>
<div class="line"><span class="lineno">  353</span>      restore = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  354</span>    }</div>
<div class="line"><span class="lineno">  355</span> </div>
<div class="line"><span class="lineno">  356</span>    <span class="comment">/* Try to move the new message to the old place.</span></div>
<div class="line"><span class="lineno">  357</span><span class="comment">     * (MH only.)</span></div>
<div class="line"><span class="lineno">  358</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno">  359</span><span class="comment">     * This is important when we are just updating flags.</span></div>
<div class="line"><span class="lineno">  360</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno">  361</span><span class="comment">     * Note that there is a race condition against programs which</span></div>
<div class="line"><span class="lineno">  362</span><span class="comment">     * use the first free slot instead of the maximum message</span></div>
<div class="line"><span class="lineno">  363</span><span class="comment">     * number.  NeoMutt does _not_ behave like this.</span></div>
<div class="line"><span class="lineno">  364</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno">  365</span><span class="comment">     * Anyway, if this fails, the message is in the folder, so</span></div>
<div class="line"><span class="lineno">  366</span><span class="comment">     * all what happens is that a concurrently running neomutt will</span></div>
<div class="line"><span class="lineno">  367</span><span class="comment">     * lose flag modifications.  */</span></div>
<div class="line"><span class="lineno">  368</span>    <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  369</span>    {</div>
<div class="line"><span class="lineno">  370</span>      <span class="keywordtype">char</span> newpath[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  371</span>      snprintf(newpath, <span class="keyword">sizeof</span>(newpath), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno">  372</span>      rc = <a class="code hl_function" href="file_8c.html#a1cdf183d05e03b173070aa506d192822">mutt_file_safe_rename</a>(newpath, oldpath);</div>
<div class="line"><span class="lineno">  373</span>      <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  374</span>        <a class="code hl_function" href="mutt_2string_8c.html#af8c32ffc64dd55e92001a974a4be6bbf">mutt_str_replace</a>(&amp;e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>, partpath);</div>
<div class="line"><span class="lineno">  375</span>    }</div>
<div class="line"><span class="lineno">  376</span>  }</div>
<div class="line"><span class="lineno">  377</span>  <a class="code hl_function" href="mx_8c.html#a2610a2afe8887bb874131a4ba092aa6a">mx_msg_close</a>(m, &amp;src);</div>
<div class="line"><span class="lineno">  378</span>  <a class="code hl_function" href="mx_8c.html#a2610a2afe8887bb874131a4ba092aa6a">mx_msg_close</a>(m, &amp;dest);</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>  <span class="keywordflow">if</span> ((rc == -1) &amp;&amp; restore)</div>
<div class="line"><span class="lineno">  381</span>  {</div>
<div class="line"><span class="lineno">  382</span>    e-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a> = old_body_offset;</div>
<div class="line"><span class="lineno">  383</span>    e-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a> = old_body_length;</div>
<div class="line"><span class="lineno">  384</span>    e-&gt;<a class="code hl_variable" href="structEmail.html#a562a3aee45efc37c07dedcc8e1fef93f">lines</a> = old_hdr_lines;</div>
<div class="line"><span class="lineno">  385</span>  }</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>  <a class="code hl_function" href="email_2body_8c.html#a129af1c316fcbc26b55fb48957bab2cb">mutt_body_free</a>(&amp;e-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">parts</a>);</div>
<div class="line"><span class="lineno">  388</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  389</span>}</div>
<div class="ttc" id="acopy_8c_html_a72172841415fb14e143da3c102be0364"><div class="ttname"><a href="copy_8c.html#a72172841415fb14e143da3c102be0364">mutt_copy_message</a></div><div class="ttdeci">int mutt_copy_message(FILE *fp_out, struct Email *e, struct Message *msg, CopyMessageFlags cmflags, CopyHeaderFlags chflags, int wraplen)</div><div class="ttdoc">Copy a message from a Mailbox.</div><div class="ttdef"><b>Definition</b> <a href="copy_8c_source.html#l00908">copy.c:908</a></div></div>
<div class="ttc" id="acopy_8h_html_a2a61b3ef55bc40f9364eea3f09bb4da8"><div class="ttname"><a href="copy_8h.html#a2a61b3ef55bc40f9364eea3f09bb4da8">MUTT_CM_UPDATE</a></div><div class="ttdeci">#define MUTT_CM_UPDATE</div><div class="ttdoc">Update structs on sync.</div><div class="ttdef"><b>Definition</b> <a href="copy_8h_source.html#l00042">copy.h:42</a></div></div>
<div class="ttc" id="acopy_8h_html_a397b6166af3a14708bddb8ccd0241e11"><div class="ttname"><a href="copy_8h.html#a397b6166af3a14708bddb8ccd0241e11">CH_UPDATE</a></div><div class="ttdeci">#define CH_UPDATE</div><div class="ttdoc">Update the status and x-status fields?</div><div class="ttdef"><b>Definition</b> <a href="copy_8h_source.html#l00054">copy.h:54</a></div></div>
<div class="ttc" id="acopy_8h_html_a94e818174cb0508df54058debb1c631a"><div class="ttname"><a href="copy_8h.html#a94e818174cb0508df54058debb1c631a">CH_UPDATE_LEN</a></div><div class="ttdeci">#define CH_UPDATE_LEN</div><div class="ttdoc">Update Lines: and Content-Length:</div><div class="ttdef"><b>Definition</b> <a href="copy_8h_source.html#l00064">copy.h:64</a></div></div>
<div class="ttc" id="aemail_2body_8c_html_a129af1c316fcbc26b55fb48957bab2cb"><div class="ttname"><a href="email_2body_8c.html#a129af1c316fcbc26b55fb48957bab2cb">mutt_body_free</a></div><div class="ttdeci">void mutt_body_free(struct Body **ptr)</div><div class="ttdoc">Free a Body.</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8c_source.html#l00058">body.c:58</a></div></div>
<div class="ttc" id="amh_8c_html_ac1ea60e60bbc020f83707ee6671fd19c"><div class="ttname"><a href="#ac1ea60e60bbc020f83707ee6671fd19c">mh_commit_msg</a></div><div class="ttdeci">static int mh_commit_msg(struct Mailbox *m, struct Message *msg, struct Email *e, bool updseq)</div><div class="ttdoc">Commit a message to an MH folder.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00244">mh.c:244</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_ad20e00309de897a1e882fc7400335b83"><div class="ttname"><a href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a></div><div class="ttdeci">size_t mutt_str_copy(char *dest, const char *src, size_t dsize)</div><div class="ttdoc">Copy a string into a buffer (guaranteeing NUL-termination)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00581">string.c:581</a></div></div>
<div class="ttc" id="amx_8c_html_a2610a2afe8887bb874131a4ba092aa6a"><div class="ttname"><a href="mx_8c.html#a2610a2afe8887bb874131a4ba092aa6a">mx_msg_close</a></div><div class="ttdeci">int mx_msg_close(struct Mailbox *m, struct Message **ptr)</div><div class="ttdoc">Close a message.</div><div class="ttdef"><b>Definition</b> <a href="mx_8c_source.html#l01185">mx.c:1185</a></div></div>
<div class="ttc" id="amx_8c_html_a9b2902ecb2bebbd553a8ec733ca59886"><div class="ttname"><a href="mx_8c.html#a9b2902ecb2bebbd553a8ec733ca59886">mx_msg_open</a></div><div class="ttdeci">struct Message * mx_msg_open(struct Mailbox *m, struct Email *e)</div><div class="ttdoc">Return a stream pointer for a message.</div><div class="ttdef"><b>Definition</b> <a href="mx_8c_source.html#l01139">mx.c:1139</a></div></div>
<div class="ttc" id="amx_8c_html_ad7adbbda58c642107eadf33b1fbf0c13"><div class="ttname"><a href="mx_8c.html#ad7adbbda58c642107eadf33b1fbf0c13">mx_msg_open_new</a></div><div class="ttdeci">struct Message * mx_msg_open_new(struct Mailbox *m, const struct Email *e, MsgOpenFlags flags)</div><div class="ttdoc">Open a new message.</div><div class="ttdef"><b>Definition</b> <a href="mx_8c_source.html#l01044">mx.c:1044</a></div></div>
<div class="ttc" id="amx_8h_html_a4f461719ebd7d96d0b2f2492c595fc26"><div class="ttname"><a href="mx_8h.html#a4f461719ebd7d96d0b2f2492c595fc26">MUTT_MSG_NO_FLAGS</a></div><div class="ttdeci">#define MUTT_MSG_NO_FLAGS</div><div class="ttdoc">No flags are set.</div><div class="ttdef"><b>Definition</b> <a href="mx_8h_source.html#l00038">mx.h:38</a></div></div>
<div class="ttc" id="astructBody_html_a0b87b7bdb6faef44d9aac4854975f805"><div class="ttname"><a href="structBody.html#a0b87b7bdb6faef44d9aac4854975f805">Body::parts</a></div><div class="ttdeci">struct Body * parts</div><div class="ttdoc">parts of a multipart or message/rfc822</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00073">body.h:73</a></div></div>
<div class="ttc" id="astructBody_html_a1969dfeb0a155ccb16153fe777a103b0"><div class="ttname"><a href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">Body::offset</a></div><div class="ttdeci">LOFF_T offset</div><div class="ttdoc">offset where the actual data begins</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00052">body.h:52</a></div></div>
<div class="ttc" id="astructBody_html_a6f92d7ec8568ca04ae07931c56dd0790"><div class="ttname"><a href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">Body::length</a></div><div class="ttdeci">LOFF_T length</div><div class="ttdoc">length (in bytes) of attachment</div><div class="ttdef"><b>Definition</b> <a href="email_2body_8h_source.html#l00053">body.h:53</a></div></div>
<div class="ttc" id="astructEmail_html_a562a3aee45efc37c07dedcc8e1fef93f"><div class="ttname"><a href="structEmail.html#a562a3aee45efc37c07dedcc8e1fef93f">Email::lines</a></div><div class="ttdeci">int lines</div><div class="ttdoc">How many lines in the body of this message?</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00062">email.h:62</a></div></div>
<div class="ttc" id="astructEmail_html_a57ad6ac618c0f685804f6f5bb390b3a6"><div class="ttname"><a href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">Email::body</a></div><div class="ttdeci">struct Body * body</div><div class="ttdoc">List of MIME parts.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00069">email.h:69</a></div></div>
<div class="ttc" id="astructMessage_html"><div class="ttname"><a href="structMessage.html">Message</a></div><div class="ttdoc">A local copy of an email.</div><div class="ttdef"><b>Definition</b> <a href="core_2message_8h_source.html#l00033">message.h:34</a></div></div>
</div><!-- fragment --><div id="dynsection-10" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_af171daaf22fb156b2426447ab54e861c_cgraph.svg" width="570" height="534"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-11" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_af171daaf22fb156b2426447ab54e861c_icgraph.svg" width="347" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8f975cd8a104fe6a996e4506eadb8f95" name="a8f975cd8a104fe6a996e4506eadb8f95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f975cd8a104fe6a996e4506eadb8f95">&#9670;&#160;</a></span>mh_sync_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mh_sync_message </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structEmail.html">Email</a> *</td>          <td class="paramname"><span class="paramname"><em>e</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sync an email to an MH folder. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramname">e</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00398">398</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  399</span>{</div>
<div class="line"><span class="lineno">  400</span>  <span class="keywordflow">if</span> (!m || !e)</div>
<div class="line"><span class="lineno">  401</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span>  <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="structEmail.html#a8d4df03be101c132581352d182ae99ae">attach_del</a> || e-&gt;<a class="code hl_variable" href="structEmail.html#a34cc4493729d7a3b1f4ed783e739a9ec">env</a>-&gt;<a class="code hl_variable" href="structEnvelope.html#a3e2b8b426bb895a4817f9bebff11bbcc">changed</a>)</div>
<div class="line"><span class="lineno">  404</span>  {</div>
<div class="line"><span class="lineno">  405</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#af171daaf22fb156b2426447ab54e861c">mh_rewrite_message</a>(m, e) != 0)</div>
<div class="line"><span class="lineno">  406</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  407</span>    e-&gt;<a class="code hl_variable" href="structEmail.html#a34cc4493729d7a3b1f4ed783e739a9ec">env</a>-&gt;<a class="code hl_variable" href="structEnvelope.html#a3e2b8b426bb895a4817f9bebff11bbcc">changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  408</span>  }</div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  411</span>}</div>
<div class="ttc" id="amh_8c_html_af171daaf22fb156b2426447ab54e861c"><div class="ttname"><a href="#af171daaf22fb156b2426447ab54e861c">mh_rewrite_message</a></div><div class="ttdeci">static int mh_rewrite_message(struct Mailbox *m, struct Email *e)</div><div class="ttdoc">Sync a message in an MH folder.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00324">mh.c:324</a></div></div>
<div class="ttc" id="astructEmail_html_a34cc4493729d7a3b1f4ed783e739a9ec"><div class="ttname"><a href="structEmail.html#a34cc4493729d7a3b1f4ed783e739a9ec">Email::env</a></div><div class="ttdeci">struct Envelope * env</div><div class="ttdoc">Envelope information.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00068">email.h:68</a></div></div>
<div class="ttc" id="astructEmail_html_a8d4df03be101c132581352d182ae99ae"><div class="ttname"><a href="structEmail.html#a8d4df03be101c132581352d182ae99ae">Email::attach_del</a></div><div class="ttdeci">bool attach_del</div><div class="ttdoc">Has an attachment marked for deletion.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00099">email.h:99</a></div></div>
<div class="ttc" id="astructEnvelope_html_a3e2b8b426bb895a4817f9bebff11bbcc"><div class="ttname"><a href="structEnvelope.html#a3e2b8b426bb895a4817f9bebff11bbcc">Envelope::changed</a></div><div class="ttdeci">unsigned char changed</div><div class="ttdoc">Changed fields, e.g. MUTT_ENV_CHANGED_SUBJECT.</div><div class="ttdef"><b>Definition</b> <a href="envelope_8h_source.html#l00090">envelope.h:90</a></div></div>
</div><!-- fragment --><div id="dynsection-12" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a8f975cd8a104fe6a996e4506eadb8f95_cgraph.svg" width="347" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-13" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a8f975cd8a104fe6a996e4506eadb8f95_icgraph.svg" width="384" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a18d1d5ae034020d3672a2bfb04d3ed68" name="a18d1d5ae034020d3672a2bfb04d3ed68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18d1d5ae034020d3672a2bfb04d3ed68">&#9670;&#160;</a></span>mh_update_mtime()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mh_update_mtime </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update our record of the mailbox modification time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00417">417</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  418</span>{</div>
<div class="line"><span class="lineno">  419</span>  <span class="keywordtype">char</span> buf[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  420</span>  <span class="keyword">struct </span>stat st = { 0 };</div>
<div class="line"><span class="lineno">  421</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhMboxData.html">MhMboxData</a> *<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a> = <a class="code hl_function" href="mh_2mdata_8c.html#a5d572a4239365af11ea4ed4799486678">mh_mdata_get</a>(m);</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>  snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s/.mh_sequences&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  424</span>  <span class="keywordflow">if</span> (stat(buf, &amp;st) == 0)</div>
<div class="line"><span class="lineno">  425</span>    <a class="code hl_function" href="file_8c.html#a0a1a67cd697cb0074317215d4ce6c9e3">mutt_file_get_stat_timespec</a>(&amp;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;mtime_seq, &amp;st, <a class="code hl_enumvalue" href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a>);</div>
<div class="line"><span class="lineno">  426</span> </div>
<div class="line"><span class="lineno">  427</span>  <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(buf, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>  <span class="keywordflow">if</span> (stat(buf, &amp;st) == 0)</div>
<div class="line"><span class="lineno">  430</span>    <a class="code hl_function" href="file_8c.html#a0a1a67cd697cb0074317215d4ce6c9e3">mutt_file_get_stat_timespec</a>(&amp;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;mtime, &amp;st, <a class="code hl_enumvalue" href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a>);</div>
<div class="line"><span class="lineno">  431</span>}</div>
<div class="ttc" id="afile_8c_html_a0a1a67cd697cb0074317215d4ce6c9e3"><div class="ttname"><a href="file_8c.html#a0a1a67cd697cb0074317215d4ce6c9e3">mutt_file_get_stat_timespec</a></div><div class="ttdeci">void mutt_file_get_stat_timespec(struct timespec *dest, struct stat *st, enum MuttStatType type)</div><div class="ttdoc">Read the stat() time into a time value.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l01472">file.c:1472</a></div></div>
<div class="ttc" id="amh_2mdata_8c_html_a5d572a4239365af11ea4ed4799486678"><div class="ttname"><a href="mh_2mdata_8c.html#a5d572a4239365af11ea4ed4799486678">mh_mdata_get</a></div><div class="ttdeci">struct MhMboxData * mh_mdata_get(struct Mailbox *m)</div><div class="ttdoc">Get the private data for this Mailbox.</div><div class="ttdef"><b>Definition</b> <a href="mh_2mdata_8c_source.html#l00059">mdata.c:59</a></div></div>
<div class="ttc" id="astructMailbox_html_a69b544c5c748ab3046dcc6e61a41f595"><div class="ttname"><a href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">Mailbox::mdata</a></div><div class="ttdeci">void * mdata</div><div class="ttdoc">Driver specific data.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00132">mailbox.h:132</a></div></div>
<div class="ttc" id="astructMhMboxData_html"><div class="ttname"><a href="structMhMboxData.html">MhMboxData</a></div><div class="ttdoc">Mh-specific Mailbox data -.</div><div class="ttdef"><b>Definition</b> <a href="mh_2mdata_8h_source.html#l00034">mdata.h:35</a></div></div>
</div><!-- fragment --><div id="dynsection-14" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a18d1d5ae034020d3672a2bfb04d3ed68_cgraph.svg" width="328" height="219"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-15" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a18d1d5ae034020d3672a2bfb04d3ed68_icgraph.svg" width="312" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7aadbbd4acc00a4cd42fd42faf97f806" name="a7aadbbd4acc00a4cd42fd42faf97f806"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7aadbbd4acc00a4cd42fd42faf97f806">&#9670;&#160;</a></span>mh_parse_dir()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mh_parse_dir </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct MhEmailArray *</td>          <td class="paramname"><span class="paramname"><em>mha</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct Progress *</td>          <td class="paramname"><span class="paramname"><em>progress</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read an Mh mailbox. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mha</td><td>Array for results </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">progress</td><td>Progress bar </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
    <tr><td class="paramname">-2</td><td>Aborted </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00442">442</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  443</span>{</div>
<div class="line"><span class="lineno">  444</span>  <span class="keyword">struct </span>dirent *de = NULL;</div>
<div class="line"><span class="lineno">  445</span>  <span class="keywordtype">int</span> rc = 0;</div>
<div class="line"><span class="lineno">  446</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> *entry = NULL;</div>
<div class="line"><span class="lineno">  447</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = NULL;</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *buf = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  450</span>  <a class="code hl_function" href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a>(buf, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  451</span> </div>
<div class="line"><span class="lineno">  452</span>  DIR *dir = <a class="code hl_function" href="file_8c.html#a69da918c66c3f22815d6e4aed88b6122">mutt_file_opendir</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(buf), <a class="code hl_enumvalue" href="file_8h.html#a222e4f679593f00cd8c126212b3cdb3ba88d03a1ea19c4b7fdccd5dfc936a7a60">MUTT_OPENDIR_NONE</a>);</div>
<div class="line"><span class="lineno">  453</span>  <span class="keywordflow">if</span> (!dir)</div>
<div class="line"><span class="lineno">  454</span>  {</div>
<div class="line"><span class="lineno">  455</span>    rc = -1;</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="lineno">  457</span>  }</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>  <span class="keywordflow">while</span> (((de = readdir(dir))) &amp;&amp; !<a class="code hl_variable" href="signal_8c.html#a85c069643781da758ffa8281db66e8f0">SigInt</a>)</div>
<div class="line"><span class="lineno">  460</span>  {</div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a6223240d84e5ce2b19911dd83877cbed">mh_valid_message</a>(de-&gt;d_name))</div>
<div class="line"><span class="lineno">  462</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;queueing %s\n&quot;</span>, de-&gt;d_name);</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>    e = <a class="code hl_function" href="email_2email_8c.html#ab53e91414f24cecdc75fcfea6f1824e3">email_new</a>();</div>
<div class="line"><span class="lineno">  467</span> </div>
<div class="line"><span class="lineno">  468</span>    <a class="code hl_function" href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a>(progress, <a class="code hl_define" href="array_8h.html#a7f1bf469a48c0a2618c94b7b8281c5bf">ARRAY_SIZE</a>(mha) + 1, -1);</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>    e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(de-&gt;d_name);</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>    entry = <a class="code hl_function" href="mhemail_8c.html#a19b26ea2b819930498ad8a7a42d95d87">mh_entry_new</a>();</div>
<div class="line"><span class="lineno">  473</span>    entry-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a> = e;</div>
<div class="line"><span class="lineno">  474</span>    <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(mha, entry);</div>
<div class="line"><span class="lineno">  475</span>  }</div>
<div class="line"><span class="lineno">  476</span> </div>
<div class="line"><span class="lineno">  477</span>  closedir(dir);</div>
<div class="line"><span class="lineno">  478</span> </div>
<div class="line"><span class="lineno">  479</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="signal_8c.html#a85c069643781da758ffa8281db66e8f0">SigInt</a>)</div>
<div class="line"><span class="lineno">  480</span>  {</div>
<div class="line"><span class="lineno">  481</span>    <a class="code hl_variable" href="signal_8c.html#a85c069643781da758ffa8281db66e8f0">SigInt</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  482</span>    <span class="keywordflow">return</span> -2; <span class="comment">/* action aborted */</span></div>
<div class="line"><span class="lineno">  483</span>  }</div>
<div class="line"><span class="lineno">  484</span> </div>
<div class="line"><span class="lineno">  485</span>cleanup:</div>
<div class="line"><span class="lineno">  486</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;buf);</div>
<div class="line"><span class="lineno">  487</span> </div>
<div class="line"><span class="lineno">  488</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  489</span>}</div>
<div class="ttc" id="aarray_8h_html_a4f570f2382025383e4b2cc46ede6ebd0"><div class="ttname"><a href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a></div><div class="ttdeci">#define ARRAY_ADD(head, elem)</div><div class="ttdoc">Add an element at the end of the array.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00156">array.h:156</a></div></div>
<div class="ttc" id="aarray_8h_html_a7f1bf469a48c0a2618c94b7b8281c5bf"><div class="ttname"><a href="array_8h.html#a7f1bf469a48c0a2618c94b7b8281c5bf">ARRAY_SIZE</a></div><div class="ttdeci">#define ARRAY_SIZE(head)</div><div class="ttdoc">The number of elements stored.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00087">array.h:87</a></div></div>
<div class="ttc" id="abuffer_8c_html_ac958acbd189e463a2c3bbc2f23aaeb1e"><div class="ttname"><a href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a></div><div class="ttdeci">size_t buf_strcpy(struct Buffer *buf, const char *s)</div><div class="ttdoc">Copy a string into a Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00395">buffer.c:395</a></div></div>
<div class="ttc" id="aemail_2email_8c_html_ab53e91414f24cecdc75fcfea6f1824e3"><div class="ttname"><a href="email_2email_8c.html#ab53e91414f24cecdc75fcfea6f1824e3">email_new</a></div><div class="ttdeci">struct Email * email_new(void)</div><div class="ttdoc">Create a new Email.</div><div class="ttdef"><b>Definition</b> <a href="email_2email_8c_source.html#l00077">email.c:77</a></div></div>
<div class="ttc" id="amhemail_8c_html_a19b26ea2b819930498ad8a7a42d95d87"><div class="ttname"><a href="mhemail_8c.html#a19b26ea2b819930498ad8a7a42d95d87">mh_entry_new</a></div><div class="ttdeci">struct MhEmail * mh_entry_new(void)</div><div class="ttdoc">Create a new Mh entry.</div><div class="ttdef"><b>Definition</b> <a href="mhemail_8c_source.html#l00039">mhemail.c:39</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a3fe33d90e4814281cd57de048119c950"><div class="ttname"><a href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a></div><div class="ttdeci">char * mutt_str_dup(const char *str)</div><div class="ttdoc">Copy a string, safely.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00255">string.c:255</a></div></div>
<div class="ttc" id="apool_8c_html_a41cba27c25d33cb6822789a2856093f2"><div class="ttname"><a href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a></div><div class="ttdeci">struct Buffer * buf_pool_get(void)</div><div class="ttdoc">Get a Buffer from the pool.</div><div class="ttdef"><b>Definition</b> <a href="pool_8c_source.html#l00082">pool.c:82</a></div></div>
<div class="ttc" id="apool_8c_html_a4cc6068279461cb8628219586dfa35a1"><div class="ttname"><a href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a></div><div class="ttdeci">void buf_pool_release(struct Buffer **ptr)</div><div class="ttdoc">Return a Buffer to the pool.</div><div class="ttdef"><b>Definition</b> <a href="pool_8c_source.html#l00096">pool.c:96</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_ae0ca330f9059a039a4ece5cb1b00155b"><div class="ttname"><a href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a></div><div class="ttdeci">bool progress_update(struct Progress *progress, size_t pos, int percent)</div><div class="ttdoc">Update the state of the progress bar.</div><div class="ttdef"><b>Definition</b> <a href="progress_8c_source.html#l00080">progress.c:80</a></div></div>
<div class="ttc" id="asignal_8c_html_a85c069643781da758ffa8281db66e8f0"><div class="ttname"><a href="signal_8c.html#a85c069643781da758ffa8281db66e8f0">SigInt</a></div><div class="ttdeci">volatile sig_atomic_t SigInt</div><div class="ttdoc">true after SIGINT is received</div><div class="ttdef"><b>Definition</b> <a href="signal_8c_source.html#l00068">signal.c:68</a></div></div>
<div class="ttc" id="astructBuffer_html"><div class="ttname"><a href="structBuffer.html">Buffer</a></div><div class="ttdoc">String manipulation buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00035">buffer.h:36</a></div></div>
<div class="ttc" id="astructEmail_html"><div class="ttname"><a href="structEmail.html">Email</a></div><div class="ttdoc">The envelope/body of an email.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00038">email.h:39</a></div></div>
</div><!-- fragment --><div id="dynsection-16" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a7aadbbd4acc00a4cd42fd42faf97f806_cgraph.svg" width="434" height="571"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-17" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a7aadbbd4acc00a4cd42fd42faf97f806_icgraph.svg" width="263" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af0af3fc3f68028dca25071dde7f27791" name="af0af3fc3f68028dca25071dde7f27791"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0af3fc3f68028dca25071dde7f27791">&#9670;&#160;</a></span>mh_parse_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structEmail.html">Email</a> * mh_parse_message </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>fname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structEmail.html">Email</a> *</td>          <td class="paramname"><span class="paramname"><em>e</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Actually parse an MH message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fname</td><td><a class="el" href="structMessage.html" title="A local copy of an email.">Message</a> filename </td></tr>
    <tr><td class="paramname">e</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> to populate (OPTIONAL) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Populated <a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a></td></tr>
  </table>
  </dd>
</dl>
<p>This may also be used to fill out a fake header structure generated by lazy mh parsing. </p>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00510">510</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  511</span>{</div>
<div class="line"><span class="lineno">  512</span>  FILE *fp = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(fname, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">  513</span>  <span class="keywordflow">if</span> (!fp)</div>
<div class="line"><span class="lineno">  514</span>  {</div>
<div class="line"><span class="lineno">  515</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  516</span>  }</div>
<div class="line"><span class="lineno">  517</span> </div>
<div class="line"><span class="lineno">  518</span>  <span class="keyword">const</span> <span class="keywordtype">long</span> size = <a class="code hl_function" href="file_8c.html#a4cffa4f503de3736198956ebed431f7e">mutt_file_get_size_fp</a>(fp);</div>
<div class="line"><span class="lineno">  519</span>  <span class="keywordflow">if</span> (size == 0)</div>
<div class="line"><span class="lineno">  520</span>  {</div>
<div class="line"><span class="lineno">  521</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  522</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  523</span>  }</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>  <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno">  526</span>    e = <a class="code hl_function" href="email_2email_8c.html#ab53e91414f24cecdc75fcfea6f1824e3">email_new</a>();</div>
<div class="line"><span class="lineno">  527</span> </div>
<div class="line"><span class="lineno">  528</span>  e-&gt;<a class="code hl_variable" href="structEmail.html#a34cc4493729d7a3b1f4ed783e739a9ec">env</a> = <a class="code hl_function" href="email_2parse_8c.html#a709f7f23d8a54a0f75abc28a0b365ace">mutt_rfc822_read_header</a>(fp, e, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  529</span> </div>
<div class="line"><span class="lineno">  530</span>  <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="structEmail.html#af64bcf33ccd8b0ba248fc8d427c21264">received</a> != 0)</div>
<div class="line"><span class="lineno">  531</span>    e-&gt;<a class="code hl_variable" href="structEmail.html#af64bcf33ccd8b0ba248fc8d427c21264">received</a> = e-&gt;<a class="code hl_variable" href="structEmail.html#a9e3cda5dab6d53f68cad95d28068d962">date_sent</a>;</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>  <span class="comment">/* always update the length since we have fresh information available. */</span></div>
<div class="line"><span class="lineno">  534</span>  e-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a6f92d7ec8568ca04ae07931c56dd0790">length</a> = size - e-&gt;<a class="code hl_variable" href="structEmail.html#a57ad6ac618c0f685804f6f5bb390b3a6">body</a>-&gt;<a class="code hl_variable" href="structBody.html#a1969dfeb0a155ccb16153fe777a103b0">offset</a>;</div>
<div class="line"><span class="lineno">  535</span>  e-&gt;<a class="code hl_variable" href="structEmail.html#ace0e20a11dbdc84ca9ea63497c05b603">index</a> = -1;</div>
<div class="line"><span class="lineno">  536</span> </div>
<div class="line"><span class="lineno">  537</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  538</span>  <span class="keywordflow">return</span> e;</div>
<div class="line"><span class="lineno">  539</span>}</div>
<div class="ttc" id="aemail_2parse_8c_html_a709f7f23d8a54a0f75abc28a0b365ace"><div class="ttname"><a href="email_2parse_8c.html#a709f7f23d8a54a0f75abc28a0b365ace">mutt_rfc822_read_header</a></div><div class="ttdeci">struct Envelope * mutt_rfc822_read_header(FILE *fp, struct Email *e, bool user_hdrs, bool weed)</div><div class="ttdoc">Parses an RFC822 header.</div><div class="ttdef"><b>Definition</b> <a href="email_2parse_8c_source.html#l01204">parse.c:1204</a></div></div>
<div class="ttc" id="afile_8c_html_a4cffa4f503de3736198956ebed431f7e"><div class="ttname"><a href="file_8c.html#a4cffa4f503de3736198956ebed431f7e">mutt_file_get_size_fp</a></div><div class="ttdeci">long mutt_file_get_size_fp(FILE *fp)</div><div class="ttdoc">Get the size of a file.</div><div class="ttdef"><b>Definition</b> <a href="file_8c_source.html#l01430">file.c:1430</a></div></div>
<div class="ttc" id="afile_8h_html_a9b519e795f098be88b93cd72c49a35ec"><div class="ttname"><a href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a></div><div class="ttdeci">#define mutt_file_fclose(FP)</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00139">file.h:139</a></div></div>
<div class="ttc" id="afile_8h_html_a9fa358d76519cb6bc8ffca5850976d46"><div class="ttname"><a href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a></div><div class="ttdeci">#define mutt_file_fopen(PATH, MODE)</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00138">file.h:138</a></div></div>
<div class="ttc" id="astructEmail_html_a9e3cda5dab6d53f68cad95d28068d962"><div class="ttname"><a href="structEmail.html#a9e3cda5dab6d53f68cad95d28068d962">Email::date_sent</a></div><div class="ttdeci">time_t date_sent</div><div class="ttdoc">Time when the message was sent (UTC)</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00060">email.h:60</a></div></div>
<div class="ttc" id="astructEmail_html_ace0e20a11dbdc84ca9ea63497c05b603"><div class="ttname"><a href="structEmail.html#ace0e20a11dbdc84ca9ea63497c05b603">Email::index</a></div><div class="ttdeci">int index</div><div class="ttdoc">The absolute (unsorted) message number.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00110">email.h:110</a></div></div>
<div class="ttc" id="astructEmail_html_af64bcf33ccd8b0ba248fc8d427c21264"><div class="ttname"><a href="structEmail.html#af64bcf33ccd8b0ba248fc8d427c21264">Email::received</a></div><div class="ttdeci">time_t received</div><div class="ttdoc">Time when the message was placed in the mailbox.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00061">email.h:61</a></div></div>
</div><!-- fragment --><div id="dynsection-18" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_af0af3fc3f68028dca25071dde7f27791_cgraph.svg" width="386" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-19" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_af0af3fc3f68028dca25071dde7f27791_icgraph.svg" width="351" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad2d3ae203f62bb52381ac736a0e8292b" name="ad2d3ae203f62bb52381ac736a0e8292b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2d3ae203f62bb52381ac736a0e8292b">&#9670;&#160;</a></span>mh_delayed_parsing()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mh_delayed_parsing </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct MhEmailArray *</td>          <td class="paramname"><span class="paramname"><em>mha</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct Progress *</td>          <td class="paramname"><span class="paramname"><em>progress</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function does the second parsing pass. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mha</td><td>Mh array to parse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">progress</td><td>Progress bar </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00547">547</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  549</span>{</div>
<div class="line"><span class="lineno">  550</span>  <span class="keywordtype">char</span> fn[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  553</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_header_cache = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;header_cache&quot;</span>);</div>
<div class="line"><span class="lineno">  554</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structHeaderCache.html">HeaderCache</a> *hc = <a class="code hl_function" href="hcache_2hcache_8c.html#a5691b8a075665d48c570eb105a472556">hcache_open</a>(c_header_cache, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), NULL, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  555</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  556</span> </div>
<div class="line"><span class="lineno">  557</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> *md = NULL;</div>
<div class="line"><span class="lineno">  558</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> **mdp = NULL;</div>
<div class="line"><span class="lineno">  559</span>  <a class="code hl_define" href="array_8h.html#a6b8ea5fb2f366d7716f5042b347093a6">ARRAY_FOREACH</a>(mdp, mha)</div>
<div class="line"><span class="lineno">  560</span>  {</div>
<div class="line"><span class="lineno">  561</span>    md = *mdp;</div>
<div class="line"><span class="lineno">  562</span>    <span class="keywordflow">if</span> (!md || !md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a> || md-&gt;<a class="code hl_variable" href="structMhEmail.html#a0d4a5cfe0f8a2086e3791f02b352b0af">header_parsed</a>)</div>
<div class="line"><span class="lineno">  563</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>    <a class="code hl_function" href="progress_2lib_8h.html#ae0ca330f9059a039a4ece5cb1b00155b">progress_update</a>(progress, ARRAY_FOREACH_IDX_mdp, -1);</div>
<div class="line"><span class="lineno">  566</span> </div>
<div class="line"><span class="lineno">  567</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  568</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *key = md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>;</div>
<div class="line"><span class="lineno">  569</span>    <span class="keywordtype">size_t</span> keylen = strlen(key);</div>
<div class="line"><span class="lineno">  570</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structHCacheEntry.html">HCacheEntry</a> hce = <a class="code hl_function" href="hcache_2hcache_8c.html#a8ef10068ab1140db0955929b282525f6">hcache_fetch_email</a>(hc, key, keylen, 0);</div>
<div class="line"><span class="lineno">  571</span> </div>
<div class="line"><span class="lineno">  572</span>    <span class="keywordflow">if</span> (hce.<a class="code hl_variable" href="structHCacheEntry.html#a5348d7756835f94b4173db6afc4849eb">email</a>)</div>
<div class="line"><span class="lineno">  573</span>    {</div>
<div class="line"><span class="lineno">  574</span>      hce.<a class="code hl_variable" href="structHCacheEntry.html#a5348d7756835f94b4173db6afc4849eb">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#a6d9062408a8c89b19cf25584dd2ffb57">old</a> = md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#a6d9062408a8c89b19cf25584dd2ffb57">old</a>;</div>
<div class="line"><span class="lineno">  575</span>      hce.<a class="code hl_variable" href="structHCacheEntry.html#a5348d7756835f94b4173db6afc4849eb">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno">  576</span>      <a class="code hl_function" href="email_2email_8c.html#ae9f719d3fc31d00b92bcf9f77d56ee67">email_free</a>(&amp;md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>);</div>
<div class="line"><span class="lineno">  577</span>      md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a> = hce.<a class="code hl_variable" href="structHCacheEntry.html#a5348d7756835f94b4173db6afc4849eb">email</a>;</div>
<div class="line"><span class="lineno">  578</span>    }</div>
<div class="line"><span class="lineno">  579</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  580</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  581</span>    {</div>
<div class="line"><span class="lineno">  582</span>      snprintf(fn, <span class="keyword">sizeof</span>(fn), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="#af0af3fc3f68028dca25071dde7f27791">mh_parse_message</a>(fn, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>))</div>
<div class="line"><span class="lineno">  585</span>      {</div>
<div class="line"><span class="lineno">  586</span>        md-&gt;<a class="code hl_variable" href="structMhEmail.html#a0d4a5cfe0f8a2086e3791f02b352b0af">header_parsed</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  587</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  588</span>        key = md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>;</div>
<div class="line"><span class="lineno">  589</span>        keylen = strlen(key);</div>
<div class="line"><span class="lineno">  590</span>        <a class="code hl_function" href="hcache_2hcache_8c.html#a9e0172956ca278dc113eefc10baef638">hcache_store_email</a>(hc, key, keylen, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>, 0);</div>
<div class="line"><span class="lineno">  591</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  592</span>      }</div>
<div class="line"><span class="lineno">  593</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  594</span>      {</div>
<div class="line"><span class="lineno">  595</span>        <a class="code hl_function" href="email_2email_8c.html#ae9f719d3fc31d00b92bcf9f77d56ee67">email_free</a>(&amp;md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>);</div>
<div class="line"><span class="lineno">  596</span>      }</div>
<div class="line"><span class="lineno">  597</span>    }</div>
<div class="line"><span class="lineno">  598</span>  }</div>
<div class="line"><span class="lineno">  599</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  600</span>  <a class="code hl_function" href="hcache_2hcache_8c.html#a791c8437997aca5d8747271ff4c75e98">hcache_close</a>(&amp;hc);</div>
<div class="line"><span class="lineno">  601</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  602</span> </div>
<div class="line"><span class="lineno">  603</span>  <span class="keyword">const</span> <span class="keyword">enum</span> <a class="code hl_enumeration" href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4">EmailSortType</a> c_sort = <a class="code hl_function" href="config_2helpers_8c.html#af7f3de51c3c2f5b8f527f40c8397a3fc">cs_subset_sort</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;sort&quot;</span>);</div>
<div class="line"><span class="lineno">  604</span>  <span class="keywordflow">if</span> (m &amp;&amp; mha &amp;&amp; (<a class="code hl_define" href="array_8h.html#a7f1bf469a48c0a2618c94b7b8281c5bf">ARRAY_SIZE</a>(mha) &gt; 0) &amp;&amp; (c_sort == <a class="code hl_enumvalue" href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4aa5fa714c8f7a789cb67f5d22cd014361">EMAIL_SORT_UNSORTED</a>))</div>
<div class="line"><span class="lineno">  605</span>  {</div>
<div class="line"><span class="lineno">  606</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a51339e1b6c72f67dcc9649e7859789c5">LL_DEBUG3</a>, <span class="stringliteral">&quot;mh: sorting %s into natural order\n&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  607</span>    <a class="code hl_define" href="array_8h.html#a3b58598337ec447421a317fa2f836ebd">ARRAY_SORT</a>(mha, <a class="code hl_function" href="group__sort__api.html#ga6f4af5f39354f7748e2268bd53538de4">mh_sort_path</a>, NULL);</div>
<div class="line"><span class="lineno">  608</span>  }</div>
<div class="line"><span class="lineno">  609</span>}</div>
<div class="ttc" id="aarray_8h_html_a3b58598337ec447421a317fa2f836ebd"><div class="ttname"><a href="array_8h.html#a3b58598337ec447421a317fa2f836ebd">ARRAY_SORT</a></div><div class="ttdeci">#define ARRAY_SORT(head, fn, sdata)</div><div class="ttdoc">Sort an array.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00335">array.h:335</a></div></div>
<div class="ttc" id="aconfig_2helpers_8c_html_a9f184e61342916799259930333f4205f"><div class="ttname"><a href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00168">helpers.c:168</a></div></div>
<div class="ttc" id="aconfig_2helpers_8c_html_af7f3de51c3c2f5b8f527f40c8397a3fc"><div class="ttname"><a href="config_2helpers_8c.html#af7f3de51c3c2f5b8f527f40c8397a3fc">cs_subset_sort</a></div><div class="ttdeci">short cs_subset_sort(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a sort config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00266">helpers.c:266</a></div></div>
<div class="ttc" id="aemail_2email_8c_html_ae9f719d3fc31d00b92bcf9f77d56ee67"><div class="ttname"><a href="email_2email_8c.html#ae9f719d3fc31d00b92bcf9f77d56ee67">email_free</a></div><div class="ttdeci">void email_free(struct Email **ptr)</div><div class="ttdoc">Free an Email.</div><div class="ttdef"><b>Definition</b> <a href="email_2email_8c_source.html#l00046">email.c:46</a></div></div>
<div class="ttc" id="aemail_2sort_8h_html_aefa89e4f16231d09e09e4693bebf6dd4"><div class="ttname"><a href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4">EmailSortType</a></div><div class="ttdeci">EmailSortType</div><div class="ttdoc">Methods for sorting Emails.</div><div class="ttdef"><b>Definition</b> <a href="email_2sort_8h_source.html#l00052">sort.h:53</a></div></div>
<div class="ttc" id="aemail_2sort_8h_html_aefa89e4f16231d09e09e4693bebf6dd4aa5fa714c8f7a789cb67f5d22cd014361"><div class="ttname"><a href="email_2sort_8h.html#aefa89e4f16231d09e09e4693bebf6dd4aa5fa714c8f7a789cb67f5d22cd014361">EMAIL_SORT_UNSORTED</a></div><div class="ttdeci">@ EMAIL_SORT_UNSORTED</div><div class="ttdoc">Sort by the order the messages appear in the mailbox.</div><div class="ttdef"><b>Definition</b> <a href="email_2sort_8h_source.html#l00064">sort.h:64</a></div></div>
<div class="ttc" id="agroup__sort__api_html_ga6f4af5f39354f7748e2268bd53538de4"><div class="ttname"><a href="group__sort__api.html#ga6f4af5f39354f7748e2268bd53538de4">mh_sort_path</a></div><div class="ttdeci">static int mh_sort_path(const void *a, const void *b, void *sdata)</div><div class="ttdoc">Compare two Mh Mailboxes by path - Implements sort_t -.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00494">mh.c:494</a></div></div>
<div class="ttc" id="ahcache_2hcache_8c_html_a5691b8a075665d48c570eb105a472556"><div class="ttname"><a href="hcache_2hcache_8c.html#a5691b8a075665d48c570eb105a472556">hcache_open</a></div><div class="ttdeci">struct HeaderCache * hcache_open(const char *path, const char *folder, hcache_namer_t namer, bool create)</div><div class="ttdoc">Multiplexor for StoreOps::open.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2hcache_8c_source.html#l00473">hcache.c:473</a></div></div>
<div class="ttc" id="ahcache_2hcache_8c_html_a791c8437997aca5d8747271ff4c75e98"><div class="ttname"><a href="hcache_2hcache_8c.html#a791c8437997aca5d8747271ff4c75e98">hcache_close</a></div><div class="ttdeci">void hcache_close(struct HeaderCache **ptr)</div><div class="ttdoc">Multiplexor for StoreOps::close.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2hcache_8c_source.html#l00544">hcache.c:544</a></div></div>
<div class="ttc" id="ahcache_2hcache_8c_html_a8ef10068ab1140db0955929b282525f6"><div class="ttname"><a href="hcache_2hcache_8c.html#a8ef10068ab1140db0955929b282525f6">hcache_fetch_email</a></div><div class="ttdeci">struct HCacheEntry hcache_fetch_email(struct HeaderCache *hc, const char *key, size_t keylen, uint32_t uidvalidity)</div><div class="ttdoc">Multiplexor for StoreOps::fetch.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2hcache_8c_source.html#l00564">hcache.c:564</a></div></div>
<div class="ttc" id="ahcache_2hcache_8c_html_a9e0172956ca278dc113eefc10baef638"><div class="ttname"><a href="hcache_2hcache_8c.html#a9e0172956ca278dc113eefc10baef638">hcache_store_email</a></div><div class="ttdeci">int hcache_store_email(struct HeaderCache *hc, const char *key, size_t keylen, struct Email *e, uint32_t uidvalidity)</div><div class="ttdoc">Multiplexor for StoreOps::store.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2hcache_8c_source.html#l00672">hcache.c:672</a></div></div>
<div class="ttc" id="alogging2_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a51339e1b6c72f67dcc9649e7859789c5"><div class="ttname"><a href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a51339e1b6c72f67dcc9649e7859789c5">LL_DEBUG3</a></div><div class="ttdeci">@ LL_DEBUG3</div><div class="ttdoc">Log at debug level 3.</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00046">logging2.h:46</a></div></div>
<div class="ttc" id="amh_8c_html_af0af3fc3f68028dca25071dde7f27791"><div class="ttname"><a href="#af0af3fc3f68028dca25071dde7f27791">mh_parse_message</a></div><div class="ttdeci">static struct Email * mh_parse_message(const char *fname, struct Email *e)</div><div class="ttdoc">Actually parse an MH message.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00510">mh.c:510</a></div></div>
<div class="ttc" id="astructEmail_html_a6d9062408a8c89b19cf25584dd2ffb57"><div class="ttname"><a href="structEmail.html#a6d9062408a8c89b19cf25584dd2ffb57">Email::old</a></div><div class="ttdeci">bool old</div><div class="ttdoc">Email is seen, but unread.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00049">email.h:49</a></div></div>
<div class="ttc" id="astructHCacheEntry_html"><div class="ttname"><a href="structHCacheEntry.html">HCacheEntry</a></div><div class="ttdoc">Wrapper for Email retrieved from the header cache.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2lib_8h_source.html#l00098">lib.h:99</a></div></div>
<div class="ttc" id="astructHCacheEntry_html_a5348d7756835f94b4173db6afc4849eb"><div class="ttname"><a href="structHCacheEntry.html#a5348d7756835f94b4173db6afc4849eb">HCacheEntry::email</a></div><div class="ttdeci">struct Email * email</div><div class="ttdoc">Retrieved email.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2lib_8h_source.html#l00102">lib.h:102</a></div></div>
<div class="ttc" id="astructHeaderCache_html"><div class="ttname"><a href="structHeaderCache.html">HeaderCache</a></div><div class="ttdoc">Header Cache.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2lib_8h_source.html#l00085">lib.h:86</a></div></div>
<div class="ttc" id="astructMhEmail_html_a0d4a5cfe0f8a2086e3791f02b352b0af"><div class="ttname"><a href="structMhEmail.html#a0d4a5cfe0f8a2086e3791f02b352b0af">MhEmail::header_parsed</a></div><div class="ttdeci">bool header_parsed</div><div class="ttdoc">Has the Email header been parsed?</div><div class="ttdef"><b>Definition</b> <a href="mhemail_8h_source.html#l00039">mhemail.h:39</a></div></div>
<div class="ttc" id="astructNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00041">neomutt.h:42</a></div></div>
<div class="ttc" id="astructNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00046">neomutt.h:46</a></div></div>
</div><!-- fragment --><div id="dynsection-20" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ad2d3ae203f62bb52381ac736a0e8292b_cgraph.svg" width="351" height="651"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-21" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ad2d3ae203f62bb52381ac736a0e8292b_icgraph.svg" width="306" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae417c6c4670e084ec2e371ef09e26e35" name="ae417c6c4670e084ec2e371ef09e26e35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae417c6c4670e084ec2e371ef09e26e35">&#9670;&#160;</a></span>mh_move_to_mailbox()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int mh_move_to_mailbox </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct MhEmailArray *</td>          <td class="paramname"><span class="paramname"><em>mha</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copy the Mh list to the <a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mha</td><td>Mh array to copy, then free </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">num</td><td>Number of new emails </td></tr>
    <tr><td class="paramname">0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00618">618</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  619</span>{</div>
<div class="line"><span class="lineno">  620</span>  <span class="keywordflow">if</span> (!m)</div>
<div class="line"><span class="lineno">  621</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  622</span> </div>
<div class="line"><span class="lineno">  623</span>  <span class="keywordtype">int</span> oldmsgcount = m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>;</div>
<div class="line"><span class="lineno">  624</span> </div>
<div class="line"><span class="lineno">  625</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> *md = NULL;</div>
<div class="line"><span class="lineno">  626</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> **mdp = NULL;</div>
<div class="line"><span class="lineno">  627</span>  <a class="code hl_define" href="array_8h.html#a6b8ea5fb2f366d7716f5042b347093a6">ARRAY_FOREACH</a>(mdp, mha)</div>
<div class="line"><span class="lineno">  628</span>  {</div>
<div class="line"><span class="lineno">  629</span>    md = *mdp;</div>
<div class="line"><span class="lineno">  630</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Considering %s\n&quot;</span>, <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(md-&gt;<a class="code hl_variable" href="structMhEmail.html#a34bec8eb69452e1092e8781e8da0c4b9">canon_fname</a>));</div>
<div class="line"><span class="lineno">  631</span>    <span class="keywordflow">if</span> (!md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>)</div>
<div class="line"><span class="lineno">  632</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  633</span> </div>
<div class="line"><span class="lineno">  634</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Adding header structure. Flags: %s%s%s%s%s\n&quot;</span>,</div>
<div class="line"><span class="lineno">  635</span>               md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#a8e810bc67ce7fea04bfe8a3739093d78">flagged</a> ? <span class="stringliteral">&quot;f&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a> ? <span class="stringliteral">&quot;D&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  636</span>               md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#aa26dd591f92e548bc3c56d0b7fdb3e8c">replied</a> ? <span class="stringliteral">&quot;r&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#a6d9062408a8c89b19cf25584dd2ffb57">old</a> ? <span class="stringliteral">&quot;O&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  637</span>               md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#a0bd79550be901d44e50953fb43614e10">read</a> ? <span class="stringliteral">&quot;R&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  638</span>    <a class="code hl_function" href="mx_8c.html#a0572e1f7a00e528557923201a39c7de9">mx_alloc_memory</a>(m, m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>);</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>] = md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>;</div>
<div class="line"><span class="lineno">  641</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>]-&gt;<a class="code hl_variable" href="structEmail.html#ace0e20a11dbdc84ca9ea63497c05b603">index</a> = m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>;</div>
<div class="line"><span class="lineno">  642</span>    <a class="code hl_function" href="core_2mailbox_8c.html#a2c6a73f0789f1985d07f296537493cf0">mailbox_size_add</a>(m, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>);</div>
<div class="line"><span class="lineno">  643</span> </div>
<div class="line"><span class="lineno">  644</span>    md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a> = NULL;</div>
<div class="line"><span class="lineno">  645</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>++;</div>
<div class="line"><span class="lineno">  646</span>  }</div>
<div class="line"><span class="lineno">  647</span> </div>
<div class="line"><span class="lineno">  648</span>  <span class="keywordtype">int</span> num = 0;</div>
<div class="line"><span class="lineno">  649</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a> &gt; oldmsgcount)</div>
<div class="line"><span class="lineno">  650</span>    num = m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a> - oldmsgcount;</div>
<div class="line"><span class="lineno">  651</span> </div>
<div class="line"><span class="lineno">  652</span>  <span class="keywordflow">return</span> num;</div>
<div class="line"><span class="lineno">  653</span>}</div>
<div class="ttc" id="acore_2mailbox_8c_html_a2c6a73f0789f1985d07f296537493cf0"><div class="ttname"><a href="core_2mailbox_8c.html#a2c6a73f0789f1985d07f296537493cf0">mailbox_size_add</a></div><div class="ttdeci">void mailbox_size_add(struct Mailbox *m, const struct Email *e)</div><div class="ttdoc">Add an email&#39;s size to the total size of a Mailbox.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8c_source.html#l00247">mailbox.c:247</a></div></div>
<div class="ttc" id="amx_8c_html_a0572e1f7a00e528557923201a39c7de9"><div class="ttname"><a href="mx_8c.html#a0572e1f7a00e528557923201a39c7de9">mx_alloc_memory</a></div><div class="ttdeci">void mx_alloc_memory(struct Mailbox *m, int req_size)</div><div class="ttdoc">Create storage for the emails.</div><div class="ttdef"><b>Definition</b> <a href="mx_8c_source.html#l01211">mx.c:1211</a></div></div>
<div class="ttc" id="astring2_8h_html_a7e0481bed27661ea2679f256b24e0283"><div class="ttname"><a href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a></div><div class="ttdeci">#define NONULL(x)</div><div class="ttdef"><b>Definition</b> <a href="string2_8h_source.html#l00043">string2.h:43</a></div></div>
<div class="ttc" id="astructEmail_html_ac5db33e3d6d9723d8e496078d5769567"><div class="ttname"><a href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">Email::deleted</a></div><div class="ttdeci">bool deleted</div><div class="ttdoc">Email is deleted.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00078">email.h:78</a></div></div>
<div class="ttc" id="astructMailbox_html_a3d7ee4badbaec0d67db9e29d5ba716ee"><div class="ttname"><a href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">Mailbox::msg_count</a></div><div class="ttdeci">int msg_count</div><div class="ttdoc">Total number of messages.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00088">mailbox.h:88</a></div></div>
<div class="ttc" id="astructMailbox_html_a73ca79846dce43a175892c5d88e932ca"><div class="ttname"><a href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">Mailbox::emails</a></div><div class="ttdeci">struct Email ** emails</div><div class="ttdoc">Array of Emails.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00096">mailbox.h:96</a></div></div>
<div class="ttc" id="astructMhEmail_html_a34bec8eb69452e1092e8781e8da0c4b9"><div class="ttname"><a href="structMhEmail.html#a34bec8eb69452e1092e8781e8da0c4b9">MhEmail::canon_fname</a></div><div class="ttdeci">char * canon_fname</div><div class="ttdoc">Canonical filename for hashing.</div><div class="ttdef"><b>Definition</b> <a href="mhemail_8h_source.html#l00038">mhemail.h:38</a></div></div>
</div><!-- fragment --><div id="dynsection-22" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ae417c6c4670e084ec2e371ef09e26e35_cgraph.svg" width="347" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-23" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ae417c6c4670e084ec2e371ef09e26e35_icgraph.svg" width="312" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae374fa312c846e5836c0fcce3aeec4f4" name="ae374fa312c846e5836c0fcce3aeec4f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae374fa312c846e5836c0fcce3aeec4f4">&#9670;&#160;</a></span>mh_read_dir()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool mh_read_dir </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read an MH mailbox. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Success </td></tr>
    <tr><td class="paramname">false</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00661">661</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  662</span>{</div>
<div class="line"><span class="lineno">  663</span>  <span class="keywordflow">if</span> (!m)</div>
<div class="line"><span class="lineno">  664</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  665</span> </div>
<div class="line"><span class="lineno">  666</span>  <a class="code hl_function" href="mutt_2path_8c.html#a5ab1c7e67015696230c62a80223bc752">mutt_path_tidy</a>(&amp;m-&gt;<a class="code hl_variable" href="structMailbox.html#aa44c1232018ddd1953039aa857b23ab5">pathbuf</a>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  667</span> </div>
<div class="line"><span class="lineno">  668</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhSequences.html">MhSequences</a> mhs = { 0 };</div>
<div class="line"><span class="lineno">  669</span>  <span class="keyword">struct </span>Progress *progress = NULL;</div>
<div class="line"><span class="lineno">  670</span> </div>
<div class="line"><span class="lineno">  671</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno">  672</span>  {</div>
<div class="line"><span class="lineno">  673</span>    progress = <a class="code hl_function" href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a>(<a class="code hl_enumvalue" href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75adc0a9dcc8b2f53e3698038e7164b6489">MUTT_PROGRESS_READ</a>, 0);</div>
<div class="line"><span class="lineno">  674</span>    <a class="code hl_function" href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a>(progress, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Scanning %s...&quot;</span>), <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  675</span>  }</div>
<div class="line"><span class="lineno">  676</span> </div>
<div class="line"><span class="lineno">  677</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhMboxData.html">MhMboxData</a> *<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a> = <a class="code hl_function" href="mh_2mdata_8c.html#a5d572a4239365af11ea4ed4799486678">mh_mdata_get</a>(m);</div>
<div class="line"><span class="lineno">  678</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>)</div>
<div class="line"><span class="lineno">  679</span>  {</div>
<div class="line"><span class="lineno">  680</span>    <a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a> = <a class="code hl_function" href="mh_2mdata_8c.html#a620a5992e64776eec2cdccd0c27321d2">mh_mdata_new</a>();</div>
<div class="line"><span class="lineno">  681</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a> = <a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>;</div>
<div class="line"><span class="lineno">  682</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a015fb45ad1a08cf8e44e3553202834fb">mdata_free</a> = <a class="code hl_function" href="group__mailbox__mdata__free.html#ga749311930ce075f401b0d6482cdf75fc">mh_mdata_free</a>;</div>
<div class="line"><span class="lineno">  683</span>  }</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>  <a class="code hl_function" href="#a18d1d5ae034020d3672a2bfb04d3ed68">mh_update_mtime</a>(m);</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>  <span class="keyword">struct </span>MhEmailArray mha = <a class="code hl_define" href="array_8h.html#af50a4967d27a0531a1b10a23fc22fe05">ARRAY_HEAD_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">  688</span>  <span class="keywordtype">int</span> rc = <a class="code hl_function" href="#a7aadbbd4acc00a4cd42fd42faf97f806">mh_parse_dir</a>(m, &amp;mha, progress);</div>
<div class="line"><span class="lineno">  689</span>  <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno">  690</span>  <span class="keywordflow">if</span> (rc &lt; 0)</div>
<div class="line"><span class="lineno">  691</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  692</span> </div>
<div class="line"><span class="lineno">  693</span>  <span class="keywordflow">if</span> (m-&gt;<a class="code hl_variable" href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">verbose</a>)</div>
<div class="line"><span class="lineno">  694</span>  {</div>
<div class="line"><span class="lineno">  695</span>    progress = <a class="code hl_function" href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a>(<a class="code hl_enumvalue" href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75adc0a9dcc8b2f53e3698038e7164b6489">MUTT_PROGRESS_READ</a>, <a class="code hl_define" href="array_8h.html#a7f1bf469a48c0a2618c94b7b8281c5bf">ARRAY_SIZE</a>(&amp;mha));</div>
<div class="line"><span class="lineno">  696</span>    <a class="code hl_function" href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a>(progress, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Reading %s...&quot;</span>), <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  697</span>  }</div>
<div class="line"><span class="lineno">  698</span>  <a class="code hl_function" href="#ad2d3ae203f62bb52381ac736a0e8292b">mh_delayed_parsing</a>(m, &amp;mha, progress);</div>
<div class="line"><span class="lineno">  699</span>  <a class="code hl_function" href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a>(&amp;progress);</div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="sequence_8c.html#ad5089c5888bb5f8fba2348be50c943dc">mh_seq_read</a>(&amp;mhs, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m)) &lt; 0)</div>
<div class="line"><span class="lineno">  702</span>  {</div>
<div class="line"><span class="lineno">  703</span>    <a class="code hl_function" href="mhemail_8c.html#a59ad8e03594c918f10a5ed9a2f696f29">mharray_clear</a>(&amp;mha);</div>
<div class="line"><span class="lineno">  704</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  705</span>  }</div>
<div class="line"><span class="lineno">  706</span>  <a class="code hl_function" href="#ae06b4547b1aaad67848597ff451ca584">mh_update_emails</a>(&amp;mha, &amp;mhs);</div>
<div class="line"><span class="lineno">  707</span>  <a class="code hl_function" href="sequence_8c.html#a86fe1d2831cdac159da58fba06a69349">mh_seq_free</a>(&amp;mhs);</div>
<div class="line"><span class="lineno">  708</span> </div>
<div class="line"><span class="lineno">  709</span>  <a class="code hl_function" href="#ae417c6c4670e084ec2e371ef09e26e35">mh_move_to_mailbox</a>(m, &amp;mha);</div>
<div class="line"><span class="lineno">  710</span>  <a class="code hl_function" href="mhemail_8c.html#a59ad8e03594c918f10a5ed9a2f696f29">mharray_clear</a>(&amp;mha);</div>
<div class="line"><span class="lineno">  711</span> </div>
<div class="line"><span class="lineno">  712</span>  <span class="keywordflow">if</span> (!mdata-&gt;<a class="code hl_variable" href="structMhMboxData.html#a379d00adbfc0301ebcacd3b133778e3b">umask</a>)</div>
<div class="line"><span class="lineno">  713</span>    mdata-&gt;<a class="code hl_variable" href="structMhMboxData.html#a379d00adbfc0301ebcacd3b133778e3b">umask</a> = <a class="code hl_function" href="mh_2shared_8c.html#ab90612a145bd327ab7a5ce5d78286b64">mh_umask</a>(m);</div>
<div class="line"><span class="lineno">  714</span> </div>
<div class="line"><span class="lineno">  715</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  716</span>}</div>
<div class="ttc" id="aarray_8h_html_af50a4967d27a0531a1b10a23fc22fe05"><div class="ttname"><a href="array_8h.html#af50a4967d27a0531a1b10a23fc22fe05">ARRAY_HEAD_INITIALIZER</a></div><div class="ttdeci">#define ARRAY_HEAD_INITIALIZER</div><div class="ttdoc">Static initializer for arrays.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00058">array.h:58</a></div></div>
<div class="ttc" id="agroup__mailbox__mdata__free_html_ga749311930ce075f401b0d6482cdf75fc"><div class="ttname"><a href="group__mailbox__mdata__free.html#ga749311930ce075f401b0d6482cdf75fc">mh_mdata_free</a></div><div class="ttdeci">void mh_mdata_free(void **ptr)</div><div class="ttdoc">Free the private Mailbox data - Implements Mailbox::mdata_free() -.</div><div class="ttdef"><b>Definition</b> <a href="mh_2mdata_8c_source.html#l00037">mdata.c:37</a></div></div>
<div class="ttc" id="amh_2mdata_8c_html_a620a5992e64776eec2cdccd0c27321d2"><div class="ttname"><a href="mh_2mdata_8c.html#a620a5992e64776eec2cdccd0c27321d2">mh_mdata_new</a></div><div class="ttdeci">struct MhMboxData * mh_mdata_new(void)</div><div class="ttdoc">Create a new MhMboxData object.</div><div class="ttdef"><b>Definition</b> <a href="mh_2mdata_8c_source.html#l00049">mdata.c:49</a></div></div>
<div class="ttc" id="amh_2shared_8c_html_ab90612a145bd327ab7a5ce5d78286b64"><div class="ttname"><a href="mh_2shared_8c.html#ab90612a145bd327ab7a5ce5d78286b64">mh_umask</a></div><div class="ttdeci">mode_t mh_umask(struct Mailbox *m)</div><div class="ttdoc">Create a umask from the mailbox directory.</div><div class="ttdef"><b>Definition</b> <a href="mh_2shared_8c_source.html#l00049">shared.c:49</a></div></div>
<div class="ttc" id="amh_8c_html_a18d1d5ae034020d3672a2bfb04d3ed68"><div class="ttname"><a href="#a18d1d5ae034020d3672a2bfb04d3ed68">mh_update_mtime</a></div><div class="ttdeci">static void mh_update_mtime(struct Mailbox *m)</div><div class="ttdoc">Update our record of the mailbox modification time.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00417">mh.c:417</a></div></div>
<div class="ttc" id="amh_8c_html_a7aadbbd4acc00a4cd42fd42faf97f806"><div class="ttname"><a href="#a7aadbbd4acc00a4cd42fd42faf97f806">mh_parse_dir</a></div><div class="ttdeci">static int mh_parse_dir(struct Mailbox *m, struct MhEmailArray *mha, struct Progress *progress)</div><div class="ttdoc">Read an Mh mailbox.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00442">mh.c:442</a></div></div>
<div class="ttc" id="amh_8c_html_ad2d3ae203f62bb52381ac736a0e8292b"><div class="ttname"><a href="#ad2d3ae203f62bb52381ac736a0e8292b">mh_delayed_parsing</a></div><div class="ttdeci">static void mh_delayed_parsing(struct Mailbox *m, struct MhEmailArray *mha, struct Progress *progress)</div><div class="ttdoc">This function does the second parsing pass.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00547">mh.c:547</a></div></div>
<div class="ttc" id="amh_8c_html_ae06b4547b1aaad67848597ff451ca584"><div class="ttname"><a href="#ae06b4547b1aaad67848597ff451ca584">mh_update_emails</a></div><div class="ttdeci">static void mh_update_emails(struct MhEmailArray *mha, struct MhSequences *mhs)</div><div class="ttdoc">Update our record of flags.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00211">mh.c:211</a></div></div>
<div class="ttc" id="amh_8c_html_ae417c6c4670e084ec2e371ef09e26e35"><div class="ttname"><a href="#ae417c6c4670e084ec2e371ef09e26e35">mh_move_to_mailbox</a></div><div class="ttdeci">static int mh_move_to_mailbox(struct Mailbox *m, const struct MhEmailArray *mha)</div><div class="ttdoc">Copy the Mh list to the Mailbox.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00618">mh.c:618</a></div></div>
<div class="ttc" id="amhemail_8c_html_a59ad8e03594c918f10a5ed9a2f696f29"><div class="ttname"><a href="mhemail_8c.html#a59ad8e03594c918f10a5ed9a2f696f29">mharray_clear</a></div><div class="ttdeci">void mharray_clear(struct MhEmailArray *mha)</div><div class="ttdoc">Free a Mh array.</div><div class="ttdef"><b>Definition</b> <a href="mhemail_8c_source.html#l00064">mhemail.c:64</a></div></div>
<div class="ttc" id="amutt_2path_8c_html_a5ab1c7e67015696230c62a80223bc752"><div class="ttname"><a href="mutt_2path_8c.html#a5ab1c7e67015696230c62a80223bc752">mutt_path_tidy</a></div><div class="ttdeci">bool mutt_path_tidy(struct Buffer *path, bool is_dir)</div><div class="ttdoc">Remove unnecessary parts of a path.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2path_8c_source.html#l00169">path.c:169</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_a0a558d538b8742adf8b1251f2848ba75adc0a9dcc8b2f53e3698038e7164b6489"><div class="ttname"><a href="progress_2lib_8h.html#a0a558d538b8742adf8b1251f2848ba75adc0a9dcc8b2f53e3698038e7164b6489">MUTT_PROGRESS_READ</a></div><div class="ttdeci">@ MUTT_PROGRESS_READ</div><div class="ttdoc">Progress tracks elements, according to $read_inc</div><div class="ttdef"><b>Definition</b> <a href="progress_2lib_8h_source.html#l00083">lib.h:83</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_a551a8d9e844532e2851d6bee121c09b3"><div class="ttname"><a href="progress_2lib_8h.html#a551a8d9e844532e2851d6bee121c09b3">progress_new</a></div><div class="ttdeci">struct Progress * progress_new(enum ProgressType type, size_t size)</div><div class="ttdoc">Create a new Progress Bar.</div><div class="ttdef"><b>Definition</b> <a href="progress_8c_source.html#l00139">progress.c:139</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_ab4c7a63427cdcaae2b1147ff6f010af4"><div class="ttname"><a href="progress_2lib_8h.html#ab4c7a63427cdcaae2b1147ff6f010af4">progress_free</a></div><div class="ttdeci">void progress_free(struct Progress **ptr)</div><div class="ttdoc">Free a Progress Bar.</div><div class="ttdef"><b>Definition</b> <a href="progress_8c_source.html#l00110">progress.c:110</a></div></div>
<div class="ttc" id="aprogress_2lib_8h_html_abd7142bf1b3c664cf1c3edca7c9b41d8"><div class="ttname"><a href="progress_2lib_8h.html#abd7142bf1b3c664cf1c3edca7c9b41d8">progress_set_message</a></div><div class="ttdeci">void progress_set_message(struct Progress *progress, const char *fmt,...) __attribute__((__format__(__printf__</div></div>
<div class="ttc" id="asequence_8c_html_a86fe1d2831cdac159da58fba06a69349"><div class="ttname"><a href="sequence_8c.html#a86fe1d2831cdac159da58fba06a69349">mh_seq_free</a></div><div class="ttdeci">void mh_seq_free(struct MhSequences *mhs)</div><div class="ttdoc">Free some sequences.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8c_source.html#l00068">sequence.c:68</a></div></div>
<div class="ttc" id="asequence_8c_html_ad5089c5888bb5f8fba2348be50c943dc"><div class="ttname"><a href="sequence_8c.html#ad5089c5888bb5f8fba2348be50c943dc">mh_seq_read</a></div><div class="ttdeci">int mh_seq_read(struct MhSequences *mhs, const char *path)</div><div class="ttdoc">Read a set of MH sequences.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8c_source.html#l00378">sequence.c:378</a></div></div>
<div class="ttc" id="astructMailbox_html_a015fb45ad1a08cf8e44e3553202834fb"><div class="ttname"><a href="structMailbox.html#a015fb45ad1a08cf8e44e3553202834fb">Mailbox::mdata_free</a></div><div class="ttdeci">void(* mdata_free)(void **ptr)</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00143">mailbox.h:143</a></div></div>
<div class="ttc" id="astructMailbox_html_aa44c1232018ddd1953039aa857b23ab5"><div class="ttname"><a href="structMailbox.html#aa44c1232018ddd1953039aa857b23ab5">Mailbox::pathbuf</a></div><div class="ttdeci">struct Buffer pathbuf</div><div class="ttdoc">Path of the Mailbox.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00080">mailbox.h:80</a></div></div>
<div class="ttc" id="astructMailbox_html_af1ff47b8f14a4503c9b8473582b13d5a"><div class="ttname"><a href="structMailbox.html#af1ff47b8f14a4503c9b8473582b13d5a">Mailbox::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdoc">Display status messages?</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00117">mailbox.h:117</a></div></div>
<div class="ttc" id="astructMhMboxData_html_a379d00adbfc0301ebcacd3b133778e3b"><div class="ttname"><a href="structMhMboxData.html#a379d00adbfc0301ebcacd3b133778e3b">MhMboxData::umask</a></div><div class="ttdeci">mode_t umask</div><div class="ttdoc">umask to use when creating files</div><div class="ttdef"><b>Definition</b> <a href="mh_2mdata_8h_source.html#l00038">mdata.h:38</a></div></div>
<div class="ttc" id="astructMhSequences_html"><div class="ttname"><a href="structMhSequences.html">MhSequences</a></div><div class="ttdoc">Set of MH sequence numbers.</div><div class="ttdef"><b>Definition</b> <a href="sequence_8h_source.html#l00040">sequence.h:41</a></div></div>
</div><!-- fragment --><div id="dynsection-24" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ae374fa312c846e5836c0fcce3aeec4f4_cgraph.svg" width="480" height="874"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-25" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_ae374fa312c846e5836c0fcce3aeec4f4_icgraph.svg" width="278" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9a6412540f5b990d8f82823d537ce824" name="a9a6412540f5b990d8f82823d537ce824"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a6412540f5b990d8f82823d537ce824">&#9670;&#160;</a></span>mh_sync_mailbox_message()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mh_sync_mailbox_message </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structEmail.html">Email</a> *</td>          <td class="paramname"><span class="paramname"><em>e</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structHeaderCache.html">HeaderCache</a> *</td>          <td class="paramname"><span class="paramname"><em>hc</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Save changes to the mailbox. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramname">e</td><td><a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> </td></tr>
    <tr><td class="paramname">hc</td><td>Header cache handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00726">726</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  727</span>{</div>
<div class="line"><span class="lineno">  728</span>  <span class="keywordflow">if</span> (!m || !e)</div>
<div class="line"><span class="lineno">  729</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  730</span> </div>
<div class="line"><span class="lineno">  731</span>  <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="structEmail.html#ac5db33e3d6d9723d8e496078d5769567">deleted</a>)</div>
<div class="line"><span class="lineno">  732</span>  {</div>
<div class="line"><span class="lineno">  733</span>    <span class="keywordtype">char</span> path[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  734</span>    snprintf(path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno">  735</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> c_mh_purge = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;mh_purge&quot;</span>);</div>
<div class="line"><span class="lineno">  736</span>    <span class="keywordflow">if</span> (c_mh_purge)</div>
<div class="line"><span class="lineno">  737</span>    {</div>
<div class="line"><span class="lineno">  738</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  739</span>      <span class="keywordflow">if</span> (hc)</div>
<div class="line"><span class="lineno">  740</span>      {</div>
<div class="line"><span class="lineno">  741</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *key = e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>;</div>
<div class="line"><span class="lineno">  742</span>        <span class="keywordtype">size_t</span> keylen = strlen(key);</div>
<div class="line"><span class="lineno">  743</span>        <a class="code hl_function" href="hcache_2hcache_8c.html#a66e48b640205127c7a4bb987b8d0192d">hcache_delete_email</a>(hc, key, keylen);</div>
<div class="line"><span class="lineno">  744</span>      }</div>
<div class="line"><span class="lineno">  745</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  746</span>      unlink(path);</div>
<div class="line"><span class="lineno">  747</span>    }</div>
<div class="line"><span class="lineno">  748</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  749</span>    {</div>
<div class="line"><span class="lineno">  750</span>      <span class="comment">/* MH just moves files out of the way when you delete them */</span></div>
<div class="line"><span class="lineno">  751</span>      <span class="keywordflow">if</span> (*e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a> != <span class="charliteral">&#39;,&#39;</span>)</div>
<div class="line"><span class="lineno">  752</span>      {</div>
<div class="line"><span class="lineno">  753</span>        <span class="keywordtype">char</span> tmp[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  754</span>        snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s/,%s&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno">  755</span>        unlink(tmp);</div>
<div class="line"><span class="lineno">  756</span>        <span class="keywordflow">if</span> (rename(path, tmp) != 0)</div>
<div class="line"><span class="lineno">  757</span>        {</div>
<div class="line"><span class="lineno">  758</span>          <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  759</span>        }</div>
<div class="line"><span class="lineno">  760</span>      }</div>
<div class="line"><span class="lineno">  761</span>    }</div>
<div class="line"><span class="lineno">  762</span>  }</div>
<div class="line"><span class="lineno">  763</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a> || e-&gt;<a class="code hl_variable" href="structEmail.html#a8d4df03be101c132581352d182ae99ae">attach_del</a>)</div>
<div class="line"><span class="lineno">  764</span>  {</div>
<div class="line"><span class="lineno">  765</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8f975cd8a104fe6a996e4506eadb8f95">mh_sync_message</a>(m, e) == -1)</div>
<div class="line"><span class="lineno">  766</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  767</span>  }</div>
<div class="line"><span class="lineno">  768</span> </div>
<div class="line"><span class="lineno">  769</span><span class="preprocessor">#ifdef USE_HCACHE</span></div>
<div class="line"><span class="lineno">  770</span>  <span class="keywordflow">if</span> (hc &amp;&amp; e-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a>)</div>
<div class="line"><span class="lineno">  771</span>  {</div>
<div class="line"><span class="lineno">  772</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *key = e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>;</div>
<div class="line"><span class="lineno">  773</span>    <span class="keywordtype">size_t</span> keylen = strlen(key);</div>
<div class="line"><span class="lineno">  774</span>    <a class="code hl_function" href="hcache_2hcache_8c.html#a9e0172956ca278dc113eefc10baef638">hcache_store_email</a>(hc, key, keylen, e, 0);</div>
<div class="line"><span class="lineno">  775</span>  }</div>
<div class="line"><span class="lineno">  776</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  779</span>}</div>
<div class="ttc" id="aconfig_2helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00047">helpers.c:47</a></div></div>
<div class="ttc" id="ahcache_2hcache_8c_html_a66e48b640205127c7a4bb987b8d0192d"><div class="ttname"><a href="hcache_2hcache_8c.html#a66e48b640205127c7a4bb987b8d0192d">hcache_delete_email</a></div><div class="ttdeci">int hcache_delete_email(struct HeaderCache *hc, const char *key, size_t keylen)</div><div class="ttdoc">Multiplexor for StoreOps::delete_record.</div><div class="ttdef"><b>Definition</b> <a href="hcache_2hcache_8c_source.html#l00741">hcache.c:741</a></div></div>
<div class="ttc" id="amh_8c_html_a8f975cd8a104fe6a996e4506eadb8f95"><div class="ttname"><a href="#a8f975cd8a104fe6a996e4506eadb8f95">mh_sync_message</a></div><div class="ttdeci">static int mh_sync_message(struct Mailbox *m, struct Email *e)</div><div class="ttdoc">Sync an email to an MH folder.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00398">mh.c:398</a></div></div>
<div class="ttc" id="astructEmail_html_a8b1e186b9d388e199ba9c6239c612627"><div class="ttname"><a href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">Email::changed</a></div><div class="ttdeci">bool changed</div><div class="ttdoc">Email has been edited.</div><div class="ttdef"><b>Definition</b> <a href="email_8h_source.html#l00077">email.h:77</a></div></div>
</div><!-- fragment --><div id="dynsection-26" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a9a6412540f5b990d8f82823d537ce824_cgraph.svg" width="398" height="254"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-27" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a9a6412540f5b990d8f82823d537ce824_icgraph.svg" width="364" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a15c5a67872d2f500dba92e40ebca90d2" name="a15c5a67872d2f500dba92e40ebca90d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15c5a67872d2f500dba92e40ebca90d2">&#9670;&#160;</a></span>mh_update_flags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool mh_update_flags </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structEmail.html">Email</a> *</td>          <td class="paramname"><span class="paramname"><em>e_old</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structEmail.html">Email</a> *</td>          <td class="paramname"><span class="paramname"><em>e_new</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update the mailbox flags. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
    <tr><td class="paramname">e_old</td><td>Old <a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> </td></tr>
    <tr><td class="paramname">e_new</td><td>New <a class="el" href="structEmail.html" title="The envelope/body of an email.">Email</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>The flags changed </td></tr>
    <tr><td class="paramname">false</td><td>Otherwise </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00856">856</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  857</span>{</div>
<div class="line"><span class="lineno">  858</span>  <span class="keywordflow">if</span> (!m)</div>
<div class="line"><span class="lineno">  859</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  860</span> </div>
<div class="line"><span class="lineno">  861</span>  <span class="comment">/* save the global state here so we can reset it at the</span></div>
<div class="line"><span class="lineno">  862</span><span class="comment">   * end of list block if required.  */</span></div>
<div class="line"><span class="lineno">  863</span>  <span class="keywordtype">bool</span> context_changed = m-&gt;<a class="code hl_variable" href="structMailbox.html#a12ba98c349220ae172753f4f3294ed59">changed</a>;</div>
<div class="line"><span class="lineno">  864</span> </div>
<div class="line"><span class="lineno">  865</span>  <span class="comment">/* user didn&#39;t modify this message.  alter the flags to match the</span></div>
<div class="line"><span class="lineno">  866</span><span class="comment">   * current state on disk.  This may not actually do</span></div>
<div class="line"><span class="lineno">  867</span><span class="comment">   * anything. mutt_set_flag() will just ignore the call if the status</span></div>
<div class="line"><span class="lineno">  868</span><span class="comment">   * bits are already properly set, but it is still faster not to pass</span></div>
<div class="line"><span class="lineno">  869</span><span class="comment">   * through it */</span></div>
<div class="line"><span class="lineno">  870</span>  <span class="keywordflow">if</span> (e_old-&gt;<a class="code hl_variable" href="structEmail.html#a8e810bc67ce7fea04bfe8a3739093d78">flagged</a> != e_new-&gt;<a class="code hl_variable" href="structEmail.html#a8e810bc67ce7fea04bfe8a3739093d78">flagged</a>)</div>
<div class="line"><span class="lineno">  871</span>    <a class="code hl_function" href="flags_8c.html#a29547b9c7c39eb22039ff4b8f1c03829">mutt_set_flag</a>(m, e_old, <a class="code hl_enumvalue" href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013a98e86a6ccd0fbd487266f4f0cbf28d58">MUTT_FLAG</a>, e_new-&gt;<a class="code hl_variable" href="structEmail.html#a8e810bc67ce7fea04bfe8a3739093d78">flagged</a>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  872</span>  <span class="keywordflow">if</span> (e_old-&gt;<a class="code hl_variable" href="structEmail.html#aa26dd591f92e548bc3c56d0b7fdb3e8c">replied</a> != e_new-&gt;<a class="code hl_variable" href="structEmail.html#aa26dd591f92e548bc3c56d0b7fdb3e8c">replied</a>)</div>
<div class="line"><span class="lineno">  873</span>    <a class="code hl_function" href="flags_8c.html#a29547b9c7c39eb22039ff4b8f1c03829">mutt_set_flag</a>(m, e_old, <a class="code hl_enumvalue" href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013af85858c2c1c662fe4c0407b31c75410b">MUTT_REPLIED</a>, e_new-&gt;<a class="code hl_variable" href="structEmail.html#aa26dd591f92e548bc3c56d0b7fdb3e8c">replied</a>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  874</span>  <span class="keywordflow">if</span> (e_old-&gt;<a class="code hl_variable" href="structEmail.html#a0bd79550be901d44e50953fb43614e10">read</a> != e_new-&gt;<a class="code hl_variable" href="structEmail.html#a0bd79550be901d44e50953fb43614e10">read</a>)</div>
<div class="line"><span class="lineno">  875</span>    <a class="code hl_function" href="flags_8c.html#a29547b9c7c39eb22039ff4b8f1c03829">mutt_set_flag</a>(m, e_old, <a class="code hl_enumvalue" href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013a6be24502ab2b73e6c0dfdcc682b103bd">MUTT_READ</a>, e_new-&gt;<a class="code hl_variable" href="structEmail.html#a0bd79550be901d44e50953fb43614e10">read</a>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  876</span>  <span class="keywordflow">if</span> (e_old-&gt;<a class="code hl_variable" href="structEmail.html#a6d9062408a8c89b19cf25584dd2ffb57">old</a> != e_new-&gt;<a class="code hl_variable" href="structEmail.html#a6d9062408a8c89b19cf25584dd2ffb57">old</a>)</div>
<div class="line"><span class="lineno">  877</span>    <a class="code hl_function" href="flags_8c.html#a29547b9c7c39eb22039ff4b8f1c03829">mutt_set_flag</a>(m, e_old, <a class="code hl_enumvalue" href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013a7deaef4ebf08b54c1258f117b9ec6f50">MUTT_OLD</a>, e_new-&gt;<a class="code hl_variable" href="structEmail.html#a6d9062408a8c89b19cf25584dd2ffb57">old</a>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  878</span> </div>
<div class="line"><span class="lineno">  879</span>  <span class="comment">/* mutt_set_flag() will set this, but we don&#39;t need to</span></div>
<div class="line"><span class="lineno">  880</span><span class="comment">   * sync the changes we made because we just updated the</span></div>
<div class="line"><span class="lineno">  881</span><span class="comment">   * context to match the current on-disk state of the</span></div>
<div class="line"><span class="lineno">  882</span><span class="comment">   * message.  */</span></div>
<div class="line"><span class="lineno">  883</span>  <span class="keywordtype">bool</span> header_changed = e_old-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a>;</div>
<div class="line"><span class="lineno">  884</span>  e_old-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  885</span> </div>
<div class="line"><span class="lineno">  886</span>  <span class="comment">/* if the mailbox was not modified before we made these</span></div>
<div class="line"><span class="lineno">  887</span><span class="comment">   * changes, unset the changed flag since nothing needs to</span></div>
<div class="line"><span class="lineno">  888</span><span class="comment">   * be synchronized.  */</span></div>
<div class="line"><span class="lineno">  889</span>  <span class="keywordflow">if</span> (!context_changed)</div>
<div class="line"><span class="lineno">  890</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a12ba98c349220ae172753f4f3294ed59">changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  891</span> </div>
<div class="line"><span class="lineno">  892</span>  <span class="keywordflow">return</span> header_changed;</div>
<div class="line"><span class="lineno">  893</span>}</div>
<div class="ttc" id="aflags_8c_html_a29547b9c7c39eb22039ff4b8f1c03829"><div class="ttname"><a href="flags_8c.html#a29547b9c7c39eb22039ff4b8f1c03829">mutt_set_flag</a></div><div class="ttdeci">void mutt_set_flag(struct Mailbox *m, struct Email *e, enum MessageType flag, bool bf, bool upd_mbox)</div><div class="ttdoc">Set a flag on an email.</div><div class="ttdef"><b>Definition</b> <a href="flags_8c_source.html#l00056">flags.c:56</a></div></div>
<div class="ttc" id="amutt_8h_html_ac6606ebe91c8ac66a2c314c79f5ab013a6be24502ab2b73e6c0dfdcc682b103bd"><div class="ttname"><a href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013a6be24502ab2b73e6c0dfdcc682b103bd">MUTT_READ</a></div><div class="ttdeci">@ MUTT_READ</div><div class="ttdoc">Messages that have been read.</div><div class="ttdef"><b>Definition</b> <a href="mutt_8h_source.html#l00073">mutt.h:73</a></div></div>
<div class="ttc" id="amutt_8h_html_ac6606ebe91c8ac66a2c314c79f5ab013a7deaef4ebf08b54c1258f117b9ec6f50"><div class="ttname"><a href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013a7deaef4ebf08b54c1258f117b9ec6f50">MUTT_OLD</a></div><div class="ttdeci">@ MUTT_OLD</div><div class="ttdoc">Old messages.</div><div class="ttdef"><b>Definition</b> <a href="mutt_8h_source.html#l00071">mutt.h:71</a></div></div>
<div class="ttc" id="amutt_8h_html_ac6606ebe91c8ac66a2c314c79f5ab013a98e86a6ccd0fbd487266f4f0cbf28d58"><div class="ttname"><a href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013a98e86a6ccd0fbd487266f4f0cbf28d58">MUTT_FLAG</a></div><div class="ttdeci">@ MUTT_FLAG</div><div class="ttdoc">Flagged messages.</div><div class="ttdef"><b>Definition</b> <a href="mutt_8h_source.html#l00079">mutt.h:79</a></div></div>
<div class="ttc" id="amutt_8h_html_ac6606ebe91c8ac66a2c314c79f5ab013af85858c2c1c662fe4c0407b31c75410b"><div class="ttname"><a href="mutt_8h.html#ac6606ebe91c8ac66a2c314c79f5ab013af85858c2c1c662fe4c0407b31c75410b">MUTT_REPLIED</a></div><div class="ttdeci">@ MUTT_REPLIED</div><div class="ttdoc">Messages that have been replied to.</div><div class="ttdef"><b>Definition</b> <a href="mutt_8h_source.html#l00072">mutt.h:72</a></div></div>
<div class="ttc" id="astructMailbox_html_a12ba98c349220ae172753f4f3294ed59"><div class="ttname"><a href="structMailbox.html#a12ba98c349220ae172753f4f3294ed59">Mailbox::changed</a></div><div class="ttdeci">bool changed</div><div class="ttdoc">Mailbox has been modified.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00110">mailbox.h:110</a></div></div>
</div><!-- fragment --><div id="dynsection-28" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a15c5a67872d2f500dba92e40ebca90d2_cgraph.svg" width="291" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-29" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a15c5a67872d2f500dba92e40ebca90d2_icgraph.svg" width="268" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a99c7310c93b72b3d8865be13d22c9d5f" name="a99c7310c93b72b3d8865be13d22c9d5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99c7310c93b72b3d8865be13d22c9d5f">&#9670;&#160;</a></span>mh_check()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432">MxStatus</a> mh_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structMailbox.html">Mailbox</a> *</td>          <td class="paramname"><span class="paramname"><em>m</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check for new mail. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td><a class="el" href="structMailbox.html" title="A mailbox.">Mailbox</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">enum</td><td><a class="el" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432" title="Return values from mbox_check(), mbox_check_stats(), mbox_sync(), and mbox_close()">MxStatus</a></td></tr>
  </table>
  </dd>
</dl>
<p>This function handles arrival of new mail and reopening of mh folders. Things are getting rather complex because we don't have a well-defined "mailbox order", so the tricks from <a class="el" href="mbox_8c.html" title="Mbox local mailbox type.">mbox.c</a> and <a class="el" href="mx_8c.html" title="Mailbox multiplexor.">mx.c</a> won't work here.</p>
<p>Don't change this code unless you <em>really</em> understand what happens. </p>

<p class="definition">Definition at line <a class="el" href="mh_8c_source.html#l00907">907</a> of file <a class="el" href="mh_8c_source.html">mh.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  908</span>{</div>
<div class="line"><span class="lineno">  909</span>  <span class="keywordtype">char</span> buf[<a class="code hl_define" href="mutt_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = { 0 };</div>
<div class="line"><span class="lineno">  910</span>  <span class="keyword">struct </span>stat st = { 0 };</div>
<div class="line"><span class="lineno">  911</span>  <span class="keyword">struct </span>stat st_cur = { 0 };</div>
<div class="line"><span class="lineno">  912</span>  <span class="keywordtype">bool</span> modified = <span class="keyword">false</span>, occult = <span class="keyword">false</span>, flags_changed = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  913</span>  <span class="keywordtype">int</span> num_new = 0;</div>
<div class="line"><span class="lineno">  914</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhSequences.html">MhSequences</a> mhs = { 0 };</div>
<div class="line"><span class="lineno">  915</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structHashTable.html">HashTable</a> *fnames = NULL;</div>
<div class="line"><span class="lineno">  916</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhMboxData.html">MhMboxData</a> *<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a> = <a class="code hl_function" href="mh_2mdata_8c.html#a5d572a4239365af11ea4ed4799486678">mh_mdata_get</a>(m);</div>
<div class="line"><span class="lineno">  917</span> </div>
<div class="line"><span class="lineno">  918</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_check_new = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;check_new&quot;</span>);</div>
<div class="line"><span class="lineno">  919</span>  <span class="keywordflow">if</span> (!c_check_new)</div>
<div class="line"><span class="lineno">  920</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>;</div>
<div class="line"><span class="lineno">  921</span> </div>
<div class="line"><span class="lineno">  922</span>  <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(buf, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m), <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  923</span>  <span class="keywordflow">if</span> (stat(buf, &amp;st) == -1)</div>
<div class="line"><span class="lineno">  924</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  925</span> </div>
<div class="line"><span class="lineno">  926</span>  <span class="comment">/* create .mh_sequences when there isn&#39;t one. */</span></div>
<div class="line"><span class="lineno">  927</span>  snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s/.mh_sequences&quot;</span>, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m));</div>
<div class="line"><span class="lineno">  928</span>  <span class="keywordtype">int</span> rc = stat(buf, &amp;st_cur);</div>
<div class="line"><span class="lineno">  929</span>  <span class="keywordflow">if</span> ((rc == -1) &amp;&amp; (errno == ENOENT))</div>
<div class="line"><span class="lineno">  930</span>  {</div>
<div class="line"><span class="lineno">  931</span>    <span class="keywordtype">char</span> *tmp = NULL;</div>
<div class="line"><span class="lineno">  932</span>    FILE *fp = NULL;</div>
<div class="line"><span class="lineno">  933</span> </div>
<div class="line"><span class="lineno">  934</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="mh_2shared_8c.html#a7e127a63a4d213e3bf15efce2460e818">mh_mkstemp</a>(m, &amp;fp, &amp;tmp))</div>
<div class="line"><span class="lineno">  935</span>    {</div>
<div class="line"><span class="lineno">  936</span>      <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  937</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="file_8c.html#a1cdf183d05e03b173070aa506d192822">mutt_file_safe_rename</a>(tmp, buf) == -1)</div>
<div class="line"><span class="lineno">  938</span>        unlink(tmp);</div>
<div class="line"><span class="lineno">  939</span>      <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;tmp);</div>
<div class="line"><span class="lineno">  940</span>    }</div>
<div class="line"><span class="lineno">  941</span>  }</div>
<div class="line"><span class="lineno">  942</span> </div>
<div class="line"><span class="lineno">  943</span>  <span class="keywordflow">if</span> ((rc == -1) &amp;&amp; (stat(buf, &amp;st_cur) == -1))</div>
<div class="line"><span class="lineno">  944</span>    modified = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  945</span> </div>
<div class="line"><span class="lineno">  946</span>  <span class="keywordflow">if</span> ((<a class="code hl_function" href="file_8c.html#acf5bbc5f63d75ef10f2d16f183de0de0">mutt_file_stat_timespec_compare</a>(&amp;st, <a class="code hl_enumvalue" href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a>, &amp;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;mtime) &gt; 0) ||</div>
<div class="line"><span class="lineno">  947</span>      (<a class="code hl_function" href="file_8c.html#acf5bbc5f63d75ef10f2d16f183de0de0">mutt_file_stat_timespec_compare</a>(&amp;st_cur, <a class="code hl_enumvalue" href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a>, &amp;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;mtime_seq) &gt; 0))</div>
<div class="line"><span class="lineno">  948</span>  {</div>
<div class="line"><span class="lineno">  949</span>    modified = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  950</span>  }</div>
<div class="line"><span class="lineno">  951</span> </div>
<div class="line"><span class="lineno">  952</span>  <span class="keywordflow">if</span> (!modified)</div>
<div class="line"><span class="lineno">  953</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>;</div>
<div class="line"><span class="lineno">  954</span> </div>
<div class="line"><span class="lineno">  955</span>  <span class="comment">/* Update the modification times on the mailbox.</span></div>
<div class="line"><span class="lineno">  956</span><span class="comment">   *</span></div>
<div class="line"><span class="lineno">  957</span><span class="comment">   * The monitor code notices changes in the open mailbox too quickly.</span></div>
<div class="line"><span class="lineno">  958</span><span class="comment">   * In practice, this sometimes leads to all the new messages not being</span></div>
<div class="line"><span class="lineno">  959</span><span class="comment">   * noticed during the SAME group of mtime stat updates.  To work around</span></div>
<div class="line"><span class="lineno">  960</span><span class="comment">   * the problem, don&#39;t update the stat times for a monitor caused check. */</span></div>
<div class="line"><span class="lineno">  961</span><span class="preprocessor">#ifdef USE_INOTIFY</span></div>
<div class="line"><span class="lineno">  962</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="monitor_8c.html#aa9e22d715c7468a084e0f73b04d0e38c">MonitorCurMboxChanged</a>)</div>
<div class="line"><span class="lineno">  963</span>  {</div>
<div class="line"><span class="lineno">  964</span>    <a class="code hl_variable" href="monitor_8c.html#aa9e22d715c7468a084e0f73b04d0e38c">MonitorCurMboxChanged</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  965</span>  }</div>
<div class="line"><span class="lineno">  966</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  967</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  968</span>  {</div>
<div class="line"><span class="lineno">  969</span>    <a class="code hl_function" href="file_8c.html#a0a1a67cd697cb0074317215d4ce6c9e3">mutt_file_get_stat_timespec</a>(&amp;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;mtime_seq, &amp;st_cur, <a class="code hl_enumvalue" href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a>);</div>
<div class="line"><span class="lineno">  970</span>    <a class="code hl_function" href="file_8c.html#a0a1a67cd697cb0074317215d4ce6c9e3">mutt_file_get_stat_timespec</a>(&amp;<a class="code hl_variable" href="structMailbox.html#a69b544c5c748ab3046dcc6e61a41f595">mdata</a>-&gt;mtime, &amp;st, <a class="code hl_enumvalue" href="file_8h.html#ad852389693b4c5a8d79c25e84b2d1139ab6a80eef142816f3ad6e880fc23fb2df">MUTT_STAT_MTIME</a>);</div>
<div class="line"><span class="lineno">  971</span>  }</div>
<div class="line"><span class="lineno">  972</span> </div>
<div class="line"><span class="lineno">  973</span>  <span class="keyword">struct </span>MhEmailArray mha = <a class="code hl_define" href="array_8h.html#af50a4967d27a0531a1b10a23fc22fe05">ARRAY_HEAD_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">  974</span> </div>
<div class="line"><span class="lineno">  975</span>  <a class="code hl_function" href="#a7aadbbd4acc00a4cd42fd42faf97f806">mh_parse_dir</a>(m, &amp;mha, NULL);</div>
<div class="line"><span class="lineno">  976</span>  <a class="code hl_function" href="#ad2d3ae203f62bb52381ac736a0e8292b">mh_delayed_parsing</a>(m, &amp;mha, NULL);</div>
<div class="line"><span class="lineno">  977</span> </div>
<div class="line"><span class="lineno">  978</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="sequence_8c.html#ad5089c5888bb5f8fba2348be50c943dc">mh_seq_read</a>(&amp;mhs, <a class="code hl_function" href="core_2mailbox_8h.html#a7e9739eb3e94344633f7051c2fb9453e">mailbox_path</a>(m)) &lt; 0)</div>
<div class="line"><span class="lineno">  979</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a>;</div>
<div class="line"><span class="lineno">  980</span>  <a class="code hl_function" href="#ae06b4547b1aaad67848597ff451ca584">mh_update_emails</a>(&amp;mha, &amp;mhs);</div>
<div class="line"><span class="lineno">  981</span>  <a class="code hl_function" href="sequence_8c.html#a86fe1d2831cdac159da58fba06a69349">mh_seq_free</a>(&amp;mhs);</div>
<div class="line"><span class="lineno">  982</span> </div>
<div class="line"><span class="lineno">  983</span>  <span class="comment">/* check for modifications and adjust flags */</span></div>
<div class="line"><span class="lineno">  984</span>  fnames = <a class="code hl_function" href="hash_8c.html#a75439958fb5faf57c039faec79d19998">mutt_hash_new</a>(<a class="code hl_define" href="array_8h.html#a7f1bf469a48c0a2618c94b7b8281c5bf">ARRAY_SIZE</a>(&amp;mha), <a class="code hl_define" href="hash_8h.html#a091c40218093334e24d80f897e76a977">MUTT_HASH_NO_FLAGS</a>);</div>
<div class="line"><span class="lineno">  985</span> </div>
<div class="line"><span class="lineno">  986</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> *md = NULL;</div>
<div class="line"><span class="lineno">  987</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structMhEmail.html">MhEmail</a> **mdp = NULL;</div>
<div class="line"><span class="lineno">  988</span>  <a class="code hl_define" href="array_8h.html#a6b8ea5fb2f366d7716f5042b347093a6">ARRAY_FOREACH</a>(mdp, &amp;mha)</div>
<div class="line"><span class="lineno">  989</span>  {</div>
<div class="line"><span class="lineno">  990</span>    md = *mdp;</div>
<div class="line"><span class="lineno">  991</span>    <span class="comment">/* the hash key must survive past the header, which is freed below. */</span></div>
<div class="line"><span class="lineno">  992</span>    md-&gt;<a class="code hl_variable" href="structMhEmail.html#a34bec8eb69452e1092e8781e8da0c4b9">canon_fname</a> = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno">  993</span>    <a class="code hl_function" href="hash_8c.html#a10bd305a8183db9829caee9ea1bac2f5">mutt_hash_insert</a>(fnames, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a34bec8eb69452e1092e8781e8da0c4b9">canon_fname</a>, md);</div>
<div class="line"><span class="lineno">  994</span>  }</div>
<div class="line"><span class="lineno">  995</span> </div>
<div class="line"><span class="lineno">  996</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m-&gt;<a class="code hl_variable" href="structMailbox.html#a3d7ee4badbaec0d67db9e29d5ba716ee">msg_count</a>; i++)</div>
<div class="line"><span class="lineno">  997</span>  {</div>
<div class="line"><span class="lineno">  998</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structEmail.html">Email</a> *e = m-&gt;<a class="code hl_variable" href="structMailbox.html#a73ca79846dce43a175892c5d88e932ca">emails</a>[i];</div>
<div class="line"><span class="lineno">  999</span>    <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno"> 1000</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1001</span> </div>
<div class="line"><span class="lineno"> 1002</span>    md = <a class="code hl_function" href="hash_8c.html#a21cfc2c56db496fc57d3d85a71c03215">mutt_hash_find</a>(fnames, e-&gt;<a class="code hl_variable" href="structEmail.html#ac041599cfe41b49e7b8f9d752d07bb39">path</a>);</div>
<div class="line"><span class="lineno"> 1003</span>    <span class="keywordflow">if</span> (md &amp;&amp; md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a> &amp;&amp; <a class="code hl_function" href="email_2email_8c.html#a3d20f2e3c0991425b91d9403a038a51e">email_cmp_strict</a>(e, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>))</div>
<div class="line"><span class="lineno"> 1004</span>    {</div>
<div class="line"><span class="lineno"> 1005</span>      <span class="comment">/* found the right message */</span></div>
<div class="line"><span class="lineno"> 1006</span>      <span class="keywordflow">if</span> (!e-&gt;<a class="code hl_variable" href="structEmail.html#a8b1e186b9d388e199ba9c6239c612627">changed</a>)</div>
<div class="line"><span class="lineno"> 1007</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a15c5a67872d2f500dba92e40ebca90d2">mh_update_flags</a>(m, e, md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>))</div>
<div class="line"><span class="lineno"> 1008</span>          flags_changed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1009</span> </div>
<div class="line"><span class="lineno"> 1010</span>      <a class="code hl_function" href="email_2email_8c.html#ae9f719d3fc31d00b92bcf9f77d56ee67">email_free</a>(&amp;md-&gt;<a class="code hl_variable" href="structMhEmail.html#a2c4f25588fb9aa0ef67fa98c9cf90a50">email</a>);</div>
<div class="line"><span class="lineno"> 1011</span>    }</div>
<div class="line"><span class="lineno"> 1012</span>    <span class="keywordflow">else</span> <span class="comment">/* message has disappeared */</span></div>
<div class="line"><span class="lineno"> 1013</span>    {</div>
<div class="line"><span class="lineno"> 1014</span>      occult = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1015</span>    }</div>
<div class="line"><span class="lineno"> 1016</span>  }</div>
<div class="line"><span class="lineno"> 1017</span> </div>
<div class="line"><span class="lineno"> 1018</span>  <span class="comment">/* destroy the file name hash */</span></div>
<div class="line"><span class="lineno"> 1019</span> </div>
<div class="line"><span class="lineno"> 1020</span>  <a class="code hl_function" href="hash_8c.html#afa22b7f78bbf1b59a4a2bd4bdd20948b">mutt_hash_free</a>(&amp;fnames);</div>
<div class="line"><span class="lineno"> 1021</span> </div>
<div class="line"><span class="lineno"> 1022</span>  <span class="comment">/* If we didn&#39;t just get new mail, update the tables. */</span></div>
<div class="line"><span class="lineno"> 1023</span>  <span class="keywordflow">if</span> (occult)</div>
<div class="line"><span class="lineno"> 1024</span>    <a class="code hl_function" href="core_2mailbox_8c.html#af09ac36728ca3255523cd3b0bfd1f172">mailbox_changed</a>(m, <a class="code hl_enumvalue" href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4a96d28ff20a133d31e2e6ce8bb4e8b78f">NT_MAILBOX_RESORT</a>);</div>
<div class="line"><span class="lineno"> 1025</span> </div>
<div class="line"><span class="lineno"> 1026</span>  <span class="comment">/* Incorporate new messages */</span></div>
<div class="line"><span class="lineno"> 1027</span>  num_new = <a class="code hl_function" href="#ae417c6c4670e084ec2e371ef09e26e35">mh_move_to_mailbox</a>(m, &amp;mha);</div>
<div class="line"><span class="lineno"> 1028</span>  <a class="code hl_function" href="mhemail_8c.html#a59ad8e03594c918f10a5ed9a2f696f29">mharray_clear</a>(&amp;mha);</div>
<div class="line"><span class="lineno"> 1029</span> </div>
<div class="line"><span class="lineno"> 1030</span>  <span class="keywordflow">if</span> (num_new &gt; 0)</div>
<div class="line"><span class="lineno"> 1031</span>  {</div>
<div class="line"><span class="lineno"> 1032</span>    <a class="code hl_function" href="core_2mailbox_8c.html#af09ac36728ca3255523cd3b0bfd1f172">mailbox_changed</a>(m, <a class="code hl_enumvalue" href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4aa2cbdb348633a2bc5926ba0efddf2e3a">NT_MAILBOX_INVALID</a>);</div>
<div class="line"><span class="lineno"> 1033</span>    m-&gt;<a class="code hl_variable" href="structMailbox.html#a12ba98c349220ae172753f4f3294ed59">changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1034</span>  }</div>
<div class="line"><span class="lineno"> 1035</span> </div>
<div class="line"><span class="lineno"> 1036</span>  <a class="code hl_define" href="array_8h.html#aaa8805bd90a2015d8f5eb0fe3bb13b3f">ARRAY_FREE</a>(&amp;mha);</div>
<div class="line"><span class="lineno"> 1037</span>  <span class="keywordflow">if</span> (occult)</div>
<div class="line"><span class="lineno"> 1038</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432ad9cf54713c660db891b05384830e57f4">MX_STATUS_REOPENED</a>;</div>
<div class="line"><span class="lineno"> 1039</span>  <span class="keywordflow">if</span> (num_new &gt; 0)</div>
<div class="line"><span class="lineno"> 1040</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432af3d8ebc52b40a1f9f22b7b4366d0315b">MX_STATUS_NEW_MAIL</a>;</div>
<div class="line"><span class="lineno"> 1041</span>  <span class="keywordflow">if</span> (flags_changed)</div>
<div class="line"><span class="lineno"> 1042</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432ad3528e181f2bf299a5a598271c0059e6">MX_STATUS_FLAGS</a>;</div>
<div class="line"><span class="lineno"> 1043</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a>;</div>
<div class="line"><span class="lineno"> 1044</span>}</div>
<div class="ttc" id="aarray_8h_html_aaa8805bd90a2015d8f5eb0fe3bb13b3f"><div class="ttname"><a href="array_8h.html#aaa8805bd90a2015d8f5eb0fe3bb13b3f">ARRAY_FREE</a></div><div class="ttdeci">#define ARRAY_FREE(head)</div><div class="ttdoc">Release all memory.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00204">array.h:204</a></div></div>
<div class="ttc" id="acore_2mailbox_8c_html_af09ac36728ca3255523cd3b0bfd1f172"><div class="ttname"><a href="core_2mailbox_8c.html#af09ac36728ca3255523cd3b0bfd1f172">mailbox_changed</a></div><div class="ttdeci">void mailbox_changed(struct Mailbox *m, enum NotifyMailbox action)</div><div class="ttdoc">Notify observers of a change to a Mailbox.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8c_source.html#l00231">mailbox.c:231</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_a01795608bad9d16eed1bc017f0bd96c4a96d28ff20a133d31e2e6ce8bb4e8b78f"><div class="ttname"><a href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4a96d28ff20a133d31e2e6ce8bb4e8b78f">NT_MAILBOX_RESORT</a></div><div class="ttdeci">@ NT_MAILBOX_RESORT</div><div class="ttdoc">Email list needs resorting.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00181">mailbox.h:181</a></div></div>
<div class="ttc" id="acore_2mailbox_8h_html_a01795608bad9d16eed1bc017f0bd96c4aa2cbdb348633a2bc5926ba0efddf2e3a"><div class="ttname"><a href="core_2mailbox_8h.html#a01795608bad9d16eed1bc017f0bd96c4aa2cbdb348633a2bc5926ba0efddf2e3a">NT_MAILBOX_INVALID</a></div><div class="ttdeci">@ NT_MAILBOX_INVALID</div><div class="ttdoc">Email list was changed.</div><div class="ttdef"><b>Definition</b> <a href="core_2mailbox_8h_source.html#l00180">mailbox.h:180</a></div></div>
<div class="ttc" id="aemail_2email_8c_html_a3d20f2e3c0991425b91d9403a038a51e"><div class="ttname"><a href="email_2email_8c.html#a3d20f2e3c0991425b91d9403a038a51e">email_cmp_strict</a></div><div class="ttdeci">bool email_cmp_strict(const struct Email *e1, const struct Email *e2)</div><div class="ttdoc">Strictly compare message emails.</div><div class="ttdef"><b>Definition</b> <a href="email_2email_8c_source.html#l00096">email.c:96</a></div></div>
<div class="ttc" id="ahash_8c_html_a10bd305a8183db9829caee9ea1bac2f5"><div class="ttname"><a href="hash_8c.html#a10bd305a8183db9829caee9ea1bac2f5">mutt_hash_insert</a></div><div class="ttdeci">struct HashElem * mutt_hash_insert(struct HashTable *table, const char *strkey, void *data)</div><div class="ttdoc">Add a new element to the Hash Table (with string keys)</div><div class="ttdef"><b>Definition</b> <a href="hash_8c_source.html#l00335">hash.c:335</a></div></div>
<div class="ttc" id="ahash_8c_html_a21cfc2c56db496fc57d3d85a71c03215"><div class="ttname"><a href="hash_8c.html#a21cfc2c56db496fc57d3d85a71c03215">mutt_hash_find</a></div><div class="ttdeci">void * mutt_hash_find(const struct HashTable *table, const char *strkey)</div><div class="ttdoc">Find the HashElem data in a Hash Table element using a key.</div><div class="ttdef"><b>Definition</b> <a href="hash_8c_source.html#l00362">hash.c:362</a></div></div>
<div class="ttc" id="ahash_8c_html_a75439958fb5faf57c039faec79d19998"><div class="ttname"><a href="hash_8c.html#a75439958fb5faf57c039faec79d19998">mutt_hash_new</a></div><div class="ttdeci">struct HashTable * mutt_hash_new(size_t num_elems, HashFlags flags)</div><div class="ttdoc">Create a new Hash Table (with string keys)</div><div class="ttdef"><b>Definition</b> <a href="hash_8c_source.html#l00259">hash.c:259</a></div></div>
<div class="ttc" id="ahash_8c_html_afa22b7f78bbf1b59a4a2bd4bdd20948b"><div class="ttname"><a href="hash_8c.html#afa22b7f78bbf1b59a4a2bd4bdd20948b">mutt_hash_free</a></div><div class="ttdeci">void mutt_hash_free(struct HashTable **ptr)</div><div class="ttdoc">Free a hash table.</div><div class="ttdef"><b>Definition</b> <a href="hash_8c_source.html#l00457">hash.c:457</a></div></div>
<div class="ttc" id="ahash_8h_html_a091c40218093334e24d80f897e76a977"><div class="ttname"><a href="hash_8h.html#a091c40218093334e24d80f897e76a977">MUTT_HASH_NO_FLAGS</a></div><div class="ttdeci">#define MUTT_HASH_NO_FLAGS</div><div class="ttdoc">No flags are set.</div><div class="ttdef"><b>Definition</b> <a href="hash_8h_source.html#l00111">hash.h:111</a></div></div>
<div class="ttc" id="amh_2shared_8c_html_a7e127a63a4d213e3bf15efce2460e818"><div class="ttname"><a href="mh_2shared_8c.html#a7e127a63a4d213e3bf15efce2460e818">mh_mkstemp</a></div><div class="ttdeci">bool mh_mkstemp(struct Mailbox *m, FILE **fp, char **tgt)</div><div class="ttdoc">Create a temporary file.</div><div class="ttdef"><b>Definition</b> <a href="mh_2shared_8c_source.html#l00073">shared.c:73</a></div></div>
<div class="ttc" id="amh_8c_html_a15c5a67872d2f500dba92e40ebca90d2"><div class="ttname"><a href="#a15c5a67872d2f500dba92e40ebca90d2">mh_update_flags</a></div><div class="ttdeci">static bool mh_update_flags(struct Mailbox *m, struct Email *e_old, struct Email *e_new)</div><div class="ttdoc">Update the mailbox flags.</div><div class="ttdef"><b>Definition</b> <a href="mh_8c_source.html#l00856">mh.c:856</a></div></div>
<div class="ttc" id="amonitor_8c_html_aa9e22d715c7468a084e0f73b04d0e38c"><div class="ttname"><a href="monitor_8c.html#aa9e22d715c7468a084e0f73b04d0e38c">MonitorCurMboxChanged</a></div><div class="ttdeci">bool MonitorCurMboxChanged</div><div class="ttdoc">Set to true when the current mailbox has changed.</div><div class="ttdef"><b>Definition</b> <a href="monitor_8c_source.html#l00055">monitor.c:55</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432aa482eddd52e9811eaef42b91a7e38160">MX_STATUS_ERROR</a></div><div class="ttdeci">@ MX_STATUS_ERROR</div><div class="ttdoc">An error occurred.</div><div class="ttdef"><b>Definition</b> <a href="mxapi_8h_source.html#l00061">mxapi.h:61</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432acc30aaa1797601a158bcead39ef19a4b">MX_STATUS_OK</a></div><div class="ttdeci">@ MX_STATUS_OK</div><div class="ttdoc">No changes.</div><div class="ttdef"><b>Definition</b> <a href="mxapi_8h_source.html#l00062">mxapi.h:62</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432ad3528e181f2bf299a5a598271c0059e6"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432ad3528e181f2bf299a5a598271c0059e6">MX_STATUS_FLAGS</a></div><div class="ttdeci">@ MX_STATUS_FLAGS</div><div class="ttdoc">Nondestructive flags change (IMAP)</div><div class="ttdef"><b>Definition</b> <a href="mxapi_8h_source.html#l00066">mxapi.h:66</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432ad9cf54713c660db891b05384830e57f4"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432ad9cf54713c660db891b05384830e57f4">MX_STATUS_REOPENED</a></div><div class="ttdeci">@ MX_STATUS_REOPENED</div><div class="ttdoc">Mailbox was reopened.</div><div class="ttdef"><b>Definition</b> <a href="mxapi_8h_source.html#l00065">mxapi.h:65</a></div></div>
<div class="ttc" id="amxapi_8h_html_af414aea967025ea4ba10b86268488432af3d8ebc52b40a1f9f22b7b4366d0315b"><div class="ttname"><a href="mxapi_8h.html#af414aea967025ea4ba10b86268488432af3d8ebc52b40a1f9f22b7b4366d0315b">MX_STATUS_NEW_MAIL</a></div><div class="ttdeci">@ MX_STATUS_NEW_MAIL</div><div class="ttdoc">New mail received in Mailbox.</div><div class="ttdef"><b>Definition</b> <a href="mxapi_8h_source.html#l00063">mxapi.h:63</a></div></div>
<div class="ttc" id="astructHashTable_html"><div class="ttname"><a href="structHashTable.html">HashTable</a></div><div class="ttdoc">A Hash Table.</div><div class="ttdef"><b>Definition</b> <a href="hash_8h_source.html#l00098">hash.h:99</a></div></div>
</div><!-- fragment --><div id="dynsection-30" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a99c7310c93b72b3d8865be13d22c9d5f_cgraph.svg" width="490" height="1272"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-31" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="mh_8c_a99c7310c93b72b3d8865be13d22c9d5f_icgraph.svg" width="264" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
