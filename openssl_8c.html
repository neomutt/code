<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NeoMutt: conn/openssl.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><a href="https://neomutt.org"><img alt="Logo" src="neomutt-64.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <a style="color: black; text-decoration: none;" href="https://neomutt.org">
   <div id="projectname">NeoMutt
   &#160;<span id="projectnumber">2025-09-05-43-g177ed6</span>
   </div>
   <div id="projectbrief">Teaching an old dog new tricks</div>
   </a>
   <a href="https://github.com/neomutt/neomutt" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000000; color:#fff; position: fixed; top: 0; border: 0; right: 0; z-index: 9999;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </td>
   <td><a style="text-decoration: none; position: absolute; right: 0; top: 25px; margin-right: 100px; color: #66d866; font-size: 400%;" href="http://www.doxygen.org/index.html">DOXYGEN</a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('openssl_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">openssl.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Handling of OpenSSL encryption.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;config.h&quot;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;openssl/asn1.h&gt;</code><br />
<code>#include &lt;openssl/bio.h&gt;</code><br />
<code>#include &lt;openssl/err.h&gt;</code><br />
<code>#include &lt;openssl/evp.h&gt;</code><br />
<code>#include &lt;openssl/obj_mac.h&gt;</code><br />
<code>#include &lt;openssl/opensslv.h&gt;</code><br />
<code>#include &lt;openssl/ossl_typ.h&gt;</code><br />
<code>#include &lt;openssl/pem.h&gt;</code><br />
<code>#include &lt;openssl/rand.h&gt;</code><br />
<code>#include &lt;openssl/safestack.h&gt;</code><br />
<code>#include &lt;openssl/ssl.h&gt;</code><br />
<code>#include &lt;openssl/x509.h&gt;</code><br />
<code>#include &lt;openssl/x509v3.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;strings.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="conn_2private_8h_source.html">private.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt_2lib_8h_source.html">mutt/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="address_2lib_8h_source.html">address/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_2lib_8h_source.html">config/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="core_2lib_8h_source.html">core/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connaccount_8h_source.html">connaccount.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection_8h_source.html">connection.h</a>&quot;</code><br />
<code>#include &quot;globals.h&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt__logging_8h_source.html">mutt_logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ssl_8h_source.html">ssl.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for openssl.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c__incl.svg" width="3366" height="274"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="openssl_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a42856d46ab73f3511a5353d4e30af6d4" id="r_a42856d46ab73f3511a5353d4e30af6d4"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a42856d46ab73f3511a5353d4e30af6d4">STACK_OF</a> (X509)</td></tr>
<tr class="memdesc:a42856d46ab73f3511a5353d4e30af6d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Keep a handle on accepted certificates in case we want to open up another connection to the same server in this session.  <br /></td></tr>
<tr class="separator:a42856d46ab73f3511a5353d4e30af6d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86d74c54bdd9ad5c3ff5ae03a0772565" id="r_a86d74c54bdd9ad5c3ff5ae03a0772565"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a86d74c54bdd9ad5c3ff5ae03a0772565">ssl_load_certificates</a> (SSL_CTX *ctx)</td></tr>
<tr class="memdesc:a86d74c54bdd9ad5c3ff5ae03a0772565"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load certificates and filter out the expired ones.  <br /></td></tr>
<tr class="separator:a86d74c54bdd9ad5c3ff5ae03a0772565"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4a51e4093b93309989ffff46504c241" id="r_ab4a51e4093b93309989ffff46504c241"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab4a51e4093b93309989ffff46504c241">ssl_set_verify_partial</a> (SSL_CTX *ctx)</td></tr>
<tr class="memdesc:ab4a51e4093b93309989ffff46504c241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allow verification using partial chains (with no root)  <br /></td></tr>
<tr class="separator:ab4a51e4093b93309989ffff46504c241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13c099b66aaf5ef1eba6df644a9cd82d" id="r_a13c099b66aaf5ef1eba6df644a9cd82d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a> (const char *file)</td></tr>
<tr class="memdesc:a13c099b66aaf5ef1eba6df644a9cd82d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a source of random numbers.  <br /></td></tr>
<tr class="separator:a13c099b66aaf5ef1eba6df644a9cd82d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0eb5f86037e1612ca14cd3a0a87a0dc" id="r_ad0eb5f86037e1612ca14cd3a0a87a0dc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad0eb5f86037e1612ca14cd3a0a87a0dc">ssl_err</a> (struct SslSockData *data, int err)</td></tr>
<tr class="memdesc:ad0eb5f86037e1612ca14cd3a0a87a0dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Display an SSL error message.  <br /></td></tr>
<tr class="separator:ad0eb5f86037e1612ca14cd3a0a87a0dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f0e82431c3c3b2f63982217cc0e9f50" id="r_a8f0e82431c3c3b2f63982217cc0e9f50"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8f0e82431c3c3b2f63982217cc0e9f50">ssl_dprint_err_stack</a> (void)</td></tr>
<tr class="memdesc:a8f0e82431c3c3b2f63982217cc0e9f50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dump the SSL error stack.  <br /></td></tr>
<tr class="separator:a8f0e82431c3c3b2f63982217cc0e9f50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68682ecd35358cb52878d8bcf0724e93" id="r_a68682ecd35358cb52878d8bcf0724e93"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a68682ecd35358cb52878d8bcf0724e93">ssl_passwd_cb</a> (char *buf, int buflen, int rwflag, void *userdata)</td></tr>
<tr class="memdesc:a68682ecd35358cb52878d8bcf0724e93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to get a password.  <br /></td></tr>
<tr class="separator:a68682ecd35358cb52878d8bcf0724e93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6c36f9660a30f073893f32139a8bfa04" id="r_ga6c36f9660a30f073893f32139a8bfa04"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__connection__open.html#ga6c36f9660a30f073893f32139a8bfa04">ssl_socket_open_err</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:ga6c36f9660a30f073893f32139a8bfa04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Error callback for opening an SSL connection - Implements <a class="el" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">Connection::open()</a> -.  <br /></td></tr>
<tr class="separator:ga6c36f9660a30f073893f32139a8bfa04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1599982dabbbc5933b587dbb07c95b15" id="r_a1599982dabbbc5933b587dbb07c95b15"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1599982dabbbc5933b587dbb07c95b15">x509_get_part</a> (X509_NAME *name, int nid)</td></tr>
<tr class="memdesc:a1599982dabbbc5933b587dbb07c95b15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve from X509 data.  <br /></td></tr>
<tr class="separator:a1599982dabbbc5933b587dbb07c95b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5693f6c49d75be39538f705796656511" id="r_a5693f6c49d75be39538f705796656511"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5693f6c49d75be39538f705796656511">x509_fingerprint</a> (struct <a class="el" href="structBuffer.html">Buffer</a> *buf, X509 *cert, const EVP_MD *(*hashfunc)(void))</td></tr>
<tr class="memdesc:a5693f6c49d75be39538f705796656511"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a fingerprint for an X509 certificate.  <br /></td></tr>
<tr class="separator:a5693f6c49d75be39538f705796656511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16277434f03da3b852516c19d3de7cda" id="r_a16277434f03da3b852516c19d3de7cda"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a16277434f03da3b852516c19d3de7cda">asn1time_to_string</a> (ASN1_UTCTIME *tm)</td></tr>
<tr class="memdesc:a16277434f03da3b852516c19d3de7cda"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a time to a string.  <br /></td></tr>
<tr class="separator:a16277434f03da3b852516c19d3de7cda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f6abab1b060f3eb73d6455c90847e39" id="r_a7f6abab1b060f3eb73d6455c90847e39"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7f6abab1b060f3eb73d6455c90847e39">certificates_equal</a> (X509 *cert, X509 *peercert, unsigned char *peermd, unsigned int peermdlen)</td></tr>
<tr class="memdesc:a7f6abab1b060f3eb73d6455c90847e39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare two X509 certificated.  <br /></td></tr>
<tr class="separator:a7f6abab1b060f3eb73d6455c90847e39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad29824f6d037bbefe08d5551fafabe74" id="r_ad29824f6d037bbefe08d5551fafabe74"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a> (X509 *peercert, bool silent)</td></tr>
<tr class="memdesc:ad29824f6d037bbefe08d5551fafabe74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a certificate has expired.  <br /></td></tr>
<tr class="separator:ad29824f6d037bbefe08d5551fafabe74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae39adc817bff49725d338570174c4a0b" id="r_ae39adc817bff49725d338570174c4a0b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae39adc817bff49725d338570174c4a0b">hostname_match</a> (const char *hostname, const char *certname)</td></tr>
<tr class="memdesc:ae39adc817bff49725d338570174c4a0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the hostname match the certificate.  <br /></td></tr>
<tr class="separator:ae39adc817bff49725d338570174c4a0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e20046425bd97175be33f596af1511" id="r_ac2e20046425bd97175be33f596af1511"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac2e20046425bd97175be33f596af1511">ssl_init</a> (void)</td></tr>
<tr class="memdesc:ac2e20046425bd97175be33f596af1511"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the SSL library.  <br /></td></tr>
<tr class="separator:ac2e20046425bd97175be33f596af1511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad249269819bbf126758110522b538d62" id="r_ad249269819bbf126758110522b538d62"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad249269819bbf126758110522b538d62">ssl_get_client_cert</a> (struct SslSockData *ssldata, struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:ad249269819bbf126758110522b538d62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the client certificate for an SSL connection.  <br /></td></tr>
<tr class="separator:ad249269819bbf126758110522b538d62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga580181fa12ad95a66805761f701e7cd2" id="r_ga580181fa12ad95a66805761f701e7cd2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__connection__close.html#ga580181fa12ad95a66805761f701e7cd2">ssl_socket_close_and_restore</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:ga580181fa12ad95a66805761f701e7cd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an SSL <a class="el" href="structConnection.html">Connection</a> and restore <a class="el" href="structConnection.html">Connection</a> callbacks - Implements <a class="el" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">Connection::close()</a> -.  <br /></td></tr>
<tr class="separator:ga580181fa12ad95a66805761f701e7cd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f1104e3e22a4015529223f2288398f3" id="r_a5f1104e3e22a4015529223f2288398f3"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5f1104e3e22a4015529223f2288398f3">check_certificate_cache</a> (X509 *peercert)</td></tr>
<tr class="memdesc:a5f1104e3e22a4015529223f2288398f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is the X509 Certificate in the cache?  <br /></td></tr>
<tr class="separator:a5f1104e3e22a4015529223f2288398f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada3c8409337c74100a934208b0551be0" id="r_ada3c8409337c74100a934208b0551be0"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ada3c8409337c74100a934208b0551be0">check_certificate_file</a> (X509 *peercert)</td></tr>
<tr class="memdesc:ada3c8409337c74100a934208b0551be0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read and check a certificate file.  <br /></td></tr>
<tr class="separator:ada3c8409337c74100a934208b0551be0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a039081100802f18e9d2fb80b492e61ac" id="r_a039081100802f18e9d2fb80b492e61ac"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a039081100802f18e9d2fb80b492e61ac">check_host</a> (X509 *x509cert, const char *hostname, char *err, size_t errlen)</td></tr>
<tr class="memdesc:a039081100802f18e9d2fb80b492e61ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the host on the certificate.  <br /></td></tr>
<tr class="separator:a039081100802f18e9d2fb80b492e61ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdbe2b83fcf6173cf72e7f729f230a72" id="r_afdbe2b83fcf6173cf72e7f729f230a72"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afdbe2b83fcf6173cf72e7f729f230a72">check_certificate_by_digest</a> (X509 *peercert)</td></tr>
<tr class="memdesc:afdbe2b83fcf6173cf72e7f729f230a72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate a certificate by its digest.  <br /></td></tr>
<tr class="separator:afdbe2b83fcf6173cf72e7f729f230a72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8bbb9fa54bc203070165c84f273cb0f" id="r_ab8bbb9fa54bc203070165c84f273cb0f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a> (X509 *c)</td></tr>
<tr class="memdesc:ab8bbb9fa54bc203070165c84f273cb0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cache a trusted certificate.  <br /></td></tr>
<tr class="separator:ab8bbb9fa54bc203070165c84f273cb0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd1c8bc6deae4960eb20099d6fda2ebf" id="r_acd1c8bc6deae4960eb20099d6fda2ebf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acd1c8bc6deae4960eb20099d6fda2ebf">add_cert</a> (const char *title, X509 *cert, bool issuer, struct StringArray *carr)</td></tr>
<tr class="memdesc:acd1c8bc6deae4960eb20099d6fda2ebf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Look up certificate info and save it to a list.  <br /></td></tr>
<tr class="separator:acd1c8bc6deae4960eb20099d6fda2ebf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0a15dc5df31b626a42f31bd6a5ea7f4" id="r_ae0a15dc5df31b626a42f31bd6a5ea7f4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a> (X509 *cert, int idx, size_t len, SSL *ssl, bool allow_always)</td></tr>
<tr class="memdesc:ae0a15dc5df31b626a42f31bd6a5ea7f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ask the user if a certificate is valid.  <br /></td></tr>
<tr class="separator:ae0a15dc5df31b626a42f31bd6a5ea7f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93e2f01418ccb7300b9864837c0a2719" id="r_a93e2f01418ccb7300b9864837c0a2719"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a93e2f01418ccb7300b9864837c0a2719">ssl_verify_callback</a> (int preverify_ok, X509_STORE_CTX *ctx)</td></tr>
<tr class="memdesc:a93e2f01418ccb7300b9864837c0a2719"><td class="mdescLeft">&#160;</td><td class="mdescRight">Certificate verification callback.  <br /></td></tr>
<tr class="separator:a93e2f01418ccb7300b9864837c0a2719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7480af2397359ace6c8741be1e680295" id="r_a7480af2397359ace6c8741be1e680295"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7480af2397359ace6c8741be1e680295">ssl_negotiate</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, struct SslSockData *ssldata)</td></tr>
<tr class="memdesc:a7480af2397359ace6c8741be1e680295"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempt to negotiate SSL over the wire.  <br /></td></tr>
<tr class="separator:a7480af2397359ace6c8741be1e680295"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf61ace510a4bea2797d93f0226dc631" id="r_aaf61ace510a4bea2797d93f0226dc631"><td class="memItemLeft" align="right" valign="top">static struct SslSockData *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:aaf61ace510a4bea2797d93f0226dc631"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a <a class="el" href="structConnection.html">Connection</a>'s socket data.  <br /></td></tr>
<tr class="separator:aaf61ace510a4bea2797d93f0226dc631"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dd67086d5ccb49018781662b104954e" id="r_a5dd67086d5ccb49018781662b104954e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5dd67086d5ccb49018781662b104954e">ssl_setup</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:a5dd67086d5ccb49018781662b104954e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up SSL on the <a class="el" href="structConnection.html">Connection</a>.  <br /></td></tr>
<tr class="separator:a5dd67086d5ccb49018781662b104954e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga30f5a89c44c5daba9413290a83abdd9c" id="r_ga30f5a89c44c5daba9413290a83abdd9c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__connection__poll.html#ga30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, time_t wait_secs)</td></tr>
<tr class="memdesc:ga30f5a89c44c5daba9413290a83abdd9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if any data is waiting on a socket - Implements <a class="el" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">Connection::poll()</a> -.  <br /></td></tr>
<tr class="separator:ga30f5a89c44c5daba9413290a83abdd9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaee6856c134462c191da6659c8b469145" id="r_gaee6856c134462c191da6659c8b469145"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__connection__open.html#gaee6856c134462c191da6659c8b469145">ssl_socket_open</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:gaee6856c134462c191da6659c8b469145"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open an SSL socket - Implements <a class="el" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">Connection::open()</a> -.  <br /></td></tr>
<tr class="separator:gaee6856c134462c191da6659c8b469145"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga61b00cd8dc0e66e258ab0d7d9286113e" id="r_ga61b00cd8dc0e66e258ab0d7d9286113e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__connection__read.html#ga61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, char *buf, size_t count)</td></tr>
<tr class="memdesc:ga61b00cd8dc0e66e258ab0d7d9286113e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read data from an SSL socket - Implements <a class="el" href="structConnection.html#afdd852b383b3926639ec9132c048590a">Connection::read()</a> -.  <br /></td></tr>
<tr class="separator:ga61b00cd8dc0e66e258ab0d7d9286113e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga40b2b0f0a706d96487919a4b0489026a" id="r_ga40b2b0f0a706d96487919a4b0489026a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__connection__write.html#ga40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, const char *buf, size_t count)</td></tr>
<tr class="memdesc:ga40b2b0f0a706d96487919a4b0489026a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write data to an SSL socket - Implements <a class="el" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">Connection::write()</a> -.  <br /></td></tr>
<tr class="separator:ga40b2b0f0a706d96487919a4b0489026a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaafcc34fa7bf9d54a9323c36761353e6a" id="r_gaafcc34fa7bf9d54a9323c36761353e6a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__connection__close.html#gaafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:gaafcc34fa7bf9d54a9323c36761353e6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an SSL connection - Implements <a class="el" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">Connection::close()</a> -.  <br /></td></tr>
<tr class="separator:gaafcc34fa7bf9d54a9323c36761353e6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23591e82bf992ceb5e62c459fd787b8a" id="r_a23591e82bf992ceb5e62c459fd787b8a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a23591e82bf992ceb5e62c459fd787b8a">mutt_ssl_starttls</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:a23591e82bf992ceb5e62c459fd787b8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Negotiate TLS over an already opened connection.  <br /></td></tr>
<tr class="separator:a23591e82bf992ceb5e62c459fd787b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6341b74ebed0751e68285e6bf379fab" id="r_ae6341b74ebed0751e68285e6bf379fab"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae6341b74ebed0751e68285e6bf379fab">mutt_ssl_socket_setup</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:ae6341b74ebed0751e68285e6bf379fab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up SSL socket mulitplexor.  <br /></td></tr>
<tr class="separator:ae6341b74ebed0751e68285e6bf379fab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab43c12dc4d5c8504c852b18a43ef0f8a" id="r_ab43c12dc4d5c8504c852b18a43ef0f8a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a> = -1</td></tr>
<tr class="memdesc:ab43c12dc4d5c8504c852b18a43ef0f8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">index for storing hostname as application specific data in SSL structure  <br /></td></tr>
<tr class="separator:ab43c12dc4d5c8504c852b18a43ef0f8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af84a999f737b3cc63228cecc117a5d87" id="r_af84a999f737b3cc63228cecc117a5d87"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a> = -1</td></tr>
<tr class="memdesc:af84a999f737b3cc63228cecc117a5d87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index for storing the "skip mode" state in SSL structure.  <br /></td></tr>
<tr class="separator:af84a999f737b3cc63228cecc117a5d87"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handling of OpenSSL encryption. </p>
<dl class="section author"><dt>Authors</dt><dd><ul>
<li>Damien Riegel</li>
<li>Pietro Cerutti</li>
<li>Richard Russon</li>
<li>Ian Zimmerman</li>
</ul>
</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 2 of the License, or (at your option) any later version.</dd></dl>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>

<p class="definition">Definition in file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a42856d46ab73f3511a5353d4e30af6d4" name="a42856d46ab73f3511a5353d4e30af6d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42856d46ab73f3511a5353d4e30af6d4">&#9670;&#160;</a></span>STACK_OF()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static STACK_OF </td>
          <td>(</td>
          <td class="paramtype">X509</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Keep a handle on accepted certificates in case we want to open up another connection to the same server in this session. </p>
<p>SSL socket data - </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00093">93</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  101</span>{</div>
<div class="line"><span class="lineno">  102</span>  SSL_CTX *sctx;</div>
<div class="line"><span class="lineno">  103</span>  SSL *ssl;</div>
<div class="line"><span class="lineno">  104</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> isopen;</div>
<div class="line"><span class="lineno">  105</span>};</div>
</div><!-- fragment --><div id="dynsection-1" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a42856d46ab73f3511a5353d4e30af6d4_icgraph.svg" width="230" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a86d74c54bdd9ad5c3ff5ae03a0772565" name="a86d74c54bdd9ad5c3ff5ae03a0772565"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86d74c54bdd9ad5c3ff5ae03a0772565">&#9670;&#160;</a></span>ssl_load_certificates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool ssl_load_certificates </td>
          <td>(</td>
          <td class="paramtype">SSL_CTX *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load certificates and filter out the expired ones. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>SSL context </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>Success </td></tr>
    <tr><td class="paramname">0</td><td>Error</td></tr>
  </table>
  </dd>
</dl>
<p>ssl certificate verification can behave strangely if there are expired certs loaded into the trusted store. This function filters out expired certs.</p>
<p>Previously the code used this form: SSL_CTX_load_verify_locations (ssldata-&gt;ctx, <code>$certificate_file</code>, NULL); </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00119">119</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  120</span>{</div>
<div class="line"><span class="lineno">  121</span>  <span class="keywordtype">bool</span> rc = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;loading trusted certificates\n&quot;</span>);</div>
<div class="line"><span class="lineno">  124</span>  X509_STORE *store = SSL_CTX_get_cert_store(ctx);</div>
<div class="line"><span class="lineno">  125</span>  <span class="keywordflow">if</span> (!store)</div>
<div class="line"><span class="lineno">  126</span>  {</div>
<div class="line"><span class="lineno">  127</span>    store = X509_STORE_new();</div>
<div class="line"><span class="lineno">  128</span>    SSL_CTX_set_cert_store(ctx, store);</div>
<div class="line"><span class="lineno">  129</span>  }</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div>
<div class="line"><span class="lineno">  132</span>  FILE *fp = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(c_certificate_file, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">  133</span>  <span class="keywordflow">if</span> (!fp)</div>
<div class="line"><span class="lineno">  134</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>  X509 *cert = NULL;</div>
<div class="line"><span class="lineno">  137</span>  <span class="keywordflow">while</span> (NULL != PEM_read_X509(fp, &amp;cert, NULL, NULL))</div>
<div class="line"><span class="lineno">  138</span>  {</div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordflow">if</span> ((X509_cmp_current_time(X509_get0_notBefore(cert)) &gt;= 0) ||</div>
<div class="line"><span class="lineno">  140</span>        (X509_cmp_current_time(X509_get0_notAfter(cert)) &lt;= 0))</div>
<div class="line"><span class="lineno">  141</span>    {</div>
<div class="line"><span class="lineno">  142</span>      <span class="keywordtype">char</span> buf[256] = { 0 };</div>
<div class="line"><span class="lineno">  143</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;filtering expired cert: %s\n&quot;</span>,</div>
<div class="line"><span class="lineno">  144</span>                 X509_NAME_oneline(X509_get_subject_name(cert), buf, <span class="keyword">sizeof</span>(buf)));</div>
<div class="line"><span class="lineno">  145</span>    }</div>
<div class="line"><span class="lineno">  146</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  147</span>    {</div>
<div class="line"><span class="lineno">  148</span>      X509_STORE_add_cert(store, cert);</div>
<div class="line"><span class="lineno">  149</span>    }</div>
<div class="line"><span class="lineno">  150</span>  }</div>
<div class="line"><span class="lineno">  151</span>  <span class="comment">/* PEM_read_X509 sets the error NO_START_LINE on eof */</span></div>
<div class="line"><span class="lineno">  152</span>  <span class="keywordflow">if</span> (ERR_GET_REASON(ERR_peek_last_error()) != PEM_R_NO_START_LINE)</div>
<div class="line"><span class="lineno">  153</span>    rc = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  154</span>  ERR_clear_error();</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>  X509_free(cert);</div>
<div class="line"><span class="lineno">  157</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  160</span>}</div>
<div class="ttc" id="aconfig_2helpers_8c_html_a9f184e61342916799259930333f4205f"><div class="ttname"><a href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00168">helpers.c:168</a></div></div>
<div class="ttc" id="afile_8h_html_a9b519e795f098be88b93cd72c49a35ec"><div class="ttname"><a href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a></div><div class="ttdeci">#define mutt_file_fclose(FP)</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00139">file.h:139</a></div></div>
<div class="ttc" id="afile_8h_html_a9fa358d76519cb6bc8ffca5850976d46"><div class="ttname"><a href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a></div><div class="ttdeci">#define mutt_file_fopen(PATH, MODE)</div><div class="ttdef"><b>Definition</b> <a href="file_8h_source.html#l00138">file.h:138</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00090">logging2.h:90</a></div></div>
<div class="ttc" id="alogging2_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdeci">@ LL_DEBUG2</div><div class="ttdoc">Log at debug level 2.</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00045">logging2.h:45</a></div></div>
<div class="ttc" id="astructNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00042">neomutt.h:43</a></div></div>
<div class="ttc" id="astructNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00047">neomutt.h:47</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a86d74c54bdd9ad5c3ff5ae03a0772565_cgraph.svg" width="316" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-3" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a86d74c54bdd9ad5c3ff5ae03a0772565_icgraph.svg" width="279" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab4a51e4093b93309989ffff46504c241" name="ab4a51e4093b93309989ffff46504c241"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4a51e4093b93309989ffff46504c241">&#9670;&#160;</a></span>ssl_set_verify_partial()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool ssl_set_verify_partial </td>
          <td>(</td>
          <td class="paramtype">SSL_CTX *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allow verification using partial chains (with no root) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>SSL context </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Success </td></tr>
    <tr><td class="paramname">false</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00168">168</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  169</span>{</div>
<div class="line"><span class="lineno">  170</span>  <span class="keywordtype">bool</span> rc = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  171</span><span class="preprocessor">#ifdef HAVE_SSL_PARTIAL_CHAIN</span></div>
<div class="line"><span class="lineno">  172</span>  X509_VERIFY_PARAM *param = NULL;</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_partial_chains = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_partial_chains&quot;</span>);</div>
<div class="line"><span class="lineno">  175</span>  <span class="keywordflow">if</span> (c_ssl_verify_partial_chains)</div>
<div class="line"><span class="lineno">  176</span>  {</div>
<div class="line"><span class="lineno">  177</span>    param = X509_VERIFY_PARAM_new();</div>
<div class="line"><span class="lineno">  178</span>    <span class="keywordflow">if</span> (param)</div>
<div class="line"><span class="lineno">  179</span>    {</div>
<div class="line"><span class="lineno">  180</span>      X509_VERIFY_PARAM_set_flags(param, X509_V_FLAG_PARTIAL_CHAIN);</div>
<div class="line"><span class="lineno">  181</span>      <span class="keywordflow">if</span> (SSL_CTX_set1_param(ctx, param) == 0)</div>
<div class="line"><span class="lineno">  182</span>      {</div>
<div class="line"><span class="lineno">  183</span>        <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;SSL_CTX_set1_param() failed\n&quot;</span>);</div>
<div class="line"><span class="lineno">  184</span>        rc = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  185</span>      }</div>
<div class="line"><span class="lineno">  186</span>      X509_VERIFY_PARAM_free(param);</div>
<div class="line"><span class="lineno">  187</span>    }</div>
<div class="line"><span class="lineno">  188</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  189</span>    {</div>
<div class="line"><span class="lineno">  190</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;X509_VERIFY_PARAM_new() failed\n&quot;</span>);</div>
<div class="line"><span class="lineno">  191</span>      rc = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  192</span>    }</div>
<div class="line"><span class="lineno">  193</span>  }</div>
<div class="line"><span class="lineno">  194</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  195</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  196</span>}</div>
<div class="ttc" id="aconfig_2helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00047">helpers.c:47</a></div></div>
</div><!-- fragment --><div id="dynsection-4" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ab4a51e4093b93309989ffff46504c241_cgraph.svg" width="320" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-5" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ab4a51e4093b93309989ffff46504c241_icgraph.svg" width="284" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a13c099b66aaf5ef1eba6df644a9cd82d" name="a13c099b66aaf5ef1eba6df644a9cd82d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13c099b66aaf5ef1eba6df644a9cd82d">&#9670;&#160;</a></span>add_entropy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int add_entropy </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>file</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Add a source of random numbers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>Random device </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&gt;0</td><td>Success, number of bytes read from the source </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00204">204</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  205</span>{</div>
<div class="line"><span class="lineno">  206</span>  <span class="keywordflow">if</span> (!file)</div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>  <span class="keyword">struct </span>stat st = { 0 };</div>
<div class="line"><span class="lineno">  210</span>  <span class="keywordtype">int</span> n = -1;</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>  <span class="keywordflow">if</span> (stat(file, &amp;st) == -1)</div>
<div class="line"><span class="lineno">  213</span>    <span class="keywordflow">return</span> (errno == ENOENT) ? 0 : -1;</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>  <a class="code hl_define" href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Filling entropy pool: %s...&quot;</span>), file);</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>  <span class="comment">/* check that the file permissions are secure */</span></div>
<div class="line"><span class="lineno">  218</span>  <span class="keywordflow">if</span> ((st.st_uid != getuid()) || ((st.st_mode &amp; (S_IWGRP | S_IRGRP)) != 0) ||</div>
<div class="line"><span class="lineno">  219</span>      ((st.st_mode &amp; (S_IWOTH | S_IROTH)) != 0))</div>
<div class="line"><span class="lineno">  220</span>  {</div>
<div class="line"><span class="lineno">  221</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;%s has insecure permissions&quot;</span>), file);</div>
<div class="line"><span class="lineno">  222</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  223</span>  }</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span><span class="preprocessor">#ifdef HAVE_RAND_EGD</span></div>
<div class="line"><span class="lineno">  226</span>  n = RAND_egd(file);</div>
<div class="line"><span class="lineno">  227</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  228</span>  <span class="keywordflow">if</span> (n &lt;= 0)</div>
<div class="line"><span class="lineno">  229</span>    n = RAND_load_file(file, -1);</div>
<div class="line"><span class="lineno">  230</span> </div>
<div class="line"><span class="lineno">  231</span>  <span class="keywordflow">return</span> n;</div>
<div class="line"><span class="lineno">  232</span>}</div>
<div class="ttc" id="agroup__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00093">logging2.h:93</a></div></div>
<div class="ttc" id="agroup__logging__api_html_gae108f891125caafa9250cf0959c40c04"><div class="ttname"><a href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a></div><div class="ttdeci">#define mutt_message(...)</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00092">logging2.h:92</a></div></div>
<div class="ttc" id="amutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a13c099b66aaf5ef1eba6df644a9cd82d_icgraph.svg" width="220" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad0eb5f86037e1612ca14cd3a0a87a0dc" name="ad0eb5f86037e1612ca14cd3a0a87a0dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0eb5f86037e1612ca14cd3a0a87a0dc">&#9670;&#160;</a></span>ssl_err()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_err </td>
          <td>(</td>
          <td class="paramtype">struct SslSockData *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>err</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Display an SSL error message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>SSL socket data </td></tr>
    <tr><td class="paramname">err</td><td>SSL error code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00239">239</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  240</span>{</div>
<div class="line"><span class="lineno">  241</span>  <span class="keywordtype">int</span> e = SSL_get_error(data-&gt;ssl, err);</div>
<div class="line"><span class="lineno">  242</span>  <span class="keywordflow">switch</span> (e)</div>
<div class="line"><span class="lineno">  243</span>  {</div>
<div class="line"><span class="lineno">  244</span>    <span class="keywordflow">case</span> SSL_ERROR_NONE:</div>
<div class="line"><span class="lineno">  245</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  246</span>    <span class="keywordflow">case</span> SSL_ERROR_ZERO_RETURN:</div>
<div class="line"><span class="lineno">  247</span>      data-&gt;isopen = 0;</div>
<div class="line"><span class="lineno">  248</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  249</span>    <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div>
<div class="line"><span class="lineno">  250</span>      data-&gt;isopen = 0;</div>
<div class="line"><span class="lineno">  251</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  252</span>  }</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *errmsg = NULL;</div>
<div class="line"><span class="lineno">  255</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sslerr;</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>  <span class="keywordflow">switch</span> (e)</div>
<div class="line"><span class="lineno">  258</span>  {</div>
<div class="line"><span class="lineno">  259</span>    <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div>
<div class="line"><span class="lineno">  260</span>      errmsg = <span class="stringliteral">&quot;I/O error&quot;</span>;</div>
<div class="line"><span class="lineno">  261</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  262</span>    <span class="keywordflow">case</span> SSL_ERROR_WANT_ACCEPT:</div>
<div class="line"><span class="lineno">  263</span>      errmsg = <span class="stringliteral">&quot;retry accept&quot;</span>;</div>
<div class="line"><span class="lineno">  264</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  265</span>    <span class="keywordflow">case</span> SSL_ERROR_WANT_CONNECT:</div>
<div class="line"><span class="lineno">  266</span>      errmsg = <span class="stringliteral">&quot;retry connect&quot;</span>;</div>
<div class="line"><span class="lineno">  267</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  268</span>    <span class="keywordflow">case</span> SSL_ERROR_WANT_READ:</div>
<div class="line"><span class="lineno">  269</span>      errmsg = <span class="stringliteral">&quot;retry read&quot;</span>;</div>
<div class="line"><span class="lineno">  270</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  271</span>    <span class="keywordflow">case</span> SSL_ERROR_WANT_WRITE:</div>
<div class="line"><span class="lineno">  272</span>      errmsg = <span class="stringliteral">&quot;retry write&quot;</span>;</div>
<div class="line"><span class="lineno">  273</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  274</span>    <span class="keywordflow">case</span> SSL_ERROR_WANT_X509_LOOKUP:</div>
<div class="line"><span class="lineno">  275</span>      errmsg = <span class="stringliteral">&quot;retry x509 lookup&quot;</span>;</div>
<div class="line"><span class="lineno">  276</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  277</span>    <span class="keywordflow">case</span> SSL_ERROR_ZERO_RETURN:</div>
<div class="line"><span class="lineno">  278</span>      errmsg = <span class="stringliteral">&quot;SSL connection closed&quot;</span>;</div>
<div class="line"><span class="lineno">  279</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  280</span>    <span class="keywordflow">case</span> SSL_ERROR_SSL:</div>
<div class="line"><span class="lineno">  281</span>      sslerr = ERR_get_error();</div>
<div class="line"><span class="lineno">  282</span>      <span class="keywordflow">switch</span> (sslerr)</div>
<div class="line"><span class="lineno">  283</span>      {</div>
<div class="line"><span class="lineno">  284</span>        <span class="keywordflow">case</span> 0:</div>
<div class="line"><span class="lineno">  285</span>          <span class="keywordflow">switch</span> (err)</div>
<div class="line"><span class="lineno">  286</span>          {</div>
<div class="line"><span class="lineno">  287</span>            <span class="keywordflow">case</span> 0:</div>
<div class="line"><span class="lineno">  288</span>              errmsg = <span class="stringliteral">&quot;EOF&quot;</span>;</div>
<div class="line"><span class="lineno">  289</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  290</span>            <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  291</span>              errmsg = strerror(errno);</div>
<div class="line"><span class="lineno">  292</span>          }</div>
<div class="line"><span class="lineno">  293</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  295</span>          errmsg = ERR_error_string(sslerr, NULL);</div>
<div class="line"><span class="lineno">  296</span>      }</div>
<div class="line"><span class="lineno">  297</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  298</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  299</span>      errmsg = <span class="stringliteral">&quot;unknown error&quot;</span>;</div>
<div class="line"><span class="lineno">  300</span>  }</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;SSL error: %s\n&quot;</span>, errmsg);</div>
<div class="line"><span class="lineno">  303</span>}</div>
<div class="ttc" id="alogging2_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdeci">@ LL_DEBUG1</div><div class="ttdoc">Log at debug level 1.</div><div class="ttdef"><b>Definition</b> <a href="logging2_8h_source.html#l00044">logging2.h:44</a></div></div>
</div><!-- fragment --><div id="dynsection-7" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad0eb5f86037e1612ca14cd3a0a87a0dc_icgraph.svg" width="242" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8f0e82431c3c3b2f63982217cc0e9f50" name="a8f0e82431c3c3b2f63982217cc0e9f50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f0e82431c3c3b2f63982217cc0e9f50">&#9670;&#160;</a></span>ssl_dprint_err_stack()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_dprint_err_stack </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Dump the SSL error stack. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00308">308</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  309</span>{</div>
<div class="line"><span class="lineno">  310</span>  BIO *bio = BIO_new(BIO_s_mem());</div>
<div class="line"><span class="lineno">  311</span>  <span class="keywordflow">if</span> (!bio)</div>
<div class="line"><span class="lineno">  312</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  313</span>  ERR_print_errors(bio);</div>
<div class="line"><span class="lineno">  314</span> </div>
<div class="line"><span class="lineno">  315</span>  <span class="keywordtype">char</span> *buf = NULL;</div>
<div class="line"><span class="lineno">  316</span>  <span class="keywordtype">long</span> buflen = BIO_get_mem_data(bio, &amp;buf);</div>
<div class="line"><span class="lineno">  317</span>  <span class="keywordflow">if</span> (buflen &gt; 0)</div>
<div class="line"><span class="lineno">  318</span>  {</div>
<div class="line"><span class="lineno">  319</span>    <span class="keywordtype">char</span> *output = <a class="code hl_define" href="memory_8h.html#af997cb3719dc7abbeabae655d0ee1b9e">MUTT_MEM_MALLOC</a>(buflen + 1, <span class="keywordtype">char</span>);</div>
<div class="line"><span class="lineno">  320</span>    memcpy(output, buf, buflen);</div>
<div class="line"><span class="lineno">  321</span>    output[buflen] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  322</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;SSL error stack: %s\n&quot;</span>, output);</div>
<div class="line"><span class="lineno">  323</span>    <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;output);</div>
<div class="line"><span class="lineno">  324</span>  }</div>
<div class="line"><span class="lineno">  325</span>  BIO_free(bio);</div>
<div class="line"><span class="lineno">  326</span>}</div>
<div class="ttc" id="amemory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition</b> <a href="memory_8h_source.html#l00062">memory.h:62</a></div></div>
<div class="ttc" id="amemory_8h_html_af997cb3719dc7abbeabae655d0ee1b9e"><div class="ttname"><a href="memory_8h.html#af997cb3719dc7abbeabae655d0ee1b9e">MUTT_MEM_MALLOC</a></div><div class="ttdeci">#define MUTT_MEM_MALLOC(n, type)</div><div class="ttdef"><b>Definition</b> <a href="memory_8h_source.html#l00048">memory.h:48</a></div></div>
</div><!-- fragment --><div id="dynsection-8" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a8f0e82431c3c3b2f63982217cc0e9f50_icgraph.svg" width="280" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a68682ecd35358cb52878d8bcf0724e93" name="a68682ecd35358cb52878d8bcf0724e93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68682ecd35358cb52878d8bcf0724e93">&#9670;&#160;</a></span>ssl_passwd_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_passwd_cb </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>buflen</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>rwflag</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>userdata</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback to get a password. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer.">Buffer</a> for the password </td></tr>
    <tr><td class="paramname">buflen</td><td>Length of the buffer </td></tr>
    <tr><td class="paramname">rwflag</td><td>0 if writing, 1 if reading (UNUSED) </td></tr>
    <tr><td class="paramname">userdata</td><td><a class="el" href="structConnAccount.html" title="Login details for a remote server.">ConnAccount</a> whose password is requested </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&gt;0</td><td>Success, number of chars written to buf </td></tr>
    <tr><td class="paramname">0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00337">337</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  338</span>{</div>
<div class="line"><span class="lineno">  339</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structConnAccount.html">ConnAccount</a> *cac = userdata;</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="connaccount_8c.html#a2e00de19727c4db19f452dde494a770a">mutt_account_getuser</a>(cac) &lt; 0)</div>
<div class="line"><span class="lineno">  342</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;getting password for %s@%s:%u\n&quot;</span>, cac-&gt;<a class="code hl_variable" href="structConnAccount.html#a48b8084b2dd1ef3d4e051a01cf15c7ca">user</a>, cac-&gt;<a class="code hl_variable" href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">host</a>, cac-&gt;<a class="code hl_variable" href="structConnAccount.html#aff0fc77d9a388c80c347c5c2c925086d">port</a>);</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="connaccount_8c.html#a2bc0b90ace43b835b6ad51f3d8fa5c1a">mutt_account_getpass</a>(cac) &lt; 0)</div>
<div class="line"><span class="lineno">  347</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>  <span class="keywordflow">return</span> snprintf(buf, buflen, <span class="stringliteral">&quot;%s&quot;</span>, cac-&gt;<a class="code hl_variable" href="structConnAccount.html#a842f1bf5afe0830ae96d80bdacead037">pass</a>);</div>
<div class="line"><span class="lineno">  350</span>}</div>
<div class="ttc" id="aconnaccount_8c_html_a2bc0b90ace43b835b6ad51f3d8fa5c1a"><div class="ttname"><a href="connaccount_8c.html#a2bc0b90ace43b835b6ad51f3d8fa5c1a">mutt_account_getpass</a></div><div class="ttdeci">int mutt_account_getpass(struct ConnAccount *cac)</div><div class="ttdoc">Fetch password into ConnAccount, if necessary.</div><div class="ttdef"><b>Definition</b> <a href="connaccount_8c_source.html#l00131">connaccount.c:131</a></div></div>
<div class="ttc" id="aconnaccount_8c_html_a2e00de19727c4db19f452dde494a770a"><div class="ttname"><a href="connaccount_8c.html#a2e00de19727c4db19f452dde494a770a">mutt_account_getuser</a></div><div class="ttdeci">int mutt_account_getuser(struct ConnAccount *cac)</div><div class="ttdoc">Retrieve username into ConnAccount, if necessary.</div><div class="ttdef"><b>Definition</b> <a href="connaccount_8c_source.html#l00052">connaccount.c:52</a></div></div>
<div class="ttc" id="astructConnAccount_html"><div class="ttname"><a href="structConnAccount.html">ConnAccount</a></div><div class="ttdoc">Login details for a remote server.</div><div class="ttdef"><b>Definition</b> <a href="connaccount_8h_source.html#l00052">connaccount.h:53</a></div></div>
<div class="ttc" id="astructConnAccount_html_a48b8084b2dd1ef3d4e051a01cf15c7ca"><div class="ttname"><a href="structConnAccount.html#a48b8084b2dd1ef3d4e051a01cf15c7ca">ConnAccount::user</a></div><div class="ttdeci">char user[128]</div><div class="ttdoc">Username.</div><div class="ttdef"><b>Definition</b> <a href="connaccount_8h_source.html#l00056">connaccount.h:56</a></div></div>
<div class="ttc" id="astructConnAccount_html_a842f1bf5afe0830ae96d80bdacead037"><div class="ttname"><a href="structConnAccount.html#a842f1bf5afe0830ae96d80bdacead037">ConnAccount::pass</a></div><div class="ttdeci">char pass[256]</div><div class="ttdoc">Password.</div><div class="ttdef"><b>Definition</b> <a href="connaccount_8h_source.html#l00057">connaccount.h:57</a></div></div>
<div class="ttc" id="astructConnAccount_html_aa440323ef3111e1faaf33f6a57103a3a"><div class="ttname"><a href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">ConnAccount::host</a></div><div class="ttdeci">char host[128]</div><div class="ttdoc">Server to login to.</div><div class="ttdef"><b>Definition</b> <a href="connaccount_8h_source.html#l00054">connaccount.h:54</a></div></div>
<div class="ttc" id="astructConnAccount_html_aff0fc77d9a388c80c347c5c2c925086d"><div class="ttname"><a href="structConnAccount.html#aff0fc77d9a388c80c347c5c2c925086d">ConnAccount::port</a></div><div class="ttdeci">unsigned short port</div><div class="ttdoc">Port to connect to.</div><div class="ttdef"><b>Definition</b> <a href="connaccount_8h_source.html#l00058">connaccount.h:58</a></div></div>
</div><!-- fragment --><div id="dynsection-9" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a68682ecd35358cb52878d8bcf0724e93_cgraph.svg" width="327" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-10" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a68682ecd35358cb52878d8bcf0724e93_icgraph.svg" width="300" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1599982dabbbc5933b587dbb07c95b15" name="a1599982dabbbc5933b587dbb07c95b15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1599982dabbbc5933b587dbb07c95b15">&#9670;&#160;</a></span>x509_get_part()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * x509_get_part </td>
          <td>(</td>
          <td class="paramtype">X509_NAME *</td>          <td class="paramname"><span class="paramname"><em>name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nid</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve from X509 data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of data to retrieve </td></tr>
    <tr><td class="paramname">nid</td><td>ID of the item to retrieve </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Retrieved data</td></tr>
  </table>
  </dd>
</dl>
<p>The returned pointer is to a static buffer, so it must not be free()'d. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00370">370</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  371</span>{</div>
<div class="line"><span class="lineno">  372</span>  <span class="keyword">static</span> <span class="keywordtype">char</span> data[128];</div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>  <span class="keywordflow">if</span> (!name || (X509_NAME_get_text_by_NID(name, nid, data, <span class="keyword">sizeof</span>(data)) &lt; 0))</div>
<div class="line"><span class="lineno">  375</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>  <span class="keywordflow">return</span> data;</div>
<div class="line"><span class="lineno">  378</span>}</div>
</div><!-- fragment --><div id="dynsection-11" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a1599982dabbbc5933b587dbb07c95b15_icgraph.svg" width="246" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5693f6c49d75be39538f705796656511" name="a5693f6c49d75be39538f705796656511"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5693f6c49d75be39538f705796656511">&#9670;&#160;</a></span>x509_fingerprint()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void x509_fingerprint </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structBuffer.html">Buffer</a> *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>cert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const EVP_MD *(*</td>          <td class="paramname"><span class="paramname"><em>hashfunc&#160;</em></span>)(void)&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate a fingerprint for an X509 certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer.">Buffer</a> for fingerprint </td></tr>
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">hashfunc</td><td>Hashing function </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00386">386</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  387</span>{</div>
<div class="line"><span class="lineno">  388</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> md[EVP_MAX_MD_SIZE];</div>
<div class="line"><span class="lineno">  389</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 0;</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>  <span class="keywordflow">if</span> (X509_digest(cert, hashfunc(), md, &amp;n) == 0) <span class="comment">// Failure</span></div>
<div class="line"><span class="lineno">  392</span>  {</div>
<div class="line"><span class="lineno">  393</span>    <a class="code hl_function" href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a>(buf, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[unable to calculate]&quot;</span>));</div>
<div class="line"><span class="lineno">  394</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  395</span>  }</div>
<div class="line"><span class="lineno">  396</span> </div>
<div class="line"><span class="lineno">  397</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n; i++)</div>
<div class="line"><span class="lineno">  398</span>  {</div>
<div class="line"><span class="lineno">  399</span>    <a class="code hl_function" href="buffer_8c.html#a0849b79217aad19e4bf9381d532d59d1">buf_add_printf</a>(buf, <span class="stringliteral">&quot;%02X&quot;</span>, md[i]);</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>    <span class="comment">// Put a space after a pair of bytes (except for the last one)</span></div>
<div class="line"><span class="lineno">  402</span>    <span class="keywordflow">if</span> (((i % 2) == 1) &amp;&amp; (i &lt; (n - 1)))</div>
<div class="line"><span class="lineno">  403</span>      <a class="code hl_function" href="buffer_8c.html#a9765efbb7f2c32e46fb1cb271a02ba20">buf_addch</a>(buf, <span class="charliteral">&#39; &#39;</span>);</div>
<div class="line"><span class="lineno">  404</span>  }</div>
<div class="line"><span class="lineno">  405</span>}</div>
<div class="ttc" id="abuffer_8c_html_a0849b79217aad19e4bf9381d532d59d1"><div class="ttname"><a href="buffer_8c.html#a0849b79217aad19e4bf9381d532d59d1">buf_add_printf</a></div><div class="ttdeci">int buf_add_printf(struct Buffer *buf, const char *fmt,...)</div><div class="ttdoc">Format a string appending a Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00204">buffer.c:204</a></div></div>
<div class="ttc" id="abuffer_8c_html_a9765efbb7f2c32e46fb1cb271a02ba20"><div class="ttname"><a href="buffer_8c.html#a9765efbb7f2c32e46fb1cb271a02ba20">buf_addch</a></div><div class="ttdeci">size_t buf_addch(struct Buffer *buf, char c)</div><div class="ttdoc">Add a single character to a Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00241">buffer.c:241</a></div></div>
<div class="ttc" id="abuffer_8c_html_ac958acbd189e463a2c3bbc2f23aaeb1e"><div class="ttname"><a href="buffer_8c.html#ac958acbd189e463a2c3bbc2f23aaeb1e">buf_strcpy</a></div><div class="ttdeci">size_t buf_strcpy(struct Buffer *buf, const char *s)</div><div class="ttdoc">Copy a string into a Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00395">buffer.c:395</a></div></div>
</div><!-- fragment --><div id="dynsection-12" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5693f6c49d75be39538f705796656511_cgraph.svg" width="298" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-13" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5693f6c49d75be39538f705796656511_icgraph.svg" width="344" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a16277434f03da3b852516c19d3de7cda" name="a16277434f03da3b852516c19d3de7cda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16277434f03da3b852516c19d3de7cda">&#9670;&#160;</a></span>asn1time_to_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * asn1time_to_string </td>
          <td>(</td>
          <td class="paramtype">ASN1_UTCTIME *</td>          <td class="paramname"><span class="paramname"><em>tm</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert a time to a string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tm</td><td>Time to convert </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Time string</td></tr>
  </table>
  </dd>
</dl>
<p>The returned pointer is to a static buffer, so it must not be free()'d. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00414">414</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  415</span>{</div>
<div class="line"><span class="lineno">  416</span>  <span class="keyword">static</span> <span class="keywordtype">char</span> buf[64];</div>
<div class="line"><span class="lineno">  417</span>  BIO *bio = NULL;</div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>  <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(buf, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[invalid date]&quot;</span>), <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>  bio = BIO_new(BIO_s_mem());</div>
<div class="line"><span class="lineno">  422</span>  <span class="keywordflow">if</span> (bio)</div>
<div class="line"><span class="lineno">  423</span>  {</div>
<div class="line"><span class="lineno">  424</span>    <span class="keywordflow">if</span> (ASN1_TIME_print(bio, tm))</div>
<div class="line"><span class="lineno">  425</span>      (void) BIO_read(bio, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  426</span>    BIO_free(bio);</div>
<div class="line"><span class="lineno">  427</span>  }</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>  <span class="keywordflow">return</span> buf;</div>
<div class="line"><span class="lineno">  430</span>}</div>
<div class="ttc" id="amutt_2string_8c_html_ad20e00309de897a1e882fc7400335b83"><div class="ttname"><a href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a></div><div class="ttdeci">size_t mutt_str_copy(char *dest, const char *src, size_t dsize)</div><div class="ttdoc">Copy a string into a buffer (guaranteeing NUL-termination)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00581">string.c:581</a></div></div>
</div><!-- fragment --><div id="dynsection-14" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a16277434f03da3b852516c19d3de7cda_cgraph.svg" width="308" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-15" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a16277434f03da3b852516c19d3de7cda_icgraph.svg" width="356" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7f6abab1b060f3eb73d6455c90847e39" name="a7f6abab1b060f3eb73d6455c90847e39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f6abab1b060f3eb73d6455c90847e39">&#9670;&#160;</a></span>certificates_equal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool certificates_equal </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>cert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>peercert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *</td>          <td class="paramname"><span class="paramname"><em>peermd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>peermdlen</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare two X509 certificated. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">peercert</td><td>Peer certificate </td></tr>
    <tr><td class="paramname">peermd</td><td>Peer certificate message digest </td></tr>
    <tr><td class="paramname">peermdlen</td><td>Length of peer certificate message digest </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificates match </td></tr>
    <tr><td class="paramname">false</td><td>Certificates differ </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00441">441</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  443</span>{</div>
<div class="line"><span class="lineno">  444</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> md[EVP_MAX_MD_SIZE];</div>
<div class="line"><span class="lineno">  445</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mdlen;</div>
<div class="line"><span class="lineno">  446</span> </div>
<div class="line"><span class="lineno">  447</span>  <span class="comment">/* Avoid CPU-intensive digest calculation if the certificates are</span></div>
<div class="line"><span class="lineno">  448</span><span class="comment">   * not even remotely equal.  */</span></div>
<div class="line"><span class="lineno">  449</span>  <span class="keywordflow">if</span> ((X509_subject_name_cmp(cert, peercert) != 0) ||</div>
<div class="line"><span class="lineno">  450</span>      (X509_issuer_name_cmp(cert, peercert) != 0))</div>
<div class="line"><span class="lineno">  451</span>  {</div>
<div class="line"><span class="lineno">  452</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  453</span>  }</div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>  <span class="keywordflow">if</span> (!X509_digest(cert, EVP_sha256(), md, &amp;mdlen) || (peermdlen != mdlen))</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>  <span class="keywordflow">if</span> (memcmp(peermd, md, mdlen) != 0)</div>
<div class="line"><span class="lineno">  459</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  462</span>}</div>
</div><!-- fragment --><div id="dynsection-16" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a7f6abab1b060f3eb73d6455c90847e39_icgraph.svg" width="534" height="144"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad29824f6d037bbefe08d5551fafabe74" name="ad29824f6d037bbefe08d5551fafabe74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad29824f6d037bbefe08d5551fafabe74">&#9670;&#160;</a></span>check_certificate_expiration()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_expiration </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>peercert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>silent</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if a certificate has expired. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate to check </td></tr>
    <tr><td class="paramname">silent</td><td>If true, don't notify the user if the certificate has expired </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Certificate has expired (or hasn't yet become valid) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00471">471</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  472</span>{</div>
<div class="line"><span class="lineno">  473</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_dates = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_dates&quot;</span>);</div>
<div class="line"><span class="lineno">  474</span>  <span class="keywordflow">if</span> (c_ssl_verify_dates == <a class="code hl_enumvalue" href="quad_8h.html#a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b">MUTT_NO</a>)</div>
<div class="line"><span class="lineno">  475</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  476</span> </div>
<div class="line"><span class="lineno">  477</span>  <span class="keywordflow">if</span> (X509_cmp_current_time(X509_get0_notBefore(peercert)) &gt;= 0)</div>
<div class="line"><span class="lineno">  478</span>  {</div>
<div class="line"><span class="lineno">  479</span>    <span class="keywordflow">if</span> (!silent)</div>
<div class="line"><span class="lineno">  480</span>    {</div>
<div class="line"><span class="lineno">  481</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Server certificate is not yet valid\n&quot;</span>);</div>
<div class="line"><span class="lineno">  482</span>      <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Server certificate is not yet valid&quot;</span>));</div>
<div class="line"><span class="lineno">  483</span>    }</div>
<div class="line"><span class="lineno">  484</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  485</span>  }</div>
<div class="line"><span class="lineno">  486</span> </div>
<div class="line"><span class="lineno">  487</span>  <span class="keywordflow">if</span> (X509_cmp_current_time(X509_get0_notAfter(peercert)) &lt;= 0)</div>
<div class="line"><span class="lineno">  488</span>  {</div>
<div class="line"><span class="lineno">  489</span>    <span class="keywordflow">if</span> (!silent)</div>
<div class="line"><span class="lineno">  490</span>    {</div>
<div class="line"><span class="lineno">  491</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Server certificate has expired\n&quot;</span>);</div>
<div class="line"><span class="lineno">  492</span>      <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Server certificate has expired&quot;</span>));</div>
<div class="line"><span class="lineno">  493</span>    }</div>
<div class="line"><span class="lineno">  494</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  495</span>  }</div>
<div class="line"><span class="lineno">  496</span> </div>
<div class="line"><span class="lineno">  497</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  498</span>}</div>
<div class="ttc" id="aquad_8h_html_a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b"><div class="ttname"><a href="quad_8h.html#a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b">MUTT_NO</a></div><div class="ttdeci">@ MUTT_NO</div><div class="ttdoc">User answered &#39;No&#39;, or assume &#39;No&#39;.</div><div class="ttdef"><b>Definition</b> <a href="quad_8h_source.html#l00038">quad.h:38</a></div></div>
</div><!-- fragment --><div id="dynsection-17" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad29824f6d037bbefe08d5551fafabe74_cgraph.svg" width="364" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-18" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad29824f6d037bbefe08d5551fafabe74_icgraph.svg" width="602" height="128"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae39adc817bff49725d338570174c4a0b" name="ae39adc817bff49725d338570174c4a0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae39adc817bff49725d338570174c4a0b">&#9670;&#160;</a></span>hostname_match()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool hostname_match </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>hostname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>certname</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Does the hostname match the certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hostname</td><td>Hostname </td></tr>
    <tr><td class="paramname">certname</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Hostname matches the certificate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00506">506</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  507</span>{</div>
<div class="line"><span class="lineno">  508</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *cmp1 = NULL, *cmp2 = NULL;</div>
<div class="line"><span class="lineno">  509</span> </div>
<div class="line"><span class="lineno">  510</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="mutt_2string_8c.html#a6f574867aa9db4d434adbc8af1f5f7e7">mutt_strn_equal</a>(certname, <span class="stringliteral">&quot;*.&quot;</span>, 2))</div>
<div class="line"><span class="lineno">  511</span>  {</div>
<div class="line"><span class="lineno">  512</span>    cmp1 = certname + 2;</div>
<div class="line"><span class="lineno">  513</span>    cmp2 = strchr(hostname, <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line"><span class="lineno">  514</span>    <span class="keywordflow">if</span> (!cmp2)</div>
<div class="line"><span class="lineno">  515</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>    cmp2++;</div>
<div class="line"><span class="lineno">  518</span>  }</div>
<div class="line"><span class="lineno">  519</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  520</span>  {</div>
<div class="line"><span class="lineno">  521</span>    cmp1 = certname;</div>
<div class="line"><span class="lineno">  522</span>    cmp2 = hostname;</div>
<div class="line"><span class="lineno">  523</span>  }</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>  <span class="keywordflow">if</span> ((*cmp1 == <span class="charliteral">&#39;\0&#39;</span>) || (*cmp2 == <span class="charliteral">&#39;\0&#39;</span>))</div>
<div class="line"><span class="lineno">  526</span>  {</div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  528</span>  }</div>
<div class="line"><span class="lineno">  529</span> </div>
<div class="line"><span class="lineno">  530</span>  <span class="keywordflow">if</span> (strcasecmp(cmp1, cmp2) != 0)</div>
<div class="line"><span class="lineno">  531</span>  {</div>
<div class="line"><span class="lineno">  532</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  533</span>  }</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  536</span>}</div>
<div class="ttc" id="amutt_2string_8c_html_a6f574867aa9db4d434adbc8af1f5f7e7"><div class="ttname"><a href="mutt_2string_8c.html#a6f574867aa9db4d434adbc8af1f5f7e7">mutt_strn_equal</a></div><div class="ttdeci">bool mutt_strn_equal(const char *a, const char *b, size_t num)</div><div class="ttdoc">Check for equality of two strings (to a maximum), safely.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00427">string.c:427</a></div></div>
</div><!-- fragment --><div id="dynsection-19" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae39adc817bff49725d338570174c4a0b_cgraph.svg" width="308" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-20" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae39adc817bff49725d338570174c4a0b_icgraph.svg" width="276" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac2e20046425bd97175be33f596af1511" name="ac2e20046425bd97175be33f596af1511"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2e20046425bd97175be33f596af1511">&#9670;&#160;</a></span>ssl_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialise the SSL library. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error</td></tr>
  </table>
  </dd>
</dl>
<p>OpenSSL library needs to be fed with sufficient entropy. On systems with /dev/urandom, this is done transparently by the library itself, on other systems we need to fill the entropy pool ourselves.</p>
<p>Even though only OpenSSL 0.9.5 and later will complain about the lack of entropy, we try to our best and fill the pool with older versions also. (That's the reason for the ugly ifdefs and macros, otherwise I could have simply ifdef'd the whole ssl_init function) </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00552">552</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  553</span>{</div>
<div class="line"><span class="lineno">  554</span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> init_complete = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>  <span class="keywordflow">if</span> (init_complete)</div>
<div class="line"><span class="lineno">  557</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  558</span> </div>
<div class="line"><span class="lineno">  559</span>  <span class="keywordflow">if</span> (RAND_status() != 1)</div>
<div class="line"><span class="lineno">  560</span>  {</div>
<div class="line"><span class="lineno">  561</span>    <span class="comment">/* load entropy from files */</span></div>
<div class="line"><span class="lineno">  562</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *path = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  563</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_entropy_file = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;entropy_file&quot;</span>);</div>
<div class="line"><span class="lineno">  564</span>    <a class="code hl_function" href="#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(c_entropy_file);</div>
<div class="line"><span class="lineno">  565</span>    <a class="code hl_function" href="#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(RAND_file_name(path-&gt;<a class="code hl_variable" href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">data</a>, path-&gt;<a class="code hl_variable" href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">dsize</a>));</div>
<div class="line"><span class="lineno">  566</span> </div>
<div class="line"><span class="lineno">  567</span><span class="comment">/* load entropy from egd sockets */</span></div>
<div class="line"><span class="lineno">  568</span><span class="preprocessor">#ifdef HAVE_RAND_EGD</span></div>
<div class="line"><span class="lineno">  569</span>    <a class="code hl_function" href="#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(<a class="code hl_function" href="mutt_2string_8c.html#a954e319c94dafe57f48ea9b847269127">mutt_str_getenv</a>(<span class="stringliteral">&quot;EGDSOCKET&quot;</span>));</div>
<div class="line"><span class="lineno">  570</span>    <a class="code hl_function" href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a>(path, <span class="stringliteral">&quot;%s/.entropy&quot;</span>, <a class="code hl_define" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#ac181d2dd4b8f4acbcfe0b1878ebbfa08">home_dir</a>));</div>
<div class="line"><span class="lineno">  571</span>    <a class="code hl_function" href="#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(<a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(path));</div>
<div class="line"><span class="lineno">  572</span>    <a class="code hl_function" href="#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(TMPDIR <span class="stringliteral">&quot;/entropy&quot;</span>);</div>
<div class="line"><span class="lineno">  573</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  574</span> </div>
<div class="line"><span class="lineno">  575</span>    <span class="comment">/* shuffle $RANDFILE (or ~/.rnd if unset) */</span></div>
<div class="line"><span class="lineno">  576</span>    RAND_write_file(RAND_file_name(path-&gt;<a class="code hl_variable" href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">data</a>, path-&gt;<a class="code hl_variable" href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">dsize</a>));</div>
<div class="line"><span class="lineno">  577</span>    <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;path);</div>
<div class="line"><span class="lineno">  578</span> </div>
<div class="line"><span class="lineno">  579</span>    <a class="code hl_function" href="mutt__logging_8c.html#af068b3f524a31fad293b2fb61dfc4534">mutt_clear_error</a>();</div>
<div class="line"><span class="lineno">  580</span>    <span class="keywordflow">if</span> (RAND_status() != 1)</div>
<div class="line"><span class="lineno">  581</span>    {</div>
<div class="line"><span class="lineno">  582</span>      <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Failed to find enough entropy on your system&quot;</span>));</div>
<div class="line"><span class="lineno">  583</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  584</span>    }</div>
<div class="line"><span class="lineno">  585</span>  }</div>
<div class="line"><span class="lineno">  586</span> </div>
<div class="line"><span class="lineno">  587</span><span class="comment">/* OpenSSL performs automatic initialization as of 1.1.</span></div>
<div class="line"><span class="lineno">  588</span><span class="comment"> * However LibreSSL does not (as of 2.8.3). */</span></div>
<div class="line"><span class="lineno">  589</span><span class="preprocessor">#if (defined(OPENSSL_VERSION_NUMBER) &amp;&amp; (OPENSSL_VERSION_NUMBER &lt; 0x10100000L)) || \</span></div>
<div class="line"><span class="lineno">  590</span><span class="preprocessor">    (defined(LIBRESSL_VERSION_NUMBER))</span></div>
<div class="line"><span class="lineno">  591</span>  <span class="comment">/* I don&#39;t think you can do this just before reading the error. The call</span></div>
<div class="line"><span class="lineno">  592</span><span class="comment">   * itself might clobber the last SSL error. */</span></div>
<div class="line"><span class="lineno">  593</span>  SSL_load_error_strings();</div>
<div class="line"><span class="lineno">  594</span>  SSL_library_init();</div>
<div class="line"><span class="lineno">  595</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  596</span>  init_complete = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  597</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  598</span>}</div>
<div class="ttc" id="abuffer_8c_html_a02123807d31181ac701b566226e93b33"><div class="ttname"><a href="buffer_8c.html#a02123807d31181ac701b566226e93b33">buf_printf</a></div><div class="ttdeci">int buf_printf(struct Buffer *buf, const char *fmt,...)</div><div class="ttdoc">Format a string overwriting a Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00161">buffer.c:161</a></div></div>
<div class="ttc" id="abuffer_8h_html_a728ebc5a947b77c8d56db44ce553a7ab"><div class="ttname"><a href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a></div><div class="ttdeci">static const char * buf_string(const struct Buffer *buf)</div><div class="ttdoc">Convert a buffer to a const char * &quot;string&quot;.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00096">buffer.h:96</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a954e319c94dafe57f48ea9b847269127"><div class="ttname"><a href="mutt_2string_8c.html#a954e319c94dafe57f48ea9b847269127">mutt_str_getenv</a></div><div class="ttdeci">const char * mutt_str_getenv(const char *name)</div><div class="ttdoc">Get an environment variable.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00726">string.c:726</a></div></div>
<div class="ttc" id="amutt__logging_8c_html_af068b3f524a31fad293b2fb61dfc4534"><div class="ttname"><a href="mutt__logging_8c.html#af068b3f524a31fad293b2fb61dfc4534">mutt_clear_error</a></div><div class="ttdeci">void mutt_clear_error(void)</div><div class="ttdoc">Clear the message line (bottom line of screen)</div><div class="ttdef"><b>Definition</b> <a href="mutt__logging_8c_source.html#l00074">mutt_logging.c:74</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a13c099b66aaf5ef1eba6df644a9cd82d"><div class="ttname"><a href="#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a></div><div class="ttdeci">static int add_entropy(const char *file)</div><div class="ttdoc">Add a source of random numbers.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00204">openssl.c:204</a></div></div>
<div class="ttc" id="apool_8c_html_a41cba27c25d33cb6822789a2856093f2"><div class="ttname"><a href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a></div><div class="ttdeci">struct Buffer * buf_pool_get(void)</div><div class="ttdoc">Get a Buffer from the pool.</div><div class="ttdef"><b>Definition</b> <a href="pool_8c_source.html#l00082">pool.c:82</a></div></div>
<div class="ttc" id="apool_8c_html_a4cc6068279461cb8628219586dfa35a1"><div class="ttname"><a href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a></div><div class="ttdeci">void buf_pool_release(struct Buffer **ptr)</div><div class="ttdoc">Return a Buffer to the pool.</div><div class="ttdef"><b>Definition</b> <a href="pool_8c_source.html#l00096">pool.c:96</a></div></div>
<div class="ttc" id="astring2_8h_html_a7e0481bed27661ea2679f256b24e0283"><div class="ttname"><a href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a></div><div class="ttdeci">#define NONULL(x)</div><div class="ttdef"><b>Definition</b> <a href="string2_8h_source.html#l00043">string2.h:43</a></div></div>
<div class="ttc" id="astructBuffer_html"><div class="ttname"><a href="structBuffer.html">Buffer</a></div><div class="ttdoc">String manipulation buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00035">buffer.h:36</a></div></div>
<div class="ttc" id="astructBuffer_html_a1d9ee60bcf94de702b15ec2b5d811995"><div class="ttname"><a href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">Buffer::dsize</a></div><div class="ttdeci">size_t dsize</div><div class="ttdoc">Length of data.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00039">buffer.h:39</a></div></div>
<div class="ttc" id="astructBuffer_html_aeec1fd4af0ddf6765b0187466d4361b8"><div class="ttname"><a href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">Buffer::data</a></div><div class="ttdeci">char * data</div><div class="ttdoc">Pointer to data.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8h_source.html#l00037">buffer.h:37</a></div></div>
<div class="ttc" id="astructNeoMutt_html_ac181d2dd4b8f4acbcfe0b1878ebbfa08"><div class="ttname"><a href="structNeoMutt.html#ac181d2dd4b8f4acbcfe0b1878ebbfa08">NeoMutt::home_dir</a></div><div class="ttdeci">char * home_dir</div><div class="ttdoc">User&#39;s home directory.</div><div class="ttdef"><b>Definition</b> <a href="neomutt_8h_source.html#l00053">neomutt.h:53</a></div></div>
</div><!-- fragment --><div id="dynsection-21" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ac2e20046425bd97175be33f596af1511_cgraph.svg" width="247" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-22" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ac2e20046425bd97175be33f596af1511_icgraph.svg" width="280" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad249269819bbf126758110522b538d62" name="ad249269819bbf126758110522b538d62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad249269819bbf126758110522b538d62">&#9670;&#160;</a></span>ssl_get_client_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_get_client_cert </td>
          <td>(</td>
          <td class="paramtype">struct SslSockData *</td>          <td class="paramname"><span class="paramname"><em>ssldata</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the client certificate for an SSL connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ssldata</td><td>SSL socket data </td></tr>
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html">Connection</a> to a server </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00605">605</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  606</span>{</div>
<div class="line"><span class="lineno">  607</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_ssl_client_cert = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_client_cert&quot;</span>);</div>
<div class="line"><span class="lineno">  608</span>  <span class="keywordflow">if</span> (!c_ssl_client_cert)</div>
<div class="line"><span class="lineno">  609</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  610</span> </div>
<div class="line"><span class="lineno">  611</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Using client certificate %s\n&quot;</span>, c_ssl_client_cert);</div>
<div class="line"><span class="lineno">  612</span>  SSL_CTX_set_default_passwd_cb_userdata(ssldata-&gt;sctx, &amp;conn-&gt;<a class="code hl_variable" href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">account</a>);</div>
<div class="line"><span class="lineno">  613</span>  SSL_CTX_set_default_passwd_cb(ssldata-&gt;sctx, <a class="code hl_function" href="#a68682ecd35358cb52878d8bcf0724e93">ssl_passwd_cb</a>);</div>
<div class="line"><span class="lineno">  614</span>  SSL_CTX_use_certificate_file(ssldata-&gt;sctx, c_ssl_client_cert, SSL_FILETYPE_PEM);</div>
<div class="line"><span class="lineno">  615</span>  SSL_CTX_use_PrivateKey_file(ssldata-&gt;sctx, c_ssl_client_cert, SSL_FILETYPE_PEM);</div>
<div class="line"><span class="lineno">  616</span>}</div>
<div class="ttc" id="aopenssl_8c_html_a68682ecd35358cb52878d8bcf0724e93"><div class="ttname"><a href="#a68682ecd35358cb52878d8bcf0724e93">ssl_passwd_cb</a></div><div class="ttdeci">static int ssl_passwd_cb(char *buf, int buflen, int rwflag, void *userdata)</div><div class="ttdoc">Callback to get a password.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00337">openssl.c:337</a></div></div>
<div class="ttc" id="astructConnection_html_ac3c39549b6611c8eaed2a25573b5c432"><div class="ttname"><a href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">Connection::account</a></div><div class="ttdeci">struct ConnAccount account</div><div class="ttdoc">Account details: username, password, etc.</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00049">connection.h:49</a></div></div>
</div><!-- fragment --><div id="dynsection-23" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad249269819bbf126758110522b538d62_cgraph.svg" width="307" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-24" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad249269819bbf126758110522b538d62_icgraph.svg" width="270" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5f1104e3e22a4015529223f2288398f3" name="a5f1104e3e22a4015529223f2288398f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f1104e3e22a4015529223f2288398f3">&#9670;&#160;</a></span>check_certificate_cache()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_cache </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>peercert</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Is the X509 Certificate in the cache? </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is in the cache </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00637">637</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  638</span>{</div>
<div class="line"><span class="lineno">  639</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> peermd[EVP_MAX_MD_SIZE];</div>
<div class="line"><span class="lineno">  640</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> peermdlen;</div>
<div class="line"><span class="lineno">  641</span>  X509 *cert = NULL;</div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span>  <span class="keywordflow">if</span> (!X509_digest(peercert, EVP_sha256(), peermd, &amp;peermdlen) || !SslSessionCerts)</div>
<div class="line"><span class="lineno">  644</span>  {</div>
<div class="line"><span class="lineno">  645</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  646</span>  }</div>
<div class="line"><span class="lineno">  647</span> </div>
<div class="line"><span class="lineno">  648</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = sk_X509_num(SslSessionCerts) - 1; i &gt;= 0; i--)</div>
<div class="line"><span class="lineno">  649</span>  {</div>
<div class="line"><span class="lineno">  650</span>    cert = sk_X509_value(SslSessionCerts, i);</div>
<div class="line"><span class="lineno">  651</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a7f6abab1b060f3eb73d6455c90847e39">certificates_equal</a>(cert, peercert, peermd, peermdlen))</div>
<div class="line"><span class="lineno">  652</span>    {</div>
<div class="line"><span class="lineno">  653</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  654</span>    }</div>
<div class="line"><span class="lineno">  655</span>  }</div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  658</span>}</div>
<div class="ttc" id="aopenssl_8c_html_a7f6abab1b060f3eb73d6455c90847e39"><div class="ttname"><a href="#a7f6abab1b060f3eb73d6455c90847e39">certificates_equal</a></div><div class="ttdeci">static bool certificates_equal(X509 *cert, X509 *peercert, unsigned char *peermd, unsigned int peermdlen)</div><div class="ttdoc">Compare two X509 certificated.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00441">openssl.c:441</a></div></div>
</div><!-- fragment --><div id="dynsection-25" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5f1104e3e22a4015529223f2288398f3_cgraph.svg" width="354" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-26" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5f1104e3e22a4015529223f2288398f3_icgraph.svg" width="356" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ada3c8409337c74100a934208b0551be0" name="ada3c8409337c74100a934208b0551be0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada3c8409337c74100a934208b0551be0">&#9670;&#160;</a></span>check_certificate_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_file </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>peercert</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read and check a certificate file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Error, or certificate is invalid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00666">666</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  667</span>{</div>
<div class="line"><span class="lineno">  668</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> peermd[EVP_MAX_MD_SIZE];</div>
<div class="line"><span class="lineno">  669</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> peermdlen;</div>
<div class="line"><span class="lineno">  670</span>  X509 *cert = NULL;</div>
<div class="line"><span class="lineno">  671</span>  <span class="keywordtype">int</span> pass = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  672</span>  FILE *fp = NULL;</div>
<div class="line"><span class="lineno">  673</span> </div>
<div class="line"><span class="lineno">  674</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div>
<div class="line"><span class="lineno">  675</span>  fp = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(c_certificate_file, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">  676</span>  <span class="keywordflow">if</span> (!fp)</div>
<div class="line"><span class="lineno">  677</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>  <span class="keywordflow">if</span> (!X509_digest(peercert, EVP_sha256(), peermd, &amp;peermdlen))</div>
<div class="line"><span class="lineno">  680</span>  {</div>
<div class="line"><span class="lineno">  681</span>    <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  682</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  683</span>  }</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>  <span class="keywordflow">while</span> (PEM_read_X509(fp, &amp;cert, NULL, NULL))</div>
<div class="line"><span class="lineno">  686</span>  {</div>
<div class="line"><span class="lineno">  687</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a7f6abab1b060f3eb73d6455c90847e39">certificates_equal</a>(cert, peercert, peermd, peermdlen) &amp;&amp;</div>
<div class="line"><span class="lineno">  688</span>        <a class="code hl_function" href="#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a>(cert, <span class="keyword">true</span>))</div>
<div class="line"><span class="lineno">  689</span>    {</div>
<div class="line"><span class="lineno">  690</span>      pass = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  691</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  692</span>    }</div>
<div class="line"><span class="lineno">  693</span>  }</div>
<div class="line"><span class="lineno">  694</span>  <span class="comment">/* PEM_read_X509 sets an error on eof */</span></div>
<div class="line"><span class="lineno">  695</span>  <span class="keywordflow">if</span> (!pass)</div>
<div class="line"><span class="lineno">  696</span>    ERR_clear_error();</div>
<div class="line"><span class="lineno">  697</span>  X509_free(cert);</div>
<div class="line"><span class="lineno">  698</span>  <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  699</span> </div>
<div class="line"><span class="lineno">  700</span>  <span class="keywordflow">return</span> pass;</div>
<div class="line"><span class="lineno">  701</span>}</div>
<div class="ttc" id="aopenssl_8c_html_ad29824f6d037bbefe08d5551fafabe74"><div class="ttname"><a href="#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a></div><div class="ttdeci">static bool check_certificate_expiration(X509 *peercert, bool silent)</div><div class="ttdoc">Check if a certificate has expired.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00471">openssl.c:471</a></div></div>
</div><!-- fragment --><div id="dynsection-27" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ada3c8409337c74100a934208b0551be0_cgraph.svg" width="400" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-28" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ada3c8409337c74100a934208b0551be0_icgraph.svg" width="354" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a039081100802f18e9d2fb80b492e61ac" name="a039081100802f18e9d2fb80b492e61ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a039081100802f18e9d2fb80b492e61ac">&#9670;&#160;</a></span>check_host()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int check_host </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>x509cert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>hostname</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>err</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>errlen</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check the host on the certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x509cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">hostname</td><td>Hostname </td></tr>
    <tr><td class="paramname">err</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer.">Buffer</a> for error message </td></tr>
    <tr><td class="paramname">errlen</td><td>Length of buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>Hostname matches the certificate </td></tr>
    <tr><td class="paramname">0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00712">712</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  713</span>{</div>
<div class="line"><span class="lineno">  714</span>  <span class="keywordtype">int</span> rc = 0;</div>
<div class="line"><span class="lineno">  715</span>  <span class="comment">/* hostname in ASCII format: */</span></div>
<div class="line"><span class="lineno">  716</span>  <span class="keywordtype">char</span> *hostname_ascii = NULL;</div>
<div class="line"><span class="lineno">  717</span>  <span class="comment">/* needed to get the common name: */</span></div>
<div class="line"><span class="lineno">  718</span>  X509_NAME *x509_subject = NULL;</div>
<div class="line"><span class="lineno">  719</span>  <span class="keywordtype">char</span> *buf = NULL;</div>
<div class="line"><span class="lineno">  720</span>  <span class="keywordtype">int</span> bufsize;</div>
<div class="line"><span class="lineno">  721</span>  <span class="comment">/* needed to get the DNS subjectAltNames: */</span></div>
<div class="line"><span class="lineno">  722</span>  <a class="code hl_function" href="#a42856d46ab73f3511a5353d4e30af6d4">STACK_OF</a>(GENERAL_NAME) * subj_alt_names;</div>
<div class="line"><span class="lineno">  723</span>  <span class="keywordtype">int</span> subj_alt_names_count;</div>
<div class="line"><span class="lineno">  724</span>  GENERAL_NAME *subj_alt_name = NULL;</div>
<div class="line"><span class="lineno">  725</span>  <span class="comment">/* did we find a name matching hostname? */</span></div>
<div class="line"><span class="lineno">  726</span>  <span class="keywordtype">bool</span> match_found;</div>
<div class="line"><span class="lineno">  727</span> </div>
<div class="line"><span class="lineno">  728</span>  <span class="comment">/* Check if &#39;hostname&#39; matches the one of the subjectAltName extensions of</span></div>
<div class="line"><span class="lineno">  729</span><span class="comment">   * type DNS or the Common Name (CN). */</span></div>
<div class="line"><span class="lineno">  730</span> </div>
<div class="line"><span class="lineno">  731</span><span class="preprocessor">#ifdef HAVE_LIBIDN</span></div>
<div class="line"><span class="lineno">  732</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="idna_8c.html#a245452209019d6bc1eed6f6f341eccf2">mutt_idna_to_ascii_lz</a>(hostname, &amp;hostname_ascii, 0) != 0)</div>
<div class="line"><span class="lineno">  733</span>  {</div>
<div class="line"><span class="lineno">  734</span>    hostname_ascii = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(hostname);</div>
<div class="line"><span class="lineno">  735</span>  }</div>
<div class="line"><span class="lineno">  736</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  737</span>  hostname_ascii = <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(hostname);</div>
<div class="line"><span class="lineno">  738</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  739</span> </div>
<div class="line"><span class="lineno">  740</span>  <span class="comment">/* Try the DNS subjectAltNames. */</span></div>
<div class="line"><span class="lineno">  741</span>  match_found = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  742</span>  subj_alt_names = X509_get_ext_d2i(x509cert, NID_subject_alt_name, NULL, NULL);</div>
<div class="line"><span class="lineno">  743</span>  <span class="keywordflow">if</span> (subj_alt_names)</div>
<div class="line"><span class="lineno">  744</span>  {</div>
<div class="line"><span class="lineno">  745</span>    subj_alt_names_count = sk_GENERAL_NAME_num(subj_alt_names);</div>
<div class="line"><span class="lineno">  746</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; subj_alt_names_count; i++)</div>
<div class="line"><span class="lineno">  747</span>    {</div>
<div class="line"><span class="lineno">  748</span>      subj_alt_name = sk_GENERAL_NAME_value(subj_alt_names, i);</div>
<div class="line"><span class="lineno">  749</span>      <span class="keywordflow">if</span> (subj_alt_name-&gt;type == GEN_DNS)</div>
<div class="line"><span class="lineno">  750</span>      {</div>
<div class="line"><span class="lineno">  751</span>        <span class="keywordflow">if</span> ((subj_alt_name-&gt;d.ia5-&gt;length &gt;= 0) &amp;&amp;</div>
<div class="line"><span class="lineno">  752</span>            (<a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>((<span class="keywordtype">char</span> *) subj_alt_name-&gt;d.ia5-&gt;data) ==</div>
<div class="line"><span class="lineno">  753</span>             (<span class="keywordtype">size_t</span>) subj_alt_name-&gt;d.ia5-&gt;length) &amp;&amp;</div>
<div class="line"><span class="lineno">  754</span>            (match_found = <a class="code hl_function" href="#ae39adc817bff49725d338570174c4a0b">hostname_match</a>(hostname_ascii,</div>
<div class="line"><span class="lineno">  755</span>                                          (<span class="keywordtype">char</span> *) (subj_alt_name-&gt;d.ia5-&gt;data))))</div>
<div class="line"><span class="lineno">  756</span>        {</div>
<div class="line"><span class="lineno">  757</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  758</span>        }</div>
<div class="line"><span class="lineno">  759</span>      }</div>
<div class="line"><span class="lineno">  760</span>    }</div>
<div class="line"><span class="lineno">  761</span>    GENERAL_NAMES_free(subj_alt_names);</div>
<div class="line"><span class="lineno">  762</span>  }</div>
<div class="line"><span class="lineno">  763</span> </div>
<div class="line"><span class="lineno">  764</span>  <span class="keywordflow">if</span> (!match_found)</div>
<div class="line"><span class="lineno">  765</span>  {</div>
<div class="line"><span class="lineno">  766</span>    <span class="comment">/* Try the common name */</span></div>
<div class="line"><span class="lineno">  767</span>    x509_subject = X509_get_subject_name(x509cert);</div>
<div class="line"><span class="lineno">  768</span>    <span class="keywordflow">if</span> (!x509_subject)</div>
<div class="line"><span class="lineno">  769</span>    {</div>
<div class="line"><span class="lineno">  770</span>      <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div>
<div class="line"><span class="lineno">  771</span>        <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(err, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;can&#39;t get certificate subject&quot;</span>), errlen);</div>
<div class="line"><span class="lineno">  772</span>      <span class="keywordflow">goto</span> out;</div>
<div class="line"><span class="lineno">  773</span>    }</div>
<div class="line"><span class="lineno">  774</span> </div>
<div class="line"><span class="lineno">  775</span>    <span class="comment">/* first get the space requirements */</span></div>
<div class="line"><span class="lineno">  776</span>    bufsize = X509_NAME_get_text_by_NID(x509_subject, NID_commonName, NULL, 0);</div>
<div class="line"><span class="lineno">  777</span>    <span class="keywordflow">if</span> (bufsize == -1)</div>
<div class="line"><span class="lineno">  778</span>    {</div>
<div class="line"><span class="lineno">  779</span>      <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div>
<div class="line"><span class="lineno">  780</span>        <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(err, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;can&#39;t get certificate common name&quot;</span>), errlen);</div>
<div class="line"><span class="lineno">  781</span>      <span class="keywordflow">goto</span> out;</div>
<div class="line"><span class="lineno">  782</span>    }</div>
<div class="line"><span class="lineno">  783</span>    bufsize++; <span class="comment">/* space for the terminal nul char */</span></div>
<div class="line"><span class="lineno">  784</span>    buf = <a class="code hl_define" href="memory_8h.html#af997cb3719dc7abbeabae655d0ee1b9e">MUTT_MEM_MALLOC</a>(bufsize, <span class="keywordtype">char</span>);</div>
<div class="line"><span class="lineno">  785</span>    <span class="keywordflow">if</span> (X509_NAME_get_text_by_NID(x509_subject, NID_commonName, buf, bufsize) == -1)</div>
<div class="line"><span class="lineno">  786</span>    {</div>
<div class="line"><span class="lineno">  787</span>      <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div>
<div class="line"><span class="lineno">  788</span>        <a class="code hl_function" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(err, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;can&#39;t get certificate common name&quot;</span>), errlen);</div>
<div class="line"><span class="lineno">  789</span>      <span class="keywordflow">goto</span> out;</div>
<div class="line"><span class="lineno">  790</span>    }</div>
<div class="line"><span class="lineno">  791</span>    <span class="comment">/* cast is safe since bufsize is incremented above, so bufsize-1 is always</span></div>
<div class="line"><span class="lineno">  792</span><span class="comment">     * zero or greater.  */</span></div>
<div class="line"><span class="lineno">  793</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(buf) == (<span class="keywordtype">size_t</span>) bufsize - 1)</div>
<div class="line"><span class="lineno">  794</span>    {</div>
<div class="line"><span class="lineno">  795</span>      match_found = <a class="code hl_function" href="#ae39adc817bff49725d338570174c4a0b">hostname_match</a>(hostname_ascii, buf);</div>
<div class="line"><span class="lineno">  796</span>    }</div>
<div class="line"><span class="lineno">  797</span>  }</div>
<div class="line"><span class="lineno">  798</span> </div>
<div class="line"><span class="lineno">  799</span>  <span class="keywordflow">if</span> (!match_found)</div>
<div class="line"><span class="lineno">  800</span>  {</div>
<div class="line"><span class="lineno">  801</span>    <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div>
<div class="line"><span class="lineno">  802</span>      snprintf(err, errlen, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;certificate owner does not match hostname %s&quot;</span>), hostname);</div>
<div class="line"><span class="lineno">  803</span>    <span class="keywordflow">goto</span> out;</div>
<div class="line"><span class="lineno">  804</span>  }</div>
<div class="line"><span class="lineno">  805</span> </div>
<div class="line"><span class="lineno">  806</span>  rc = 1;</div>
<div class="line"><span class="lineno">  807</span> </div>
<div class="line"><span class="lineno">  808</span>out:</div>
<div class="line"><span class="lineno">  809</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;buf);</div>
<div class="line"><span class="lineno">  810</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;hostname_ascii);</div>
<div class="line"><span class="lineno">  811</span> </div>
<div class="line"><span class="lineno">  812</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  813</span>}</div>
<div class="ttc" id="aidna_8c_html_a245452209019d6bc1eed6f6f341eccf2"><div class="ttname"><a href="idna_8c.html#a245452209019d6bc1eed6f6f341eccf2">mutt_idna_to_ascii_lz</a></div><div class="ttdeci">int mutt_idna_to_ascii_lz(const char *input, char **output, uint8_t flags)</div><div class="ttdoc">Convert a domain to Punycode.</div><div class="ttdef"><b>Definition</b> <a href="idna_8c_source.html#l00090">idna.c:90</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a3fe33d90e4814281cd57de048119c950"><div class="ttname"><a href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a></div><div class="ttdeci">char * mutt_str_dup(const char *str)</div><div class="ttdoc">Copy a string, safely.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00255">string.c:255</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_acca6786b903b22a5924219f9db96e10d"><div class="ttname"><a href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a></div><div class="ttdeci">size_t mutt_str_len(const char *a)</div><div class="ttdoc">Calculate the length of a string, safely.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00498">string.c:498</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a42856d46ab73f3511a5353d4e30af6d4"><div class="ttname"><a href="#a42856d46ab73f3511a5353d4e30af6d4">STACK_OF</a></div><div class="ttdeci">static STACK_OF(X509)</div><div class="ttdoc">Keep a handle on accepted certificates in case we want to open up another connection to the same serv...</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00093">openssl.c:93</a></div></div>
<div class="ttc" id="aopenssl_8c_html_ae39adc817bff49725d338570174c4a0b"><div class="ttname"><a href="#ae39adc817bff49725d338570174c4a0b">hostname_match</a></div><div class="ttdeci">static bool hostname_match(const char *hostname, const char *certname)</div><div class="ttdoc">Does the hostname match the certificate.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00506">openssl.c:506</a></div></div>
</div><!-- fragment --><div id="dynsection-29" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a039081100802f18e9d2fb80b492e61ac_cgraph.svg" width="296" height="307"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-30" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a039081100802f18e9d2fb80b492e61ac_icgraph.svg" width="280" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="afdbe2b83fcf6173cf72e7f729f230a72" name="afdbe2b83fcf6173cf72e7f729f230a72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdbe2b83fcf6173cf72e7f729f230a72">&#9670;&#160;</a></span>check_certificate_by_digest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_by_digest </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>peercert</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Validate a certificate by its digest. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00821">821</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  822</span>{</div>
<div class="line"><span class="lineno">  823</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a>(peercert, <span class="keyword">false</span>) &amp;&amp; <a class="code hl_function" href="#ada3c8409337c74100a934208b0551be0">check_certificate_file</a>(peercert);</div>
<div class="line"><span class="lineno">  824</span>}</div>
<div class="ttc" id="aopenssl_8c_html_ada3c8409337c74100a934208b0551be0"><div class="ttname"><a href="#ada3c8409337c74100a934208b0551be0">check_certificate_file</a></div><div class="ttdeci">static bool check_certificate_file(X509 *peercert)</div><div class="ttdoc">Read and check a certificate file.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00666">openssl.c:666</a></div></div>
</div><!-- fragment --><div id="dynsection-31" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_afdbe2b83fcf6173cf72e7f729f230a72_cgraph.svg" width="594" height="75"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-32" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-32-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-32-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-32-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_afdbe2b83fcf6173cf72e7f729f230a72_icgraph.svg" width="336" height="60"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab8bbb9fa54bc203070165c84f273cb0f" name="ab8bbb9fa54bc203070165c84f273cb0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8bbb9fa54bc203070165c84f273cb0f">&#9670;&#160;</a></span>ssl_cache_trusted_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_cache_trusted_cert </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>c</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cache a trusted certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&gt;0</td><td>Number of elements in the cache </td></tr>
    <tr><td class="paramname">0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00832">832</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  833</span>{</div>
<div class="line"><span class="lineno">  834</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;trusted\n&quot;</span>);</div>
<div class="line"><span class="lineno">  835</span>  <span class="keywordflow">if</span> (!SslSessionCerts)</div>
<div class="line"><span class="lineno">  836</span>    SslSessionCerts = sk_X509_new_null();</div>
<div class="line"><span class="lineno">  837</span>  <span class="keywordflow">return</span> sk_X509_push(SslSessionCerts, X509_dup(c));</div>
<div class="line"><span class="lineno">  838</span>}</div>
</div><!-- fragment --><div id="dynsection-33" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-33-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-33-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-33-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ab8bbb9fa54bc203070165c84f273cb0f_icgraph.svg" width="378" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="acd1c8bc6deae4960eb20099d6fda2ebf" name="acd1c8bc6deae4960eb20099d6fda2ebf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd1c8bc6deae4960eb20099d6fda2ebf">&#9670;&#160;</a></span>add_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_cert </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>title</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>cert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>issuer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct StringArray *</td>          <td class="paramname"><span class="paramname"><em>carr</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Look up certificate info and save it to a list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">title</td><td>Title for this block of certificate info </td></tr>
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">issuer</td><td>If true, look up the issuer rather than owner details </td></tr>
    <tr><td class="paramname">carr</td><td>Array to save info to </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00847">847</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  848</span>{</div>
<div class="line"><span class="lineno">  849</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> part[] = {</div>
<div class="line"><span class="lineno">  850</span>    NID_commonName,             <span class="comment">// CN</span></div>
<div class="line"><span class="lineno">  851</span>    NID_pkcs9_emailAddress,     <span class="comment">// Email</span></div>
<div class="line"><span class="lineno">  852</span>    NID_organizationName,       <span class="comment">// O</span></div>
<div class="line"><span class="lineno">  853</span>    NID_organizationalUnitName, <span class="comment">// OU</span></div>
<div class="line"><span class="lineno">  854</span>    NID_localityName,           <span class="comment">// L</span></div>
<div class="line"><span class="lineno">  855</span>    NID_stateOrProvinceName,    <span class="comment">// ST</span></div>
<div class="line"><span class="lineno">  856</span>    NID_countryName,            <span class="comment">// C</span></div>
<div class="line"><span class="lineno">  857</span>  };</div>
<div class="line"><span class="lineno">  858</span> </div>
<div class="line"><span class="lineno">  859</span>  X509_NAME *x509 = NULL;</div>
<div class="line"><span class="lineno">  860</span>  <span class="keywordflow">if</span> (issuer)</div>
<div class="line"><span class="lineno">  861</span>    x509 = X509_get_issuer_name(cert);</div>
<div class="line"><span class="lineno">  862</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  863</span>    x509 = X509_get_subject_name(cert);</div>
<div class="line"><span class="lineno">  864</span> </div>
<div class="line"><span class="lineno">  865</span>  <span class="comment">// Allocate formatted strings and let the array take ownership</span></div>
<div class="line"><span class="lineno">  866</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(carr, <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(title));</div>
<div class="line"><span class="lineno">  867</span> </div>
<div class="line"><span class="lineno">  868</span>  <span class="keywordtype">char</span> *line = NULL;</div>
<div class="line"><span class="lineno">  869</span>  <span class="keywordtype">char</span> *text = NULL;</div>
<div class="line"><span class="lineno">  870</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code hl_define" href="memory_8h.html#a13aaf9e9e194ebfd84f90bcf4e264aca">countof</a>(part); i++)</div>
<div class="line"><span class="lineno">  871</span>  {</div>
<div class="line"><span class="lineno">  872</span>    text = <a class="code hl_function" href="#a1599982dabbbc5933b587dbb07c95b15">x509_get_part</a>(x509, part[i]);</div>
<div class="line"><span class="lineno">  873</span>    <span class="keywordflow">if</span> (text)</div>
<div class="line"><span class="lineno">  874</span>    {</div>
<div class="line"><span class="lineno">  875</span>      <a class="code hl_function" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <span class="stringliteral">&quot;   %s&quot;</span>, text);</div>
<div class="line"><span class="lineno">  876</span>      <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(carr, line);</div>
<div class="line"><span class="lineno">  877</span>    }</div>
<div class="line"><span class="lineno">  878</span>  }</div>
<div class="line"><span class="lineno">  879</span>}</div>
<div class="ttc" id="aarray_8h_html_a4f570f2382025383e4b2cc46ede6ebd0"><div class="ttname"><a href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a></div><div class="ttdeci">#define ARRAY_ADD(head, elem)</div><div class="ttdoc">Add an element at the end of the array.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00156">array.h:156</a></div></div>
<div class="ttc" id="amemory_8h_html_a13aaf9e9e194ebfd84f90bcf4e264aca"><div class="ttname"><a href="memory_8h.html#a13aaf9e9e194ebfd84f90bcf4e264aca">countof</a></div><div class="ttdeci">#define countof(x)</div><div class="ttdef"><b>Definition</b> <a href="memory_8h_source.html#l00044">memory.h:44</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_a4388c16988fac9a7596dee4d4af89595"><div class="ttname"><a href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a></div><div class="ttdeci">int mutt_str_asprintf(char **strp, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00803">string.c:803</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a1599982dabbbc5933b587dbb07c95b15"><div class="ttname"><a href="#a1599982dabbbc5933b587dbb07c95b15">x509_get_part</a></div><div class="ttdeci">static char * x509_get_part(X509_NAME *name, int nid)</div><div class="ttdoc">Retrieve from X509 data.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00370">openssl.c:370</a></div></div>
</div><!-- fragment --><div id="dynsection-34" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-34-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-34-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-34-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_acd1c8bc6deae4960eb20099d6fda2ebf_cgraph.svg" width="263" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-35" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-35-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-35-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-35-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_acd1c8bc6deae4960eb20099d6fda2ebf_icgraph.svg" width="292" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae0a15dc5df31b626a42f31bd6a5ea7f4" name="ae0a15dc5df31b626a42f31bd6a5ea7f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0a15dc5df31b626a42f31bd6a5ea7f4">&#9670;&#160;</a></span>interactive_check_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool interactive_check_cert </td>
          <td>(</td>
          <td class="paramtype">X509 *</td>          <td class="paramname"><span class="paramname"><em>cert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>idx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL *</td>          <td class="paramname"><span class="paramname"><em>ssl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>allow_always</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Ask the user if a certificate is valid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">idx</td><td>Place of certificate in the chain </td></tr>
    <tr><td class="paramname">len</td><td>Length of the certificate chain </td></tr>
    <tr><td class="paramname">ssl</td><td>SSL state </td></tr>
    <tr><td class="paramname">allow_always</td><td>If certificate may be always allowed </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>User selected 'skip' </td></tr>
    <tr><td class="paramname">false</td><td>Otherwise </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00891">891</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  892</span>{</div>
<div class="line"><span class="lineno">  893</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="globals_8c.html#a9b3a197dcd72484bca9ba6f0ce451e1f">OptGui</a>)</div>
<div class="line"><span class="lineno">  894</span>  {</div>
<div class="line"><span class="lineno">  895</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;unable to prompt for certificate in batch mode\n&quot;</span>);</div>
<div class="line"><span class="lineno">  896</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Untrusted server certificate&quot;</span>));</div>
<div class="line"><span class="lineno">  897</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  898</span>  }</div>
<div class="line"><span class="lineno">  899</span> </div>
<div class="line"><span class="lineno">  900</span>  <span class="keyword">struct </span>StringArray carr = <a class="code hl_define" href="array_8h.html#af50a4967d27a0531a1b10a23fc22fe05">ARRAY_HEAD_INITIALIZER</a>;</div>
<div class="line"><span class="lineno">  901</span>  <span class="keyword">struct </span><a class="code hl_struct" href="structBuffer.html">Buffer</a> *buf = <a class="code hl_function" href="pool_8c.html#a41cba27c25d33cb6822789a2856093f2">buf_pool_get</a>();</div>
<div class="line"><span class="lineno">  902</span> </div>
<div class="line"><span class="lineno">  903</span>  <a class="code hl_function" href="#acd1c8bc6deae4960eb20099d6fda2ebf">add_cert</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;This certificate belongs to:&quot;</span>), cert, <span class="keyword">false</span>, &amp;carr);</div>
<div class="line"><span class="lineno">  904</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, NULL);</div>
<div class="line"><span class="lineno">  905</span>  <a class="code hl_function" href="#acd1c8bc6deae4960eb20099d6fda2ebf">add_cert</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;This certificate was issued by:&quot;</span>), cert, <span class="keyword">true</span>, &amp;carr);</div>
<div class="line"><span class="lineno">  906</span> </div>
<div class="line"><span class="lineno">  907</span>  <span class="keywordtype">char</span> *line = NULL;</div>
<div class="line"><span class="lineno">  908</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, NULL);</div>
<div class="line"><span class="lineno">  909</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, <a class="code hl_function" href="mutt_2string_8c.html#a3fe33d90e4814281cd57de048119c950">mutt_str_dup</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;This certificate is valid&quot;</span>)));</div>
<div class="line"><span class="lineno">  910</span>  <a class="code hl_function" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;   from %s&quot;</span>), <a class="code hl_function" href="#a16277434f03da3b852516c19d3de7cda">asn1time_to_string</a>(X509_getm_notBefore(cert)));</div>
<div class="line"><span class="lineno">  911</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, line);</div>
<div class="line"><span class="lineno">  912</span>  <a class="code hl_function" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;     to %s&quot;</span>), <a class="code hl_function" href="#a16277434f03da3b852516c19d3de7cda">asn1time_to_string</a>(X509_getm_notAfter(cert)));</div>
<div class="line"><span class="lineno">  913</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, line);</div>
<div class="line"><span class="lineno">  914</span> </div>
<div class="line"><span class="lineno">  915</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, NULL);</div>
<div class="line"><span class="lineno">  916</span>  <a class="code hl_function" href="#a5693f6c49d75be39538f705796656511">x509_fingerprint</a>(buf, cert, EVP_sha1);</div>
<div class="line"><span class="lineno">  917</span>  <a class="code hl_function" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SHA1 Fingerprint: %s&quot;</span>), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(buf));</div>
<div class="line"><span class="lineno">  918</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, line);</div>
<div class="line"><span class="lineno">  919</span> </div>
<div class="line"><span class="lineno">  920</span>  <a class="code hl_function" href="buffer_8c.html#a3b1f80652b37dc26046f9acdd85a0b05">buf_reset</a>(buf);</div>
<div class="line"><span class="lineno">  921</span>  <a class="code hl_function" href="#a5693f6c49d75be39538f705796656511">x509_fingerprint</a>(buf, cert, EVP_sha256);</div>
<div class="line"><span class="lineno">  922</span>  buf-&gt;<a class="code hl_variable" href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">data</a>[39] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* Divide into two lines of output */</span></div>
<div class="line"><span class="lineno">  923</span>  <a class="code hl_function" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <span class="stringliteral">&quot;%s%s&quot;</span>, <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SHA256 Fingerprint: &quot;</span>), <a class="code hl_function" href="buffer_8h.html#a728ebc5a947b77c8d56db44ce553a7ab">buf_string</a>(buf));</div>
<div class="line"><span class="lineno">  924</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, line);</div>
<div class="line"><span class="lineno">  925</span>  <a class="code hl_function" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <span class="stringliteral">&quot;%*s%s&quot;</span>, (<span class="keywordtype">int</span>) <a class="code hl_function" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SHA256 Fingerprint: &quot;</span>)),</div>
<div class="line"><span class="lineno">  926</span>                    <span class="stringliteral">&quot;&quot;</span>, buf-&gt;<a class="code hl_variable" href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">data</a> + 40);</div>
<div class="line"><span class="lineno">  927</span>  <a class="code hl_define" href="array_8h.html#a4f570f2382025383e4b2cc46ede6ebd0">ARRAY_ADD</a>(&amp;carr, line);</div>
<div class="line"><span class="lineno">  928</span> </div>
<div class="line"><span class="lineno">  929</span>  <span class="keywordtype">bool</span> allow_skip = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  930</span><span class="comment">/* The leaf/host certificate can&#39;t be skipped. */</span></div>
<div class="line"><span class="lineno">  931</span><span class="preprocessor">#ifdef HAVE_SSL_PARTIAL_CHAIN</span></div>
<div class="line"><span class="lineno">  932</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_partial_chains = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_partial_chains&quot;</span>);</div>
<div class="line"><span class="lineno">  933</span>  <span class="keywordflow">if</span> ((idx != 0) &amp;&amp; c_ssl_verify_partial_chains)</div>
<div class="line"><span class="lineno">  934</span>    allow_skip = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  935</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  936</span> </div>
<div class="line"><span class="lineno">  937</span>  <span class="keywordtype">char</span> title[256] = { 0 };</div>
<div class="line"><span class="lineno">  938</span>  snprintf(title, <span class="keyword">sizeof</span>(title),</div>
<div class="line"><span class="lineno">  939</span>           <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SSL Certificate check (certificate %zu of %zu in chain)&quot;</span>), len - idx, len);</div>
<div class="line"><span class="lineno">  940</span> </div>
<div class="line"><span class="lineno">  941</span>  <span class="comment">/* Inside ssl_verify_callback(), this function is guarded by a call to</span></div>
<div class="line"><span class="lineno">  942</span><span class="comment">   * check_certificate_by_digest().  This means if check_certificate_expiration() is</span></div>
<div class="line"><span class="lineno">  943</span><span class="comment">   * true, then check_certificate_file() must be false.  Therefore we don&#39;t need</span></div>
<div class="line"><span class="lineno">  944</span><span class="comment">   * to also scan the certificate file here.  */</span></div>
<div class="line"><span class="lineno">  945</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div>
<div class="line"><span class="lineno">  946</span>  allow_always = allow_always &amp;&amp; c_certificate_file &amp;&amp;</div>
<div class="line"><span class="lineno">  947</span>                 <a class="code hl_function" href="#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a>(cert, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  948</span> </div>
<div class="line"><span class="lineno">  949</span>  <span class="keywordtype">int</span> rc = <a class="code hl_function" href="group__gui__dlg.html#ga2a3679347f519661d55ad954c6b8f8b3">dlg_certificate</a>(title, &amp;carr, allow_always, allow_skip);</div>
<div class="line"><span class="lineno">  950</span>  <span class="keywordflow">if</span> ((rc == 3) &amp;&amp; !allow_always)</div>
<div class="line"><span class="lineno">  951</span>    rc = 4;</div>
<div class="line"><span class="lineno">  952</span> </div>
<div class="line"><span class="lineno">  953</span>  <span class="keywordflow">switch</span> (rc)</div>
<div class="line"><span class="lineno">  954</span>  {</div>
<div class="line"><span class="lineno">  955</span>    <span class="keywordflow">case</span> 1: <span class="comment">// Reject</span></div>
<div class="line"><span class="lineno">  956</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  957</span>    <span class="keywordflow">case</span> 2: <span class="comment">// Once</span></div>
<div class="line"><span class="lineno">  958</span>      SSL_set_ex_data(ssl, <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div>
<div class="line"><span class="lineno">  959</span>      <a class="code hl_function" href="#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a>(cert);</div>
<div class="line"><span class="lineno">  960</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  961</span>    <span class="keywordflow">case</span> 3: <span class="comment">// Always</span></div>
<div class="line"><span class="lineno">  962</span>    {</div>
<div class="line"><span class="lineno">  963</span>      <span class="keywordtype">bool</span> saved = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  964</span>      FILE *fp = <a class="code hl_define" href="file_8h.html#a9fa358d76519cb6bc8ffca5850976d46">mutt_file_fopen</a>(c_certificate_file, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line"><span class="lineno">  965</span>      <span class="keywordflow">if</span> (fp)</div>
<div class="line"><span class="lineno">  966</span>      {</div>
<div class="line"><span class="lineno">  967</span>        <span class="keywordflow">if</span> (PEM_write_X509(fp, cert))</div>
<div class="line"><span class="lineno">  968</span>          saved = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  969</span>        <a class="code hl_define" href="file_8h.html#a9b519e795f098be88b93cd72c49a35ec">mutt_file_fclose</a>(&amp;fp);</div>
<div class="line"><span class="lineno">  970</span>      }</div>
<div class="line"><span class="lineno">  971</span> </div>
<div class="line"><span class="lineno">  972</span>      <span class="keywordflow">if</span> (saved)</div>
<div class="line"><span class="lineno">  973</span>        <a class="code hl_define" href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Certificate saved&quot;</span>));</div>
<div class="line"><span class="lineno">  974</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  975</span>        <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Warning: Couldn&#39;t save certificate&quot;</span>));</div>
<div class="line"><span class="lineno">  976</span> </div>
<div class="line"><span class="lineno">  977</span>      SSL_set_ex_data(ssl, <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div>
<div class="line"><span class="lineno">  978</span>      <a class="code hl_function" href="#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a>(cert);</div>
<div class="line"><span class="lineno">  979</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  980</span>    }</div>
<div class="line"><span class="lineno">  981</span>    <span class="keywordflow">case</span> 4: <span class="comment">// Skip</span></div>
<div class="line"><span class="lineno">  982</span>      SSL_set_ex_data(ssl, <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, &amp;<a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>);</div>
<div class="line"><span class="lineno">  983</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  984</span>  }</div>
<div class="line"><span class="lineno">  985</span> </div>
<div class="line"><span class="lineno">  986</span>  <a class="code hl_function" href="mutt_2string_8c.html#ac6115e7fb3ab6a3b86d9f4f745890fb0">string_array_clear</a>(&amp;carr);</div>
<div class="line"><span class="lineno">  987</span>  <a class="code hl_function" href="pool_8c.html#a4cc6068279461cb8628219586dfa35a1">buf_pool_release</a>(&amp;buf);</div>
<div class="line"><span class="lineno">  988</span> </div>
<div class="line"><span class="lineno">  989</span>  <span class="keywordflow">return</span> (rc &gt; 1);</div>
<div class="line"><span class="lineno">  990</span>}</div>
<div class="ttc" id="aarray_8h_html_af50a4967d27a0531a1b10a23fc22fe05"><div class="ttname"><a href="array_8h.html#af50a4967d27a0531a1b10a23fc22fe05">ARRAY_HEAD_INITIALIZER</a></div><div class="ttdeci">#define ARRAY_HEAD_INITIALIZER</div><div class="ttdoc">Static initializer for arrays.</div><div class="ttdef"><b>Definition</b> <a href="array_8h_source.html#l00058">array.h:58</a></div></div>
<div class="ttc" id="abuffer_8c_html_a3b1f80652b37dc26046f9acdd85a0b05"><div class="ttname"><a href="buffer_8c.html#a3b1f80652b37dc26046f9acdd85a0b05">buf_reset</a></div><div class="ttdeci">void buf_reset(struct Buffer *buf)</div><div class="ttdoc">Reset an existing Buffer.</div><div class="ttdef"><b>Definition</b> <a href="buffer_8c_source.html#l00076">buffer.c:76</a></div></div>
<div class="ttc" id="aglobals_8c_html_a9b3a197dcd72484bca9ba6f0ce451e1f"><div class="ttname"><a href="globals_8c.html#a9b3a197dcd72484bca9ba6f0ce451e1f">OptGui</a></div><div class="ttdeci">bool OptGui</div><div class="ttdoc">(pseudo) when the gui (and curses) are started</div><div class="ttdef"><b>Definition</b> <a href="globals_8c_source.html#l00059">globals.c:59</a></div></div>
<div class="ttc" id="agroup__gui__dlg_html_ga2a3679347f519661d55ad954c6b8f8b3"><div class="ttname"><a href="group__gui__dlg.html#ga2a3679347f519661d55ad954c6b8f8b3">dlg_certificate</a></div><div class="ttdeci">int dlg_certificate(const char *title, struct StringArray *carr, bool allow_always, bool allow_skip)</div><div class="ttdoc">Ask the user to validate the certificate -.</div><div class="ttdef"><b>Definition</b> <a href="dlg__verifycert_8c_source.html#l00169">dlg_verifycert.c:169</a></div></div>
<div class="ttc" id="amutt_2string_8c_html_ac6115e7fb3ab6a3b86d9f4f745890fb0"><div class="ttname"><a href="mutt_2string_8c.html#ac6115e7fb3ab6a3b86d9f4f745890fb0">string_array_clear</a></div><div class="ttdeci">void string_array_clear(struct StringArray *arr)</div><div class="ttdoc">Free all memory of a StringArray.</div><div class="ttdef"><b>Definition</b> <a href="mutt_2string_8c_source.html#l00931">string.c:931</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a16277434f03da3b852516c19d3de7cda"><div class="ttname"><a href="#a16277434f03da3b852516c19d3de7cda">asn1time_to_string</a></div><div class="ttdeci">static char * asn1time_to_string(ASN1_UTCTIME *tm)</div><div class="ttdoc">Convert a time to a string.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00414">openssl.c:414</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a5693f6c49d75be39538f705796656511"><div class="ttname"><a href="#a5693f6c49d75be39538f705796656511">x509_fingerprint</a></div><div class="ttdeci">static void x509_fingerprint(struct Buffer *buf, X509 *cert, const EVP_MD *(*hashfunc)(void))</div><div class="ttdoc">Generate a fingerprint for an X509 certificate.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00386">openssl.c:386</a></div></div>
<div class="ttc" id="aopenssl_8c_html_ab8bbb9fa54bc203070165c84f273cb0f"><div class="ttname"><a href="#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a></div><div class="ttdeci">static int ssl_cache_trusted_cert(X509 *c)</div><div class="ttdoc">Cache a trusted certificate.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00832">openssl.c:832</a></div></div>
<div class="ttc" id="aopenssl_8c_html_acd1c8bc6deae4960eb20099d6fda2ebf"><div class="ttname"><a href="#acd1c8bc6deae4960eb20099d6fda2ebf">add_cert</a></div><div class="ttdeci">static void add_cert(const char *title, X509 *cert, bool issuer, struct StringArray *carr)</div><div class="ttdoc">Look up certificate info and save it to a list.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00847">openssl.c:847</a></div></div>
<div class="ttc" id="aopenssl_8c_html_af84a999f737b3cc63228cecc117a5d87"><div class="ttname"><a href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a></div><div class="ttdeci">static int SkipModeExDataIndex</div><div class="ttdoc">Index for storing the &quot;skip mode&quot; state in SSL structure.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00089">openssl.c:89</a></div></div>
</div><!-- fragment --><div id="dynsection-36" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-36-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-36-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-36-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae0a15dc5df31b626a42f31bd6a5ea7f4_cgraph.svg" width="586" height="855"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-37" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-37-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-37-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-37-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae0a15dc5df31b626a42f31bd6a5ea7f4_icgraph.svg" width="348" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a93e2f01418ccb7300b9864837c0a2719" name="a93e2f01418ccb7300b9864837c0a2719"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93e2f01418ccb7300b9864837c0a2719">&#9670;&#160;</a></span>ssl_verify_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_verify_callback </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>preverify_ok</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509_STORE_CTX *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Certificate verification callback. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">preverify_ok</td><td>If true, don't question the user if they skipped verification </td></tr>
    <tr><td class="paramname">ctx</td><td>X509 store context </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Error, or Certificate is invalid</td></tr>
  </table>
  </dd>
</dl>
<p>Called for each certificate in the chain sent by the peer, starting from the root; returning true means that the given certificate is trusted, returning false immediately aborts the SSL connection </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01003">1003</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1004</span>{</div>
<div class="line"><span class="lineno"> 1005</span>  <span class="keywordtype">char</span> buf[256] = { 0 };</div>
<div class="line"><span class="lineno"> 1006</span> </div>
<div class="line"><span class="lineno"> 1007</span>  SSL *ssl = X509_STORE_CTX_get_ex_data(ctx, SSL_get_ex_data_X509_STORE_CTX_idx());</div>
<div class="line"><span class="lineno"> 1008</span>  <span class="keywordflow">if</span> (!ssl)</div>
<div class="line"><span class="lineno"> 1009</span>  {</div>
<div class="line"><span class="lineno"> 1010</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;failed to retrieve SSL structure from X509_STORE_CTX\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1011</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1012</span>  }</div>
<div class="line"><span class="lineno"> 1013</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *host = SSL_get_ex_data(ssl, <a class="code hl_variable" href="#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a>);</div>
<div class="line"><span class="lineno"> 1014</span>  <span class="keywordflow">if</span> (!host)</div>
<div class="line"><span class="lineno"> 1015</span>  {</div>
<div class="line"><span class="lineno"> 1016</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;failed to retrieve hostname from SSL structure\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1017</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1018</span>  }</div>
<div class="line"><span class="lineno"> 1019</span> </div>
<div class="line"><span class="lineno"> 1020</span>  <span class="comment">/* This is true when a previous entry in the certificate chain did</span></div>
<div class="line"><span class="lineno"> 1021</span><span class="comment">   * not verify and the user manually chose to skip it via the</span></div>
<div class="line"><span class="lineno"> 1022</span><span class="comment">   * $ssl_verify_partial_chains option.</span></div>
<div class="line"><span class="lineno"> 1023</span><span class="comment">   * In this case, all following certificates need to be treated as non-verified</span></div>
<div class="line"><span class="lineno"> 1024</span><span class="comment">   * until one is actually verified.  */</span></div>
<div class="line"><span class="lineno"> 1025</span>  <span class="keywordtype">bool</span> skip_mode = (SSL_get_ex_data(ssl, <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>));</div>
<div class="line"><span class="lineno"> 1026</span> </div>
<div class="line"><span class="lineno"> 1027</span>  X509 *cert = X509_STORE_CTX_get_current_cert(ctx);</div>
<div class="line"><span class="lineno"> 1028</span>  <span class="keywordtype">int</span> pos = X509_STORE_CTX_get_error_depth(ctx);</div>
<div class="line"><span class="lineno"> 1029</span>  <span class="keywordtype">size_t</span> len = sk_X509_num(X509_STORE_CTX_get0_chain(ctx));</div>
<div class="line"><span class="lineno"> 1030</span> </div>
<div class="line"><span class="lineno"> 1031</span>  <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;checking cert chain entry %s (preverify: %d skipmode: %d)\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1032</span>             X509_NAME_oneline(X509_get_subject_name(cert), buf, <span class="keyword">sizeof</span>(buf)),</div>
<div class="line"><span class="lineno"> 1033</span>             preverify_ok, skip_mode);</div>
<div class="line"><span class="lineno"> 1034</span> </div>
<div class="line"><span class="lineno"> 1035</span><span class="preprocessor">#ifdef HAVE_SSL_PARTIAL_CHAIN</span></div>
<div class="line"><span class="lineno"> 1036</span>  <span class="comment">/* Sometimes, when a certificate is (s)kipped, OpenSSL will pass it</span></div>
<div class="line"><span class="lineno"> 1037</span><span class="comment">   * a second time with preverify_ok = 1.  Don&#39;t show it or the user</span></div>
<div class="line"><span class="lineno"> 1038</span><span class="comment">   * will think their &quot;s&quot; key is broken.  */</span></div>
<div class="line"><span class="lineno"> 1039</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_partial_chains = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_partial_chains&quot;</span>);</div>
<div class="line"><span class="lineno"> 1040</span>  <span class="keywordflow">if</span> (c_ssl_verify_partial_chains)</div>
<div class="line"><span class="lineno"> 1041</span>  {</div>
<div class="line"><span class="lineno"> 1042</span>    <span class="keyword">static</span> <span class="keywordtype">int</span> last_pos = 0;</div>
<div class="line"><span class="lineno"> 1043</span>    <span class="keyword">static</span> X509 *last_cert = NULL;</div>
<div class="line"><span class="lineno"> 1044</span>    <span class="keywordflow">if</span> (skip_mode &amp;&amp; preverify_ok &amp;&amp; (pos == last_pos) &amp;&amp; last_cert)</div>
<div class="line"><span class="lineno"> 1045</span>    {</div>
<div class="line"><span class="lineno"> 1046</span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> last_cert_md[EVP_MAX_MD_SIZE];</div>
<div class="line"><span class="lineno"> 1047</span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> last_cert_mdlen;</div>
<div class="line"><span class="lineno"> 1048</span>      <span class="keywordflow">if</span> (X509_digest(last_cert, EVP_sha256(), last_cert_md, &amp;last_cert_mdlen) &amp;&amp;</div>
<div class="line"><span class="lineno"> 1049</span>          <a class="code hl_function" href="#a7f6abab1b060f3eb73d6455c90847e39">certificates_equal</a>(cert, last_cert, last_cert_md, last_cert_mdlen))</div>
<div class="line"><span class="lineno"> 1050</span>      {</div>
<div class="line"><span class="lineno"> 1051</span>        <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;ignoring duplicate skipped certificate\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1052</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1053</span>      }</div>
<div class="line"><span class="lineno"> 1054</span>    }</div>
<div class="line"><span class="lineno"> 1055</span> </div>
<div class="line"><span class="lineno"> 1056</span>    last_pos = pos;</div>
<div class="line"><span class="lineno"> 1057</span>    <span class="keywordflow">if</span> (last_cert)</div>
<div class="line"><span class="lineno"> 1058</span>      X509_free(last_cert);</div>
<div class="line"><span class="lineno"> 1059</span>    last_cert = X509_dup(cert);</div>
<div class="line"><span class="lineno"> 1060</span>  }</div>
<div class="line"><span class="lineno"> 1061</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1062</span> </div>
<div class="line"><span class="lineno"> 1063</span>  <span class="comment">/* check session cache first */</span></div>
<div class="line"><span class="lineno"> 1064</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a5f1104e3e22a4015529223f2288398f3">check_certificate_cache</a>(cert))</div>
<div class="line"><span class="lineno"> 1065</span>  {</div>
<div class="line"><span class="lineno"> 1066</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;using cached certificate\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1067</span>    SSL_set_ex_data(ssl, <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div>
<div class="line"><span class="lineno"> 1068</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1069</span>  }</div>
<div class="line"><span class="lineno"> 1070</span> </div>
<div class="line"><span class="lineno"> 1071</span>  <span class="comment">/* check hostname only for the leaf certificate */</span></div>
<div class="line"><span class="lineno"> 1072</span>  buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1073</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_host = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_host&quot;</span>);</div>
<div class="line"><span class="lineno"> 1074</span>  <span class="keywordflow">if</span> ((pos == 0) &amp;&amp; (c_ssl_verify_host != <a class="code hl_enumvalue" href="quad_8h.html#a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b">MUTT_NO</a>))</div>
<div class="line"><span class="lineno"> 1075</span>  {</div>
<div class="line"><span class="lineno"> 1076</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a039081100802f18e9d2fb80b492e61ac">check_host</a>(cert, host, buf, <span class="keyword">sizeof</span>(buf)) == 0)</div>
<div class="line"><span class="lineno"> 1077</span>    {</div>
<div class="line"><span class="lineno"> 1078</span>      <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Certificate host check failed: %s&quot;</span>), buf);</div>
<div class="line"><span class="lineno"> 1079</span>      <span class="comment">/* we disallow (a)ccept always in the prompt, because it will have no effect</span></div>
<div class="line"><span class="lineno"> 1080</span><span class="comment">       * for hostname mismatches. */</span></div>
<div class="line"><span class="lineno"> 1081</span>      <span class="keywordflow">return</span> <a class="code hl_function" href="#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a>(cert, pos, len, ssl, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1082</span>    }</div>
<div class="line"><span class="lineno"> 1083</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;hostname check passed\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1084</span>  }</div>
<div class="line"><span class="lineno"> 1085</span> </div>
<div class="line"><span class="lineno"> 1086</span>  <span class="keywordflow">if</span> (!preverify_ok || skip_mode)</div>
<div class="line"><span class="lineno"> 1087</span>  {</div>
<div class="line"><span class="lineno"> 1088</span>    <span class="comment">/* automatic check from user&#39;s database */</span></div>
<div class="line"><span class="lineno"> 1089</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div>
<div class="line"><span class="lineno"> 1090</span>    <span class="keywordflow">if</span> (c_certificate_file &amp;&amp; <a class="code hl_function" href="#afdbe2b83fcf6173cf72e7f729f230a72">check_certificate_by_digest</a>(cert))</div>
<div class="line"><span class="lineno"> 1091</span>    {</div>
<div class="line"><span class="lineno"> 1092</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;digest check passed\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1093</span>      SSL_set_ex_data(ssl, <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div>
<div class="line"><span class="lineno"> 1094</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1095</span>    }</div>
<div class="line"><span class="lineno"> 1096</span> </div>
<div class="line"><span class="lineno"> 1097</span>    <span class="comment">/* log verification error */</span></div>
<div class="line"><span class="lineno"> 1098</span>    <span class="keywordtype">int</span> err = X509_STORE_CTX_get_error(ctx);</div>
<div class="line"><span class="lineno"> 1099</span>    snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s (%d)&quot;</span>, X509_verify_cert_error_string(err), err);</div>
<div class="line"><span class="lineno"> 1100</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;X509_verify_cert: %s\n&quot;</span>, buf);</div>
<div class="line"><span class="lineno"> 1101</span> </div>
<div class="line"><span class="lineno"> 1102</span>    <span class="comment">/* prompt user */</span></div>
<div class="line"><span class="lineno"> 1103</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a>(cert, pos, len, ssl, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1104</span>  }</div>
<div class="line"><span class="lineno"> 1105</span> </div>
<div class="line"><span class="lineno"> 1106</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1107</span>}</div>
<div class="ttc" id="aopenssl_8c_html_a039081100802f18e9d2fb80b492e61ac"><div class="ttname"><a href="#a039081100802f18e9d2fb80b492e61ac">check_host</a></div><div class="ttdeci">static int check_host(X509 *x509cert, const char *hostname, char *err, size_t errlen)</div><div class="ttdoc">Check the host on the certificate.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00712">openssl.c:712</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a5f1104e3e22a4015529223f2288398f3"><div class="ttname"><a href="#a5f1104e3e22a4015529223f2288398f3">check_certificate_cache</a></div><div class="ttdeci">static bool check_certificate_cache(X509 *peercert)</div><div class="ttdoc">Is the X509 Certificate in the cache?</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00637">openssl.c:637</a></div></div>
<div class="ttc" id="aopenssl_8c_html_ab43c12dc4d5c8504c852b18a43ef0f8a"><div class="ttname"><a href="#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a></div><div class="ttdeci">static int HostExDataIndex</div><div class="ttdoc">index for storing hostname as application specific data in SSL structure</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00085">openssl.c:85</a></div></div>
<div class="ttc" id="aopenssl_8c_html_ae0a15dc5df31b626a42f31bd6a5ea7f4"><div class="ttname"><a href="#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a></div><div class="ttdeci">static bool interactive_check_cert(X509 *cert, int idx, size_t len, SSL *ssl, bool allow_always)</div><div class="ttdoc">Ask the user if a certificate is valid.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00891">openssl.c:891</a></div></div>
<div class="ttc" id="aopenssl_8c_html_afdbe2b83fcf6173cf72e7f729f230a72"><div class="ttname"><a href="#afdbe2b83fcf6173cf72e7f729f230a72">check_certificate_by_digest</a></div><div class="ttdeci">static bool check_certificate_by_digest(X509 *peercert)</div><div class="ttdoc">Validate a certificate by its digest.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00821">openssl.c:821</a></div></div>
</div><!-- fragment --><div id="dynsection-38" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-38-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-38-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-38-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a93e2f01418ccb7300b9864837c0a2719_cgraph.svg" width="534" height="339"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-39" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-39-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-39-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-39-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a93e2f01418ccb7300b9864837c0a2719_icgraph.svg" width="292" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7480af2397359ace6c8741be1e680295" name="a7480af2397359ace6c8741be1e680295"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7480af2397359ace6c8741be1e680295">&#9670;&#160;</a></span>ssl_negotiate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_negotiate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct SslSockData *</td>          <td class="paramname"><span class="paramname"><em>ssldata</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Attempt to negotiate SSL over the wire. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html">Connection</a> to a server </td></tr>
    <tr><td class="paramname">ssldata</td><td>SSL socket data </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error</td></tr>
  </table>
  </dd>
</dl>
<p>After SSL state has been initialized, attempt to negotiate SSL over the wire, including certificate checks. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01119">1119</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1120</span>{</div>
<div class="line"><span class="lineno"> 1121</span>  <span class="keywordtype">int</span> err;</div>
<div class="line"><span class="lineno"> 1122</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *errmsg = NULL;</div>
<div class="line"><span class="lineno"> 1123</span> </div>
<div class="line"><span class="lineno"> 1124</span>  <a class="code hl_variable" href="#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a> = SSL_get_ex_new_index(0, <span class="stringliteral">&quot;host&quot;</span>, NULL, NULL, NULL);</div>
<div class="line"><span class="lineno"> 1125</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a> == -1)</div>
<div class="line"><span class="lineno"> 1126</span>  {</div>
<div class="line"><span class="lineno"> 1127</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;#1 failed to get index for application specific data\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1128</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1129</span>  }</div>
<div class="line"><span class="lineno"> 1130</span> </div>
<div class="line"><span class="lineno"> 1131</span>  <span class="keywordflow">if</span> (!SSL_set_ex_data(ssldata-&gt;ssl, <a class="code hl_variable" href="#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a>, conn-&gt;<a class="code hl_variable" href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">account</a>.<a class="code hl_variable" href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">host</a>))</div>
<div class="line"><span class="lineno"> 1132</span>  {</div>
<div class="line"><span class="lineno"> 1133</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;#2 failed to save hostname in SSL structure\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1134</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1135</span>  }</div>
<div class="line"><span class="lineno"> 1136</span> </div>
<div class="line"><span class="lineno"> 1137</span>  <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a> = SSL_get_ex_new_index(0, <span class="stringliteral">&quot;skip&quot;</span>, NULL, NULL, NULL);</div>
<div class="line"><span class="lineno"> 1138</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a> == -1)</div>
<div class="line"><span class="lineno"> 1139</span>  {</div>
<div class="line"><span class="lineno"> 1140</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;#3 failed to get index for application specific data\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1141</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1142</span>  }</div>
<div class="line"><span class="lineno"> 1143</span> </div>
<div class="line"><span class="lineno"> 1144</span>  <span class="keywordflow">if</span> (!SSL_set_ex_data(ssldata-&gt;ssl, <a class="code hl_variable" href="#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL))</div>
<div class="line"><span class="lineno"> 1145</span>  {</div>
<div class="line"><span class="lineno"> 1146</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;#4 failed to save skip mode in SSL structure\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1147</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1148</span>  }</div>
<div class="line"><span class="lineno"> 1149</span> </div>
<div class="line"><span class="lineno"> 1150</span>  SSL_set_verify(ssldata-&gt;ssl, SSL_VERIFY_PEER, <a class="code hl_function" href="#a93e2f01418ccb7300b9864837c0a2719">ssl_verify_callback</a>);</div>
<div class="line"><span class="lineno"> 1151</span>  SSL_set_mode(ssldata-&gt;ssl, SSL_MODE_AUTO_RETRY);</div>
<div class="line"><span class="lineno"> 1152</span> </div>
<div class="line"><span class="lineno"> 1153</span>  <span class="keywordflow">if</span> (!SSL_set_tlsext_host_name(ssldata-&gt;ssl, conn-&gt;<a class="code hl_variable" href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">account</a>.<a class="code hl_variable" href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">host</a>))</div>
<div class="line"><span class="lineno"> 1154</span>  {</div>
<div class="line"><span class="lineno"> 1155</span>    <span class="comment">/* L10N: This is a warning when trying to set the host name for</span></div>
<div class="line"><span class="lineno"> 1156</span><span class="comment">       TLS Server Name Indication (SNI).  This allows the server to present</span></div>
<div class="line"><span class="lineno"> 1157</span><span class="comment">       the correct certificate if it supports multiple hosts. */</span></div>
<div class="line"><span class="lineno"> 1158</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Warning: unable to set TLS SNI host name&quot;</span>));</div>
<div class="line"><span class="lineno"> 1159</span>  }</div>
<div class="line"><span class="lineno"> 1160</span> </div>
<div class="line"><span class="lineno"> 1161</span>  ERR_clear_error();</div>
<div class="line"><span class="lineno"> 1162</span> </div>
<div class="line"><span class="lineno"> 1163</span>retry:</div>
<div class="line"><span class="lineno"> 1164</span>  err = SSL_connect(ssldata-&gt;ssl);</div>
<div class="line"><span class="lineno"> 1165</span>  <span class="keywordflow">if</span> (err != 1)</div>
<div class="line"><span class="lineno"> 1166</span>  {</div>
<div class="line"><span class="lineno"> 1167</span>    <span class="comment">// Temporary failure, e.g. signal received</span></div>
<div class="line"><span class="lineno"> 1168</span>    <span class="keywordflow">if</span> (BIO_should_retry(SSL_get_rbio(ssldata-&gt;ssl)))</div>
<div class="line"><span class="lineno"> 1169</span>      <span class="keywordflow">goto</span> retry;</div>
<div class="line"><span class="lineno"> 1170</span> </div>
<div class="line"><span class="lineno"> 1171</span>    <span class="keywordflow">switch</span> (SSL_get_error(ssldata-&gt;ssl, err))</div>
<div class="line"><span class="lineno"> 1172</span>    {</div>
<div class="line"><span class="lineno"> 1173</span>      <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div>
<div class="line"><span class="lineno"> 1174</span>        errmsg = <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;I/O error&quot;</span>);</div>
<div class="line"><span class="lineno"> 1175</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1176</span>      <span class="keywordflow">case</span> SSL_ERROR_SSL:</div>
<div class="line"><span class="lineno"> 1177</span>        errmsg = ERR_error_string(ERR_get_error(), NULL);</div>
<div class="line"><span class="lineno"> 1178</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1179</span>      <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno"> 1180</span>        errmsg = <a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;unknown error&quot;</span>);</div>
<div class="line"><span class="lineno"> 1181</span>    }</div>
<div class="line"><span class="lineno"> 1182</span> </div>
<div class="line"><span class="lineno"> 1183</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SSL failed: %s&quot;</span>), errmsg);</div>
<div class="line"><span class="lineno"> 1184</span> </div>
<div class="line"><span class="lineno"> 1185</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1186</span>  }</div>
<div class="line"><span class="lineno"> 1187</span> </div>
<div class="line"><span class="lineno"> 1188</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1189</span>}</div>
<div class="ttc" id="aopenssl_8c_html_a93e2f01418ccb7300b9864837c0a2719"><div class="ttname"><a href="#a93e2f01418ccb7300b9864837c0a2719">ssl_verify_callback</a></div><div class="ttdeci">static int ssl_verify_callback(int preverify_ok, X509_STORE_CTX *ctx)</div><div class="ttdoc">Certificate verification callback.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01003">openssl.c:1003</a></div></div>
</div><!-- fragment --><div id="dynsection-40" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-40-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-40-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-40-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a7480af2397359ace6c8741be1e680295_cgraph.svg" width="292" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-41" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-41-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-41-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-41-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a7480af2397359ace6c8741be1e680295_icgraph.svg" width="239" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aaf61ace510a4bea2797d93f0226dc631" name="aaf61ace510a4bea2797d93f0226dc631"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf61ace510a4bea2797d93f0226dc631">&#9670;&#160;</a></span>sockdata()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct SslSockData * sockdata </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a <a class="el" href="structConnection.html">Connection</a>'s socket data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html">Connection</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Socket data </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01196">1196</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1197</span>{</div>
<div class="line"><span class="lineno"> 1198</span>  <span class="keywordflow">return</span> conn-&gt;<a class="code hl_variable" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a>;</div>
<div class="line"><span class="lineno"> 1199</span>}</div>
<div class="ttc" id="astructConnection_html_a2baa91d494f612c8bf43302bb96543f0"><div class="ttname"><a href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">Connection::sockdata</a></div><div class="ttdeci">void * sockdata</div><div class="ttdoc">Backend-specific socket data.</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00055">connection.h:55</a></div></div>
</div><!-- fragment --><div id="dynsection-42" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-42-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-42-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-42-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aaf61ace510a4bea2797d93f0226dc631_icgraph.svg" width="255" height="254"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5dd67086d5ccb49018781662b104954e" name="a5dd67086d5ccb49018781662b104954e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dd67086d5ccb49018781662b104954e">&#9670;&#160;</a></span>ssl_setup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_setup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set up SSL on the <a class="el" href="structConnection.html">Connection</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html">Connection</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01207">1207</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1208</span>{</div>
<div class="line"><span class="lineno"> 1209</span>  <span class="keywordtype">int</span> maxbits = 0;</div>
<div class="line"><span class="lineno"> 1210</span> </div>
<div class="line"><span class="lineno"> 1211</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a> = <a class="code hl_define" href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a>(1, <span class="keyword">struct</span> SslSockData);</div>
<div class="line"><span class="lineno"> 1212</span> </div>
<div class="line"><span class="lineno"> 1213</span>  <a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx = SSL_CTX_new(SSLv23_client_method());</div>
<div class="line"><span class="lineno"> 1214</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx)</div>
<div class="line"><span class="lineno"> 1215</span>  {</div>
<div class="line"><span class="lineno"> 1216</span>    <span class="comment">/* L10N: an SSL context is a data structure returned by the OpenSSL</span></div>
<div class="line"><span class="lineno"> 1217</span><span class="comment">       function SSL_CTX_new().  In this case it returned NULL: an</span></div>
<div class="line"><span class="lineno"> 1218</span><span class="comment">       error condition.  */</span></div>
<div class="line"><span class="lineno"> 1219</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Unable to create SSL context&quot;</span>));</div>
<div class="line"><span class="lineno"> 1220</span>    <a class="code hl_function" href="#a8f0e82431c3c3b2f63982217cc0e9f50">ssl_dprint_err_stack</a>();</div>
<div class="line"><span class="lineno"> 1221</span>    <span class="keywordflow">goto</span> free_ssldata;</div>
<div class="line"><span class="lineno"> 1222</span>  }</div>
<div class="line"><span class="lineno"> 1223</span> </div>
<div class="line"><span class="lineno"> 1224</span>  <span class="comment">/* disable SSL protocols as needed */</span></div>
<div class="line"><span class="lineno"> 1225</span><span class="preprocessor">#ifdef SSL_OP_NO_TLSv1_3</span></div>
<div class="line"><span class="lineno"> 1226</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1_3 = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1_3&quot;</span>);</div>
<div class="line"><span class="lineno"> 1227</span>  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1_3)</div>
<div class="line"><span class="lineno"> 1228</span>    SSL_CTX_set_options(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1_3);</div>
<div class="line"><span class="lineno"> 1229</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1230</span> </div>
<div class="line"><span class="lineno"> 1231</span><span class="preprocessor">#ifdef SSL_OP_NO_TLSv1_2</span></div>
<div class="line"><span class="lineno"> 1232</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1_2 = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1_2&quot;</span>);</div>
<div class="line"><span class="lineno"> 1233</span>  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1_2)</div>
<div class="line"><span class="lineno"> 1234</span>    SSL_CTX_set_options(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1_2);</div>
<div class="line"><span class="lineno"> 1235</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1236</span> </div>
<div class="line"><span class="lineno"> 1237</span><span class="preprocessor">#ifdef SSL_OP_NO_TLSv1_1</span></div>
<div class="line"><span class="lineno"> 1238</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1_1 = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1_1&quot;</span>);</div>
<div class="line"><span class="lineno"> 1239</span>  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1_1)</div>
<div class="line"><span class="lineno"> 1240</span>    SSL_CTX_set_options(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1_1);</div>
<div class="line"><span class="lineno"> 1241</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1242</span> </div>
<div class="line"><span class="lineno"> 1243</span><span class="preprocessor">#ifdef SSL_OP_NO_TLSv1</span></div>
<div class="line"><span class="lineno"> 1244</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1 = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1&quot;</span>);</div>
<div class="line"><span class="lineno"> 1245</span>  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1)</div>
<div class="line"><span class="lineno"> 1246</span>    SSL_CTX_set_options(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1);</div>
<div class="line"><span class="lineno"> 1247</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1248</span> </div>
<div class="line"><span class="lineno"> 1249</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_sslv3 = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_sslv3&quot;</span>);</div>
<div class="line"><span class="lineno"> 1250</span>  <span class="keywordflow">if</span> (!c_ssl_use_sslv3)</div>
<div class="line"><span class="lineno"> 1251</span>    SSL_CTX_set_options(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_SSLv3);</div>
<div class="line"><span class="lineno"> 1252</span> </div>
<div class="line"><span class="lineno"> 1253</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_sslv2 = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_sslv2&quot;</span>);</div>
<div class="line"><span class="lineno"> 1254</span>  <span class="keywordflow">if</span> (!c_ssl_use_sslv2)</div>
<div class="line"><span class="lineno"> 1255</span>    SSL_CTX_set_options(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_SSLv2);</div>
<div class="line"><span class="lineno"> 1256</span> </div>
<div class="line"><span class="lineno"> 1257</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_system_certs = <a class="code hl_function" href="config_2helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_system_certs&quot;</span>);</div>
<div class="line"><span class="lineno"> 1258</span>  <span class="keywordflow">if</span> (c_ssl_use_system_certs)</div>
<div class="line"><span class="lineno"> 1259</span>  {</div>
<div class="line"><span class="lineno"> 1260</span>    <span class="keywordflow">if</span> (!SSL_CTX_set_default_verify_paths(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx))</div>
<div class="line"><span class="lineno"> 1261</span>    {</div>
<div class="line"><span class="lineno"> 1262</span>      <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;Error setting default verify paths\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1263</span>      <span class="keywordflow">goto</span> free_ctx;</div>
<div class="line"><span class="lineno"> 1264</span>    }</div>
<div class="line"><span class="lineno"> 1265</span>  }</div>
<div class="line"><span class="lineno"> 1266</span> </div>
<div class="line"><span class="lineno"> 1267</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file = <a class="code hl_function" href="config_2helpers_8c.html#a9f184e61342916799259930333f4205f">cs_subset_path</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div>
<div class="line"><span class="lineno"> 1268</span>  <span class="keywordflow">if</span> (c_certificate_file &amp;&amp; !<a class="code hl_function" href="#a86d74c54bdd9ad5c3ff5ae03a0772565">ssl_load_certificates</a>(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx))</div>
<div class="line"><span class="lineno"> 1269</span>    <a class="code hl_define" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code hl_enumvalue" href="logging2_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;Error loading trusted certificates\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1270</span> </div>
<div class="line"><span class="lineno"> 1271</span>  <a class="code hl_function" href="#ad249269819bbf126758110522b538d62">ssl_get_client_cert</a>(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn), conn);</div>
<div class="line"><span class="lineno"> 1272</span> </div>
<div class="line"><span class="lineno"> 1273</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_ssl_ciphers = <a class="code hl_function" href="config_2helpers_8c.html#a6b1589ee93ff51ef31f1d9324e138078">cs_subset_string</a>(<a class="code hl_struct" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code hl_variable" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_ciphers&quot;</span>);</div>
<div class="line"><span class="lineno"> 1274</span>  <span class="keywordflow">if</span> (c_ssl_ciphers)</div>
<div class="line"><span class="lineno"> 1275</span>  {</div>
<div class="line"><span class="lineno"> 1276</span>    SSL_CTX_set_cipher_list(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx, c_ssl_ciphers);</div>
<div class="line"><span class="lineno"> 1277</span>  }</div>
<div class="line"><span class="lineno"> 1278</span> </div>
<div class="line"><span class="lineno"> 1279</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="#ab4a51e4093b93309989ffff46504c241">ssl_set_verify_partial</a>(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx))</div>
<div class="line"><span class="lineno"> 1280</span>  {</div>
<div class="line"><span class="lineno"> 1281</span>    <a class="code hl_define" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code hl_define" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Warning: error enabling ssl_verify_partial_chains&quot;</span>));</div>
<div class="line"><span class="lineno"> 1282</span>  }</div>
<div class="line"><span class="lineno"> 1283</span> </div>
<div class="line"><span class="lineno"> 1284</span>  <a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;ssl = SSL_new(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx);</div>
<div class="line"><span class="lineno"> 1285</span>  SSL_set_fd(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;ssl, conn-&gt;<a class="code hl_variable" href="structConnection.html#af805fad417c8fa7c5079ef741d8233e2">fd</a>);</div>
<div class="line"><span class="lineno"> 1286</span> </div>
<div class="line"><span class="lineno"> 1287</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a7480af2397359ace6c8741be1e680295">ssl_negotiate</a>(conn, <a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)))</div>
<div class="line"><span class="lineno"> 1288</span>    <span class="keywordflow">goto</span> free_ssl;</div>
<div class="line"><span class="lineno"> 1289</span> </div>
<div class="line"><span class="lineno"> 1290</span>  <a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;isopen = 1;</div>
<div class="line"><span class="lineno"> 1291</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a577e30cca37f125532cc73d4cbf51dcb">ssf</a> = SSL_CIPHER_get_bits(SSL_get_current_cipher(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;ssl), &amp;maxbits);</div>
<div class="line"><span class="lineno"> 1292</span> </div>
<div class="line"><span class="lineno"> 1293</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1294</span> </div>
<div class="line"><span class="lineno"> 1295</span>free_ssl:</div>
<div class="line"><span class="lineno"> 1296</span>  SSL_free(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;ssl);</div>
<div class="line"><span class="lineno"> 1297</span>  <a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;ssl = NULL;</div>
<div class="line"><span class="lineno"> 1298</span>free_ctx:</div>
<div class="line"><span class="lineno"> 1299</span>  SSL_CTX_free(<a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx);</div>
<div class="line"><span class="lineno"> 1300</span>  <a class="code hl_function" href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a>(conn)-&gt;sctx = NULL;</div>
<div class="line"><span class="lineno"> 1301</span>free_ssldata:</div>
<div class="line"><span class="lineno"> 1302</span>  <a class="code hl_define" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;conn-&gt;<a class="code hl_variable" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a>);</div>
<div class="line"><span class="lineno"> 1303</span> </div>
<div class="line"><span class="lineno"> 1304</span>  <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1305</span>}</div>
<div class="ttc" id="aconfig_2helpers_8c_html_a6b1589ee93ff51ef31f1d9324e138078"><div class="ttname"><a href="config_2helpers_8c.html#a6b1589ee93ff51ef31f1d9324e138078">cs_subset_string</a></div><div class="ttdeci">const char * cs_subset_string(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a string config item by name.</div><div class="ttdef"><b>Definition</b> <a href="config_2helpers_8c_source.html#l00291">helpers.c:291</a></div></div>
<div class="ttc" id="amemory_8h_html_a9aaf8f21a29735767a069ff1aee9d7d9"><div class="ttname"><a href="memory_8h.html#a9aaf8f21a29735767a069ff1aee9d7d9">MUTT_MEM_CALLOC</a></div><div class="ttdeci">#define MUTT_MEM_CALLOC(n, type)</div><div class="ttdef"><b>Definition</b> <a href="memory_8h_source.html#l00047">memory.h:47</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a7480af2397359ace6c8741be1e680295"><div class="ttname"><a href="#a7480af2397359ace6c8741be1e680295">ssl_negotiate</a></div><div class="ttdeci">static int ssl_negotiate(struct Connection *conn, struct SslSockData *ssldata)</div><div class="ttdoc">Attempt to negotiate SSL over the wire.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01119">openssl.c:1119</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a86d74c54bdd9ad5c3ff5ae03a0772565"><div class="ttname"><a href="#a86d74c54bdd9ad5c3ff5ae03a0772565">ssl_load_certificates</a></div><div class="ttdeci">static bool ssl_load_certificates(SSL_CTX *ctx)</div><div class="ttdoc">Load certificates and filter out the expired ones.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00119">openssl.c:119</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a8f0e82431c3c3b2f63982217cc0e9f50"><div class="ttname"><a href="#a8f0e82431c3c3b2f63982217cc0e9f50">ssl_dprint_err_stack</a></div><div class="ttdeci">static void ssl_dprint_err_stack(void)</div><div class="ttdoc">Dump the SSL error stack.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00308">openssl.c:308</a></div></div>
<div class="ttc" id="aopenssl_8c_html_aaf61ace510a4bea2797d93f0226dc631"><div class="ttname"><a href="#aaf61ace510a4bea2797d93f0226dc631">sockdata</a></div><div class="ttdeci">static struct SslSockData * sockdata(struct Connection *conn)</div><div class="ttdoc">Get a Connection&#39;s socket data.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01196">openssl.c:1196</a></div></div>
<div class="ttc" id="aopenssl_8c_html_ab4a51e4093b93309989ffff46504c241"><div class="ttname"><a href="#ab4a51e4093b93309989ffff46504c241">ssl_set_verify_partial</a></div><div class="ttdeci">static bool ssl_set_verify_partial(SSL_CTX *ctx)</div><div class="ttdoc">Allow verification using partial chains (with no root)</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00168">openssl.c:168</a></div></div>
<div class="ttc" id="aopenssl_8c_html_ad249269819bbf126758110522b538d62"><div class="ttname"><a href="#ad249269819bbf126758110522b538d62">ssl_get_client_cert</a></div><div class="ttdeci">static void ssl_get_client_cert(struct SslSockData *ssldata, struct Connection *conn)</div><div class="ttdoc">Get the client certificate for an SSL connection.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00605">openssl.c:605</a></div></div>
<div class="ttc" id="astructConnection_html_a577e30cca37f125532cc73d4cbf51dcb"><div class="ttname"><a href="structConnection.html#a577e30cca37f125532cc73d4cbf51dcb">Connection::ssf</a></div><div class="ttdeci">unsigned int ssf</div><div class="ttdoc">Security strength factor, in bits (see notes)</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00050">connection.h:50</a></div></div>
<div class="ttc" id="astructConnection_html_af805fad417c8fa7c5079ef741d8233e2"><div class="ttname"><a href="structConnection.html#af805fad417c8fa7c5079ef741d8233e2">Connection::fd</a></div><div class="ttdeci">int fd</div><div class="ttdoc">Socket file descriptor.</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00053">connection.h:53</a></div></div>
</div><!-- fragment --><div id="dynsection-43" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-43-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-43-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-43-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5dd67086d5ccb49018781662b104954e_cgraph.svg" width="447" height="446"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-44" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-44-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-44-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-44-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5dd67086d5ccb49018781662b104954e_icgraph.svg" width="258" height="94"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a23591e82bf992ceb5e62c459fd787b8a" name="a23591e82bf992ceb5e62c459fd787b8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23591e82bf992ceb5e62c459fd787b8a">&#9670;&#160;</a></span>mutt_ssl_starttls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mutt_ssl_starttls </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Negotiate TLS over an already opened connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html">Connection</a> to a server </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01424">1424</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1425</span>{</div>
<div class="line"><span class="lineno"> 1426</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac2e20046425bd97175be33f596af1511">ssl_init</a>())</div>
<div class="line"><span class="lineno"> 1427</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1428</span> </div>
<div class="line"><span class="lineno"> 1429</span>  <span class="keywordtype">int</span> rc = <a class="code hl_function" href="#a5dd67086d5ccb49018781662b104954e">ssl_setup</a>(conn);</div>
<div class="line"><span class="lineno"> 1430</span> </div>
<div class="line"><span class="lineno"> 1431</span>  <span class="comment">/* hmm. watch out if we&#39;re starting TLS over any method other than raw. */</span></div>
<div class="line"><span class="lineno"> 1432</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#afdd852b383b3926639ec9132c048590a">read</a> = <a class="code hl_function" href="group__connection__read.html#ga61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a>;</div>
<div class="line"><span class="lineno"> 1433</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">write</a> = <a class="code hl_function" href="group__connection__write.html#ga40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a>;</div>
<div class="line"><span class="lineno"> 1434</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">close</a> = <a class="code hl_function" href="group__connection__close.html#ga580181fa12ad95a66805761f701e7cd2">ssl_socket_close_and_restore</a>;</div>
<div class="line"><span class="lineno"> 1435</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">poll</a> = <a class="code hl_function" href="group__connection__poll.html#ga30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a>;</div>
<div class="line"><span class="lineno"> 1436</span> </div>
<div class="line"><span class="lineno"> 1437</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno"> 1438</span>}</div>
<div class="ttc" id="agroup__connection__close_html_ga580181fa12ad95a66805761f701e7cd2"><div class="ttname"><a href="group__connection__close.html#ga580181fa12ad95a66805761f701e7cd2">ssl_socket_close_and_restore</a></div><div class="ttdeci">static int ssl_socket_close_and_restore(struct Connection *conn)</div><div class="ttdoc">Close an SSL Connection and restore Connection callbacks - Implements Connection::close() -.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00621">openssl.c:621</a></div></div>
<div class="ttc" id="agroup__connection__poll_html_ga30f5a89c44c5daba9413290a83abdd9c"><div class="ttname"><a href="group__connection__poll.html#ga30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a></div><div class="ttdeci">static int ssl_socket_poll(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Check if any data is waiting on a socket - Implements Connection::poll() -.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01310">openssl.c:1310</a></div></div>
<div class="ttc" id="agroup__connection__read_html_ga61b00cd8dc0e66e258ab0d7d9286113e"><div class="ttname"><a href="group__connection__read.html#ga61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a></div><div class="ttdeci">static int ssl_socket_read(struct Connection *conn, char *buf, size_t count)</div><div class="ttdoc">Read data from an SSL socket - Implements Connection::read() -.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01339">openssl.c:1339</a></div></div>
<div class="ttc" id="agroup__connection__write_html_ga40b2b0f0a706d96487919a4b0489026a"><div class="ttname"><a href="group__connection__write.html#ga40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a></div><div class="ttdeci">static int ssl_socket_write(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdoc">Write data to an SSL socket - Implements Connection::write() -.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01368">openssl.c:1368</a></div></div>
<div class="ttc" id="aopenssl_8c_html_a5dd67086d5ccb49018781662b104954e"><div class="ttname"><a href="#a5dd67086d5ccb49018781662b104954e">ssl_setup</a></div><div class="ttdeci">static int ssl_setup(struct Connection *conn)</div><div class="ttdoc">Set up SSL on the Connection.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01207">openssl.c:1207</a></div></div>
<div class="ttc" id="aopenssl_8c_html_ac2e20046425bd97175be33f596af1511"><div class="ttname"><a href="#ac2e20046425bd97175be33f596af1511">ssl_init</a></div><div class="ttdeci">static int ssl_init(void)</div><div class="ttdoc">Initialise the SSL library.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00552">openssl.c:552</a></div></div>
<div class="ttc" id="astructConnection_html_a2fcded23739f26da564cdb378c8b0a4f"><div class="ttname"><a href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">Connection::poll</a></div><div class="ttdeci">int(* poll)(struct Connection *conn, time_t wait_secs)</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00105">connection.h:105</a></div></div>
<div class="ttc" id="astructConnection_html_a3b376a9471b5c0ecf43968239bf8c2db"><div class="ttname"><a href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">Connection::write</a></div><div class="ttdeci">int(* write)(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00092">connection.h:92</a></div></div>
<div class="ttc" id="astructConnection_html_a7a40be1f125477cf01ced6817be10bbc"><div class="ttname"><a href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">Connection::close</a></div><div class="ttdeci">int(* close)(struct Connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00116">connection.h:116</a></div></div>
<div class="ttc" id="astructConnection_html_afdd852b383b3926639ec9132c048590a"><div class="ttname"><a href="structConnection.html#afdd852b383b3926639ec9132c048590a">Connection::read</a></div><div class="ttdeci">int(* read)(struct Connection *conn, char *buf, size_t count)</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00079">connection.h:79</a></div></div>
</div><!-- fragment --><div id="dynsection-45" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-45-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-45-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-45-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a23591e82bf992ceb5e62c459fd787b8a_cgraph.svg" width="328" height="326"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae6341b74ebed0751e68285e6bf379fab" name="ae6341b74ebed0751e68285e6bf379fab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6341b74ebed0751e68285e6bf379fab">&#9670;&#160;</a></span>mutt_ssl_socket_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mutt_ssl_socket_setup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *</td>          <td class="paramname"><span class="paramname"><em>conn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up SSL socket mulitplexor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html">Connection</a> to a server </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01446">1446</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1447</span>{</div>
<div class="line"><span class="lineno"> 1448</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#ac2e20046425bd97175be33f596af1511">ssl_init</a>() &lt; 0)</div>
<div class="line"><span class="lineno"> 1449</span>  {</div>
<div class="line"><span class="lineno"> 1450</span>    conn-&gt;<a class="code hl_variable" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">open</a> = <a class="code hl_function" href="group__connection__open.html#ga6c36f9660a30f073893f32139a8bfa04">ssl_socket_open_err</a>;</div>
<div class="line"><span class="lineno"> 1451</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1452</span>  }</div>
<div class="line"><span class="lineno"> 1453</span> </div>
<div class="line"><span class="lineno"> 1454</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">open</a> = <a class="code hl_function" href="group__connection__open.html#gaee6856c134462c191da6659c8b469145">ssl_socket_open</a>;</div>
<div class="line"><span class="lineno"> 1455</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#afdd852b383b3926639ec9132c048590a">read</a> = <a class="code hl_function" href="group__connection__read.html#ga61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a>;</div>
<div class="line"><span class="lineno"> 1456</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">write</a> = <a class="code hl_function" href="group__connection__write.html#ga40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a>;</div>
<div class="line"><span class="lineno"> 1457</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">poll</a> = <a class="code hl_function" href="group__connection__poll.html#ga30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a>;</div>
<div class="line"><span class="lineno"> 1458</span>  conn-&gt;<a class="code hl_variable" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">close</a> = <a class="code hl_function" href="group__connection__close.html#gaafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a>;</div>
<div class="line"><span class="lineno"> 1459</span> </div>
<div class="line"><span class="lineno"> 1460</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1461</span>}</div>
<div class="ttc" id="agroup__connection__close_html_gaafcc34fa7bf9d54a9323c36761353e6a"><div class="ttname"><a href="group__connection__close.html#gaafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a></div><div class="ttdeci">static int ssl_socket_close(struct Connection *conn)</div><div class="ttdoc">Close an SSL connection - Implements Connection::close() -.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01399">openssl.c:1399</a></div></div>
<div class="ttc" id="agroup__connection__open_html_ga6c36f9660a30f073893f32139a8bfa04"><div class="ttname"><a href="group__connection__open.html#ga6c36f9660a30f073893f32139a8bfa04">ssl_socket_open_err</a></div><div class="ttdeci">static int ssl_socket_open_err(struct Connection *conn)</div><div class="ttdoc">Error callback for opening an SSL connection - Implements Connection::open() -.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l00356">openssl.c:356</a></div></div>
<div class="ttc" id="agroup__connection__open_html_gaee6856c134462c191da6659c8b469145"><div class="ttname"><a href="group__connection__open.html#gaee6856c134462c191da6659c8b469145">ssl_socket_open</a></div><div class="ttdeci">static int ssl_socket_open(struct Connection *conn)</div><div class="ttdoc">Open an SSL socket - Implements Connection::open() -.</div><div class="ttdef"><b>Definition</b> <a href="openssl_8c_source.html#l01324">openssl.c:1324</a></div></div>
<div class="ttc" id="astructConnection_html_ad015a1227002b6ae42d5ad0d3add33d2"><div class="ttname"><a href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">Connection::open</a></div><div class="ttdeci">int(* open)(struct Connection *conn)</div><div class="ttdef"><b>Definition</b> <a href="connection_8h_source.html#l00066">connection.h:66</a></div></div>
</div><!-- fragment --><div id="dynsection-46" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-46-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-46-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-46-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae6341b74ebed0751e68285e6bf379fab_cgraph.svg" width="364" height="360"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab43c12dc4d5c8504c852b18a43ef0f8a" name="ab43c12dc4d5c8504c852b18a43ef0f8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab43c12dc4d5c8504c852b18a43ef0f8a">&#9670;&#160;</a></span>HostExDataIndex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int HostExDataIndex = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>index for storing hostname as application specific data in SSL structure </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00085">85</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>

</div>
</div>
<a id="af84a999f737b3cc63228cecc117a5d87" name="af84a999f737b3cc63228cecc117a5d87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af84a999f737b3cc63228cecc117a5d87">&#9670;&#160;</a></span>SkipModeExDataIndex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int SkipModeExDataIndex = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Index for storing the "skip mode" state in SSL structure. </p>
<p>When the user skips a certificate in the chain, the stored value will be non-null. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00089">89</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
